<?xml version="1.0"?>
<command xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xsi:type="AuditHostScriptCommand" id="urn:uuid:1b2698b9-f6ea-44b6-bf7b-a405aafac437">
  <input>
    <type>application/vnd.mandiant.host+xml</type>
  </input>
  <result>
    <type>application/vnd.mandiant.auditresult+xml</type>
  </result>
  <script id="urn:uuid:1b2698b9-f6ea-44b6-bf7b-a405aafac437" chaining="implicit">
    <commands>
      <command xsi:type="ExecuteModuleCommand" id="urn:uuid:c781c7d8-d99e-45a2-bfa1-918dfee1837f">
        <module name="w32scripting-persistence" version="1.4.0.0" />
        <config xsi:type="ParameterListModuleConfig">
          <parameters>
            <param name="Prevent Hibernation">
              <value xsi:type="xsd:boolean">false</value>
            </param>
            <param name="Preserve Times">
              <value xsi:type="xsd:boolean">true</value>
            </param>
            <param name="MD5">
              <value xsi:type="xsd:boolean">true</value>
            </param>
            <param name="SHA1">
              <value xsi:type="xsd:boolean">false</value>
            </param>
            <param name="SHA256">
              <value xsi:type="xsd:boolean">false</value>
            </param>
            <param name="Analyze Entropy">
              <value xsi:type="xsd:boolean">false</value>
            </param>
            <param name="Analyze Imports">
              <value xsi:type="xsd:boolean">false</value>
            </param>
            <param name="Analyze Exports">
              <value xsi:type="xsd:boolean">false</value>
            </param>
            <param name="Analyze File Anomalies">
              <value xsi:type="xsd:boolean">false</value>
            </param>
            <param name="Scan Entry Point Distance">
              <value xsi:type="xsd:int">0</value>
            </param>
            <param name="Verify Digital Signatures">
              <value xsi:type="xsd:boolean">true</value>
            </param>
            <param name="Get Resources">
              <value xsi:type="xsd:boolean">false</value>
            </param>
            <param name="Get Version Info">
              <value xsi:type="xsd:boolean">false</value>
            </param>
            <param name="lua_script">
              <value xsi:type="xsd:string">LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQotLQotLSBNSVIgQWdlbnQgTHVhIC0gQXBwY29tcGF0IE1vZHVsZQotLQotLSBOYW1lOiAgICBhcHBjb21wYXQubHVhCi0tIFRpdGxlOiAgIEFwcENvbXBhdCBMdWEgQXVkaXQKLS0gQXV0aG9yOiAgRnJlZCBIb3VzZSA8ZnJlZC5ob3VzZUBtYW5kaWFudC5jb20+Ci0tIE1ldGhvZDogIEFQSQotLSBQdXJwb3NlOiBUaGlzIHNjcmlwdCBwYXJzZXMgdGhlIEFwcENvbXBhdCBXaW5kb3dzIFJlZ2lzdHJ5IGtleQotLSAgICAgICAgICBvbiBXaW5kb3dzIFhQIHRocm91Z2ggV2luZG93cyAxMC4gT3B0aW9uYWxseSwgZmlsZSBtZXRhCi0tICAgICAgICAgIGRhdGEgY2FuIGFsc28gYmUgZ2F0aGVyZWQgZm9yIGVudHJpZXMgdGhhdCBleGlzdCBvbiBkaXNrLgotLSAgICAgICAgICBTY3JpcHQgYWxsIHN1cHBvcnRzIGVudW1lcmF0aW5nIGFsbCBjb250cm9sIHNldHMuCi0tCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQotLQotLSBNSVIgQWdlbnQgTHVhIC0gU3RhbmRhcmQgbGlicmFyeSBtb2R1bGUKLS0KLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpzdGRsaWIgPSB7fQoKLS0tCi0tIHN0ZGxpYi5TRUVLX0JFR0lOCi0tIFRvIGJlIHVzZWQgd2l0aCBmaWxlLkZpbGVTZWVrWFhYKCksIHdoaWNoIGFjY2VwdHMgYSB0aGlyZCBwYXJhbWV0ZXIKLS0gZm9yIHRoZSBkaXJlY3Rpb24gdG8gc2Vlay4gIFRoaXMgY29uc3RhbnQgc2Vla3MgZnJvbSB0aGUgc3RhcnQgb2YKLS0gdGhlIGZpbGUuCnN0ZGxpYi5TRUVLX0JFR0lOID0gMAotLS0KLS0gc3RkbGliLlNFRUtfQ1VSUkVOVAotLSBUbyBiZSB1c2VkIHdpdGggZmlsZS5GaWxlU2Vla1hYWCgpLCB3aGljaCBhY2NlcHRzIGEgdGhpcmQgcGFyYW1ldGVyCi0tIGZvciB0aGUgZGlyZWN0aW9uIHRvIHNlZWsuICBUaGlzIGNvbnN0YW50IHNlZWtzIGZyb20gdGhlIGN1cnJlbnQgb2YKLS0gdGhlIGZpbGUuCnN0ZGxpYi5TRUVLX0NVUlJFTlQgPSAxCi0tLQotLSBzdGRsaWIuU0VFS19FTkQKLS0gVG8gYmUgdXNlZCB3aXRoIGZpbGUuRmlsZVNlZWtYWFgoKSwgd2hpY2ggYWNjZXB0cyBhIHRoaXJkIHBhcmFtZXRlcgotLSBmb3IgdGhlIGRpcmVjdGlvbiB0byBzZWVrLiAgVGhpcyBjb25zdGFudCBzZWVrcyBmcm9tIHRoZSBlbmQKLS0gbG9jYXRpb24gb2YgdGhlIGZpbGUgcG9pbnRlci4Kc3RkbGliLlNFRUtfRU5EID0gMgoKLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQotLSAgIEVSUk9SIEhBTkRMSU5HCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLS0tCi0tIEVycm9ycyBhcmUgY29uc3RhbnRzLiAgUHJldGVuZCB0aGV5IGFyZSBvcGFxdWUuIERvIG5vdCByZWx5IHVwb24gdGhlCi0tIHN0cmluZyB2YWx1ZSBnaXZlbiBoZXJlLiAgVXNlIHN0ZGxpYi5lcnJvcl9pcyB0byB0ZXN0IGVycm9yIG1lc3NhZ2VzCi0tIGFnYWluc3QgdGhlc2UgY29uc3RhbnRzLgpzdGRsaWIuZXJyb3JzID0ge30Kc3RkbGliLmVycm9ycy5GYWlsZWRUb09wZW5GU1BhdGhFcnJvciA9ICJVbmFibGUgdG8gb3BlbiBmaWxlc3lzdGVtIHBhdGguIgpzdGRsaWIuZXJyb3JzLlVuYWJsZVRvUmVhZFJhd0ZpbGVNZXRhZGF0YSA9ICJVbmFibGUgdG8gZ2V0IGZpbGUgbWV0YWRhdGEgaW4gcmF3IG1vZGUiCnN0ZGxpYi5lcnJvcnMuRmFpbGVkVG9PcGVuUmVnUGF0aEVycm9yID0gIlVuYWJsZSB0byBvcGVuIFJlZ2lzdHJ5IHBhdGguIgpzdGRsaWIuZXJyb3JzLkNhbm5vdFJlYWREaXJlY3RvcnlBc0ZpbGVFcnJvciA9ICJVbmFibGUgdG8gb3BlbiBkaXJlY3RvcnkgYXMgYSBmaWxlLiIKc3RkbGliLmVycm9ycy5VbmFibGVUb1JlYWRGaWxlRXJyb3IgPSAiVW5hYmxlIHRvIHJlYWQgdGhlIGZpbGUgcG9pbnRlci4iCnN0ZGxpYi5lcnJvcnMuVW5hYmxlVG9PcGVuRmlsZUVycm9yID0gIlVuYWJsZSB0byBvcGVuIHRoZSBmaWxlIHNwZWNpZmllZC4iCnN0ZGxpYi5lcnJvcnMuVW5hYmxlVG9TZWVrRmlsZUVycm9yID0gIlVuYWJsZSB0byBzZWVrIHRoZSBmaWxlIHBvaW50ZXIuIgpzdGRsaWIuZXJyb3JzLkludmFsaWRGaWxlT2Zmc2V0RXJyb3IgPSAiUHJvdmlkZWQgZmlsZSBvZmZzZXQgaXMgbm90IHZhbGlkLiIKc3RkbGliLmVycm9ycy5JbnZhbGlkQXJndW1lbnRFcnJvciA9ICJJbnZhbGlkIGFyZ3VtZW50cyBwcm92aWRlZCB0byBmdW5jdGlvbi4iCgotLS0KLS0gdHJ5KCkKLS0gVGhpcyBmdW5jdGlvbiBpcyBzeW50YWN0aWMgc3VnYXIgb3ZlciBMdWEncyBwY2FsbCgpIGZ1bmN0aW9uLgotLSBHaXZlbiBhIGZ1bmN0aW9uIGYsIGNhbGwgdGhlIGZ1bmN0aW9uIGluIHByb3RlY3RlZCBtb2RlLiBJZiBhbnkKLS0gZXJyb3JzIGFyZSBzaWduYWxsZWQsIGNhbGwgdGhlIGZ1bmN0aW9uIGNhdGNoIHdpdGggdGhlIGVycm9yIG1lc3NhZ2UuCi0tIEluIGFueSBjYXNlLCBjYWxsIHRoZSBmdW5jdGlvbiBmaW5hbGx5LgotLSBBbGwgc2lnbmFsbGVkIGVycm9ycyB3aWxsIGJlIGNhdWdodCBpbiB0aGUgY2FsbCB0byBmLCBzbyB5b3UgbXVzdAotLSBleHBsaWNpdGx5IHVuaGFuZGxlZCBlcnJvcnMuICBObyBndWFyYW50ZWUgaXMgbWFkZSBvbiBhIGNhbGwgdG8KLS0gZmluYWxseSBpZiBhbiBlcnJvciBpcyBzaWduYWxsZWQgaW4gY2F0Y2guCi0tIE5vdGUsIGNhbGxpbmcgcmV0dXJuIGZyb20gd2l0aGluIHRoZSBmLCBjYXRjaCwgb3IgZmluYWxseSBmdW5jdGlvbnMKLS0gcmV0dXJucyBmcm9tIHRoYXQgZnVuY3Rpb24sIE5PVCB0aGUgb3V0ZXIgc2NvcGUuCi0tIEBwYXJhbSBmIEEgZnVuY3Rpb24gd2l0aCBubyBwYXJhbWV0ZXJzLgotLSBAcGFyYW0gY2F0Y2ggQSBmdW5jdGlvbiB3aXRoIG9uZSBwYXJhbWV0ZXI6IHRoZSBlcnJvciBtZXNzYWdlLiBVc2UKLS0gICAgc3RkbGliLmVycm9yX2lzKG1lc3NhZ2UsIGNvbnN0YW50KSB0byB0ZXN0IHRoZSBlcnJvciB0eXBlLgotLSBAcGFyYW0gZmluYWxseSBBIGZ1bmN0aW9uIHdpdGggbm8gcGFyYW1ldGVycy4KLS0gQHJldHVybiBuaWwKZnVuY3Rpb24gc3RkbGliLnRyeShmLCBjYXRjaCwgZmluYWxseSkKICAgaWYgZiB0aGVuCiAgICAgIGxvY2FsIHN0YXR1cywgcmV0ID0gcGNhbGwoZikKICAgICAgaWYgbm90IHN0YXR1cyB0aGVuCiAgICAgICAgIGlmIGNhdGNoIHRoZW4KICAgICAgICAgICAgY2F0Y2gocmV0KQogICAgICAgICBlbmQKICAgICAgZW5kCiAgIGVuZAoKICAgaWYgZmluYWxseSB0aGVuCiAgICAgIGZpbmFsbHkoKQogICBlbmQKICAgcmV0dXJuIG5pbAplbmQKCi0tLQotLSBlcnJvcl9pcygpCi0tIEdpdmVuIGFuIGVycm9yIG1lc3NhZ2UgcHJvdmlkZWQgdG8gdGhlIGNhdGNoKCkgZnVuY3Rpb24gaW4gdHJ5KCksCi0tIHRlc3QgdG8gc2VlIGlmIGl0IGlzIGFuIGluc3RhbmNlIG9mIHRoZSBnaXZlbiBlcnJvciBjb25zdGFudCAoc3RkbGliLmVycm9ycy4qKQotLSBAcGFyYW0gbXNnIFRoZSBlcnJvciBtZXNzYWdlIHByb3ZpZGVkIGJ5IHRyeSgpIHRvIGEgY2F0Y2gobXNnKSBmdW5jdGlvbi4KLS0gQHBhcmFtIHRlc3QgVGhlIGVycm9yIGNvbnN0YW50LCBmcm9tIHN0ZGxpYi5lcnJvcnMuKgpmdW5jdGlvbiBzdGRsaWIuZXJyb3JfaXMobXNnLCB0ZXN0KQogICByZXR1cm4gc3RyaW5nLmZpbmQobXNnLCB0ZXN0LCAxLCBUcnVlKSB+PSBuaWwKZW5kCgotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi0tICAgTElTVCBNQU5JUFVMQVRJT04KLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQotLS0KLS0gdGFibGVfc2l6ZQotLSBAcGFyYW0gdCBBIFRhYmxlLgotLSBAcmV0dXJuIFNpbXBseSB0aGUgbnVtYmVyIG9mIGVsZW1lbnRzIGluIHRoZSB0YWJsZQpzdGRsaWIudGFibGVfc2l6ZSA9IGZ1bmN0aW9uKHQpCiAgICBsb2NhbCBjb3VudCA9IDAKICAgIGZvciBfLCBfXyBpbiBwYWlycyh0KSBkbwogICAgICAgIGNvdW50ID0gY291bnQgKyAxCiAgICBlbmQKICAgIHJldHVybiBjb3VudAplbmQKCi0tLQotLSB0YWJsZV9jb3B5Ci0tIEBwYXJhbSB0IEEgVGFibGUuCi0tIEByZXR1cm4gQSBuZXcgdGFibGUgd2l0aCB0aGUgc2FtZSBlbnRyaWVzIGFzIHRoZSBwcm92aWRlZCB0YWJsZS4Kc3RkbGliLnRhYmxlX2NvcHkgPSBmdW5jdGlvbih0KQogICAgbG9jYWwgdSA9IHsgfQogICAgZm9yIGssIHYgaW4gcGFpcnModCkgZG8gdVtrXSA9IHYgZW5kCiAgICByZXR1cm4gc2V0bWV0YXRhYmxlKHUsIGdldG1ldGF0YWJsZSh0KSkKZW5kCgotLS0KLS0gY2hhaW5fcGFpcnMKLS0gQHBhcmFtIC4uLiBBIHZhcmlhYmxlIG51bWJlciBvZiB0YWJsZXMuCi0tIEByZXR1cm4gQSBnZW5lcmF0b3IgdGhhdCByZXR1cm5zIGVhY2ggb2YgdGhlIHJlc3VsdHMgb2YgcGFpcnMoKSBhcHBsaWVkIHRvIHRoZSBhcmd1bWVudHMKLS0gICAgYXMgYSB0YWJsZSB7a2V5LCB2YWx1ZX0uICBUaGlzIGlzIHVuZm9ydHVuYXRlIHRoZSBjb3JvdXRpbmVzIGNhbiBvbmx5IHJldHVybiBhIHNpbmdsZSB2YWx1ZS4Kc3RkbGliLmNoYWluX3BhaXJzID0gZnVuY3Rpb24oLi4uKQogICAgbG9jYWwgYXJncyA9IHtuPXNlbGVjdCgnIycsIC4uLiksIC4uLn0KICAgIGxvY2FsIGNvID0gY29yb3V0aW5lLmNyZWF0ZShmdW5jdGlvbiAoKQogICAgICAgIGZvciB6ID0gMSwgYXJncy5uIGRvCiAgICAgICAgICAgIGFyZyA9IGFyZ3Nbel0KICAgICAgICAgICAgZm9yIGksIGogaW4gcGFpcnMoYXJnKSBkbwogICAgICAgICAgICAgICAgY29yb3V0aW5lLnlpZWxkKHtpLCBqfSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQpCgogICAgcmV0dXJuIGZ1bmN0aW9uICgpCiAgICAgICAgd2hpbGUgdHJ1ZSBkbwogICAgICAgICAgICBsb2NhbCBjb250LCByZXQgPSBjb3JvdXRpbmUucmVzdW1lKGNvKQogICAgICAgICAgICBpZiBub3QgY29udCB0aGVuIHJldHVybiBuaWwgZW5kCiAgICAgICAgICAgIHJldHVybiByZXQKICAgICAgICBlbmQKICAgIGVuZAplbmQKCmZ1bmN0aW9uIHN0ZGxpYi5MaXN0KHQpCiAgIGxvY2FsIHNlbGYgPSB7fQogICBsb2NhbCBtdCA9IHt9CiAgIG10Ll9fdHlwZSA9ICJMaXN0IgogICBzZXRtZXRhdGFibGUoc2VsZiwgbXQpCgogICBmdW5jdGlvbiBtdC5fX3Rvc3RyaW5nKHQpCiAgICAgICByZXR1cm4gIkxpc3QobGVuZ3RoPSIuLnNlbGYuc2l6ZSgpLi4iKSIKICAgZW5kCgogICBzZWxmLl9saXN0ID0ge30KICAgaWYgdCB0aGVuCiAgICAgIGxvY2FsIHRtdCA9IGdldG1ldGF0YWJsZSh0KQogICAgICBpZiB0bXQgYW5kIHRtdC5fX3R5cGUgPT0gbXQuX190eXBlIHRoZW4KICAgICAgICAgZm9yIHYgaW4gdC5lYWNoKCkgZG8KICAgICAgICAgICAgdGFibGUuaW5zZXJ0KHNlbGYuX2xpc3QsIHYpCiAgICAgICAgIGVuZAogICAgICBlbHNlCiAgICAgICAgIGZvciBrLCB2IGluIHBhaXJzKHQpIGRvCiAgICAgICAgICAgIHRhYmxlLmluc2VydChzZWxmLl9saXN0LCB2KQogICAgICAgICBlbmQKICAgICAgZW5kCiAgIGVuZAoKICAgLS0tCiAgIC0tIHNpemUoKQogICAtLSBSZXR1cm4gdGhlIG51bWJlciBvZiBlbGVtZW50cyBpbiB0aGUgbGlzdAogICBzZWxmLnNpemUgPSBmdW5jdGlvbigpCiAgICAgIHJldHVybiB0YWJsZS5nZXRuKHNlbGYuX2xpc3QpCiAgIGVuZAoKICAgLS0tCiAgIC0tIGluZGV4KCkKICAgLS0gQHJldHVybiBUaGUgaXRlbSBhdCB0aGUgZ2l2ZW4gaW5kZXgsIDEtaW5kZXhlZC4KICAgc2VsZi5pbmRleCA9IGZ1bmN0aW9uKGtleSkKICAgICAgcmV0dXJuIHNlbGYuX2xpc3Rba2V5XQogICBlbmQKCiAgIC0tLQogICAtLSBleHRlbmQoKQogICAtLSBBZGQgZWFjaCBvZiB0aGUgZWxlbWVudHMgaW4gdGhlIGxpc3QgdCB0byB0aGUKICAgLS0gZW5kIG9mIHRoaXMgbGlzdC4KICAgc2VsZi5leHRlbmQgPSBmdW5jdGlvbiAodCkKICAgICAgaWYgbm90IHQgdGhlbiByZXR1cm4gc2VsZiBlbmQKCiAgICAgIGxvY2FsIHRtdCA9IGdldG1ldGF0YWJsZSh0KQogICAgICBpZiB0bXQgYW5kIHRtdC5fX3R5cGUgPT0gbXQuX190eXBlIHRoZW4KICAgICAgICAgZm9yIHYgaW4gdC5lYWNoKCkgZG8KICAgICAgICAgICAgdGFibGUuaW5zZXJ0KHNlbGYuX2xpc3QsIHYpCiAgICAgICAgIGVuZAogICAgICBlbHNlCiAgICAgICAgIGZvciBrLCB2IGluIGlwYWlycyh0KSBkbwogICAgICAgICAgICB0YWJsZS5pbnNlcnQoc2VsZi5fbGlzdCwgdikKICAgICAgICAgZW5kCiAgICAgIGVuZAogICAgICByZXR1cm4gc2VsZgogICBlbmQKCiAgIC0tLQogICAtLSBhcHBlbmQoKQogICAtLSBBZGQgdGhlIGdpdmVuIGVsZW1lbnQgdG8gdGhlIGVuZCBvZiB0aGUgbGlzdAogICBzZWxmLmFwcGVuZCA9IGZ1bmN0aW9uICh2KQogICAgICBpZiBub3QgdiB0aGVuIHJldHVybiBzZWxmIGVuZAogICAgICB0YWJsZS5pbnNlcnQoc2VsZi5fbGlzdCwgdikKICAgICAgcmV0dXJuIHNlbGYKICAgZW5kCgogICAtLS0KICAgLS0gcG9wKCkKICAgLS0gUmVtb3ZlIGFuZCByZXR1cm4gdGhlIG4tdGggZWxlbWVudCBpbiB0aGUgbGlzdCwgb3IgdGhlCiAgIC0tIGxhc3QgZWxlbWVudCBpZiBub25lIGlzIHByb3ZpZGVkLgogICBzZWxmLnBvcCA9IGZ1bmN0aW9uKG4pCiAgICAgIGlmIG5vdCBuIHRoZW4gcmV0dXJuIHRhYmxlLnJlbW92ZShzZWxmLl9saXN0KSBlbmQKICAgICAgcmV0dXJuIHRhYmxlLnJlbW92ZShzZWxmLl9saXN0LCBuKQogICBlbmQKCiAgIC0tLQogICAtLSBlYWNoKCkKICAgLS0gUmV0dXJuIGEgZ2VuZXJhdG9yIGZvciBlYWNoIGVsZW1lbnQgaW4gdGhlIGxpc3QuCiAgIHNlbGYuZWFjaCA9IGZ1bmN0aW9uKCkKICAgICAgbG9jYWwgY28gPSBjb3JvdXRpbmUuY3JlYXRlKGZ1bmN0aW9uICgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgXywgdiBpbiBpcGFpcnMoc2VsZi5fbGlzdCkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvcm91dGluZS55aWVsZCh2KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQpCgogICAgICByZXR1cm4gZnVuY3Rpb24gKCkKICAgICAgICAgd2hpbGUgdHJ1ZSBkbwogICAgICAgICAgICBsb2NhbCBjb250LCByZXQgPSBjb3JvdXRpbmUucmVzdW1lKGNvKQogICAgICAgICAgICBpZiBub3QgY29udCB0aGVuIHJldHVybiBuaWwgZW5kCiAgICAgICAgICAgIHJldHVybiByZXQKICAgICAgICAgZW5kCiAgICAgIGVuZAogICBlbmQKCiAgIC0tLQogICAtLSBtYXAoKQogICAtLSBHaXZlbiBhIGZ1bmN0aW9uIGYsIGFwcGx5IHRoZSBmdW5jdGlvbiB0byBlYWNoIGVsZW1lbnQKICAgLS0gaW4gdGhlIGxpc3QsIGFuZCByZXR1cm4gYSBsaXN0IGNvbnRhaW5pbmcgdGhlIHJlc3VsdHMgb2YKICAgLS0gdGhlIG9wZXJhdGlvbnMuCiAgIHNlbGYubWFwID0gZnVuY3Rpb24oZikKICAgICAgaWYgbm90IGYgdGhlbiByZXR1cm4gc3RkbGliLkxpc3QoKSBlbmQKICAgICAgbG9jYWwgbmwgPSBzdGRsaWIuTGlzdCgpCgogICAgICBmb3IgdiBpbiBzZWxmLmVhY2goKSBkbwogICAgICAgICBubC5hcHBlbmQoZih2KSkKICAgICAgZW5kCiAgICAgIHJldHVybiBubAogICBlbmQKCiAgIC0tLQogICAtLSBmaWx0ZXIoKQogICAtLSBSZXR1cm4gYSBuZXcgbGlzdCB3aGVyZSBlYWNoIGVsZW1lbnQgY2F1c2VzIHRoZSBmdW5jdGlvbiBmCiAgIC0tIHRvIHJldHVybiB0cnVlIGlmIHBhc3NlZCBhcyBhIHBhcmFtZXRlci4KICAgc2VsZi5maWx0ZXIgPSBmdW5jdGlvbihmKQogICAgICBpZiBub3QgZiB0aGVuIHJldHVybiBzdGRsaWIuTGlzdCgpIGVuZAogICAgICBsb2NhbCBubCA9IHN0ZGxpYi5MaXN0KCkKCiAgICAgIGZvciB2IGluIHNlbGYuZWFjaCgpIGRvCiAgICAgICAgIGlmIGYodikgdGhlbgogICAgICAgICAgICBubC5hcHBlbmQodikKICAgICAgICAgZW5kCiAgICAgIGVuZAogICAgICByZXR1cm4gbmwKICAgZW5kCgogICAtLS0KICAgLS0gaGFzX29uZSgpCiAgIC0tIEBwYXJhbSBmIEEgZnVuY3Rpb24gb2Ygb25lIHBhcmFtZXRlciB0aGF0IHJldHVybiBhIGJvb2wKICAgLS0gQHJldHVybiBUcnVlIGlmIHRoZSBsaXN0IGNvbnRhaW5zIGF0IGxlYXN0IG9uZSBlbGVtZW50IG9mIHdoaWNoIGYoKSBtYXRjaGVzLgogICBzZWxmLmhhc19vbmUgPSBmdW5jdGlvbihmKQogICAgICAgbG9jYWwgcmV0ID0gZmFsc2UKICAgICAgIGZvciB2IGluIHNlbGYuZWFjaCgpIGRvCiAgICAgICAgICAgaWYgZih2KSB0aGVuCiAgICAgICAgICAgICAgIHJldCA9IHRydWUKICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICBlbmQKICAgICAgIGVuZAogICAgICAgcmV0dXJuIHJldAogICBlbmQKCiAgIC0tLQogICAtLSByZXZlcnNlKCkKICAgLS0gUmV0dXJuIGEgY29weSBvZiB0aGUgbGlzdCB3aXRoICB0aGUgZWxlbWVudHMgcmV2ZXJzZWQKICAgc2VsZi5yZXZlcnNlID0gZnVuY3Rpb24oKQogICAgICBsb2NhbCBubCA9IHN0ZGxpYi5MaXN0KHNlbGYpCiAgICAgIGxvY2FsIG5ubCA9IHN0ZGxpYi5MaXN0KCkKICAgICAgd2hpbGUgbmwuc2l6ZSgpID4gMCBkbwogICAgICAgICBubmwuYXBwZW5kKG5sLnBvcCgpKQogICAgICBlbmQKICAgICAgcmV0dXJuIG5ubAogICBlbmQKCiAgIC0tLQogICAtLSBzb3J0KCkKICAgLS0gUmV0dXJuIGEgY29weSBvZiB0aGUgbGlzdCB3aXRoIHRoZSBlbGVtZW50cyBzb3J0ZWQKICAgLS0gQHBhcmFtIGNvbXBhcmVfZm4gKE9wdGlvbmFsKSBBIGZ1bmN0aW9uIG9mIHR3byBhcmd1bWVudHMKICAgLS0gICAgdGhhdCBjb21wYXJlcyB0aGUgcGFyYW1ldGVycyAoZGVmYXVsdDogPCkuCiAgIHNlbGYuc29ydCA9IGZ1bmN0aW9uKGNvbXBhcmVfZm4pCiAgICAgIGxvY2FsIG5sID0gc3RkbGliLkxpc3Qoc2VsZikKICAgICAgdGFibGUuc29ydChubC5fbGlzdCwgY29tcGFyZV9mbikKICAgICAgcmV0dXJuIG5sCiAgIGVuZAoKICAgLS0tCiAgIC0tIHRhYmxlKCkKICAgLS0gQHJldHVybiBBIFRhYmxlIHJlcHJlc2VudGF0aW9uIG9mIHRoaXMgbGlzdC4KICAgc2VsZi50YWJsZSA9IGZ1bmN0aW9uKCkKICAgICAgIHJldHVybiBzdGRsaWIudGFibGVfY29weShzZWxmLl9saXN0KQogICBlbmQKCiAgIHJldHVybiBzZWxmCmVuZAoKLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQotLSAgIFNUUklORyBNQU5JUFVMQVRJT04KLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQotLS0KLS0gcGFydGl0aW9uKCkKLS0gQHBhcmFtIHN0ciBBIHN0cmluZyB0byBzcGxpdCB1cAotLSBAcGFyYW0gcGF0IEEgc3RyaW5nIHRoYXQgaXMgaW50ZXJwcmV0ZWQgYXMgYSBfZml4ZWRfIHN0cmluZyBhbmQKLS0gICAgdXNlZCB0byBzcGxpdCBAcGFyYW0gc3RyLgotLSBAcmV0dXJuIGJlZm9yZSxwYXQsYWZ0ZXIgIFRoZSB0aHJlZSB0dXBsZSAoYmVmb3JlLHBhdCxhZnRlcikgZnJvbQotLSAgICBAcGFyYW0gc3RyLiBJZiBwYXQgaXMgbm90IGZvdW5kLCB0aGVuIEBwYXJhbSBzdHIgd2lsbCBiZSByZXR1cm5lZAotLSAgICBpbiBiZWZvcmUuICBFYWNoIG9mIHRoZSBlbGVtZW50cyBpcyBndWFyYW50ZWVkIHRvIGJlIGEgc3RyaW5nLAotLSAgICBldmVuIGlmIGl0cyB0aGUgZW1wdHkgc3RyaW5nLgpmdW5jdGlvbiBzdGRsaWIucGFydGl0aW9uKHN0ciwgcGF0KQogICBpZiBzdHIgPT0gbmlsIHRoZW4gcmV0dXJuICIiLCAiIiwgIiIgZW5kCiAgIGlmIHBhdCA9PSBuaWwgdGhlbiByZXR1cm4gc3RyLCAiIiwgIiIgZW5kCiAgIGlmIHN0ciA9PSAiIiB0aGVuIHJldHVybiAiIiwgIiIsICIiIGVuZAogICBpZiBwYXQgPT0gIiIgdGhlbiByZXR1cm4gc3RyLCAiIiwgIiIgZW5kCgogICBsb2NhbCBzLCBlLCBjYXAgPSBzdHJpbmcuZmluZChzdHIsIHBhdCwgMSwgdHJ1ZSkKCiAgIGlmIG5vdCBzIHRoZW4KICAgICAgcmV0dXJuIHN0ciwgIiIsICIiCiAgIGVsc2UKICAgICAgcmV0dXJuIHN0cmluZy5zdWIoc3RyLCAxLCBzIC0gMSksIHBhdCwgc3RyaW5nLnN1YihzdHIsIGUgKyAxLCAtMSkKICAgZW5kCmVuZAoKZnVuY3Rpb24gc3RkbGliLnJwYXJ0aXRpb24oc3RyLCBwYXQpCiAgIGlmIHN0ciA9PSBuaWwgdGhlbiByZXR1cm4gIiIsICIiLCAiIiBlbmQKICAgaWYgcGF0ID09IG5pbCB0aGVuIHJldHVybiBzdHIsICIiLCAiIiBlbmQKICAgaWYgc3RyID09ICIiIHRoZW4gcmV0dXJuICIiLCAiIiwgIiIgZW5kCiAgIGlmIHBhdCA9PSAiIiB0aGVuIHJldHVybiBzdHIsICIiLCAiIiBlbmQKCiAgIGxvY2FsIHMgPSAxCiAgIGxvY2FsIGUgPSAxCiAgIGxvY2FsIGNhcCA9ICIiCgogICB3aGlsZSB0cnVlIGRvCiAgICAgIGxvY2FsIHNzLCBlZSwgY2NhcCA9IHN0cmluZy5maW5kKHN0ciwgcGF0LCBlICsgMSwgdHJ1ZSkKICAgICAgaWYgbm90IHNzIHRoZW4KICAgICAgICAgaWYgcyA9PSAxIHRoZW4KICAgICAgICAgICAgcmV0dXJuICIiLCAiIiwgc3RyCiAgICAgICAgIGVsc2UKICAgICAgICAgICAgcmV0dXJuIHN0cmluZy5zdWIoc3RyLCAxLCBzIC0gMSksIHBhdCwgc3RyaW5nLnN1YihzdHIsIGUgKyAxLCAtMSkKICAgICAgICAgZW5kCiAgICAgIGVuZAogICAgICBzID0gc3MKICAgICAgZSA9IGVlCiAgICAgIGMgPSBjY2FwCiAgIGVuZAplbmQKCi0tLQotLSBzcGxpdAotLSBTcGxpdCB0aGUgZ2l2ZW4gc3RyaW5nIGludG8gYSBzdGRsaWIuTGlzdCB3aXRoIGVhY2gKLS0gb2YgdGhlIHBhcnRzLiAgVGhlIHBhcnRzIHdpbGwgbm90IGNvbnRhaW4gQHBhcmFtIHBhdC4KLS0gSWYgdGhlIHBhdHRlcm4gaXMgdGhlIGVtcHR5IHN0cmluZywgdGhlbiB0aGUgZWxlbWVudHMgaW4KLS0gdGhlIGxpc3QgYXJlIHRoZSBjaGFyYWN0ZXJzIGluIHRoZSBzdHJpbmcuCi0tIEBwYXJhbSBzdHIgQSBzdHJpbmcuCi0tIEBwYXJhbSBwYXQgQSBzdHJpbmcgdGhhdCBpcyBpbnRlcnByZXRlZCBhcyBhIF9maXhlZF8gc3RyaW5nCi0tICAgIGFuZCB1c2VkIHRvIHNwbGl0IEBwYXJhbSBzdHIuCi0tIEByZXR1cm4gYSBzdGRsaWIuTGlzdCB3aXRoIHRoZSBwYXJ0cyBvZiB0aGUgc3RyaW5nLgpmdW5jdGlvbiBzdGRsaWIuc3BsaXQoc3RyLCBwYXQpCiAgIGxvY2FsIHQgPSBzdGRsaWIuTGlzdCgpCiAgIGlmIG5vdCBzdHIgICB0aGVuIHJldHVybiBzdGRsaWIuTGlzdCgpIGVuZAogICBpZiBzdHIgPT0gIiIgdGhlbiByZXR1cm4gc3RkbGliLkxpc3QoeyIifSkgZW5kCiAgIGlmIG5vdCBwYXQgICB0aGVuIHJldHVybiBzdGRsaWIuTGlzdCh7c3RyfSkgZW5kCiAgIGlmIHBhdCA9PSAiIiB0aGVuCiAgICAgIGxvY2FsIGxlbiA9IHN0cmluZy5sZW4oc3RyKQogICAgICBsb2NhbCBpID0gMQogICAgICB3aGlsZSBpIDw9IGxlbiBkbwogICAgICAgICB0LmFwcGVuZChzdHJpbmcuc3ViKHN0ciwgaSwgaSkpCiAgICAgICAgIGkgPSBpICsgMQogICAgICBlbmQKICAgICAgcmV0dXJuIHQKICAgZW5kCgogICBsb2NhbCBsYXN0X2VuZCA9IDAKICAgbG9jYWwgcywgZSA9IHN0cmluZy5maW5kKHN0ciwgcGF0LCAxLCB0cnVlKQogICB3aGlsZSBzIGRvCiAgICAgIGlmIHMgPT0gbGFzdF9lbmQgdGhlbgogICAgICAgICB0LmFwcGVuZCgiIikKICAgICAgZWxzZQogICAgICAgICB0LmFwcGVuZChzdHJpbmcuc3ViKHN0ciwgbGFzdF9lbmQgKyAxLCBzIC0gMSkpCiAgICAgIGVuZAogICAgICBsYXN0X2VuZCA9IGUKICAgICAgcywgZSA9IHN0cmluZy5maW5kKHN0ciwgcGF0LCBsYXN0X2VuZCArIDEsIHRydWUpCiAgIGVuZAogICBpZiBsYXN0X2VuZCA8PSBzdHJpbmcubGVuKHN0cikgdGhlbgogICAgICB0LmFwcGVuZChzdHJpbmcuc3ViKHN0ciwgbGFzdF9lbmQgKyAxKSkKICAgZWxzZQogICAgICB0LmFwcGVuZCgiIikKICAgZW5kCiAgIHJldHVybiB0CmVuZAoKLS0tCi0tIHJzdHJpcCgpCi0tIFJldHVybiB0aGUgZ2l2ZW4gc3RyaW5nIHdpdGggYW55IGluc3RhbmNlcyBvZiBhIGNoYXJhY3RlcgotLSBpbiBAcGFyYW0gY2hhcnMgcmVtb3ZlZCBmcm9tIHRoZSByaWdodCBoYW5kIHNpZGUuCi0tIEBwYXJhbSBzIFRoZSBzdHJpbmcgdG8gc3RyaXAgb24gdGhlIHJpZ2h0LgotLSBAcGFyYW0gY2hhcnMgQSBzdHJpbmcgY29udGFpbmluZyB0aGUgc2V0IG9mIGNoYXJhY3RlcnMgdG8gc3RyaXAuCmZ1bmN0aW9uIHN0ZGxpYi5yc3RyaXAocywgY2hhcnMpCiAgIGlmIHMgPT0gbmlsIHRoZW4gcmV0dXJuICIiIGVuZAogICBpZiBzID09ICIiIHRoZW4gcmV0dXJuICIiIGVuZAogICBsb2NhbCBiYWRjaGFycyA9IHt9CgogICBmb3IgaSA9IHN0cmluZy5sZW4oY2hhcnMpLCAxLCAtMSBkbwogICAgICBiYWRjaGFyc1tzdHJpbmcuc3ViKGNoYXJzLCBpLCBpKV0gPSB0cnVlCiAgIGVuZAoKICAgZm9yIGkgPSBzdHJpbmcubGVuKHMpLCAxLCAtMSBkbwogICAgICBsb2NhbCBjID0gc3RyaW5nLnN1YihzLCBpLCBpKQogICAgICBpZiBub3QgYmFkY2hhcnNbY10gdGhlbgogICAgICAgICByZXR1cm4gc3RyaW5nLnN1YihzLCAxLCBpKQogICAgICBlbmQKICAgZW5kCiAgIHJldHVybiAiIgplbmQKCi0tLQotLSBsc3RyaXAoKQotLSBSZXR1cm4gdGhlIGdpdmVuIHN0cmluZyB3aXRoIGFueSBpbnN0YW5jZXMgb2YgYSBjaGFyYWN0ZXIKLS0gaW4gQHBhcmFtIGNoYXJzIHJlbW92ZWQgZnJvbSB0aGUgbGVmdCBoYW5kIHNpZGUuCi0tIEBwYXJhbSBzIFRoZSBzdHJpbmcgdG8gc3RyaXAgb24gdGhlIGxlZnQuCi0tIEBwYXJhbSBjaGFycyBBIHN0cmluZyBjb250YWluaW5nIHRoZSBzZXQgb2YgY2hhcmFjdGVycyB0byBzdHJpcC4KZnVuY3Rpb24gc3RkbGliLmxzdHJpcChzLCBjaGFycykKICAgaWYgcyA9PSBuaWwgdGhlbiByZXR1cm4gIiIgZW5kCiAgIGlmIHMgPT0gIiIgdGhlbiByZXR1cm4gIiIgZW5kCiAgIGxvY2FsIGJhZGNoYXJzID0ge30KCiAgIGZvciBpID0gMSwgc3RyaW5nLmxlbihjaGFycykgZG8KICAgICAgYmFkY2hhcnNbc3RyaW5nLnN1YihjaGFycywgaSwgaSldID0gdHJ1ZQogICBlbmQKCiAgIGZvciBpID0gMSwgc3RyaW5nLmxlbihzKSBkbwogICAgICBsb2NhbCBjID0gc3RyaW5nLnN1YihzLCBpLCBpKQogICAgICBpZiBub3QgYmFkY2hhcnNbY10gdGhlbgogICAgICAgICByZXR1cm4gc3RyaW5nLnN1YihzLCBpKQogICAgICBlbmQKICAgZW5kCiAgIHJldHVybiAiIgplbmQKCi0tLQotLSBzdHJpcCgpCi0tIFJldHVybiB0aGUgZ2l2ZW4gc3RyaW5nIHdpdGggYW55IGluc3RhbmNlcyBvZiBhIGNoYXJhY3RlcgotLSBpbiBAcGFyYW0gY2hhcnMgcmVtb3ZlZCBmcm9tIGVpdGhlciBlbmQuCi0tIEBwYXJhbSBzIFRoZSBzdHJpbmcgdG8gc3RyaXAgb24gdGhlIGVuZHMuLgotLSBAcGFyYW0gY2hhcnMgQSBzdHJpbmcgY29udGFpbmluZyB0aGUgc2V0IG9mIGNoYXJhY3RlcnMgdG8gc3RyaXAuCmZ1bmN0aW9uIHN0ZGxpYi5zdHJpcChzLCBjaGFyKQogICBpZiBzID09IG5pbCB0aGVuIHJldHVybiAiIiBlbmQKICAgaWYgcyA9PSAiIiB0aGVuIHJldHVybiAiIiBlbmQKCiAgIHJldHVybiBzdGRsaWIubHN0cmlwKHN0ZGxpYi5yc3RyaXAocywgY2hhciksIGNoYXIpCmVuZAoKLS0tCi0tIGVuZHN3aXRoKCkKZnVuY3Rpb24gc3RkbGliLmVuZHN3aXRoKHNiaWcsIHNsaXR0bGUpCiAgIGlmIHR5cGUoc2xpdHRsZSkgPT0gInRhYmxlIiB0aGVuCiAgICAgIGZvciBrLHYgaW4gaXBhaXJzKHNsaXR0bGUpIGRvCiAgICAgICAgIGlmIHN0cmluZy5zdWIoc2JpZywgc3RyaW5nLmxlbihzYmlnKSAtIHN0cmluZy5sZW4odikgKyAxKSA9PSB2IHRoZW4KICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICAgZW5kCiAgICAgIGVuZAogICAgICByZXR1cm4gZmFsc2UKICAgZW5kCiAgIHJldHVybiBzdHJpbmcuc3ViKHNiaWcsIHN0cmluZy5sZW4oc2JpZykgLSBzdHJpbmcubGVuKHNsaXR0bGUpICsgMSkgPT0gc2xpdHRsZQplbmQKCi0tLQotLSBzdGFydHN3aXRoKCkKZnVuY3Rpb24gc3RkbGliLnN0YXJ0c3dpdGgoc3Vic3RyLCBzdGFydF9pZHgpCiAgIHJldHVybiBzdHJpbmcuc3ViKHN1YnN0ciwgMSwgc3RyaW5nLmxlbihzdGFydF9pZHgpKSA9PSBzdGFydF9pZHgKZW5kCgotLQotLSBUYWtlIGEgdGltZXN0YW1wIHRhYmxlIGNyZWF0ZWQgYnkgYSBmaWxlIGF1ZGl0IGFuZAotLSBjb252ZXJ0IGl0IGludG8gYSBzdGFuZGFyZCBzdHJpbmcgZm9ybWF0CmZ1bmN0aW9uIHN0ZGxpYi5Db252ZXJ0U3lzdGVtVGltZShzeXN0aW1lKQogICBpZiB0eXBlKHN5c3RpbWUpIH49ICJ0YWJsZSIgdGhlbiByZXR1cm4gIiIgZW5kCiAgIHJldHVybiBzdHJpbmcuZm9ybWF0KCIlNC40ZC0lMi4yZC0lMi4yZFQlMi4yZDolMi4yZDolMi4yZFoiLAogICAgICAgICAgICAgICAgICAgICAgICBzeXN0aW1lLndZZWFyLCBzeXN0aW1lLndNb250aCwgc3lzdGltZS53RGF5LCBzeXN0aW1lLndIb3VyLCBzeXN0aW1lLndNaW51dGUsIHN5c3RpbWUud1NlY29uZCkKZW5kCnN0ZGxpYi5zcHJpbnRfc3lzdGltZSA9IHN0ZGxpYi5Db252ZXJ0U3lzdGVtVGltZQoKLS0gZm9yIG1ldGFtZXRob2RzIHRvIGJlIGNob3NlbiwgdGhlbiB0aGUgbWV0YW1ldGhvZHMgb2YgYm90aAotLSAgIHBhcmFtZXRlcnMgbXVzdCBiZSB0aGUgc2FtZSwgc28gd2Ugc3RvcmUgc2hhcmVkIG1ldGFtZXRob2RzIGhlcmUKc3RkbGliLkRhdGVUaW1lVXRpbHMgPSB7fQpzdGRsaWIuRGF0ZVRpbWVVdGlscy5maWVsZHMgPSBzdGRsaWIuTGlzdCh7IndZZWFyIiwgIndNb250aCIsICJ3RGF5IiwgIndIb3VyIiwgIndNaW51dGUiLCAid1NlY29uZCJ9KQpzdGRsaWIuRGF0ZVRpbWVVdGlscy5jb21wYXJlID0gZnVuY3Rpb24odDEsIHQyKQogICBmb3IgZmllbGQgaW4gc3RkbGliLkRhdGVUaW1lVXRpbHMuZmllbGRzLmVhY2goKSBkbwogICAgICBpZiB0MVtmaWVsZF0gPCB0MltmaWVsZF0gdGhlbiByZXR1cm4gLTEgZW5kCiAgICAgIGlmIHQxW2ZpZWxkXSA+IHQyW2ZpZWxkXSB0aGVuIHJldHVybiAxIGVuZAogICBlbmQKICAgcmV0dXJuIDAKZW5kCnN0ZGxpYi5EYXRlVGltZVV0aWxzLl9fbHQgPSBmdW5jdGlvbih0MSwgdDIpCiAgIHJldHVybiBzdGRsaWIuRGF0ZVRpbWVVdGlscy5jb21wYXJlKHQxLCB0MikgPCAwCmVuZApzdGRsaWIuRGF0ZVRpbWVVdGlscy5fX2xlID0gZnVuY3Rpb24odDEsIHQyKQogICByZXR1cm4gc3RkbGliLkRhdGVUaW1lVXRpbHMuY29tcGFyZSh0MSwgdDIpIDwgMQplbmQKc3RkbGliLkRhdGVUaW1lVXRpbHMuX19lcSA9IGZ1bmN0aW9uKHQxLCB0MikKICAgcmV0dXJuIHN0ZGxpYi5EYXRlVGltZVV0aWxzLmNvbXBhcmUodDEsIHQyKSA9PSAwCmVuZAotLS0KLS0gYWRkKCkKLS0gTm90ZTogbWl4aW5nIGxhcmdlIHZhbHVlcyBmb3IgbXVsdGlwbGUgdW5pdHMgaXMgbm90IHN1cHBvcnRlZAotLSAgIGZvciBpbnN0YW5jZSwgZG9uJ3QgZG8gdDEuYWRkKHt3TW9udGg9MSwgd0RheT00NX0pCnN0ZGxpYi5EYXRlVGltZVV0aWxzLl9fYWRkID0gZnVuY3Rpb24odDEsIHQyKQogICBsb2NhbCByZXQgPSBzdGRsaWIuRGF0ZVRpbWUodDEpCgogICByZXQud1NlY29uZCA9IHJldC53U2Vjb25kICsgdDIud1NlY29uZAogICByZXQud01pbnV0ZSA9IHJldC53TWludXRlICsgdDIud01pbnV0ZQogICByZXQud0hvdXIgICA9IHJldC53SG91ciAgICsgdDIud0hvdXIKICAgcmV0LndEYXkgICAgPSByZXQud0RheSAgICArIHQyLndEYXkKICAgcmV0LndNb250aCAgPSByZXQud01vbnRoICArIHQyLndNb250aAogICByZXQud1llYXIgICA9IHJldC53WWVhciAgICsgdDIud1llYXIKCiAgIHJldC5fcmVkdWNlX2RhdGUoKQoKICAgcmV0dXJuIHJldAplbmQKc3RkbGliLkRhdGVUaW1lVXRpbHMuQWRkVGVzdCA9IGZ1bmN0aW9uKCkKICAgbG9jYWwgdDEKICAgbG9jYWwgdDIKICAgbG9jYWwgcmV0CiAgIGxvY2FsIGV4cAogICBsb2NhbCBsYWJlbAoKICAgbG9jYWwgdGVzdHMgPSBzdGRsaWIuTGlzdCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLS0gdGVzdCBiYXNpYyBzZWNvbmRzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsID0gInNlY29uZHMtMSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdDEgPSBzdGRsaWIuRGF0ZVRpbWUoe3dZZWFyPTE5MDAsIHdNb250aD0xLCB3RGF5PTEsIHdIb3VyPTAsIHdNaW51dGU9MCwgd1NlY29uZD0wfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdDIgPSBzdGRsaWIuRGF0ZVRpbWUoe3dNb250aD0wLCB3RGF5PTAsIHdTZWNvbmQ9MX0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cCA9IHN0ZGxpYi5EYXRlVGltZSh7d1llYXI9MTkwMCwgd01vbnRoPTEsIHdEYXk9MSwgd0hvdXI9MCwgd01pbnV0ZT0wLCB3U2Vjb25kPTF9KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbCA9ICJzZWNvbmRzLTIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQxID0gc3RkbGliLkRhdGVUaW1lKHt3WWVhcj0xOTAwLCB3TW9udGg9MSwgd0RheT0xLCB3SG91cj0wLCB3TWludXRlPTAsIHdTZWNvbmQ9MH0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQyID0gc3RkbGliLkRhdGVUaW1lKHt3TW9udGg9MCwgd0RheT0wLCB3U2Vjb25kPTYwfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwID0gc3RkbGliLkRhdGVUaW1lKHt3WWVhcj0xOTAwLCB3TW9udGg9MSwgd0RheT0xLCB3SG91cj0wLCB3TWludXRlPTEsIHdTZWNvbmQ9MH0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsID0gInNlY29uZHMtMyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdDEgPSBzdGRsaWIuRGF0ZVRpbWUoe3dZZWFyPTE5MDAsIHdNb250aD0xLCB3RGF5PTEsIHdIb3VyPTAsIHdNaW51dGU9MCwgd1NlY29uZD0wfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdDIgPSBzdGRsaWIuRGF0ZVRpbWUoe3dNb250aD0wLCB3RGF5PTAsIHdTZWNvbmQ9NzB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHAgPSBzdGRsaWIuRGF0ZVRpbWUoe3dZZWFyPTE5MDAsIHdNb250aD0xLCB3RGF5PTEsIHdIb3VyPTAsIHdNaW51dGU9MSwgd1NlY29uZD0xMH0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0tIHRlc3QgYmFzaWMgbWludXRlcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbCA9ICJtaW51dGVzLTEiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQxID0gc3RkbGliLkRhdGVUaW1lKHt3WWVhcj0xOTAwLCAgd01vbnRoPTEsIHdEYXk9MSwgd0hvdXI9MCwgd01pbnV0ZT0wLCB3U2Vjb25kPTB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0MiA9IHN0ZGxpYi5EYXRlVGltZSh7d1llYXI9MCwgICAgIHdNb250aD0wLCB3RGF5PTAsIHdIb3VyPTAsIHdNaW51dGU9MTAsIHdTZWNvbmQ9MH0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cCA9IHN0ZGxpYi5EYXRlVGltZSh7d1llYXI9MTkwMCwgd01vbnRoPTEsIHdEYXk9MSwgd0hvdXI9MCwgd01pbnV0ZT0xMCwgd1NlY29uZD0wfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWwgPSAibWludXRlcy0yIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0MSA9IHN0ZGxpYi5EYXRlVGltZSh7d1llYXI9MTkwMCwgIHdNb250aD0xLCB3RGF5PTEsIHdIb3VyPTAsIHdNaW51dGU9MCwgd1NlY29uZD0wfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdDIgPSBzdGRsaWIuRGF0ZVRpbWUoe3dZZWFyPTAsICAgICB3TW9udGg9MCwgd0RheT0wLCB3SG91cj0wLCB3TWludXRlPTYwLCB3U2Vjb25kPTB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHAgPSBzdGRsaWIuRGF0ZVRpbWUoe3dZZWFyPTE5MDAsIHdNb250aD0xLCB3RGF5PTEsIHdIb3VyPTEsIHdNaW51dGU9MCwgd1NlY29uZD0wfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWwgPSAibWludXRlcy0zIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0MSA9IHN0ZGxpYi5EYXRlVGltZSh7d1llYXI9MTkwMCwgIHdNb250aD0xLCB3RGF5PTEsIHdIb3VyPTAsIHdNaW51dGU9MCwgd1NlY29uZD0wfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdDIgPSBzdGRsaWIuRGF0ZVRpbWUoe3dZZWFyPTAsICAgICB3TW9udGg9MCwgd0RheT0wLCB3SG91cj0wLCB3TWludXRlPTcwLCB3U2Vjb25kPTB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHAgPSBzdGRsaWIuRGF0ZVRpbWUoe3dZZWFyPTE5MDAsIHdNb250aD0xLCB3RGF5PTEsIHdIb3VyPTEsIHdNaW51dGU9MTAsIHdTZWNvbmQ9MH0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0tIHRlc3QgYmFzaWMgaG91cnMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWwgPSAiaG91cnMtMSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdDEgPSBzdGRsaWIuRGF0ZVRpbWUoe3dZZWFyPTE5MDAsICB3TW9udGg9MSwgd0RheT0xLCB3SG91cj0wLCB3TWludXRlPTAsIHdTZWNvbmQ9MH0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQyID0gc3RkbGliLkRhdGVUaW1lKHt3WWVhcj0wLCAgICAgd01vbnRoPTAsIHdEYXk9MCwgd0hvdXI9MTAsIHdNaW51dGU9MCwgd1NlY29uZD0wfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwID0gc3RkbGliLkRhdGVUaW1lKHt3WWVhcj0xOTAwLCB3TW9udGg9MSwgd0RheT0xLCB3SG91cj0xMCwgd01pbnV0ZT0wLCB3U2Vjb25kPTB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbCA9ICJob3Vycy0yIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0MSA9IHN0ZGxpYi5EYXRlVGltZSh7d1llYXI9MTkwMCwgIHdNb250aD0xLCB3RGF5PTEsIHdIb3VyPTAsIHdNaW51dGU9MCwgd1NlY29uZD0wfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdDIgPSBzdGRsaWIuRGF0ZVRpbWUoe3dZZWFyPTAsICAgICB3TW9udGg9MCwgd0RheT0wLCB3SG91cj0yNCwgd01pbnV0ZT0wLCB3U2Vjb25kPTB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHAgPSBzdGRsaWIuRGF0ZVRpbWUoe3dZZWFyPTE5MDAsIHdNb250aD0xLCB3RGF5PTIsIHdIb3VyPTAsIHdNaW51dGU9MCwgd1NlY29uZD0wfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWwgPSAiaG91cnMtMyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdDEgPSBzdGRsaWIuRGF0ZVRpbWUoe3dZZWFyPTE5MDAsICB3TW9udGg9MSwgd0RheT0xLCB3SG91cj0wLCB3TWludXRlPTAsIHdTZWNvbmQ9MH0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQyID0gc3RkbGliLkRhdGVUaW1lKHt3WWVhcj0wLCAgICAgd01vbnRoPTAsIHdEYXk9MCwgd0hvdXI9MjUsIHdNaW51dGU9MCwgd1NlY29uZD0wfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwID0gc3RkbGliLkRhdGVUaW1lKHt3WWVhcj0xOTAwLCB3TW9udGg9MSwgd0RheT0yLCB3SG91cj0xLCB3TWludXRlPTAsIHdTZWNvbmQ9MH0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0tIHRlc3QgYmFzaWMgZGF5cwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbCA9ICJkYXlzLTEiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQxID0gc3RkbGliLkRhdGVUaW1lKHt3WWVhcj0xOTAwLCAgd01vbnRoPTEsIHdEYXk9MSwgd0hvdXI9MCwgd01pbnV0ZT0wLCB3U2Vjb25kPTB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0MiA9IHN0ZGxpYi5EYXRlVGltZSh7d1llYXI9MCwgICAgIHdNb250aD0wLCB3RGF5PTEsIHdIb3VyPTAsIHdNaW51dGU9MCwgd1NlY29uZD0wfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwID0gc3RkbGliLkRhdGVUaW1lKHt3WWVhcj0xOTAwLCB3TW9udGg9MSwgd0RheT0yLCB3SG91cj0wLCB3TWludXRlPTAsIHdTZWNvbmQ9MH0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsID0gImRheXMtMiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdDEgPSBzdGRsaWIuRGF0ZVRpbWUoe3dZZWFyPTE5MDAsICB3TW9udGg9MSwgd0RheT0xLCAgd0hvdXI9MCwgd01pbnV0ZT0wLCB3U2Vjb25kPTB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0MiA9IHN0ZGxpYi5EYXRlVGltZSh7d1llYXI9MCwgICAgIHdNb250aD0wLCB3RGF5PTMwLCB3SG91cj0wLCB3TWludXRlPTAsIHdTZWNvbmQ9MH0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cCA9IHN0ZGxpYi5EYXRlVGltZSh7d1llYXI9MTkwMCwgd01vbnRoPTEsIHdEYXk9MzEsIHdIb3VyPTAsIHdNaW51dGU9MCwgd1NlY29uZD0wfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWwgPSAiZGF5cy0zIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0MSA9IHN0ZGxpYi5EYXRlVGltZSh7d1llYXI9MTkwMCwgIHdNb250aD0xLCB3RGF5PTEsIHdIb3VyPTAsIHdNaW51dGU9MCwgd1NlY29uZD0wfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdDIgPSBzdGRsaWIuRGF0ZVRpbWUoe3dZZWFyPTAsICAgICB3TW9udGg9MCwgd0RheT0zMSwgd0hvdXI9MCwgd01pbnV0ZT0wLCB3U2Vjb25kPTB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHAgPSBzdGRsaWIuRGF0ZVRpbWUoe3dZZWFyPTE5MDAsIHdNb250aD0yLCB3RGF5PTEsIHdIb3VyPTAsIHdNaW51dGU9MCwgd1NlY29uZD0wfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLS0gdGVzdCBiYXNpYyBtb250aHMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWwgPSAibW9udGhzLTEiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQxID0gc3RkbGliLkRhdGVUaW1lKHt3WWVhcj0xOTAwLCAgd01vbnRoPTEsIHdEYXk9MSwgd0hvdXI9MCwgd01pbnV0ZT0wLCB3U2Vjb25kPTB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0MiA9IHN0ZGxpYi5EYXRlVGltZSh7d1llYXI9MCwgICAgIHdNb250aD0xLCB3RGF5PTAsIHdIb3VyPTAsIHdNaW51dGU9MCwgd1NlY29uZD0wfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwID0gc3RkbGliLkRhdGVUaW1lKHt3WWVhcj0xOTAwLCB3TW9udGg9Miwgd0RheT0xLCB3SG91cj0wLCB3TWludXRlPTAsIHdTZWNvbmQ9MH0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsID0gIm1vbnRocy0yIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0MSA9IHN0ZGxpYi5EYXRlVGltZSh7d1llYXI9MTkwMCwgIHdNb250aD0xLCAgd0RheT0xLCB3SG91cj0wLCB3TWludXRlPTAsIHdTZWNvbmQ9MH0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQyID0gc3RkbGliLkRhdGVUaW1lKHt3WWVhcj0wLCAgICAgd01vbnRoPTEyLCB3RGF5PTAsIHdIb3VyPTAsIHdNaW51dGU9MCwgd1NlY29uZD0wfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwID0gc3RkbGliLkRhdGVUaW1lKHt3WWVhcj0xOTAxLCB3TW9udGg9MSwgIHdEYXk9MSwgd0hvdXI9MCwgd01pbnV0ZT0wLCB3U2Vjb25kPTB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbCA9ICJtb250aHMtMyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdDEgPSBzdGRsaWIuRGF0ZVRpbWUoe3dZZWFyPTE5MDAsICB3TW9udGg9MSwgd0RheT0xLCB3SG91cj0wLCB3TWludXRlPTAsIHdTZWNvbmQ9MH0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQyID0gc3RkbGliLkRhdGVUaW1lKHt3WWVhcj0wLCAgICAgd01vbnRoPTEzLCB3RGF5PTAsIHdIb3VyPTAsIHdNaW51dGU9MCwgd1NlY29uZD0wfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwID0gc3RkbGliLkRhdGVUaW1lKHt3WWVhcj0xOTAxLCB3TW9udGg9Miwgd0RheT0xLCB3SG91cj0wLCB3TWludXRlPTAsIHdTZWNvbmQ9MH0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0tIHRlc3QgYmFzaWMgeWVhcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbCA9ICJ5ZWFycy0xIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0MSA9IHN0ZGxpYi5EYXRlVGltZSh7d1llYXI9MTkwMCwgIHdNb250aD0xLCB3RGF5PTEsIHdIb3VyPTAsIHdNaW51dGU9MCwgd1NlY29uZD0wfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdDIgPSBzdGRsaWIuRGF0ZVRpbWUoe3dZZWFyPTEsICAgICB3TW9udGg9MCwgd0RheT0wLCB3SG91cj0wLCB3TWludXRlPTAsIHdTZWNvbmQ9MH0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cCA9IHN0ZGxpYi5EYXRlVGltZSh7d1llYXI9MTkwMSwgd01vbnRoPTEsIHdEYXk9MSwgd0hvdXI9MCwgd01pbnV0ZT0wLCB3U2Vjb25kPTB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbCA9ICJ5ZWFycy0yIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0MSA9IHN0ZGxpYi5EYXRlVGltZSh7d1llYXI9MTkwMCwgIHdNb250aD0xLCB3RGF5PTEsIHdIb3VyPTAsIHdNaW51dGU9MCwgd1NlY29uZD0wfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdDIgPSBzdGRsaWIuRGF0ZVRpbWUoe3dZZWFyPTEwLCAgICAgd01vbnRoPTAsIHdEYXk9MCwgd0hvdXI9MCwgd01pbnV0ZT0wLCB3U2Vjb25kPTB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHAgPSBzdGRsaWIuRGF0ZVRpbWUoe3dZZWFyPTE5MTAsIHdNb250aD0xLCB3RGF5PTEsIHdIb3VyPTAsIHdNaW51dGU9MCwgd1NlY29uZD0wfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWwgPSAieWVhcnMtMyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdDEgPSBzdGRsaWIuRGF0ZVRpbWUoe3dZZWFyPTE5MDAsICB3TW9udGg9MSwgd0RheT0xLCB3SG91cj0wLCB3TWludXRlPTAsIHdTZWNvbmQ9MH0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQyID0gc3RkbGliLkRhdGVUaW1lKHt3WWVhcj01MCwgICAgIHdNb250aD0wLCB3RGF5PTAsIHdIb3VyPTAsIHdNaW51dGU9MCwgd1NlY29uZD0wfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwID0gc3RkbGliLkRhdGVUaW1lKHt3WWVhcj0xOTUwLCB3TW9udGg9MSwgd0RheT0xLCB3SG91cj0wLCB3TWludXRlPTAsIHdTZWNvbmQ9MH0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtLSB0ZXN0IGNvbWJvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsID0gImNvbWJvLTEiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQxID0gc3RkbGliLkRhdGVUaW1lKHt3WWVhcj0xOTAwLCAgd01vbnRoPTEsIHdEYXk9MSwgd0hvdXI9MCwgd01pbnV0ZT0wLCB3U2Vjb25kPTB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0MiA9IHN0ZGxpYi5EYXRlVGltZSh7d1llYXI9MSwgICAgIHdNb250aD0xLCB3RGF5PTEsIHdIb3VyPTEsIHdNaW51dGU9MSwgd1NlY29uZD0xfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwID0gc3RkbGliLkRhdGVUaW1lKHt3WWVhcj0xOTAxLCB3TW9udGg9Miwgd0RheT0yLCB3SG91cj0xLCB3TWludXRlPTEsIHdTZWNvbmQ9MX0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsID0gImNvbWJvLTIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQxID0gc3RkbGliLkRhdGVUaW1lKHt3WWVhcj0xOTAwLCAgd01vbnRoPTEsIHdEYXk9MSwgd0hvdXI9MCwgd01pbnV0ZT0wLCB3U2Vjb25kPTB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0MiA9IHN0ZGxpYi5EYXRlVGltZSh7d1llYXI9MCwgICAgIHdNb250aD0wLCB3RGF5PTAsIHdIb3VyPTI0LCB3TWludXRlPTYwLCB3U2Vjb25kPTYwfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwID0gc3RkbGliLkRhdGVUaW1lKHt3WWVhcj0xOTAwLCB3TW9udGg9MSwgd0RheT0yLCB3SG91cj0xLCB3TWludXRlPTEsIHdTZWNvbmQ9MH0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbCA9ICJ0ZW1wbGF0ZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdDEgPSBzdGRsaWIuRGF0ZVRpbWUoe3dZZWFyPTE5MDAsICB3TW9udGg9MSwgd0RheT0xLCB3SG91cj0wLCB3TWludXRlPTAsIHdTZWNvbmQ9MH0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQyID0gc3RkbGliLkRhdGVUaW1lKHt3WWVhcj0wLCAgICAgd01vbnRoPTAsIHdEYXk9MCwgd0hvdXI9MCwgd01pbnV0ZT0wLCB3U2Vjb25kPTB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHAgPSBzdGRsaWIuRGF0ZVRpbWUoe3dZZWFyPTE5MDAsIHdNb250aD0xLCB3RGF5PTEsIHdIb3VyPTAsIHdNaW51dGU9MCwgd1NlY29uZD0wfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICBmb3IgdGVzdCBpbiB0ZXN0cy5lYWNoKCkgZG8KICAgICAgbG9jYWwgcmV0ID0gdGVzdC50MSArIHRlc3QudDIKICAgICAgbG9jYWwgcmVzdWx0ID0gIkZBSUwiCiAgICAgIGlmIHJldCA9PSB0ZXN0LmV4cCB0aGVuCiAgICAgICAgIHJlc3VsdCA9ICJQQVNTIgogICAgICBlbmQKICAgICAgZGVidWcuZGVidWcocmVzdWx0LCB0ZXN0LmxhYmVsIC4uICIgICIgLi4gdG9zdHJpbmcodGVzdC50MSkgLi4gIiArICIgLi4gdG9zdHJpbmcodGVzdC50MikgLi4gIiA9ICIgLi4gdG9zdHJpbmcocmV0KSAuLiAiIGV4cDogIiAuLiB0b3N0cmluZyh0ZXN0LmV4cCkpCiAgICAgIGlmIHJldCB+PSB0ZXN0LmV4cCB0aGVuCiAgICAgICAgIHJldHVybiBmYWxzZQogICAgICBlbmQKICAgZW5kCiAgIHJldHVybiB0cnVlCmVuZAotLS0KLS0gYWRkKCkKLS0gTm90ZTogbWl4aW5nIGxhcmdlIHZhbHVlcyBmb3IgbXVsdGlwbGUgdW5pdHMgaXMgbm90IHN1cHBvcnRlZAotLSAgIGZvciBpbnN0YW5jZSwgZG9uJ3QgZG8gdDEuYWRkKHt3TW9udGg9MSwgd0RheT00NX0pCnN0ZGxpYi5EYXRlVGltZVV0aWxzLl9fc3ViID0gZnVuY3Rpb24odDEsIHQyKQogICBsb2NhbCByZXQgPSBzdGRsaWIuRGF0ZVRpbWUodDEpCgogICByZXQud1NlY29uZCA9IHJldC53U2Vjb25kIC0gdDIud1NlY29uZAogICByZXQud01pbnV0ZSA9IHJldC53TWludXRlIC0gdDIud01pbnV0ZQogICByZXQud0hvdXIgICA9IHJldC53SG91ciAgIC0gdDIud0hvdXIKICAgcmV0LndEYXkgICAgPSByZXQud0RheSAgICAtIHQyLndEYXkKICAgcmV0LndNb250aCAgPSByZXQud01vbnRoICAtIHQyLndNb250aAogICByZXQud1llYXIgICA9IHJldC53WWVhciAgIC0gdDIud1llYXIKCiAgIHJldC5fcmVkdWNlX2RhdGUoKQoKICAgcmV0dXJuIHJldAplbmQKc3RkbGliLkRhdGVUaW1lVXRpbHMuU3ViVGVzdCA9IGZ1bmN0aW9uKCkKICAgbG9jYWwgdDEKICAgbG9jYWwgdDIKICAgbG9jYWwgcmV0CiAgIGxvY2FsIGV4cAogICBsb2NhbCBsYWJlbAoKICAgbG9jYWwgdGVzdHMgPSBzdGRsaWIuTGlzdCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLS0gdGVzdCBiYXNpYyBzZWNvbmRzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsID0gInNlY29uZHMtMSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdDEgPSBzdGRsaWIuRGF0ZVRpbWUoe3dZZWFyPTE5MDAsIHdNb250aD0xLCB3RGF5PTEsIHdIb3VyPTAsIHdNaW51dGU9MCwgd1NlY29uZD0xfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdDIgPSBzdGRsaWIuRGF0ZVRpbWUoe3dNb250aD0wLCB3RGF5PTAsIHdTZWNvbmQ9MX0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cCA9IHN0ZGxpYi5EYXRlVGltZSh7d1llYXI9MTkwMCwgd01vbnRoPTEsIHdEYXk9MSwgd0hvdXI9MCwgd01pbnV0ZT0wLCB3U2Vjb25kPTB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbCA9ICJzZWNvbmRzLTIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQxID0gc3RkbGliLkRhdGVUaW1lKHt3WWVhcj0xOTAwLCB3TW9udGg9MSwgd0RheT0xLCB3SG91cj0wLCB3TWludXRlPTEsIHdTZWNvbmQ9MH0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQyID0gc3RkbGliLkRhdGVUaW1lKHt3TW9udGg9MCwgd0RheT0wLCB3U2Vjb25kPTYwfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwID0gc3RkbGliLkRhdGVUaW1lKHt3WWVhcj0xOTAwLCB3TW9udGg9MSwgd0RheT0xLCB3SG91cj0wLCB3TWludXRlPTAsIHdTZWNvbmQ9MH0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsID0gInNlY29uZHMtMyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdDEgPSBzdGRsaWIuRGF0ZVRpbWUoe3dZZWFyPTE5MDAsIHdNb250aD0xLCB3RGF5PTEsIHdIb3VyPTEsIHdNaW51dGU9MSwgd1NlY29uZD0wfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdDIgPSBzdGRsaWIuRGF0ZVRpbWUoe3dNb250aD0wLCB3RGF5PTAsIHdTZWNvbmQ9NzB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHAgPSBzdGRsaWIuRGF0ZVRpbWUoe3dZZWFyPTE5MDAsIHdNb250aD0xLCB3RGF5PTEsIHdIb3VyPTAsIHdNaW51dGU9NTksIHdTZWNvbmQ9NTB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtLSB0ZXN0IGJhc2ljIG1pbnV0ZXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWwgPSAibWludXRlcy0xIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0MSA9IHN0ZGxpYi5EYXRlVGltZSh7d1llYXI9MTkwMCwgIHdNb250aD0xLCB3RGF5PTEsIHdIb3VyPTAsIHdNaW51dGU9MSwgd1NlY29uZD0wfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdDIgPSBzdGRsaWIuRGF0ZVRpbWUoe3dZZWFyPTAsICAgICB3TW9udGg9MCwgd0RheT0wLCB3SG91cj0wLCB3TWludXRlPTEsIHdTZWNvbmQ9MH0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cCA9IHN0ZGxpYi5EYXRlVGltZSh7d1llYXI9MTkwMCwgd01vbnRoPTEsIHdEYXk9MSwgd0hvdXI9MCwgd01pbnV0ZT0wLCB3U2Vjb25kPTB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbCA9ICJtaW51dGVzLTIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQxID0gc3RkbGliLkRhdGVUaW1lKHt3WWVhcj0xOTAwLCAgd01vbnRoPTEsIHdEYXk9MSwgd0hvdXI9MSwgd01pbnV0ZT0wLCB3U2Vjb25kPTB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0MiA9IHN0ZGxpYi5EYXRlVGltZSh7d1llYXI9MCwgICAgIHdNb250aD0wLCB3RGF5PTAsIHdIb3VyPTAsIHdNaW51dGU9NjAsIHdTZWNvbmQ9MH0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cCA9IHN0ZGxpYi5EYXRlVGltZSh7d1llYXI9MTkwMCwgd01vbnRoPTEsIHdEYXk9MSwgd0hvdXI9MCwgd01pbnV0ZT0wLCB3U2Vjb25kPTB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbCA9ICJtaW51dGVzLTMiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQxID0gc3RkbGliLkRhdGVUaW1lKHt3WWVhcj0xOTAwLCAgd01vbnRoPTEsIHdEYXk9MSwgd0hvdXI9MSwgd01pbnV0ZT0wLCB3U2Vjb25kPTB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0MiA9IHN0ZGxpYi5EYXRlVGltZSh7d1llYXI9MCwgICAgIHdNb250aD0wLCB3RGF5PTAsIHdIb3VyPTAsIHdNaW51dGU9NzAsIHdTZWNvbmQ9MH0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cCA9IHN0ZGxpYi5EYXRlVGltZSh7d1llYXI9MTg5OSwgd01vbnRoPTEyLCB3RGF5PTMxLCB3SG91cj0yMywgd01pbnV0ZT01MCwgd1NlY29uZD0wfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLS0gdGVzdCBiYXNpYyBob3VycwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbCA9ICJob3Vycy0xIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0MSA9IHN0ZGxpYi5EYXRlVGltZSh7d1llYXI9MTkwMCwgIHdNb250aD0xLCB3RGF5PTEsIHdIb3VyPTEsIHdNaW51dGU9MCwgd1NlY29uZD0wfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdDIgPSBzdGRsaWIuRGF0ZVRpbWUoe3dZZWFyPTAsICAgICB3TW9udGg9MCwgd0RheT0wLCB3SG91cj0xLCB3TWludXRlPTAsIHdTZWNvbmQ9MH0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cCA9IHN0ZGxpYi5EYXRlVGltZSh7d1llYXI9MTkwMCwgd01vbnRoPTEsIHdEYXk9MSwgd0hvdXI9MCwgd01pbnV0ZT0wLCB3U2Vjb25kPTB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbCA9ICJob3Vycy0yIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0MSA9IHN0ZGxpYi5EYXRlVGltZSh7d1llYXI9MTkwMCwgIHdNb250aD0xLCB3RGF5PTEsIHdIb3VyPTEsIHdNaW51dGU9MCwgd1NlY29uZD0wfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdDIgPSBzdGRsaWIuRGF0ZVRpbWUoe3dZZWFyPTAsICAgICB3TW9udGg9MCwgd0RheT0wLCB3SG91cj0yNSwgd01pbnV0ZT0wLCB3U2Vjb25kPTB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHAgPSBzdGRsaWIuRGF0ZVRpbWUoe3dZZWFyPTE4OTksIHdNb250aD0xMiwgd0RheT0zMSwgd0hvdXI9MCwgd01pbnV0ZT0wLCB3U2Vjb25kPTB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtLSB0ZXN0IGJhc2ljIGRheXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWwgPSAiZGF5cy0xIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0MSA9IHN0ZGxpYi5EYXRlVGltZSh7d1llYXI9MTkwMCwgIHdNb250aD0xLCB3RGF5PTIsIHdIb3VyPTEsIHdNaW51dGU9MCwgd1NlY29uZD0wfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdDIgPSBzdGRsaWIuRGF0ZVRpbWUoe3dZZWFyPTAsICAgICB3TW9udGg9MCwgd0RheT0xLCB3SG91cj0wLCB3TWludXRlPTAsIHdTZWNvbmQ9MH0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cCA9IHN0ZGxpYi5EYXRlVGltZSh7d1llYXI9MTkwMCwgd01vbnRoPTEsIHdEYXk9MSwgd0hvdXI9MSwgd01pbnV0ZT0wLCB3U2Vjb25kPTB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbCA9ICJkYXlzLTIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQxID0gc3RkbGliLkRhdGVUaW1lKHt3WWVhcj0xOTAwLCAgd01vbnRoPTEsIHdEYXk9Miwgd0hvdXI9MSwgd01pbnV0ZT0wLCB3U2Vjb25kPTB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0MiA9IHN0ZGxpYi5EYXRlVGltZSh7d1llYXI9MCwgICAgIHdNb250aD0wLCB3RGF5PTIsIHdIb3VyPTAsIHdNaW51dGU9MCwgd1NlY29uZD0wfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwID0gc3RkbGliLkRhdGVUaW1lKHt3WWVhcj0xODk5LCB3TW9udGg9MTIsIHdEYXk9MzEsIHdIb3VyPTEsIHdNaW51dGU9MCwgd1NlY29uZD0wfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWwgPSAiZGF5cy0zIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0MSA9IHN0ZGxpYi5EYXRlVGltZSh7d1llYXI9MTkwMCwgIHdNb250aD0xLCB3RGF5PTEsIHdIb3VyPTEsIHdNaW51dGU9MCwgd1NlY29uZD0wfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdDIgPSBzdGRsaWIuRGF0ZVRpbWUoe3dZZWFyPTAsICAgICB3TW9udGg9MCwgd0RheT0zMSwgd0hvdXI9MCwgd01pbnV0ZT0wLCB3U2Vjb25kPTB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHAgPSBzdGRsaWIuRGF0ZVRpbWUoe3dZZWFyPTE4OTksIHdNb250aD0xMiwgd0RheT0xLCB3SG91cj0xLCB3TWludXRlPTAsIHdTZWNvbmQ9MH0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsID0gImRheXMtNCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdDEgPSBzdGRsaWIuRGF0ZVRpbWUoe3dZZWFyPTE5MDAsICB3TW9udGg9MSwgd0RheT0xLCB3SG91cj0xLCB3TWludXRlPTAsIHdTZWNvbmQ9MH0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQyID0gc3RkbGliLkRhdGVUaW1lKHt3WWVhcj0wLCAgICAgd01vbnRoPTAsIHdEYXk9MzIsIHdIb3VyPTAsIHdNaW51dGU9MCwgd1NlY29uZD0wfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwID0gc3RkbGliLkRhdGVUaW1lKHt3WWVhcj0xODk5LCB3TW9udGg9MTEsIHdEYXk9MzAsIHdIb3VyPTEsIHdNaW51dGU9MCwgd1NlY29uZD0wfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLS0gdGVzdCBiYXNpYyBtb250aHMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWwgPSAibW9udGhzLTEiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQxID0gc3RkbGliLkRhdGVUaW1lKHt3WWVhcj0xOTAwLCAgd01vbnRoPTEsIHdEYXk9MSwgd0hvdXI9MSwgd01pbnV0ZT0wLCB3U2Vjb25kPTB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0MiA9IHN0ZGxpYi5EYXRlVGltZSh7d1llYXI9MCwgICAgIHdNb250aD0wLCB3RGF5PTAsIHdIb3VyPTAsIHdNaW51dGU9MCwgd1NlY29uZD0wfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwID0gc3RkbGliLkRhdGVUaW1lKHt3WWVhcj0xOTAwLCB3TW9udGg9MSwgd0RheT0xLCB3SG91cj0xLCB3TWludXRlPTAsIHdTZWNvbmQ9MH0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsID0gIm1vbnRocy0yIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0MSA9IHN0ZGxpYi5EYXRlVGltZSh7d1llYXI9MTkwMCwgIHdNb250aD0xLCB3RGF5PTEsIHdIb3VyPTEsIHdNaW51dGU9MCwgd1NlY29uZD0wfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdDIgPSBzdGRsaWIuRGF0ZVRpbWUoe3dZZWFyPTAsICAgICB3TW9udGg9MCwgd0RheT0wLCB3SG91cj0wLCB3TWludXRlPTAsIHdTZWNvbmQ9MH0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cCA9IHN0ZGxpYi5EYXRlVGltZSh7d1llYXI9MTkwMCwgd01vbnRoPTEsIHdEYXk9MSwgd0hvdXI9MSwgd01pbnV0ZT0wLCB3U2Vjb25kPTB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbCA9ICJtb250aHMtMyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdDEgPSBzdGRsaWIuRGF0ZVRpbWUoe3dZZWFyPTE5MDAsICB3TW9udGg9MSwgd0RheT0xLCB3SG91cj0xLCB3TWludXRlPTAsIHdTZWNvbmQ9MH0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQyID0gc3RkbGliLkRhdGVUaW1lKHt3WWVhcj0wLCAgICAgd01vbnRoPTAsIHdEYXk9MCwgd0hvdXI9MCwgd01pbnV0ZT0wLCB3U2Vjb25kPTB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHAgPSBzdGRsaWIuRGF0ZVRpbWUoe3dZZWFyPTE5MDAsIHdNb250aD0xLCB3RGF5PTEsIHdIb3VyPTEsIHdNaW51dGU9MCwgd1NlY29uZD0wfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLS0gdGVzdCBiYXNpYyB5ZWFyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsID0gInllYXJzLTEiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQxID0gc3RkbGliLkRhdGVUaW1lKHt3WWVhcj0xOTAwLCAgd01vbnRoPTIsIHdEYXk9MSwgd0hvdXI9MSwgd01pbnV0ZT0wLCB3U2Vjb25kPTB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0MiA9IHN0ZGxpYi5EYXRlVGltZSh7d1llYXI9MCwgICAgIHdNb250aD0xLCB3RGF5PTAsIHdIb3VyPTAsIHdNaW51dGU9MCwgd1NlY29uZD0wfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwID0gc3RkbGliLkRhdGVUaW1lKHt3WWVhcj0xOTAwLCB3TW9udGg9MSwgd0RheT0xLCB3SG91cj0xLCB3TWludXRlPTAsIHdTZWNvbmQ9MH0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsID0gInllYXJzLTIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQxID0gc3RkbGliLkRhdGVUaW1lKHt3WWVhcj0xOTAwLCAgd01vbnRoPTIsIHdEYXk9MSwgd0hvdXI9MSwgd01pbnV0ZT0wLCB3U2Vjb25kPTB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0MiA9IHN0ZGxpYi5EYXRlVGltZSh7d1llYXI9MCwgICAgIHdNb250aD0yLCB3RGF5PTAsIHdIb3VyPTAsIHdNaW51dGU9MCwgd1NlY29uZD0wfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwID0gc3RkbGliLkRhdGVUaW1lKHt3WWVhcj0xODk5LCB3TW9udGg9MTIsIHdEYXk9MSwgd0hvdXI9MSwgd01pbnV0ZT0wLCB3U2Vjb25kPTB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbCA9ICJ5ZWFycy0zIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0MSA9IHN0ZGxpYi5EYXRlVGltZSh7d1llYXI9MTkwMCwgIHdNb250aD0xLCB3RGF5PTEsIHdIb3VyPTEsIHdNaW51dGU9MCwgd1NlY29uZD0wfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdDIgPSBzdGRsaWIuRGF0ZVRpbWUoe3dZZWFyPTAsICAgICB3TW9udGg9MTQsIHdEYXk9MCwgd0hvdXI9MCwgd01pbnV0ZT0wLCB3U2Vjb25kPTB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHAgPSBzdGRsaWIuRGF0ZVRpbWUoe3dZZWFyPTE4OTgsIHdNb250aD0xMSwgd0RheT0xLCB3SG91cj0xLCB3TWludXRlPTAsIHdTZWNvbmQ9MH0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgZm9yIHRlc3QgaW4gdGVzdHMuZWFjaCgpIGRvCiAgICAgIGxvY2FsIHJldCA9IHRlc3QudDEgLSB0ZXN0LnQyCiAgICAgIGxvY2FsIHJlc3VsdCA9ICJGQUlMIgogICAgICBpZiByZXQgPT0gdGVzdC5leHAgdGhlbgogICAgICAgICByZXN1bHQgPSAiUEFTUyIKICAgICAgZW5kCiAgICAgIGRlYnVnLmRlYnVnKHJlc3VsdCwgdGVzdC5sYWJlbCAuLiAiICAiIC4uIHRvc3RyaW5nKHRlc3QudDEpIC4uICIgLSAiIC4uIHRvc3RyaW5nKHRlc3QudDIpIC4uICIgPSAiIC4uIHRvc3RyaW5nKHJldCkgLi4gIiBleHA6ICIgLi4gdG9zdHJpbmcodGVzdC5leHApKQogICAgICBpZiByZXQgfj0gdGVzdC5leHAgdGhlbgogICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgZW5kCiAgIGVuZAogICByZXR1cm4gdHJ1ZQplbmQKCmZ1bmN0aW9uIHN0ZGxpYi5EYXRlVGltZSh0aW1lc3RydWN0KQogICBsb2NhbCBzZWxmID0ge30KICAgbG9jYWwgbXQgPSB7CiAgICAgIF9fbHQgID0gc3RkbGliLkRhdGVUaW1lVXRpbHMuX19sdCwKICAgICAgX19sZSAgPSBzdGRsaWIuRGF0ZVRpbWVVdGlscy5fX2xlLAogICAgICBfX2VxICA9IHN0ZGxpYi5EYXRlVGltZVV0aWxzLl9fZXEsCiAgICAgIF9fYWRkID0gc3RkbGliLkRhdGVUaW1lVXRpbHMuX19hZGQsCiAgICAgIF9fc3ViID0gc3RkbGliLkRhdGVUaW1lVXRpbHMuX19zdWIsCiAgIH0KICAgc2V0bWV0YXRhYmxlKHNlbGYsIG10KQogICBtdC5fX3R5cGUgPSAiRGF0ZVRpbWUiCgogICBpZiB0aW1lc3RydWN0IGFuZCB0eXBlKHRpbWVzdHJ1Y3QpID09ICJ0YWJsZSIgdGhlbgogICAgICBmb3IgZmllbGQgaW4gc3RkbGliLkRhdGVUaW1lVXRpbHMuZmllbGRzLmVhY2goKSBkbwogICAgICAgICBpZiB0aW1lc3RydWN0W2ZpZWxkXSB0aGVuCiAgICAgICAgICAgIHNlbGZbZmllbGRdID0gdGltZXN0cnVjdFtmaWVsZF0KICAgICAgICAgZWxzZQogICAgICAgICAgICBpZiBmaWVsZCA9PSAid1llYXIiIG9yCiAgICAgICAgICAgICAgIGZpZWxkID09ICJ3SG91ciIgb3IKICAgICAgICAgICAgICAgZmllbGQgPT0gIndNaW51dGUiIG9yCiAgICAgICAgICAgICAgIGZpZWxkID09ICJ3U2Vjb25kIiB0aGVuCiAgICAgICAgICAgICAgIHNlbGZbZmllbGRdID0gMAogICAgICAgICAgICBlbHNlaWYgZmllbGQgPT0gIndNb250aCIgb3IKICAgICAgICAgICAgICAgZmllbGQgPT0gIndEYXkiIHRoZW4KICAgICAgICAgICAgICAgc2VsZltmaWVsZF0gPSAxCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgc2VsZltmaWVsZF0gPSAwCiAgICAgICAgICAgIGVuZAogICAgICAgICBlbmQKICAgICAgZW5kCiAgIGVsc2VpZiB0aW1lc3RydWN0IGFuZCB0eXBlKHRpbWVzdHJ1Y3QpID09ICJzdHJpbmciIHRoZW4KICAgICAgIGxvY2FsIHksIG1vLCBkLCBoLCBtaSwgcywgXywgX18KICAgICAgIF8sIF9fLCB5LCBtbywgZCwgaCwgbWksIHMgID0gc3RyaW5nLmZpbmQodGltZXN0cnVjdCwgIiglZCVkJWQlZCktKCVkJWQpLSglZCVkKVQoJWQlZCk6KCVkJWQpOiglZCVkKSIpCiAgICAgICBzZWxmLndZZWFyID0gdG9udW1iZXIoeSkgb3IgMAogICAgICAgc2VsZi53TW9udGggPSB0b251bWJlcihtbykgb3IgMQogICAgICAgc2VsZi53RGF5ID0gdG9udW1iZXIoZCkgb3IgMQogICAgICAgc2VsZi53SG91ciA9IHRvbnVtYmVyKGgpIG9yIDAKICAgICAgIHNlbGYud01pbnV0ZSA9IHRvbnVtYmVyKG1pKSBvciAwCiAgICAgICBzZWxmLndTZWNvbmQgPSB0b251bWJlcihzKSBvciAwCiAgIGVsc2UKICAgICAgc2VsZi53WWVhciA9IDE5ODcKICAgICAgc2VsZi53TW9udGggPSAxMAogICAgICBzZWxmLndEYXkgPSAxMAogICAgICBzZWxmLndIb3VyID0gMAogICAgICBzZWxmLndNaW51dGUgPSAwCiAgICAgIHNlbGYud1NlY29uZCA9IDAKICAgZW5kCgogICBmdW5jdGlvbiBtdC5fX3Rvc3RyaW5nKHQpCiAgICAgIHJldHVybiAiRGF0ZXRpbWUoIiAuLiBzdGRsaWIuQ29udmVydFN5c3RlbVRpbWUodCkgLi4gIikiCiAgIGVuZAoKICAgLS0tCiAgIC0tIHJlZHVjZV9kYXRlCiAgIC0tIHNpbXBsaWZ5IHRoZSBmaWVsZHMgb2YgdGhpcyBkYXRldGltZSwgZm9yIGluc3RhbmNlCiAgIC0tICAgY29udmVydCA3MCBzZWNvbmRzIHRvIDEgbWludXRlIGFuZCAxMCBzZWNvbmRzCiAgIHNlbGYuX3JlZHVjZV9kYXRlID0gZnVuY3Rpb24oKQogICAgICAtLS0KICAgICAgLS0gaW50X2RpdigpCiAgICAgIC0tIEludGVnZXIgZGl2aXNpb24KICAgICAgLS0gQHJldHVybiBpbnRlZ2VyIGRpdmlzaW9uIHJlc3VsdCwgcmVtYWluZGVyCiAgICAgIGxvY2FsIGZ1bmN0aW9uIGludF9kaXYobnVtLCBkZW4pCiAgICAgICAgIHJldHVybiAobnVtIC0gbWF0aC5tb2QobnVtLCBkZW4pKSAvIGRlbiwgbWF0aC5tb2QobnVtLCBkZW4pCiAgICAgIGVuZAoKICAgICAgbG9jYWwgbW9udGhfZGF5cyA9IHsgMzEsIDI4LCAzMSwgMzAsIDMxLCAzMCwgMzEsIDMxLCAzMCwgMzEsIDMwLCAzMSB9CgogICAgICBsb2NhbCBiQ29udCA9IHRydWUKICAgICAgd2hpbGUgYkNvbnQgZG8KICAgICAgICAgYkNvbnQgPSBmYWxzZQoKICAgICAgICAgaWYgc2VsZi53TW9udGggPiAxMiB0aGVuCiAgICAgICAgICAgIC0tIG1vbnRoIGlzIDEtaW5kZXhlZAogICAgICAgICAgICBzZWxmLndZZWFyICA9IHNlbGYud1llYXIgKyBpbnRfZGl2KHNlbGYud01vbnRoLCAxMikKICAgICAgICAgICAgc2VsZi53TW9udGggPSBtYXRoLm1vZChzZWxmLndNb250aCAtIDEsIDEyKSArIDEKICAgICAgICAgICAgYkNvbnQgPSB0cnVlCiAgICAgICAgIGVuZAoKICAgICAgICAgaWYgc2VsZi53TW9udGggPiAwIGFuZCBzZWxmLndNb250aCA8IDEzIHRoZW4KICAgICAgICAgICAgaWYgbWF0aC5tb2Qoc2VsZi53WWVhciwgNCkgPT0gMCBhbmQgc2VsZi53RGF5ID4gMjkgYW5kIHNlbGYud01vbnRoID09IDIgdGhlbgogICAgICAgICAgICAgICAtLSBoYW5kbGUgbGVhcCB5ZWFyCiAgICAgICAgICAgICAgIC0tIGRheSBpcyAxLWluZGV4ZWQKICAgICAgICAgICAgICAgc2VsZi53RGF5ID0gc2VsZi53RGF5IC0gMjkKICAgICAgICAgICAgICAgc2VsZi53TW9udGggPSBzZWxmLndNb250aCArIDEKICAgICAgICAgICAgICAgYkNvbnQgPSB0cnVlCiAgICAgICAgICAgIGVsc2VpZiBzZWxmLndEYXkgPiBtb250aF9kYXlzW3NlbGYud01vbnRoXSB0aGVuCiAgICAgICAgICAgICAgIC0tIGRheSBpcyAxLWluZGV4ZWQKICAgICAgICAgICAgICAgc2VsZi53RGF5ID0gc2VsZi53RGF5IC0gbW9udGhfZGF5c1tzZWxmLndNb250aF0KICAgICAgICAgICAgICAgc2VsZi53TW9udGggPSBzZWxmLndNb250aCArIDEKICAgICAgICAgICAgICAgYkNvbnQgPSB0cnVlCiAgICAgICAgICAgIGVuZAogICAgICAgICBlbmQKCiAgICAgICAgIGlmIHNlbGYud0hvdXIgPiAyMyB0aGVuCiAgICAgICAgICAgIHNlbGYud0RheSA9IHNlbGYud0RheSArIGludF9kaXYoc2VsZi53SG91ciwgMjQpCiAgICAgICAgICAgIHNlbGYud0hvdXIgPSBtYXRoLm1vZChzZWxmLndIb3VyLCAyNCkKICAgICAgICAgICAgYkNvbnQgPSB0cnVlCiAgICAgICAgIGVuZAoKICAgICAgICAgaWYgc2VsZi53TWludXRlID4gNTkgdGhlbgogICAgICAgICAgICBzZWxmLndIb3VyID0gc2VsZi53SG91ciArIGludF9kaXYoc2VsZi53TWludXRlLCA2MCkKICAgICAgICAgICAgc2VsZi53TWludXRlID0gbWF0aC5tb2Qoc2VsZi53TWludXRlLCA2MCkKICAgICAgICAgICAgYkNvbnQgPSB0cnVlCiAgICAgICAgIGVuZAoKICAgICAgICAgaWYgc2VsZi53U2Vjb25kID4gNTkgdGhlbgogICAgICAgICAgICBzZWxmLndNaW51dGUgPSBzZWxmLndNaW51dGUgKyBpbnRfZGl2KHNlbGYud1NlY29uZCwgNjApCiAgICAgICAgICAgIHNlbGYud1NlY29uZCA9IG1hdGgubW9kKHNlbGYud1NlY29uZCwgNjApCiAgICAgICAgICAgIGJDb250ID0gdHJ1ZQogICAgICAgICBlbmQKCiAgICAgICAgIGlmIHNlbGYud1NlY29uZCA8IDAgdGhlbgogICAgICAgICAgICBpZiBzZWxmLndTZWNvbmQgPCAtNTkgdGhlbgogICAgICAgICAgICAgICBzZWxmLndNaW51dGUgPSBzZWxmLndNaW51dGUgLSBpbnRfZGl2KC1zZWxmLndTZWNvbmQsIDYwKQogICAgICAgICAgICAgICBzZWxmLndTZWNvbmQgPSBtYXRoLm1vZChzZWxmLndTZWNvbmQsIDYwKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgaWYgc2VsZi53U2Vjb25kIDwgMCB0aGVuCiAgICAgICAgICAgICAgIHNlbGYud01pbnV0ZSA9IHNlbGYud01pbnV0ZSAtIDEKICAgICAgICAgICAgICAgc2VsZi53U2Vjb25kID0gNjAgKyBzZWxmLndTZWNvbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGJDb250ID0gdHJ1ZQogICAgICAgICBlbmQKCiAgICAgICAgIGlmIHNlbGYud01pbnV0ZSA8IDAgdGhlbgogICAgICAgICAgICBpZiBzZWxmLndNaW51dGUgPCAtNTkgdGhlbgogICAgICAgICAgICAgICBzZWxmLndIb3VyID0gc2VsZi53SG91ciAtIGludF9kaXYoLXNlbGYud01pbnV0ZSwgNjApCiAgICAgICAgICAgICAgIHNlbGYud01pbnV0ZSA9IG1hdGgubW9kKHNlbGYud01pbnV0ZSwgNjApCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBpZiBzZWxmLndNaW51dGUgPCAwIHRoZW4KICAgICAgICAgICAgICAgc2VsZi53SG91ciA9IHNlbGYud0hvdXItIDEKICAgICAgICAgICAgICAgc2VsZi53TWludXRlID0gNjAgKyBzZWxmLndNaW51dGUKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGJDb250ID0gdHJ1ZQogICAgICAgICBlbmQKCiAgICAgICAgIGlmIHNlbGYud0hvdXIgPCAwIHRoZW4KICAgICAgICAgICAgaWYgc2VsZi53SG91ciA8IC0yMyB0aGVuCiAgICAgICAgICAgICAgIHNlbGYud0RheSA9IHNlbGYud0RheSAtIGludF9kaXYoLXNlbGYud0hvdXIsIDI0KQogICAgICAgICAgICAgICBzZWxmLndIb3VyID0gbWF0aC5tb2Qoc2VsZi53SG91ciwgMjQpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBpZiBzZWxmLndIb3VyIDwgMCB0aGVuCiAgICAgICAgICAgICAgIHNlbGYud0RheSA9IHNlbGYud0RheSAtIDEKICAgICAgICAgICAgICAgc2VsZi53SG91ciA9IDI0ICsgc2VsZi53SG91cgogICAgICAgICAgICBlbmQKICAgICAgICAgICAgYkNvbnQgPSB0cnVlCiAgICAgICAgIGVuZAoKICAgICAgICAgaWYgc2VsZi53RGF5IDwgMSB0aGVuCiAgICAgICAgICAgIC0tIG9ubHkgaGFuZGxlIG9uZSBtb250aCBhdCBhIHRpbWUsIGFuZCBsb29wCiAgICAgICAgICAgIHNlbGYud01vbnRoID0gc2VsZi53TW9udGggLSAxCiAgICAgICAgICAgIGlmIHNlbGYud01vbnRoID09IDIgYW5kIG1hdGgubW9kKHNlbGYud1llYXIsIDQpID09IDAgdGhlbgogICAgICAgICAgICAgICAtLSBsZWFwIHllYXIKICAgICAgICAgICAgICAgc2VsZi53RGF5ID0gMjkgKyBzZWxmLndEYXkKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICBsb2NhbCBpZHggPSBtYXRoLm1vZChzZWxmLndNb250aCAtIDEsIDEyKQogICAgICAgICAgICAgICBpZiBpZHggPCAwIHRoZW4gaWR4ID0gMTIgKyBpZHggZW5kCiAgICAgICAgICAgICAgIGlkeCA9IGlkeCArIDEKICAgICAgICAgICAgICAgc2VsZi53RGF5ID0gbW9udGhfZGF5c1tpZHhdICsgc2VsZi53RGF5CiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBiQ29udCA9IHRydWUKICAgICAgICAgZW5kCgogICAgICAgICBpZiBzZWxmLndNb250aCA8IDEgdGhlbgogICAgICAgICAgICBpZiBzZWxmLndNb250aCAtIDEgPCAtMTEgdGhlbgogICAgICAgICAgICAgICBzZWxmLndZZWFyID0gc2VsZi53WWVhciArIGludF9kaXYoc2VsZi53TW9udGggLSAxLCAxMikKICAgICAgICAgICAgICAgc2VsZi53TW9udGggPSBtYXRoLm1vZChzZWxmLndNb250aCwgMTIpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBpZiBzZWxmLndNb250aCA8IDEgdGhlbgogICAgICAgICAgICAgICBzZWxmLndZZWFyID0gc2VsZi53WWVhciAtIDEKICAgICAgICAgICAgICAgc2VsZi53TW9udGggPSAxMiArIHNlbGYud01vbnRoCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBiQ29udCA9IHRydWUKICAgICAgICAgZW5kCiAgICAgIGVuZAogICBlbmQKCiAgIHNlbGYuaXNvZm9ybWF0ID0gZnVuY3Rpb24oKQogICAgICByZXR1cm4gc3RkbGliLkNvbnZlcnRTeXN0ZW1UaW1lKHNlbGYpCiAgIGVuZAoKICAgcmV0dXJuIHNlbGYKZW5kCgotLS0KLS0gU3RyaW5nQnVpbGRlcgotLSBBIFN0cmluZ0J1aWxkZXIgaXMgYSBjbGFzcyB0aGF0IGVmZmljaWVudCBidWlsZHMgc3RyaW5ncyB3aXRoIHRoZSBhcHBlbmQoKQotLSBvcGVyYXRpb24uCi0tIEBub3RlIEJ1aWxkIHN0cmluZ3MgZnJvbSB0aGUgcmlnaHQgaGFuZCBzaWRlIG9ubHkuCmZ1bmN0aW9uIHN0ZGxpYi5TdHJpbmdCdWlsZGVyKCkKICAgbG9jYWwgX3MgPSB7IiJ9CiAgIGxvY2FsIHNlbGYgPSB7fQogICBsb2NhbCBtdCA9IHt9CiAgIHNldG1ldGF0YWJsZShzZWxmLCBtdCkKICAgbXQuX190eXBlID0gIlN0cmluZ0J1aWxkZXIiCgogICBzZWxmLl9kaXJ0eSA9IHRydWUKCiAgIC0tLQogICAtLSBhcHBlbmQoKQogICAtLSBBcHBlbmQgdGhlIGdpdmVuIHN0cmluZyB0byB0aGUgZW5kIG9mIHRoaXMgc3RyaW5nLgogICAtLSBAcGFyYW0gcyBBIHN0cmluZyBvciBTdHJpbmdCdWlsZGVyLgogICAtLSBAcmV0dXJuIHNlbGYKICAgc2VsZi5hcHBlbmQgPSBmdW5jdGlvbihzKQogICAgICBzZWxmLl9kaXJ0eSA9IHRydWUKICAgICAgc2VsZi5fY2FjaGUgPSAiIgogICAgICBsb2NhbCBzbXQgPSBnZXRtZXRhdGFibGUocykKICAgICAgaWYgc210IGFuZCBzbXQuX190eXBlID09IG10Ll9fdHlwZSB0aGVuCiAgICAgICAgIHRhYmxlLmluc2VydChfcywgcy5zdHJpbmcoKSkKICAgICAgZWxzZQogICAgICAgICB0YWJsZS5pbnNlcnQoX3MsIHMpCiAgICAgIGVuZAogICAgICBmb3IgaSA9IHRhYmxlLmdldG4oX3MpIC0gMSwgMSwgLTEgZG8KICAgICAgICAgaWYgc3RyaW5nLmxlbihfc1tpXSkgPiBzdHJpbmcubGVuKF9zW2kgKyAxXSkgdGhlbgogICAgICAgICAgICBicmVhawogICAgICAgICBlbmQKICAgICAgICAgX3NbaV0gPSBfc1tpXSAuLiB0YWJsZS5yZW1vdmUoX3MpCiAgICAgIGVuZAogICAgICByZXR1cm4gc2VsZgogICBlbmQKCiAgIC0tLQogICAtLSBzdHJpbmcoKQogICAtLSBAcmV0dXJuIFRoZSBzdHJpbmcgdGhhdCB0aGlzIFN0cmluZ0J1aWxkZXIgY29uc3RydWN0ZWQuCiAgIHNlbGYuc3RyaW5nID0gZnVuY3Rpb24oKQogICAgICBpZiBzZWxmLl9kaXJ0eSB0aGVuCiAgICAgICAgIHNlbGYuX2NhY2hlID0gdGFibGUuY29uY2F0KF9zKQogICAgICAgICBzZWxmLl9kaXJ0eSA9IGZhbHNlCiAgICAgICAgIHJldHVybiBzZWxmLl9jYWNoZQogICAgICBlbHNlCiAgICAgICAgIHJldHVybiBzZWxmLl9jYWNoZQogICAgICBlbmQKICAgZW5kCgogICAtLS0KICAgLS0gX19jb25jYXQoKQogICAtLSBTdHJpbmdCdWlsZGVyIG92ZXJsb2FkcyB0aGUgLi4gb3BlcmF0b3IuCiAgIC0tIFJlbWVtYmVyLCBidWlsZCBvbmx5IGZyb20gdGhlIHJpZ2h0IGhhbmQgc2lkZS4KICAgLS0gVW5kZWZpbmVkIGJlaGF2aW9yIGlmIHlvdSB0cnkgdG8gYnVpbGQgZnJvbSB0aGUgbGVmdC4KICAgZnVuY3Rpb24gbXQuX19jb25jYXQoYSwgYikKICAgICAgbG9jYWwgYm10ID0gZ2V0bWV0YXRhYmxlKGIpCiAgICAgIGlmIGJtdCBhbmQgYm10Ll9fdHlwZSA9PSBtdC5fX3R5cGUgdGhlbgogICAgICAgICBzZWxmLmFwcGVuZChiLnN0cmluZygpKQogICAgICBlbHNlCiAgICAgICAgIHNlbGYuYXBwZW5kKGIpCiAgICAgIGVuZAogICAgICByZXR1cm4gc2VsZgogICBlbmQKCiAgIGZ1bmN0aW9uIG10Ll9fdG9zdHJpbmcoZSkKICAgICAgcmV0dXJuIHNlbGYuc3RyaW5nKCkKICAgZW5kCgogICByZXR1cm4gc2VsZgplbmQKCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLS0gICBGSUxFSVRFTSBUUkFWRVJTQUwKLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQotLS0KLS0KLS0gQGVycm9yIHN0ZGxpYi5lcnJvcnMuRmFpbGVkVG9PcGVuRlNQYXRoRXJyb3IKIC0tIEByZXR1cm4gc2VsZiwgZXJyb3IKZnVuY3Rpb24gc3RkbGliLlBhdGgocGF0aCwgb3B0aW9ucykKICAgbG9jYWwgc2VsZiA9IHt9CiAgIGxvY2FsIG10ID0ge30KICAgc2V0bWV0YXRhYmxlKHNlbGYsIG10KQoKICAgaWYgbm90IHBhdGggdGhlbiByZXR1cm4gbmlsLCBzdGRsaWIuZXJyb3JzLkZhaWxlZFRvT3BlbkZTUGF0aEVycm9yIGVuZAogICBpZiBwYXRoID09ICIiIHRoZW4gcmV0dXJuIG5pbCwgc3RkbGliLmVycm9ycy5GYWlsZWRUb09wZW5GU1BhdGhFcnJvciBlbmQKCiAgIGxvY2FsIGZmaW5kZmlyc3QgPSBmaWxlLkZpbmRGaXJzdEZpbGVzQVBJCiAgIGxvY2FsIGZmaW5kbmV4dCAgPSBmaWxlLkZpbmROZXh0RmlsZXNBUEkKICAgbG9jYWwgZmZpbmRjbG9zZSA9IGZpbGUuRmluZEZpbGVzQ2xvc2VBUEkKICAgbG9jYWwgZm9wZW4gICAgICA9IGZpbGUuRmlsZU9wZW5BUEkKICAgbG9jYWwgZnNlZWsgICAgICA9IGZpbGUuRmlsZVNlZWtBUEkKICAgbG9jYWwgZnJlYWQgICAgICA9IGZpbGUuRmlsZVJlYWRBUEkKICAgbG9jYWwgZmNsb3NlICAgICA9IGZpbGUuRmlsZUNsb3NlQVBJCiAgIGxvY2FsIGZpbmZvICAgICAgPSBmaWxlLkZpbGVHZXRJbmZvQnlIYW5kbGVBUEkKICAgbG9jYWwgZndyaXRlICAgICA9IGZpbGUuV3JpdGVGaWxlSXRlbUJ5UGF0aEFQSQoKICAgaWYgb3B0aW9ucyB0aGVuCiAgICAgIC0tIFRoZSBNSVIgTHVhIGJpbmRpbmcgZm9yIHJhdyBhdWRpdHMgZG9lcyBub3QgcHJvdmlkZSBzdXBwb3J0IGZvcgogICAgICAtLSBGaW5kRmlyc3RGaWxlcyBvciBGaW5kTmV4dEZpbGVzLiBJbnN0ZWFkLCBhIHNpbmdsZSBjYWxsIHRvIEZpbmRGaWxlc1JBVwogICAgICAtLSBjYW4gYmUgdXNlZCwgd2hpY2ggaGFzIHRvIGJlIGFjY291bnRlZCBmb3IgaGVyZQogICAgICBpZiBvcHRpb25zLm1vZGUgPT0gInJhdyIgdGhlbgoKICAgICAgICAgLS0gc2V0IG9wdGlvbnMgdG8gY29udHJvbCB0aGUgYmVoYXZpb3Igb2YgZmlsZS5GaW5kRmlsZXNSQVcKCiAgICAgICAgIC0tIGFsd2F5cyBpbmNsdWRlIGFjdGl2ZSBmaWxlcwogICAgICAgICBmaWxlLkZpbGVTZXRPcHRpb24oImFjdGl2ZSBmaWxlcyIsICJ0cnVlIikKCiAgICAgICAgIC0tIHlvdSBzcGVjaWZpZWQgZGVwdGggb3IgYXNzdW1lIGN1cnJlbnQgZGlyZWN0b3J5ICgxKSBvbmx5CiAgICAgICAgIGlmIG9wdGlvbnMuZGVwdGggfj0gbmlsIHRoZW4KICAgICAgICAgICAgZmlsZS5GaWxlU2V0T3B0aW9uKCJkZXB0aCIsIG9wdGlvbnMuZGVwdGgpCiAgICAgICAgIGVsc2UKICAgICAgICAgICAgZmlsZS5GaWxlU2V0T3B0aW9uKCJkZXB0aCIsICIxIikKICAgICAgICAgZW5kCgogICAgICAgICAtLSBjaGVjayBpZiBkZWxldGVkIGZpbGVzIHNob3VsZCBiZSBpbmNsdWRlZAogICAgICAgICBpZiBvcHRpb25zLmluY2x1ZGVfZGVsZXRlZCB+PSBuaWwgdGhlbgogICAgICAgICAgICBmaWxlLkZpbGVTZXRPcHRpb24oImRlbGV0ZWQgZmlsZXMiLCAidHJ1ZSIpCiAgICAgICAgIGVsc2UKICAgICAgICAgICAgZmlsZS5GaWxlU2V0T3B0aW9uKCJkZWxldGVkIGZpbGVzIiwgImZhbHNlIikKICAgICAgICAgZW5kCgogICAgICAgICBmZmluZGFsbCAgID0gZmlsZS5GaW5kRmlsZXNSQVcgLS0gRmlsZVNldE9wdGlvbiBjYWxscyBhYm92ZSBhZmZlY3QgYmVoYXZpb3Igb2YgdGhpcyBBUEkKICAgICAgICAgZm9wZW4gICAgICA9IGZpbGUuRmlsZU9wZW5SQVcKICAgICAgICAgZnNlZWsgICAgICA9IGZpbGUuRmlsZVNlZWtSQVcKICAgICAgICAgZnJlYWQgICAgICA9IGZpbGUuRmlsZVJlYWRSQVcKICAgICAgICAgZmNsb3NlICAgICA9IGZpbGUuRmlsZUNsb3NlUkFXCiAgICAgICAgIGZpbmZvICAgICAgPSBuaWwKICAgICAgICAgZndyaXRlICAgICA9IGZpbGUuV3JpdGVGaWxlSXRlbUJ5UGF0aFJBVwoKICAgICAgZWxzZWlmIG5vdCBvcHRpb25zLm1vZGUgdGhlbgogICAgICAgICAgb3B0aW9ucy5tb2RlID0gImFwaSIKICAgICAgZW5kCiAgIGVsc2UKICAgICAgIG9wdGlvbnMgPSB7CiAgICAgICAgICAgbW9kZSA9ICJhcGkiCiAgICAgICB9CiAgIGVuZAoKCiAgIHBhdGggPSBzdGRsaWIucnN0cmlwKHBhdGgsICJcXCIpCiAgIHBhdGggPSBzdGRsaWIucnN0cmlwKHBhdGgsICIvIikKCiAgIG10Ll9fdG9zdHJpbmcgPSBmdW5jdGlvbigpCiAgICAgIHJldHVybiAiUGF0aDogIiAuLiBwYXRoCiAgIGVuZAogICAtLS0KICAgLS0gcGF0aCgpCiAgIC0tIFJldHVybiB0aGUgcGF0aCByZXByZXNlbnRlZCBieSB0aGlzIFBhdGguCiAgIHNlbGYucGF0aCA9IGZ1bmN0aW9uKCkKICAgICAgcmV0dXJuIHBhdGgKICAgZW5kCgogICAtLS0KICAgLS0gc3VicGF0aHMoKQogICAtLSBSZXR1cm4gYSBzdGRsaWIuTGlzdCBvZiBzdGRsaWIuUGF0aCBlbGVtZW50cyB3aGVyZSBlYWNoCiAgIC0tIGVsZW1lbnQgaXMgYSBzdWJwYXRoIG9mIHRoaXMgcGF0aC4KICAgc2VsZi5zdWJwYXRocyA9IGZ1bmN0aW9uKCkKICAgICAgbG9jYWwgaEZpbGUgICAgPSBmYWxzZQogICAgICBsb2NhbCBmaWxlaXRlbSA9IGZhbHNlCiAgICAgIGxvY2FsIGJDb250ICAgID0gZmFsc2UKICAgICAgbG9jYWwgcmV0ICAgICAgPSBzdGRsaWIuTGlzdCgpCgogICAgICAtLS0KICAgICAgLS0gY2JfcmF3X2ZpbGUoKQogICAgICAtLSBDYWxsYmFjayBmdW5jdGlvbiBpbnZva2VkIGJ5IGZpbGUuRmluZEZpbGVzUkFXIGZvciBlYWNoIHBhdGgKICAgICAgbG9jYWwgZnVuY3Rpb24gY2JfcmF3X2ZpbGUoZmlsZV9kYXRhKQogICAgICAgICBpZiBmaWxlX2RhdGEgPT0gbmlsIG9yIGZpbGVfZGF0YVsiRmlsZVBhdGgiXSA9PSBuaWwgdGhlbgogICAgICAgICAgICByZXR1cm4KICAgICAgICAgZW5kCiAgICAgICAgIC0tIGluY2x1ZGUgb3B0aW9ucyB0byBlbnN1cmUgc3VicGF0aHMgYXJlIGFsc28gb3BlbmVkIGluIHJhdyBtb2RlCiAgICAgICAgIGxvY2FsIHAsIGVyciA9IHN0ZGxpYi5QYXRoKGZpbGVfZGF0YS5GaWxlUGF0aCwgb3B0aW9ucykKICAgICAgICAgaWYgbm90IGVyciB0aGVuCiAgICAgICAgICAgIHJldC5hcHBlbmQocCkKICAgICAgICAgZW5kCiAgICAgIGVuZAoKICAgICAgaWYgb3B0aW9ucy5tb2RlID09ICJyYXciIHRoZW4KICAgICAgICAgIC0tIGZvciBSQVcgYXVkaXRzLCBvbmx5IGEgc2luZ2xlIGNhbGwgdG8gdGhpcyBBUEkgaXMKICAgICAgICAgIC0tIG5lZWRlZCBob3dldmVyLCB0aGUgcGF0aCBtdXN0IGVuZCB3aXRoICdcXCcKICAgICAgICAgIHJhd19wYXRoID0gcGF0aCAuLiAiXFwiCiAgICAgICAgICBmZmluZGFsbChyYXdfcGF0aCwgY2JfcmF3X2ZpbGUpCiAgICAgIGVsc2UKICAgICAgICAgIC0tIGZvciBBUEkgYXVkaXRzLCBhIGxvb3AgaXMgbmVlZGVkIHRvIHJldHJpZXZlIGFsbCBmaWxlcwogICAgICAgICAgaEZpbGUsIGZpbGVpdGVtID0gZmZpbmRmaXJzdChwYXRoKQogICAgICAgICAgaWYgZmlsZWl0ZW0gPT0gbmlsIHRoZW4KICAgICAgICAgICAgIGlmIGhGaWxlIHRoZW4KICAgICAgICAgICAgICAgIGZmaW5kY2xvc2UoaEZpbGUpCiAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgIHJldHVybiByZXQKICAgICAgICAgIGVuZAoKICAgICAgICAgIGJDb250ID0gdHJ1ZQogICAgICAgICAgd2hpbGUgYkNvbnQgZG8KICAgICAgICAgICAgIGlmIGZpbGVpdGVtIHRoZW4KICAgICAgICAgICAgICAgIGlmIHN0cmluZy5nZmluZChmaWxlaXRlbS5GaWxlUGF0aCwgIlxcJS4lLiQiKSgpIH49IG5pbCBvcgogICAgICAgICAgICAgICAgICAgc3RyaW5nLmdmaW5kKGZpbGVpdGVtLkZpbGVQYXRoLCAiXFwlLiQiKSgpICB+PSBuaWwKICAgICAgICAgICAgICAgIHRoZW4KICAgICAgICAgICAgICAgICAgIC0tIHBhc3MKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgIGxvY2FsIHAsIGVyciA9IHN0ZGxpYi5QYXRoKGZpbGVpdGVtLkZpbGVQYXRoLCBvcHRpb25zKQogICAgICAgICAgICAgICAgICAgaWYgbm90IGVyciB0aGVuCiAgICAgICAgICAgICAgICAgICAgICByZXQuYXBwZW5kKHApCiAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICBiQ29udCwgZmlsZWl0ZW0gPSBmZmluZG5leHQoaEZpbGUsIHBhdGgpCiAgICAgICAgICBlbmQKICAgICAgICAgIGZmaW5kY2xvc2UocGF0aCkKICAgICAgZW5kCiAgICAgIHJldHVybiByZXQKICAgZW5kCgogICAtLS0KICAgLS0gcmVjdXJzaXZlX2xpc3RpbmcoKQogICAtLSBSZXR1cm4gYSBnZW5lcmF0b3IgdGhhdCB5aWVsZHMgdGhlIHJlY3Vyc2l2ZSBQYXRoIG9iamVjdHMKICAgLS0gb2YgdGhpcyBwYXRoLgogICBzZWxmLnJlY3Vyc2l2ZV9saXN0aW5nID0gZnVuY3Rpb24obWF4X2RlcHRoLCBjdXJyX2RlcHRoKQogICAgICBpZiB0eXBlKGN1cnJfZGVwdGgpID09ICJuaWwiIHRoZW4KICAgICAgICAgY3Vycl9kZXB0aCA9IDEKICAgICAgZW5kCiAgICAgIGxvY2FsIGNvID0gY29yb3V0aW5lLmNyZWF0ZShmdW5jdGlvbigpCiAgICAgICAgIGZvciBmaWxlIGluIHNlbGYuZmlsZXMoKS5lYWNoKCkgZG8KICAgICAgICAgICAgY29yb3V0aW5lLnlpZWxkKGZpbGUpCiAgICAgICAgIGVuZAogICAgICAgICBpZiB0eXBlKG1heF9kZXB0aCkgPT0gIm5pbCIgb3IgY3Vycl9kZXB0aCA8IG1heF9kZXB0aCB0aGVuCiAgICAgICAgICAgIGZvciBkaXJlY3RvcnkgaW4gc2VsZi5kaXJlY3RvcmllcygpLmVhY2goKSBkbwogICAgICAgICAgICAgICBmb3IgZmlsZSBpbiBkaXJlY3RvcnkucmVjdXJzaXZlX2xpc3RpbmcobWF4X2RlcHRoLCBjdXJyX2RlcHRoICsgMSkgZG8KICAgICAgICAgICAgICAgICAgY29yb3V0aW5lLnlpZWxkKGZpbGUpCiAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICAgZW5kCiAgICAgIGVuZCkKICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpCiAgICAgICAgIGxvY2FsIGNvZGUsIGxpbmUgPSBjb3JvdXRpbmUucmVzdW1lKGNvKQogICAgICAgICBpZiBjb2RlIHRoZW4gcmV0dXJuIGxpbmUgZW5kCiAgICAgIGVuZAogICBlbmQKCiAgIC0tLQogICAtLSBVc2UgQVBJIGZ1bmN0aW9ucyB0byBkZXRlcm1pbmUgaWYgYSBwYXRoIGV4aXN0cwogICBzZWxmLmV4aXN0cyA9IGZ1bmN0aW9uKCkKCiAgICAgIGlmIG9wdGlvbnMubW9kZSA9PSAicmF3IiB0aGVuCiAgICAgICAgIGxvY2FsIGhGaWxlID0gZmlsZS5GaWxlT3BlblJBVyhzZWxmLnBhdGgoKSkKICAgICAgICAgbG9jYWwgYiA9IGZpbGUuRmlsZVJlYWRSQVcoaEZpbGUsIDEpCiAgICAgICAgIGZpbGUuRmlsZUNsb3NlUkFXKGhGaWxlKQoKICAgICAgICAgcmV0dXJuIGIgfj0gbmlsCiAgICAgIGVuZAoKICAgICAgLS0gYXQgcm9vdCwgZWcuICJDOiIKICAgICAgaWYgbm90IHN0cmluZy5maW5kKHNlbGYucGF0aCgpLCAiXFwiKSBhbmQgc3RyaW5nLmxlbihzZWxmLnBhdGgoKSkgPT0gMiB0aGVuCiAgICAgICAgIHJldHVybiB0cnVlCiAgICAgIGVuZAoKICAgICAgLS0gcmVjdXJzZSBvbiBwYXJlbnQgZGlyZWN0b3J5CiAgICAgIGxvY2FsIHBhcmVudF9kaXIsIF8sIF9fID0gc3RkbGliLnJwYXJ0aXRpb24oc2VsZi5wYXRoKCksICJcXCIpCiAgICAgIGxvY2FsIHAsIGVyciA9IHN0ZGxpYi5QYXRoKHBhcmVudF9kaXIpCiAgICAgIGlmIGVyciB0aGVuIHJldHVybiBmYWxzZSBlbmQKCiAgICAgIGlmIHN0ZGxpYi5QYXRoKHBhcmVudF9kaXIpLnN1YnBhdGhzKCkuZmlsdGVyKGZ1bmN0aW9uKG8pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzdHJpbmcubG93ZXIoby5wYXRoKCkpID09IHN0cmluZy5sb3dlcihzZWxmLnBhdGgoKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kKS5zaXplKCkgPT0gMCB0aGVuCiAgICAgICAgIHJldHVybiBmYWxzZQogICAgICBlbmQKICAgICAgcmV0dXJuIHRydWUKICAgZW5kCgogICAtLS0KICAgLS0gaW5mbygpCiAgIC0tIFJldHVybiBhIHRhYmxlIGNvbnRhaW5pbmcgaW5mb3JtYXRpb24gYWJvdXQgdGhpcyBwYXRoLgogICAtLSBAZXJyb3Igc3RkbGliLmVycm9ycy5GYWlsZWRUb09wZW5GU1BhdGhFcnJvcgogICAtLSBAcmV0dXJuIGluZm8sIGVycm9yCiAgIC0tICAgVGhlIGluZm8gb2JqZWN0IGNvbnRhaW5zIGF0IGxlYXN0IHRoZSBmaWVsZHM6CiAgIC0tICAgICAtICh1c2VyZGF0YSkgU2l6ZUluQnl0ZXMKICAgLS0gICAgIC0gKHN0cmluZykgRmlsZVBhdGgKICAgLS0gICAgIC0gKHN0cmluZykgZmlsZW5hbWUKICAgLS0gICAgIC0gKERhdGVUaW1lKSBNb2RpZmllZAogICAtLSAgICAgLSAoRGF0ZVRpbWUpIENoYW5nZWQKICAgLS0gICAgIC0gKHN0cmluZykgVXNlcm5hbWUKICAgLS0gICAgIC0gKHN0cmluZykgU2VjdXJpdHlUeXBlCiAgIC0tICAgICAtIChEYXRlVGltZSkgQWNjZXNzZWQKICAgLS0gICAgIC0gKHRhYmxlKSBGaWxlQXR0cmlidXRlcwogICAtLSAgICAgLSAoRGF0ZVRpbWUpIENyZWF0ZWQKICAgLS0gICAgIC0gKHN0cmluZykgU2VjdXJpdHlJRAogICAtLSAgIFNvcnJ5IGZvciB0aGUgY2FwaXRhbGl6YXRpb24gaW5jb25zaXN0ZW5jaWVzLi4uIFRoYXQncyBmcm9tIHRoZSBBUEkuCiAgIHNlbGYuaW5mbyA9IGZ1bmN0aW9uKCkKICAgICAgbG9jYWwgaEZpbGUKICAgICAgaWYgcGF0aCB0aGVuCgogICAgICAgICAtLSBUaGlzIGNvZGUgaXMgbmVlZGVkIHRvIGdldCB0aGUgZmlsZSBtZXRhZGF0YSBhc3NvY2lhdGVkIHdpdGggYW4gTE5LIGZpbGU7CiAgICAgICAgIC0tIGl0IGlzIG5lY2Vzc2FyeSBkdWUgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOgogICAgICAgICAtLSAxKSBXaGVuIHBhc3NlZCB0aGUgcGF0aCBvZiBhbiBMTksgZmlsZSwgRmlsZU9wZW5BUEkgcmV0dXJucyBhIGhhbmRsZSB0byB0aGUKICAgICAgICAgLS0gICAgdGFyZ2V0IGZpbGUgLSBub3QgdGhlIExOSyBmaWxlLiBUaGVyZWZvcmUsIEZpbGVHZXRJbmZvQnlIYW5kbGVBUEkgY2Fubm90CiAgICAgICAgIC0tICAgIGJlIHVzZWQgYXMgaXQgaXNuJ3QgcG9zc2libGUgdG8gYWN0dWFsbHkgZ2V0IGEgaGFuZGxlIHRvIHRoZSBMTksgZmlsZS4KICAgICAgICAgLS0gMikgRmlsZU9wZW5SQVcgcmV0dXJucyBhIGhhbmRsZSB0byB0aGUgTE5LIGZpbGUsIGhvd2V2ZXIsIHRoZXJlIGlzIG5vIFJBVwogICAgICAgICAtLSAgICBlcXVpdmFsZW50IG9mIHRoZSBGaWxlR2V0SW5mb0J5W1BhdGgvSGFuZGxlXSBBUEkgY2FsbHMuIEhhbmRsZXMgb3BlbmVkCiAgICAgICAgIC0tICAgIGJ5IEZpbGVPcGVuUkFXIGNhbm5vdCBiZSB1c2VkIHdpdGggRmlsZUdldEluZm9CeUhhbmRsZUFQSS4KICAgICAgICAgLS0gMykgRmlsZUdldEluZm9CeVBhdGhBUEkgY3Jhc2hlcyB3aGVuIGludm9rZWQ7IGl0IGlzIHVubGlrZWx5IHRoaXMgYWdlbnQgYnVnCiAgICAgICAgIC0tICAgIHdpbGwgZ2V0IHJlc29sdmVkCiAgICAgICAgIC0tIFRoZSB3b3JrLWFyb3VuZCBpcyB0byB1c2UgRmluZEZpcnN0RmlsZSB3aXRoIGEgd2lsZGNhcmQgdGhhdCB3aWxsIG9ubHkgbWF0Y2gKICAgICAgICAgLS0gdGhlIGRlc2lyZWQgTE5LIGZpbGUuCiAgICAgICAgIGlmIHBhdGg6ZmluZCgiJS5bbExdW25OXVtrS10kIikgfj0gbmlsIHRoZW4KICAgICAgICAgICAgLS0gY3JlYXRlIGEgd2lsZGNhcmQgdGhhdCB3aWxsIG9ubHkgbWF0Y2ggdGhlIGRlc2lyZWQgTE5LIGZpbGU7IGR1ZSB0byB0aGUKICAgICAgICAgICAgLS0gbG9naWMgaW4gdGhlIGFnZW50J3MnIEx1YUZpbmRGaXJzdEZpbGVzQVBJIGZ1bmN0aW9uLCB0aGUgd2lsZGNhcmQgbXVzdAogICAgICAgICAgICAtLSBjb250YWluIGFuIGFzdGVyaXguIHRoZSBjb2RlIGJlbG93IGNyZWF0ZXMgdGhlIHdpbGRjYXJkICI8ZmlsZV9kaXI+XFwqPGZpbGVfbmFtZT4iCiAgICAgICAgICAgIGZpbGVfZGlyLCBfXywgZmlsZV9uYW1lID0gc3RkbGliLnJwYXJ0aXRpb24ocGF0aCwgIlxcIikKICAgICAgICAgICAgbG5rX3NlYXJjaF9wYXRoID0gc3RyaW5nLmZvcm1hdCgiJXNcXColcyIsIGZpbGVfZGlyLCBmaWxlX25hbWUpCgogICAgICAgICAgICBoRmlsZSwgZmlsZWluZm8gPSBmZmluZGZpcnN0KGxua19zZWFyY2hfcGF0aCkKICAgICAgICAgICAgbG5rX2ZpbGVpbmZvID0gbmlsCiAgICAgICAgICAgIHdoaWxlIHR5cGUoZmlsZWluZm8pIH49ICJuaWwiIGRvCiAgICAgICAgICAgICAgICAtLSB0aGVyZSBjYW4gb25seSBiZSBvbmUgbWF0Y2gsIHNvIG9uY2UgZm91bmQgZXhpdCB0aGUgbG9vcAogICAgICAgICAgICAgICAgaWYgc3RyaW5nLmxvd2VyKGZpbGVpbmZvLkZpbGVQYXRoKSA9PSBzdHJpbmcubG93ZXIocGF0aCkgdGhlbgogICAgICAgICAgICAgICAgICAgIGxua19maWxlaW5mbyA9IGZpbGVpbmZvCiAgICAgICAgICAgICAgICAgICAgZmlsZWluZm9bImZpbGVuYW1lIl0gPSBmaWxlX25hbWUKICAgICAgICAgICAgICAgICAgICAtLSBTaXplSW5CeXRlcyBpcyBhIEx1YSBsaWdodHVzZXJkYXRhIG9iamVjdCwgd2hpY2ggaXMgYSBwb2ludGVyIHRvIGEgQyBvYmplY3QuCiAgICAgICAgICAgICAgICAgICAgLS0gVGhlcmUgaXMgbm8gd2F5IHRvIGFjY2VzcyB0aGlzIG9iamVjdCBpbiBMdWEgb3RoZXIgdGhhbiB0byBwcmludCBpdCBhcyBhIHN0cmluZy4KICAgICAgICAgICAgICAgICAgICAtLSBUaGUgc3RyaW5nIGZvcm1hdCBjb250YWlucyBhIGhleGxpZmllZCBRV09SRCBpbiB0aGUgZm9sbG93aW5nIGZvcm1hdDoKICAgICAgICAgICAgICAgICAgICAtLSAgICAgICJ1c2VyZGF0YTogMDAwMDAwMDAwMDAwMDAwNCIKICAgICAgICAgICAgICAgICAgICAtLSBUaGlzIGNvZGUgZXh0cmFjdHMgdGhlIFFXT1JEIGFuZCBjb252ZXJ0cyBpdCB0byBhIG51bWJlci4KICAgICAgICAgICAgICAgICAgICBmaWxlaW5mb1siZmlsZXNpemUiXSA9IG5pbAogICAgICAgICAgICAgICAgICAgIHNpemVfaGV4c3RyID0gc3RyaW5nLmdzdWIodG9zdHJpbmcoZmlsZWluZm9bIlNpemVJbkJ5dGVzIl0pLCAndXNlcmRhdGE6ICglZCspJywgJyUxJykKICAgICAgICAgICAgICAgICAgICBpZiB0eXBlKHNpemVfaGV4c3RyKSA9PSAic3RyaW5nIiBhbmQgI3NpemVfaGV4c3RyID09IDE2IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgZmlsZV9zaXplID0gMHgwMDAwMDAwMDAwMDAwMDAwCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHBjYWxsKGZ1bmN0aW9uKCkgZmlsZV9zaXplID0gdG9udW1iZXIoc2l6ZV9oZXhzdHIsIDE2KSBlbmQpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVpbmZvWyJmaWxlc2l6ZSJdID0gZmlsZV9zaXplCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgYkNvbnQsIGZpbGVpbmZvID0gZmZpbmRuZXh0KGhGaWxlLCBsbmtfc2VhcmNoX3BhdGgpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGlmIGhGaWxlIHRoZW4KICAgICAgICAgICAgICAgIGZmaW5kY2xvc2UoaEZpbGUpCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgaWYgdHlwZShsbmtfZmlsZWluZm8pID09ICJ0YWJsZSIgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuIGxua19maWxlaW5mbywgbmlsCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHJldHVybiBuaWwsIHN0ZGxpYi5lcnJvcnMuRmFpbGVkVG9PcGVuRlNQYXRoRXJyb3IKICAgICAgICAgICAgZW5kCiAgICAgICAgIGVuZAoKICAgICAgICAgLS0gZm9yIG5vbi1MTksgZmlsZXMsIG9wZW4gYSBoYW5kbGUgdG8gdGhlIGZpbGUgd2l0aCBGaWxlT3BlbkFQSSBhbmQgY2FsbAogICAgICAgICAtLSBGaWxlR2V0SW5mb0J5SGFuZGxlQVBJCiAgICAgICAgIGhGaWxlID0gZm9wZW4ocGF0aCkKICAgICAgICAgaWYgaEZpbGUgdGhlbgogICAgICAgICAgICBpZiBmaW5mbyA9PSBuaWwgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuIG5pbCwgc3RkbGliLmVycm9ycy5VbmFibGVUb1JlYWRSYXdGaWxlTWV0YWRhdGEKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBsb2NhbCBmaWxlaW5mbyA9IGZpbmZvKGhGaWxlKQogICAgICAgICAgICBmY2xvc2UoaEZpbGUpCiAgICAgICAgICAgIGlmIHR5cGUoZmlsZWluZm8pID09ICJ0YWJsZSIgdGhlbgogICAgICAgICAgICAgICAgZm9yIHRmaWVsZCBpbiBzdGRsaWIuTGlzdCh7IkNyZWF0ZWQiLCAiQWNjZXNzZWQiLCAiTW9kaWZpZWQiLCAiQ2hhbmdlZCJ9KS5lYWNoKCkgZG8KICAgICAgICAgICAgICAgICAgICBmaWxlaW5mb1t0ZmllbGRdID0gc3RkbGliLkRhdGVUaW1lKGZpbGVpbmZvW3RmaWVsZF0pCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIF8sIF9fLCBmaWxlaW5mb1siZmlsZW5hbWUiXSA9IHN0ZGxpYi5ycGFydGl0aW9uKGZpbGVpbmZvWyJGaWxlUGF0aCJdLCAiXFwiKQoKICAgICAgICAgICAgICAgIC0tIFNpemVJbkJ5dGVzIGlzIGEgTHVhIGxpZ2h0dXNlcmRhdGEgb2JqZWN0LCB3aGljaCBpcyBhIHBvaW50ZXIgdG8gYSBDIG9iamVjdC4KICAgICAgICAgICAgICAgIC0tIFRoZXJlIGlzIG5vIHdheSB0byBhY2Nlc3MgdGhpcyBvYmplY3QgaW4gTHVhIG90aGVyIHRoYW4gdG8gcHJpbnQgaXQgYXMgYSBzdHJpbmcuCiAgICAgICAgICAgICAgICAtLSBUaGUgc3RyaW5nIGZvcm1hdCBjb250YWlucyBhIGhleGxpZmllZCBRV09SRCBpbiB0aGUgZm9sbG93aW5nIGZvcm1hdDoKICAgICAgICAgICAgICAgIC0tICAgICAgInVzZXJkYXRhOiAwMDAwMDAwMDAwMDAwMDA0IgogICAgICAgICAgICAgICAgLS0gVGhpcyBjb2RlIGV4dHJhY3RzIHRoZSBRV09SRCBhbmQgY29udmVydHMgaXQgdG8gYSBudW1iZXIuCiAgICAgICAgICAgICAgICBmaWxlaW5mb1siZmlsZXNpemUiXSA9IG5pbAogICAgICAgICAgICAgICAgc2l6ZV9oZXhzdHIgPSBzdHJpbmcuZ3N1Yih0b3N0cmluZyhmaWxlaW5mb1siU2l6ZUluQnl0ZXMiXSksICd1c2VyZGF0YTogKCVkKyknLCAnJTEnKQogICAgICAgICAgICAgICAgaWYgdHlwZShzaXplX2hleHN0cikgPT0gInN0cmluZyIgYW5kICNzaXplX2hleHN0ciA9PSAxNiB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgZmlsZV9zaXplID0gMHgwMDAwMDAwMDAwMDAwMDAwCiAgICAgICAgICAgICAgICAgICAgaWYgcGNhbGwoZnVuY3Rpb24oKSBmaWxlX3NpemUgPSB0b251bWJlcihzaXplX2hleHN0ciwgMTYpIGVuZCkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBmaWxlaW5mb1siZmlsZXNpemUiXSA9IGZpbGVfc2l6ZQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICByZXR1cm4gZmlsZWluZm8sIG5pbAogICAgICAgICAgICBlbmQKICAgICAgICAgZW5kCiAgICAgIGVuZAogICAgICByZXR1cm4gbmlsLCBzdGRsaWIuZXJyb3JzLkZhaWxlZFRvT3BlbkZTUGF0aEVycm9yCiAgIGVuZAoKICAgLS0tCiAgIC0tIGlzX2RpcmVjdG9yeSgpCiAgIC0tIFJldHVybiB0cnVlIGlmIHRoZSBwYXRoIGlzIGEgZGlyZWN0b3J5LCBmYWxzZSBvdGhlcndpc2UuCiAgIHNlbGYuaXNfZGlyZWN0b3J5ID0gZnVuY3Rpb24oKQogICAgICBsb2NhbCByZXQgPSBmYWxzZQogICAgICBsb2NhbCBmaWxlaW5mbywgZXJyID0gc2VsZi5pbmZvKCkKICAgICAgaWYgdHlwZShmaWxlaW5mbykgPT0gInRhYmxlIiB0aGVuCiAgICAgICAgIGZvciBfLCB2IGluIHBhaXJzKGZpbGVpbmZvLkZpbGVBdHRyaWJ1dGVzKSBkbwogICAgICAgICAgICBpZiBzdHJpbmcuZmluZChzdHJpbmcubG93ZXIodiksICJkaXJlY3RvcnkiKSB+PSBuaWwgdGhlbgogICAgICAgICAgICAgICByZXQgPSB0cnVlCiAgICAgICAgICAgIGVuZAogICAgICAgICBlbmQKICAgICAgZW5kCiAgICAgIHJldHVybiByZXQKICAgZW5kCgogICAtLS0KICAgLS0gZmlsZXMoKQogICAtLSBSZXR1cm4gYSBzdGRsaWIuTGlzdCBvZiBzdGRsaWIuUGF0aCBlbGVtZW50cyB3aGVyZQogICAtLSBlYWNoIGVsZW1lbnQgaXMgYSBzdWJwYXRoIG9mIHRoaXMgcGF0aCwgYW5kIG5vdCBhCiAgIC0tIGRpcmVjdG9yeS4KICAgc2VsZi5maWxlcyA9IGZ1bmN0aW9uKCkKICAgICAgcmV0dXJuIHNlbGYuc3VicGF0aHMoKS5maWx0ZXIoZnVuY3Rpb24ocGF0aCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5vdCBwYXRoLmlzX2RpcmVjdG9yeSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZCkKICAgZW5kCgogICAtLS0KICAgLS0gZGlyZWN0b3JpZXMoKQogICAtLSBSZXR1cm4gYSBzdGRsaWIuTGlzdCBvZiBzdGRsaWIuUGF0aCBlbGVtZW50cyB3aGVyZQogICAtLSBlYWNoIGVsZW1lbnQgaXMgYSBzdWJwYXRoIG9mIHRoaXMgcGF0aCwgYW5kIGlzIGEKICAgLS0gZGlyZWN0b3J5LgogICBzZWxmLmRpcmVjdG9yaWVzID0gZnVuY3Rpb24oKQogICAgICByZXR1cm4gc2VsZi5zdWJwYXRocygpLmZpbHRlcihmdW5jdGlvbihwYXRoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGF0aC5pc19kaXJlY3RvcnkoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQpCiAgIGVuZAoKICAgLS0tCiAgIC0tIHJlYWQoKQogICAtLSBSZWFkIGJpbmFyeSBkYXRhIGZyb20gYSBmaWxlIGF0IGEgZ2l2ZW4gb2Zmc2V0IGFuZCByZXR1cm4gaXQgYXMgYSBiaW5hcnkgc3RyaW5nLgogICAtLSBOb3RlLCB0aGlzIGZ1bmN0aW9uIGlzIG5vdCBndWFyYW50ZWVkIHRvIGJlIGVmZmljaWVudCwgc28gbWFueSBjYWxscyB0byByZWFkCiAgIC0tIG1heSBiZSBiZXR0ZXIgZXhlY3V0ZWQgYXMgbG93LWxldmVsIEFQSSBjYWxscy4KICAgLS0gTm90ZSwgdGhhdCBpZiB0aGUgcGF0aCBkb2VzIG5vdCBleGlzdCwgdGhlbiBvcGVuaW5nIHRoZSBmaWxlIG1heSBzdGlsbCBzdWNjZWVkLCBidXQKICAgLS0gICAgYW55IGNhbGxzIHRvIHJlYWQgd2lsbCByZXR1cm4gbmlsLgogICAtLSBAcGFyYW0gb2Zmc2V0IEFuIGludGVnZXIgb2Zmc2V0IGZyb20gd2hpY2ggdG8gcmVhZCwgMCBpbmRleGVkLiBTaG91bGQgYmUgYQogICAtLSAgICBtdWx0aXBsZSBvZiA1MTIuCiAgIC0tIEBwYXJhbSBsZW5ndGggVGhlIGxlbmd0aCBvZiBkYXRhIHRvIHJlYWQsIGluIGJ5dGVzLgogICAtLSBAZXJyb3Igc3RkbGliLmVycm9ycy5DYW5ub3RSZWFkRGlyZWN0b3J5QXNGaWxlRXJyb3IKICAgLS0gQGVycm9yIHN0ZGxpYi5lcnJvcnMuVW5hYmxlVG9TZWVrRmlsZUVycm9yCiAgIC0tIEBlcnJvciBzdGRsaWIuZXJyb3JzLkludmFsaWRGaWxlT2Zmc2V0RXJyb3IKICAgLS0gQHJldHVybiBidWZmZXIsIGVycm9yCiAgIHNlbGYucmVhZCA9IGZ1bmN0aW9uKG9mZnNldCwgbGVuZ3RoKQogICAgICBsb2NhbCBkYXRhCiAgICAgIGlmIHNlbGYuaXNfZGlyZWN0b3J5KCkgdGhlbgogICAgICAgICByZXR1cm4gbmlsLCBzdGRsaWIuZXJyb3JzLkNhbm5vdFJlYWREaXJlY3RvcnlBc0ZpbGVFcnJvcgogICAgICBlbmQKCiAgICAgIGlmIG1hdGgubW9kKG9mZnNldCwgNTEyKSB+PSAwIHRoZW4KICAgICAgICAgcmV0dXJuIG5pbCwgc3RkbGliLmVycm9ycy5JbnZhbGlkRmlsZU9mZnNldEVycm9yCiAgICAgIGVuZAoKICAgICAgbG9jYWwgaEZpbGUgPSBmb3BlbihzZWxmLnBhdGgoKSkKICAgICAgaWYgbm90IGhGaWxlIHRoZW4KICAgICAgICAgcmV0dXJuIG5pbCwgc3RkbGliLmVycm9ycy5VbmFibGVUb09wZW5GaWxlRXJyb3IKICAgICAgZW5kCiAgICAgIGlmIG9mZnNldCB+PSAwIHRoZW4KICAgICAgICAgbG9jYWwgcmV0ID0gZnNlZWsoaEZpbGUsIG9mZnNldCwgc3RkbGliLlNFRUtfQkVHSU4pCgoKICAgICAgICAgaWYgbm90IHJldCB0aGVuCiAgICAgICAgICAgIGZjbG9zZShoRmlsZSkKICAgICAgICAgICAgcmV0dXJuIG5pbCwgc3RkbGliLmVycm9ycy5VbmFibGVUb1NlZWtGaWxlRXJyb3IKICAgICAgICAgZW5kCiAgICAgIGVuZAoKICAgICAgZGF0YSA9IGZyZWFkKGhGaWxlLCBsZW5ndGgpCiAgICAgIGZjbG9zZShoRmlsZSkKICAgICAgcmV0dXJuIGRhdGEKICAgZW5kCgogICAtLS0KICAgLS0gcmVhZCgpCiAgIC0tIEFuIG9iamVjdCB0aGF0IHJlYWRzIGJpbmFyeSBkYXRhIGZyb21hIGZpbGUuCiAgIC0tIFRoaXMgb2JqZWN0IHNob3VsZCBub3QgcmVhZCBhbnkgc2xvd2VyIHRoYW4gbmFpdmUgb3Blbi9zZWVrL3JlYWQvY2xvc2UsIGFuZCBtYXkKICAgLS0gcmVhZCBmYXN0ZXIgaW4gc29tZSBjYXNlcy4KICAgLS0gVGhlIHJldHVybmVkIG9iamVjdCBoYXMgdGhlIG1ldGhvZHM6CiAgIC0tICAgIHJlYWQob2Zmc2V0LCBsZW5ndGgpCiAgIC0tICAgIGNsb3NlKCkKICAgLS0gRG9uJ3QgZm9yZ2V0IHRvIGNhbGwgY2xvc2UoKSB3aGVuIGRvbmUgd2l0aCB0aGUgb2JqZWN0IHRvIGNsb3NlIHRoZSBmaWxlIGhhbmRsZSEKICAgLS0gTm90ZSwgdGhhdCBpZiB0aGUgcGF0aCBkb2VzIG5vdCBleGlzdCwgdGhlbiBvcGVuaW5nIHRoZSBmaWxlIG1heSBzdGlsbCBzdWNjZWVkLCBidXQKICAgLS0gICAgYW55IGNhbGxzIHRvIHJlYWQgd2lsbCByZXR1cm4gbmlsLgogICAtLSBAcGFyYW0gbGVuZ3RoIFRoZSBsZW5ndGggb2YgZGF0YSB0byByZWFkLCBpbiBieXRlcy4KICAgLS0gQGVycm9yIHN0ZGxpYi5lcnJvcnMuQ2Fubm90UmVhZERpcmVjdG9yeUFzRmlsZUVycm9yCiAgIC0tIEBlcnJvciBzdGRsaWIuZXJyb3JzLlVuYWJsZVRvU2Vla0ZpbGVFcnJvcgogICAtLSBAZXJyb3Igc3RkbGliLmVycm9ycy5VbmFibGVUb1JlYWRGaWxlRXJyb3IKICAgLS0gQGVycm9yIHN0ZGxpYi5lcnJvcnMuSW52YWxpZEZpbGVPZmZzZXRFcnJvcgogICAtLSBAcmV0dXJuIHNlbGYsIGVycm9yCiAgIHNlbGYuQnVmZmVyZWRGaWxlUmVhZGVyID0gZnVuY3Rpb24oKQogICAgICBsb2NhbCBidWZmZXIgPSB7fQogICAgICBidWZmZXIuYnVmICAgID0gIiIKICAgICAgYnVmZmVyLm9mZnNldCA9IDAKICAgICAgYnVmZmVyLmxlbmd0aCA9IDAKCiAgICAgIGlmIHNlbGYuaXNfZGlyZWN0b3J5KCkgdGhlbgogICAgICAgICByZXR1cm4gbmlsLCBzdGRsaWIuZXJyb3JzLkNhbm5vdFJlYWREaXJlY3RvcnlBc0ZpbGVFcnJvcgogICAgICBlbmQKCiAgICAgIGxvY2FsIGhGaWxlID0gZm9wZW4oc2VsZi5wYXRoKCkpCiAgICAgIGlmIG5vdCBoRmlsZSB0aGVuCiAgICAgICAgIHJldHVybiBuaWwsIHN0ZGxpYi5lcnJvcnMuVW5hYmxlVG9PcGVuRmlsZUVycm9yCiAgICAgIGVuZAoKICAgICAgbG9jYWwgYmZyID0ge30KICAgICAgbG9jYWwgbXQgPSB7fQogICAgICBtdC5fX3R5cGUgPSAiQnVmZmVyZWRGaWxlUmVhZGVyIgogICAgICBiZnIuY2FjaGVfaGl0cyAgID0gMAogICAgICBiZnIuY2FjaGVfbWlzc2VzID0gMAogICAgICBiZnIucmVhZCA9IGZ1bmN0aW9uKG9mZnNldCwgbGVuZ3RoKQogICAgICAgICBpZiBvZmZzZXQgPCBidWZmZXIub2Zmc2V0IG9yIG9mZnNldCArIGxlbmd0aCA+IGJ1ZmZlci5vZmZzZXQgKyBidWZmZXIubGVuZ3RoIHRoZW4KICAgICAgICAgICAgYnVmZmVyLm9mZnNldCA9IG9mZnNldCAtIG1hdGgubW9kKG9mZnNldCwgNTEyKQogICAgICAgICAgICBidWZmZXIubGVuZ3RoID0gbWF0aC5tYXgobGVuZ3RoIC0gbWF0aC5tb2QobGVuZ3RoLCA1MTIpICsgMTAyNCwgNCAqIDEwMjQgKiAxMDI0KQoKICAgICAgICAgICAgbG9jYWwgb2sgPSBmc2VlayhoRmlsZSwgYnVmZmVyLm9mZnNldCwgc3RkbGliLlNFRUtfQkVHSU4pCiAgICAgICAgICAgIGlmIG5vdCBvayB0aGVuCiAgICAgICAgICAgICAgIGZjbG9zZShoRmlsZSkKICAgICAgICAgICAgICAgcmV0dXJuIG5pbCwgc3RkbGliLmVycm9ycy5VbmFibGVUb1NlZWtGaWxlRXJyb3IKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBidWZmZXIuYnVmID0gZnJlYWQoaEZpbGUsIGJ1ZmZlci5sZW5ndGgpCiAgICAgICAgICAgIGlmIGJ1ZmZlci5sZW5ndGggfj0gMCBhbmQgKG5vdCBidWZmZXIuYnVmIG9yIHN0cmluZy5sZW4oYnVmZmVyLmJ1ZikgPT0gMCkgdGhlbgogICAgICAgICAgICAgICByZXR1cm4gIG5pbCwgc3RkbGliLmVycm9ycy5VbmFibGVUb1JlYWRGaWxlRXJyb3IKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGJ1ZmZlci5sZW5ndGggPSBzdHJpbmcubGVuKGJ1ZmZlci5idWYpCiAgICAgICAgICAgIGJmci5jYWNoZV9taXNzZXMgPSBiZnIuY2FjaGVfbWlzc2VzICsgMQogICAgICAgICBlbHNlCiAgICAgICAgICAgIGJmci5jYWNoZV9oaXRzID0gYmZyLmNhY2hlX2hpdHMgKyAxCiAgICAgICAgIGVuZAoKICAgICAgICAgcmV0dXJuIHN0cmluZy5zdWIoYnVmZmVyLmJ1Ziwgb2Zmc2V0IC0gYnVmZmVyLm9mZnNldCArIDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgIG9mZnNldCAtIGJ1ZmZlci5vZmZzZXQgKyBsZW5ndGgpLCBuaWwKICAgICAgZW5kCgogICAgICBiZnIuY2xvc2UgPSBmdW5jdGlvbigpCiAgICAgICAgIGZjbG9zZShoRmlsZSkKICAgICAgZW5kCgogICAgICBzZXRtZXRhdGFibGUoYmZyLCBtdCkKICAgICAgcmV0dXJuIGJmciwgbmlsCiAgIGVuZAoKICAgc2VsZi53cml0ZSA9IGZ1bmN0aW9uKCkKICAgICAgZndyaXRlKHAucGF0aCgpKQogICBlbmQKCiAgICAtLS0KICAgIC0tIGxpbmVzKCkKICAgIC0tIEEgZ2VuZXJhdG9yIHRoYXQgcmV0dXJucyBhbGwgdGhlIGxpbmVzIGRlbGltaXRlZCBieSBVbml4IG9yIFdpbmRvd3Mgc3R5bGUgbmV3bGluZXMuCiAgIC0tIFdhcm5pbmc6IGRvIG5vdCBicmVhayBmcm9tIGEgZ2VuZXJhdG9yIGxvb3AgdGhhdCB1c2VzIGxpbmVzLCBkb2luZyBzbyB3aWxsIGxlYWsgdGhlCiAgIC0tIGZpbGUgaGFuZGxlIGFzc29jaWF0ZWQgd2l0aCB0aGUgb3BlbiBmaWxlLiAgSW5zdGVhZCwgdXNlIG9wdGlvbnMubWF4LgogICAtLSBAcGFyYW0gb3B0aW9ucyBBIHRhYmxlIGluZGV4ZWQgYnkgc3VwcG9ydGVkIG9wdGlvbnM6CiAgIC0tICAgICBvcHRpb25zLm1heCAgQW4gaW50ZWdlciB0aGF0IGxpbWl0cyB0aGUgbWF4aW11bSBudW1iZXIgb2YgaXRlbXMgeWllbGRlZCBieQogICAtLSAgICAgICAgICB0aGUgZ2VuZXJhdG9yLgogICAtLSBAcmV0dXJuIEEgZ2VuZXJhdG9yIHRoYXQgcmV0dXJucyBhbGwgdGhlIGxpbmVzIGRlbGltaXRlZCBieSBVbml4IG9yIFdpbmRvd3Mgc3R5bGUgbmV3bGluZXMuCiAgICAtLSBAZXJyb3Igc3RkbGliLmVycm9ycy5VbmFibGVUb09wZW5GaWxlRXJyb3IKICAgLS0gVE9ETyh3YikgdGhpcyBtYXkgZXJyb25lb3VzbHkgY2hvcCBsaW5lcyB0aGF0IGZhbGwgYWxvbmcgdGhlIGJsb2NrIGJvcmRlcgogICBzZWxmLmxpbmVzID0gZnVuY3Rpb24ob3B0aW9ucykKICAgICAgaWYgbm90IG9wdGlvbnMgdGhlbiBvcHRpb25zID0ge30gZW5kCiAgICAgIGxvY2FsIGNvID0gY29yb3V0aW5lLmNyZWF0ZShmdW5jdGlvbigpCiAgICAgICAgIGxvY2FsIGNvdW50ID0gMAogICAgICAgICBsb2NhbCBtYXhfcmVhY2hlZCA9IGZhbHNlCiAgICAgICAgIGxvY2FsIGJsb2NrID0gMTI4ICogNDA5NgogICAgICAgICBsb2NhbCBibG9ja19vZmZzZXQgPSAwCiAgICAgICAgIGxvY2FsIGZwCgogICAgICAgICBmcCA9IGZvcGVuKHNlbGYucGF0aCgpKQogICAgICAgICBpZiBub3QgZnAgdGhlbgogICAgICAgICAgICBlcnJvcihzdGRsaWIuZXJyb3JzLlVuYWJsZVRvT3BlbkZpbGVFcnJvcikKICAgICAgICAgZW5kCgogICAgICAgICB3aGlsZSB0cnVlIGRvCiAgICAgICAgICAgIGlmIG1heF9yZWFjaGVkIHRoZW4gYnJlYWsgZW5kCgogICAgICAgICAgICBsb2NhbCBidWYgPSBmcmVhZChmcCwgYmxvY2spCiAgICAgICAgICAgIGlmIG5vdCBidWYgb3IgYnVmID09ICIiIHRoZW4gYnJlYWsgZW5kCgogICAgICAgICAgICBmb3IgbGluZSBpbiBzdHJpbmcuZ21hdGNoKGJ1ZiwgIlteXHJcbl0rIikgZG8KICAgICAgICAgICAgICAgaWYgbWF4X3JlYWNoZWQgdGhlbiBicmVhayBlbmQKCiAgICAgICAgICAgICAgIGNvcm91dGluZS55aWVsZChsaW5lKQogICAgICAgICAgICAgICBjb3VudCA9IGNvdW50ICsgMQoKICAgICAgICAgICAgICAgaWYgb3B0aW9ucy5tYXggYW5kIGNvdW50ID4gb3B0aW9ucy5tYXggdGhlbiBtYXhfcmVhY2hlZCA9IHRydWUgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBibG9ja19vZmZzZXQgPSBibG9ja19vZmZzZXQgKyBibG9jawogICAgICAgICBlbmQKICAgICAgICAgZmNsb3NlKGZwKQogICAgICBlbmQpCiAgICAgIHJldHVybiBmdW5jdGlvbiAoKQogICAgICAgICBsb2NhbCBjb2RlLCBsaW5lID0gY29yb3V0aW5lLnJlc3VtZShjbykKICAgICAgICAgaWYgY29kZSB0aGVuIHJldHVybiBsaW5lIGVuZAogICAgICBlbmQKICAgZW5kCiAgIHJldHVybiBzZWxmCmVuZAoKLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQotLSAgIFJFR0lTVFJZIFRSQVZFUlNBTAotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi0tLQotLSBSZWdpc3RyeUtleSgpCi0tIFdyYXBwZXIgYXJvdW5kIGxvdyBsZXZlbCBSZWdpc3RyeSBhY2Nlc3MgQVBJcy4KLS0gQGVycm9yIHN0ZGxpYi5lcnJvcnMuRmFpbGVkVG9PcGVuUmVnUGF0aEVycm9yCi0tIEByZXR1cm4gc2VsZiwgZXJyb3IKZnVuY3Rpb24gc3RkbGliLlJlZ2lzdHJ5S2V5KHBhdGgsIHJhdykKICAgbG9jYWwgc2VsZiA9IHt9CiAgIGxvY2FsIG10ID0ge30KICAgc2V0bWV0YXRhYmxlKHNlbGYsIG10KQoKICAgbG9jYWwgcm9wZW4gPSByZWdpc3RyeS5SZWdPcGVuS2V5QVBJCiAgIGxvY2FsIHJjbG9zZSA9IHJlZ2lzdHJ5LlJlZ0Nsb3NlQVBJCiAgIGxvY2FsIHJlbnVta2V5ID0gcmVnaXN0cnkuUmVnRW51bUtleUFQSQogICBsb2NhbCByZW51bXZhbHVlID0gcmVnaXN0cnkuUmVnRW51bVZhbHVlQVBJCiAgIGxvY2FsIHJnZXR2YWx1ZSA9IHJlZ2lzdHJ5LlJlZ0dldFZhbHVlQVBJCgogICBpZiByYXcgdGhlbgogICAgICByb3BlbiA9IHJlZ2lzdHJ5LlJlZ09wZW5LZXlSQVcKICAgICAgcmNsb3NlID0gcmVnaXN0cnkuUmVnQ2xvc2VSQVcKICAgICAgcmVudW1rZXkgPSByZWdpc3RyeS5SZWdFbnVtS2V5UkFXCiAgICAgIHJlbnVtdmFsdWUgPSByZWdpc3RyeS5SZWdFbnVtVmFsdWVSQVcKICAgICAgcmdldHZhbHVlID0gcmVnaXN0cnkuUmVnR2V0VmFsdWVSQVcKICAgZW5kCgogICBwYXRoID0gc3RkbGliLnJzdHJpcChwYXRoLCAiXFwiKQogICBsb2NhbCBrZXkgPSByb3BlbihwYXRoKQogICBpZiBub3Qga2V5IHRoZW4gcmV0dXJuIG5pbCwgc3RkbGliLmVycm9ycy5GYWlsZWRUb09wZW5SZWdQYXRoRXJyb3IgZW5kCiAgIHJjbG9zZShrZXkpCgogICBtdC5fX3Rvc3RyaW5nID0gZnVuY3Rpb24oKQogICAgICByZXR1cm4gIlJlZ2lzdHJ5IGtleTogIiAuLiBwYXRoCiAgIGVuZAoKICAgLS0tCiAgIC0tIHZhbHVlcygpCiAgIC0tIFJldHVybiBhIHN0ZGxpYi5MaXN0IG9mIFJlZ2lzdHJ5IHZhbHVlIHRhYmxlcyB0aGF0IGFyZQogICAtLSB2YWx1ZXMgYXNzb2NpYXRlZCB3aXRoIHRoaXMga2V5LgogICBzZWxmLnZhbHVlcyA9IGZ1bmN0aW9uKCkKICAgICAgbG9jYWwgdnMgPSBzdGRsaWIuTGlzdCgpCiAgICAgIHJlbnVtdmFsdWUocGF0aCwgZnVuY3Rpb24gKGspCiAgICAgICAgICAgICAgICAgICAgICAgICAgdnMuYXBwZW5kKGspCiAgICAgICAgICAgICAgICAgICAgICAgZW5kKQogICAgICByZXR1cm4gdnMKICAgZW5kCiAgIC0tLQogICAtLSB2YWx1ZSgpCiAgIC0tIFJldHVybiBhIFJlZ2lzdHJ5IHZhbHVlIHRhYmxlIGZvciB0aGUgdmFsdWUgd2l0aCB0aGUgZ2l2ZW4KICAgLS0gbmFtZSB0aGF0IGlzIGEgdmFsdWUgYXNzb2NpYXRlZCB3aXRoIHRoaXMga2V5LgogICAtLSBAZXJyb3Igc3RkbGliLmVycm9ycy5GYWlsZWRUb09wZW5SZWdQYXRoRXJyb3IKICAgLS0gQHJldHVybiB2YWx1ZSwgZXJyb3IKICAgc2VsZi52YWx1ZSA9IGZ1bmN0aW9uKG5hbWUpCiAgICAgIGxvY2FsIGtleSA9IHJvcGVuKHBhdGgpCiAgICAgIGlmIG5vdCBrZXkgdGhlbiByZXR1cm4gbmlsLCBzdGRsaWIuZXJyb3JzLkZhaWxlZFRvT3BlblJlZ1BhdGhFcnJvciBlbmQKCiAgICAgIGxvY2FsIGl0ZW0gPSByZ2V0dmFsdWUoa2V5LCBuYW1lKQogICAgICByY2xvc2Uoa2V5KQogICAgICByZXR1cm4gaXRlbQogICBlbmQKICAgLS0tCiAgIC0tIHN1YmtleXMoKQogICAtLSBSZXR1cm4gYSBzdGRsaWIuTGlzdCBvZiBzdGRsaWIuUmVnaXN0cnlLZXkgaXRlbXMKICAgLS0gdGhhdCBhcmUgc3Via2V5cyBvZiB0aGlzIGtleS4KICAgLS0gQGVycm9yIHN0ZGxpYi5lcnJvcnMuRmFpbGVkVG9PcGVuUmVnUGF0aEVycm9yCiAgIC0tIEByZXR1cm4gbGlzdCBvZiBzdWJrZXlzLCBlcnJvcgogICBzZWxmLnN1YmtleXMgPSBmdW5jdGlvbigpCiAgICAgIGxvY2FsIGtleSA9IHJvcGVuKHBhdGgpCiAgICAgIGlmIG5vdCBrZXkgdGhlbiByZXR1cm4gbmlsLCBzdGRsaWIuZXJyb3JzLkZhaWxlZFRvT3BlblJlZ1BhdGhFcnJvciBlbmQKCiAgICAgIGxvY2FsIGtleXMgPSBzdGRsaWIuTGlzdCgpCiAgICAgIHJlbnVta2V5KGtleSwgMSwgZnVuY3Rpb24oaXRlbSkKICAgICAgICAgICAgICAgICAgICAgICAgIGtleXMuYXBwZW5kKHN0ZGxpYi5SZWdpc3RyeUtleShpdGVtLlBhdGgsIHJhdykpCiAgICAgICAgICAgICAgICAgICAgICAgZW5kKQoKICAgICAgcmNsb3NlKGtleSkKICAgICAgcmV0dXJuIGtleXMKICAgZW5kCiAgIC0tLQogICAtLSBzdWJrZXkoKQogICAtLSBSZXR1cm4gYSBzdGRsaWIuUmVnaXN0cnlLZXkgaXRlbSB3aXRoIHRoZSBnaXZlbiBuYW1lCiAgIC0tIHRoYXQgaXMgYSBzdWJrZXkgb2YgdGhpcyBrZXkuCiAgIHNlbGYuc3Via2V5ID0gZnVuY3Rpb24obmFtZSkKICAgICAgcmV0dXJuIHN0ZGxpYi5SZWdpc3RyeUtleShwYXRoIC4uICJcXCIgLi4gbmFtZSwgcmF3KQogICBlbmQKCiAgIC0tLQogICAtLSBwYXRoKCkKICAgLS0gUmV0dXJuIHRoZSBmdWxsIHBhdGggYXNzb2NpYXRlZCB3aXRoIHRoaXMga2V5IGFzIGEgc3RyaW5nLgogICBzZWxmLnBhdGggPSBmdW5jdGlvbigpCiAgICAgIHJldHVybiBwYXRoCiAgIGVuZAoKICAgcmV0dXJuIHNlbGYKZW5kCgpzdGRsaWIuRW52ID0ge30Kc3RkbGliLkVudi5yZXNvbHZlX3ZhcmlhYmxlcyA9IGZ1bmN0aW9uKHBhdGgsIG9wdF92YXJpYWJsZXMpCiAgIGxvY2FsIGZpbmFsICAgICA9IHBhdGgKICAgbG9jYWwgdmFyaWFibGVzID0ge30KCiAgIGlmIG5vdCBwYXRoIHRoZW4gcmV0dXJuIG5pbCBlbmQKICAgaWYgdHlwZShwYXRoKSB+PSAic3RyaW5nIiB0aGVuIHJldHVybiBuaWwgZW5kCgogICBpZiBvcHRfdmFyaWFibGVzIHRoZW4KICAgICAgdmFyaWFibGVzID0gb3B0X3ZhcmlhYmxlcwogICBlbHNlCiAgICAgIHZhcmlhYmxlcyA9IHN0ZGxpYi5FbnYudmFyaWFibGVzKCkKICAgZW5kCgogICAtLSBnaXZlbiBhIHdvcmQsIHJldHVybiB0aGUgZ2ZpbmQgcGF0dGVybiByZXF1aXJlZCBmb3IgYQogICAtLSBjYXNlIGluc2Vuc2l0aXZlIHNlYXJjaAogICBmdW5jdGlvbiByZWdleF9pY2FzZSAocykKICAgICAgLS0gcmVwbGFjZSBlYWNoIGNoYXIgd2l0aCB1cHBwZXIgYW5kIGxvd2VyIGNhc2UgcmVnZXggZm9yIGNoYXIKICAgICAgcyA9IHN0cmluZy5nc3ViKHMsICIuIiwgZnVuY3Rpb24gKGMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBzdHJpbmcuZmluZChjLCAnJWEnKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN0cmluZy5mb3JtYXQoIlslcyVzXSIsIHN0cmluZy5sb3dlcihjKSwgc3RyaW5nLnVwcGVyKGMpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0tIGVzY2FwZSBwYXJlbnRoZXNpcyAoZS5nLiwgIiVQcm9ncmFtRmlsZXMgKHg4NiklIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3RyaW5nLmdzdWIoYywgIihbJSglKV0pIiwgIiUlJTEiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgIHJldHVybiBzCiAgIGVuZAoKICAgZm9yIHZhcmlhYmxlLCByZXNvbHV0aW9uIGluIHBhaXJzKHZhcmlhYmxlcykgZG8KICAgICAgdmFyaWFibGUgPSBzdHJpbmcubG93ZXIodmFyaWFibGUpCiAgICAgIGxvY2FsIHMsIGUsIG0KICAgICAgZSA9IDAKICAgICAgd2hpbGUgdHJ1ZSBkbwogICAgICAgICBsb2NhbCB2YXJfcmVnZXggPSAiJSUoIiAuLiByZWdleF9pY2FzZSh2YXJpYWJsZSkgLi4gIiklJSIKICAgICAgICAgcywgZSwgbSA9IHN0cmluZy5maW5kKGZpbmFsLCB2YXJfcmVnZXgsIGUpCiAgICAgICAgIGlmIG5vdCBzIHRoZW4gYnJlYWsgZW5kCiAgICAgICAgIGZpbmFsID0gc3RyaW5nLmdzdWIoZmluYWwsIHZhcl9yZWdleCwgcmVzb2x1dGlvbikKICAgICAgZW5kCiAgIGVuZAogICByZXR1cm4gZmluYWwKZW5kCgpzdGRsaWIuRW52LnZhcmlhYmxlcyA9IGZ1bmN0aW9uKCkKICAgbG9jYWwgbWFwcGluZyA9IHt9CiAgIGxvY2FsIGxvY2F0aW9ucyA9IHsKICAgICAgIHsgICBrZXkgPSAiSEtMTVxcU29mdHdhcmVcXE1pY3Jvc29mdFxcV2luZG93cyBOVFxcQ3VycmVudFZlcnNpb24iLAogICAgICAgICAgIHZhbHVlID0gIlN5c3RlbVJvb3QifSwKICAgICAgIHsgICBrZXkgPSAiSEtMTVxcU29mdHdhcmVcXE1pY3Jvc29mdFxcV2luZG93cyBOVFxcQ3VycmVudFZlcnNpb24iLAogICAgICAgICAgIHZhbHVlID0gIlBhdGhOYW1lIn0sCiAgICAgICB7ICAga2V5ID0gIkhLTE1cXFNvZnR3YXJlXFxNaWNyb3NvZnRcXFdpbmRvd3MgTlRcXEN1cnJlbnRWZXJzaW9uIiwKICAgICAgICAgICB2YWx1ZSA9ICJDdXJyZW50VmVyc2lvbiJ9LAogICAgICAgeyAgIGtleSA9ICJIS0xNXFxTb2Z0d2FyZVxcTWljcm9zb2Z0XFxXaW5kb3dzXFxDdXJyZW50VmVyc2lvbiIsCiAgICAgICAgICAgdmFsdWUgPSAiUHJvZ3JhbUZpbGVzRGlyIn0sCiAgICAgICB7ICAga2V5ID0gIkhLTE1cXFNvZnR3YXJlXFxNaWNyb3NvZnRcXFdpbmRvd3NcXEN1cnJlbnRWZXJzaW9uIiwKICAgICAgICAgICB2YWx1ZSA9ICJQcm9ncmFtRmlsZXNEaXIgKHg4NikifSwKICAgICAgIHsgICBrZXkgPSAiSEtMTVxcU29mdHdhcmVcXE1pY3Jvc29mdFxcV2luZG93c1xcQ3VycmVudFZlcnNpb24iLAogICAgICAgICAgIHZhbHVlID0gIlByb2dyYW1XNjQzMkRpciJ9LAogICAgICAgeyAgIGtleSA9ICJIS0xNXFxTWVNURU1cXEN1cnJlbnRDb250cm9sU2V0XFxDb250cm9sXFxTZXNzaW9uIE1hbmFnZXJcXEVudmlyb25tZW50IiwKICAgICAgICAgICB2YWx1ZSA9ICJ3aW5kaXIifSwKICAgICAgIHsgICBrZXkgPSAiSEtMTVxcU1lTVEVNXFxDdXJyZW50Q29udHJvbFNldFxcQ29udHJvbFxcU2Vzc2lvbiBNYW5hZ2VyXFxFbnZpcm9ubWVudCIsCiAgICAgICAgICAgdmFsdWUgPSAiVEVNUCJ9LAogICAgICAgeyAgIGtleSA9ICJIS0xNXFxTWVNURU1cXEN1cnJlbnRDb250cm9sU2V0XFxDb250cm9sXFxTZXNzaW9uIE1hbmFnZXJcXEVudmlyb25tZW50IiwKICAgICAgICAgICB2YWx1ZSA9ICJUTVAifSwKICAgICAgIHsgICBrZXkgPSAiSEtMTVxcU1lTVEVNXFxDdXJyZW50Q29udHJvbFNldFxcQ29udHJvbFxcU2Vzc2lvbiBNYW5hZ2VyXFxFbnZpcm9ubWVudCIsCiAgICAgICAgICAgdmFsdWUgPSAiQ29tU3BlYyJ9LAogICAgICAgeyAgIGtleSA9ICJIS0xNXFxTWVNURU1cXEN1cnJlbnRDb250cm9sU2V0XFxDb250cm9sXFxTZXNzaW9uIE1hbmFnZXJcXEVudmlyb25tZW50IiwKICAgICAgICAgICB2YWx1ZSA9ICJQYXRoIn0sCiAgIH0KICAgZm9yIF8sIGxvY2F0aW9uIGluIHBhaXJzKGxvY2F0aW9ucykgZG8KICAgICAgIGxvY2FsIHJlZywgZXJyID0gc3RkbGliLlJlZ2lzdHJ5S2V5KGxvY2F0aW9uLmtleSkKICAgICAgIGlmIHJlZyB0aGVuCiAgICAgICAgICAgbG9jYWwgdmFsdWUsIGVyciA9IHJlZy52YWx1ZShsb2NhdGlvbi52YWx1ZSkKICAgICAgICAgICBpZiB2YWx1ZSB0aGVuCiAgICAgICAgICAgICAgIG1hcHBpbmdbbG9jYXRpb24udmFsdWVdICA9IHN0ZGxpYi5FbnYucmVzb2x2ZV92YXJpYWJsZXModG9zdHJpbmcodmFsdWUuVGV4dCksIG1hcHBpbmcpCiAgICAgICAgICAgZW5kCiAgICAgICBlbmQKICAgZW5kCgogICBpZiBtYXBwaW5nWyJTeXN0ZW1Sb290Il0gdGhlbgogICAgICAgbWFwcGluZ1siU3lzdGVtRHJpdmUiXSA9IHN0cmluZy5zdWIobWFwcGluZ1siU3lzdGVtUm9vdCJdLCAxLCAyKQogICBlbmQKCiAgIC0tIHJlbmFtZSBmaWVsZHMgYXMgZW52aXJvbm1lbnQgdmFyaWFibGUgbmFtZSBpcyBub3QgYWx3YXlzIGFuIGV4YWN0IG1hdGNoIGZvciByZWdpc3RyeSBrZXkgdmFsdWUKICAgaWYgbWFwcGluZ1siUHJvZ3JhbUZpbGVzRGlyIl0gdGhlbgogICAgICAgbWFwcGluZ1siUHJvZ3JhbUZpbGVzIl0gPSBtYXBwaW5nWyJQcm9ncmFtRmlsZXNEaXIiXQogICBlbmQKCiAgIGlmIG1hcHBpbmdbIlByb2dyYW1GaWxlc0RpciAoeDg2KSJdIHRoZW4KICAgICAgIG1hcHBpbmdbIlByb2dyYW1GaWxlcyh4ODYpIl0gPSBtYXBwaW5nWyJQcm9ncmFtRmlsZXNEaXIgKHg4NikiXQogICBlbmQKCiAgIGlmIG1hcHBpbmdbIlByb2dyYW1XNjQzMkRpciJdIHRoZW4KICAgICAgIG1hcHBpbmdbIlByb2dyYW1XNjQzMiJdID0gbWFwcGluZ1siUHJvZ3JhbVc2NDMyRGlyIl0KICAgZW5kCgogICAtLSBoYXJkIGNvZGUgdmFsdWU7IGRvZXMgbm90IGFwcGVhciB0byBiZSBkZXJpdmVkIGZyb20gYSByZWdpc3RyeSBrZXkKICAgbWFwcGluZ1siUHJvZ3JhbURhdGEiXSA9IG1hcHBpbmdbIlN5c3RlbURyaXZlIl0gLi4gJ1xcUHJvZ3JhbURhdGEnCgogICByZXR1cm4gbWFwcGluZwplbmQKCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLS0gICBNSVNDCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0Kc3RkbGliLkNvdW50ZXIgPSBmdW5jdGlvbihzdGFydCkKICAgIGxvY2FsIGkgPSAtMQogICAgcmV0dXJuIGZ1bmN0aW9uKCkKICAgICAgICBpID0gaSArIDEKICAgICAgICByZXR1cm4gaQogICAgZW5kCmVuZAoKLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQotLQotLSBNSVIgQWdlbnQgTHVhIC0gQmluYXJ5IFBhcnNlciBtb2R1bGUKLS0KLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpiaW5hcnlwYXJzZXIgPSB7fQoKLS0gaHR0cDovL2x1YS11c2Vycy5vcmcvbGlzdHMvbHVhLWwvMjAwMi0wOS9tc2cwMDEzNC5odG1sCmJpbmFyeXBhcnNlci50YWIgPSB7ICAtLSB0YWJbaV1bal0gPSB4b3IoaS0xLCBqLTEpCiAgezAsIDEsIDIsIDMsIDQsIDUsIDYsIDcsIDgsIDksIDEwLCAxMSwgMTIsIDEzLCAxNCwgMTUsIH0sCiAgezEsIDAsIDMsIDIsIDUsIDQsIDcsIDYsIDksIDgsIDExLCAxMCwgMTMsIDEyLCAxNSwgMTQsIH0sCiAgezIsIDMsIDAsIDEsIDYsIDcsIDQsIDUsIDEwLCAxMSwgOCwgOSwgMTQsIDE1LCAxMiwgMTMsIH0sCiAgezMsIDIsIDEsIDAsIDcsIDYsIDUsIDQsIDExLCAxMCwgOSwgOCwgMTUsIDE0LCAxMywgMTIsIH0sCiAgezQsIDUsIDYsIDcsIDAsIDEsIDIsIDMsIDEyLCAxMywgMTQsIDE1LCA4LCA5LCAxMCwgMTEsIH0sCiAgezUsIDQsIDcsIDYsIDEsIDAsIDMsIDIsIDEzLCAxMiwgMTUsIDE0LCA5LCA4LCAxMSwgMTAsIH0sCiAgezYsIDcsIDQsIDUsIDIsIDMsIDAsIDEsIDE0LCAxNSwgMTIsIDEzLCAxMCwgMTEsIDgsIDksIH0sCiAgezcsIDYsIDUsIDQsIDMsIDIsIDEsIDAsIDE1LCAxNCwgMTMsIDEyLCAxMSwgMTAsIDksIDgsIH0sCiAgezgsIDksIDEwLCAxMSwgMTIsIDEzLCAxNCwgMTUsIDAsIDEsIDIsIDMsIDQsIDUsIDYsIDcsIH0sCiAgezksIDgsIDExLCAxMCwgMTMsIDEyLCAxNSwgMTQsIDEsIDAsIDMsIDIsIDUsIDQsIDcsIDYsIH0sCiAgezEwLCAxMSwgOCwgOSwgMTQsIDE1LCAxMiwgMTMsIDIsIDMsIDAsIDEsIDYsIDcsIDQsIDUsIH0sCiAgezExLCAxMCwgOSwgOCwgMTUsIDE0LCAxMywgMTIsIDMsIDIsIDEsIDAsIDcsIDYsIDUsIDQsIH0sCiAgezEyLCAxMywgMTQsIDE1LCA4LCA5LCAxMCwgMTEsIDQsIDUsIDYsIDcsIDAsIDEsIDIsIDMsIH0sCiAgezEzLCAxMiwgMTUsIDE0LCA5LCA4LCAxMSwgMTAsIDUsIDQsIDcsIDYsIDEsIDAsIDMsIDIsIH0sCiAgezE0LCAxNSwgMTIsIDEzLCAxMCwgMTEsIDgsIDksIDYsIDcsIDQsIDUsIDIsIDMsIDAsIDEsIH0sCiAgezE1LCAxNCwgMTMsIDEyLCAxMSwgMTAsIDksIDgsIDcsIDYsIDUsIDQsIDMsIDIsIDEsIDAsIH0sCn0KCi0tLQotLSBieG9yKCkKLS0gQmluYXJ5IFhPUiAoZXhjbHVzaXZlIE9SKSBvbiB0d28gbnVtYmVycy4KLS0gQHBhcmFtIGEgQSBpbnRlZ2VyLgotLSBAcGFyYW0gYiBBbiBpbnRlZ2VyLgotLSBAcmV0dXJuIEFuIGludGVnZXIuCmJpbmFyeXBhcnNlci5ieG9yID0gZnVuY3Rpb24oYSwgYikKICBsb2NhbCByZXMsIGMgPSAwLCAxCiAgd2hpbGUgYSA+IDAgYW5kIGIgPiAwIGRvCiAgICBsb2NhbCBhMiwgYjIgPSBtYXRoLm1vZChhLCAxNiksIG1hdGgubW9kKGIsIDE2KQogICAgcmVzID0gcmVzICsgYmluYXJ5cGFyc2VyLnRhYlthMiArIDFdW2IyICsgMV0gKiBjCiAgICBhID0gKGEgLSBhMikgLyAxNgogICAgYiA9IChiIC0gYjIpIC8gMTYKICAgIGMgPSBjICogMTYKICBlbmQKICByZXMgPSByZXMgKyBhICogYyArIGIgKiBjCiAgcmV0dXJuIHJlcwplbmQKCmJpbmFyeXBhcnNlci5fZmYgPSAyXjMyIC0gMQotLS0KLS0gYm5vdCgpCi0tIEJpbmFyeSBOT1Qgb24gdHdvIG51bWJlcnMuCi0tIEBwYXJhbSBhIEEgaW50ZWdlci4KLS0gQHBhcmFtIGIgQW4gaW50ZWdlci4KLS0gQHJldHVybiBBbiBpbnRlZ2VyLgpiaW5hcnlwYXJzZXIuYm5vdCA9IGZ1bmN0aW9uKGEpCiAgcmV0dXJuIGJpbmFyeXBhcnNlci5fZmYgLSBhCmVuZAoKLS0tCi0tIGJhbmQoKQotLSBCaW5hcnkgQU5EIG9uIHR3byBudW1iZXJzLgotLSBAcGFyYW0gYSBBIGludGVnZXIuCi0tIEBwYXJhbSBiIEFuIGludGVnZXIuCi0tIEByZXR1cm4gQW4gaW50ZWdlci4KYmluYXJ5cGFyc2VyLmJhbmQgPSBmdW5jdGlvbihhLCBiKQogIHJldHVybiAoKGEgKyBiKSAtIGJpbmFyeXBhcnNlci5ieG9yKGEsIGIpKSAvIDIKZW5kCgotLS0KLS0gYnhvcigpCi0tIEJpbmFyeSBPUiBvbiB0d28gbnVtYmVycy4KLS0gQHBhcmFtIGEgQSBpbnRlZ2VyLgotLSBAcGFyYW0gYiBBbiBpbnRlZ2VyLgotLSBAcmV0dXJuIEFuIGludGVnZXIuCmJpbmFyeXBhcnNlci5ib3IgPSBmdW5jdGlvbihhLCBiKQogIHJldHVybiBiaW5hcnlwYXJzZXIuX2ZmIC0gYmluYXJ5cGFyc2VyLmJhbmQoYmluYXJ5cGFyc2VyLl9mZiAtIGEsIGJpbmFyeXBhcnNlci5fZmYgLSBiKQplbmQKCmZ1bmN0aW9uIGJpbmFyeXBhcnNlci5oZXgobnVtKQogIHJldHVybiBzdHJpbmcuZm9ybWF0KCclMDJYJywgbnVtKQplbmQKCi0tLQotLSBjaGVja19pbnQoKQotLSBlbnN1cmUgaW50ZWdlcgotLSBAcGFyYW0gbiBBIGludGVnZXIuCmJpbmFyeXBhcnNlci5jaGVja19pbnQgPSBmdW5jdGlvbihuKQogLS0gY2hlY2tpbmcgbm90IGZsb2F0CiBpZihuIC0gbWF0aC5mbG9vcihuKSA+IDApIHRoZW4KICBlcnJvcigidHJ5aW5nIHRvIHVzZSBiaXR3aXNlIG9wZXJhdGlvbiBvbiBub24taW50ZWdlciEiKQogZW5kCmVuZAoKLS0tCi0tIGxzaGlmdCgpCi0tIGxlZnQgc2hpZnQgbnVtYmVyIG9mIGJpdHMKLS0gQHBhcmFtIG4gQSBpbnRlZ2VyCi0tIEBwYXJhbSBiaXRzIE51bWJlciBvZiBiaXRzIHRvIHNoaWZ0CmJpbmFyeXBhcnNlci5sc2hpZnQgPSBmdW5jdGlvbihuLCBiaXRzKQogYmluYXJ5cGFyc2VyLmNoZWNrX2ludChuKQoKIGlmKG4gPCAwKSB0aGVuCiAgLS0gbmVnYXRpdmUKICBuID0gYmluYXJ5cGFyc2VyLmJub3QobWF0aC5hYnMobikpICsgMQogZW5kCgogZm9yIGk9MSwgYml0cyBkbwogIG4gPSBuKjIKIGVuZAogcmV0dXJuIGJpbmFyeXBhcnNlci5iYW5kKG4sIDQyOTQ5NjcyOTUpIC0tIDB4RkZGRkZGRkYKZW5kCgotLS0KLS0gcnNoaWZ0KCkKLS0gcmlnaHQgc2hpZnQgbnVtYmVyIG9mIGJpdHMKLS0gQHBhcmFtIG4gQSBpbnRlZ2VyCi0tIEBwYXJhbSBiaXRzIE51bWJlciBvZiBiaXRzIHRvIHNoaWZ0CmJpbmFyeXBhcnNlci5yc2hpZnQgPSBmdW5jdGlvbihuLCBiaXRzKQogYmluYXJ5cGFyc2VyLmNoZWNrX2ludChuKQoKIGxvY2FsIGhpZ2hfYml0ID0gMAogaWYobiA8IDApIHRoZW4KICAtLSBuZWdhdGl2ZQogIG4gPSBiaW5hcnlwYXJzZXIuYm5vdChtYXRoLmFicyhuKSkgKyAxCiAgaGlnaF9iaXQgPSAyMTQ3NDgzNjQ4IC0tIDB4ODAwMDAwMDAKIGVuZAoKIGZvciBpPTEsIGJpdHMgZG8KICBuID0gbi8yCiAgbiA9IGJpbmFyeXBhcnNlci5ib3IobWF0aC5mbG9vcihuKSwgaGlnaF9iaXQpCiBlbmQKIHJldHVybiBtYXRoLmZsb29yKG4pCmVuZAoKLS0tCi0tIG5haXZlX3dzdHJpbmcyc3RyaW5nKCkKLS0gQSBoYWNrIHRvIGNvbnZlcnQgc2ltcGxlIHdpZGUgc3RyaW5ncyB0byBBU0NJSSBzdHJpbmdzLgotLSBOb3RlLCB0aGlzIGlzIGEgaGFjaywgYW5kIHByb2JhYmx5IGNhbiBicmVhayB0aGluZ3Mgc29tZXdoZXJlLgotLSBBIGJldHRlciBvcHRpb24gaXMgdG8gcHJvYmFibHkgY2FsbCBgcmVhZF91dGYxNl9sZSgpYCBpbnN0ZWFkCi0tIEBwYXJhbSB3c3RyaW5nIEEgc3RyaW5nLgotLSBAcmV0dXJuIEFuIGJpbmFyeSBzdHJpbmcgdGhhdCBtaWdodCBiZSBBU0NJSS4KYmluYXJ5cGFyc2VyLm5haXZlX3dzdHJpbmcyc3RyaW5nID0gZnVuY3Rpb24od3N0cmluZykKICBsb2NhbCBzYiA9IHN0ZGxpYi5TdHJpbmdCdWlsZGVyKCkKICBmb3IgaSA9IDEsIHN0cmluZy5sZW4od3N0cmluZykgZG8KICAgIGxvY2FsIGIgPSBzdHJpbmcuYnl0ZSh3c3RyaW5nLCBpKQogICAgaWYgYiB+PSAwIHRoZW4KICAgICAgc2IuYXBwZW5kKHN0cmluZy5jaGFyKGIpKQogICAgZW5kCiAgZW5kCiAgcmV0dXJuIHNiLnN0cmluZygpCmVuZAoKLS0tCi0tIGFsaWduKCkKLS0gUmV0dXJuIHRoZSBnaXZlbiBvZmZzZXQgYWxpZ25lZCB0byB0aGUgbmVhcmVzdCBncmVhdGVzdCBnaXZlbiBhbGlnbm1lbnQuCi0tIEBwYXJhbSBvZmZzZXQgQW4gaW50ZWdlci4KLS0gQHBhcmFtIGFsaWdubWVudCBBbiBpbnRlZ2VyLgotLSBAcGFyYW0gQW4gaW50ZWdlci4KYmluYXJ5cGFyc2VyLmFsaWduID0gZnVuY3Rpb24ob2Zmc2V0LCBhbGlnbm1lbnQpCiAgaWYgbWF0aC5tb2Qob2Zmc2V0LCBhbGlnbm1lbnQpID09IDAgdGhlbgogICAgcmV0dXJuIG9mZnNldAogIGVsc2UKICAgIHJldHVybiBvZmZzZXQgKyAoYWxpZ25tZW50IC0gKG1hdGgubW9kKG9mZnNldCwgYWxpZ25tZW50KSkpCiAgZW5kCmVuZAoKCi0tLQotLSBzdHJpbmdieXRlczJudW1iZXIKLS0gQ29udmVydCB0aGUgYnl0ZXMgb2YgYSBsaXR0bGUgZW5kaWFuIHN0cmluZyBpbnRvIGFuIHVuc2lnbmVkIG51bWJlci4KLS0gQHdhcm5pbmcgT25seSB0aGUgZmlyc3QgNiBieXRlcyB3aWxsIGJlIHVzZWZ1bCB1bnRpbCA2NCBiaXQgc3VwcG9ydCBpcwotLSAgIGNvbXBpbGVkIGluCi0tIEBwYXJhbSBzdGFydDogMS1pbmRleGVkCi0tIEByZXR1cm4gdGhlIG51bWJlcgpiaW5hcnlwYXJzZXIuc3RyaW5nYnl0ZXMybnVtYmVyID0gZnVuY3Rpb24ocywgc3RhcnQsIGxlbikKICAgIGxvY2FsIG51bSA9IDAKICAgIGlmIG5vdCBzdGFydCB0aGVuIHN0YXJ0ID0gMSBlbmQKICAgIGlmIG5vdCBsZW4gICB0aGVuIGxlbiAgID0gc3RyaW5nLmxlbihzKSBlbmQKICAgIGZvciBpPTEsbGVuIGRvCiAgICAgICAgbnVtID0gbnVtICsgc3RyaW5nLmJ5dGUocywgc3RhcnQgKyBpIC0gMSkgKiAyNTYgXiAoaSAtIDEpCiAgICBlbmQKICAgIHJldHVybiBudW0KZW5kCgotLS0KLS0gc3RyaW5nYnl0ZXMybnVtYmVyX2JlCi0tIENvbnZlcnQgdGhlIGJ5dGVzIG9mIGEgYmlnIGVuZGlhbiBzdHJpbmcgaW50byBhbiB1bnNpZ25lZCBudW1iZXIuCi0tIEB3YXJuaW5nIE9ubHkgdGhlIGZpcnN0IDYgYnl0ZXMgd2lsbCBiZSB1c2VmdWwgdW50aWwgNjQgYml0IHN1cHBvcnQgaXMKLS0gICBjb21waWxlZCBpbgotLSBAcGFyYW0gc3RhcnQ6IDEtaW5kZXhlZAotLSBAcmV0dXJuIHRoZSBudW1iZXIKYmluYXJ5cGFyc2VyLnN0cmluZ2J5dGVzMm51bWJlcl9iZSA9IGZ1bmN0aW9uKHMsIHN0YXJ0LCBsZW4pCiAgICBpZiBub3Qgc3RhcnQgdGhlbgogICAgICAgIHMgPSBzdHJpbmcucmV2ZXJzZShzKQogICAgICAgIHN0YXJ0ID0gMQogICAgICAgIGxlbiA9IHN0cmluZy5sZW4ocykKICAgIGVsc2UKICAgICAgICBpZiBub3QgbGVuIHRoZW4KICAgICAgICAgICAgLS0gaG9wZWZ1bGx5IG5vIG9mZi1ieS1vbmUgaGVyZQogICAgICAgICAgICBzID0gc3RyaW5nLnJldmVyc2Uoc3RyaW5nLnN1YihzLCBzdGFydCkpCiAgICAgICAgICAgIHN0YXJ0ID0gMQogICAgICAgICAgICBsZW4gPSBzdHJpbmcubGVuKHMpCiAgICAgICAgZWxzZQogICAgICAgICAgICBzID0gc3RyaW5nLnJldmVyc2Uoc3RyaW5nLnN1YihzLCBzdGFydCwgc3RhcnQgKyBsZW4gLSAxKSkKICAgICAgICAgICAgc3RhcnQgPSAxCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICByZXR1cm4gYmluYXJ5cGFyc2VyLnN0cmluZ2J5dGVzMm51bWJlcihzLCBzdGFydCwgbGVuKQplbmQKCi0tLQotLSBieXRlczJudW1iZXIKLS0gQ29udmVydCB1cCB0byBmb3VyIGxpdHRsZSBlbmRpYW4gYnl0ZXMgaW50byBhbiB1bnNpZ25lZCBudW1iZXIuCi0tIEB3YXJuaW5nIE9ubHkgdGhlIGZpcnN0IDQgYnl0ZXMgYXJlIHVzZWQgdW50aWwgNjQgYml0IHN1cHBvcnQgaXMKLS0gICBjb21waWxlZCBpbi4KLS0gQHJldHVybiBsb3cgRFdPUkQsIGhpZ2ggRFdPUkQKYmluYXJ5cGFyc2VyLmJ5dGVzMm51bWJlciA9IGZ1bmN0aW9uKGIxLCBiMiwgYjMsIGI0LCBiNSwgYjYsIGI3LCBiOCkKICBpZiBub3QgYjEgdGhlbiByZXR1cm4gMCBlbmQKICBsb2NhbCBuICA9IGIxCiAgbG9jYWwgbjIgPSAwCgogIGlmIGIyIHRoZW4KICAgIG4gPSBuICsgYjIgKiAyNTYKICBlbHNlCiAgICByZXR1cm4gbiwgbjIKICBlbmQKCiAgaWYgYjMgdGhlbgogICAgbiA9IG4gKyBiMyAqIDY1NTM2CiAgZWxzZQogICAgcmV0dXJuIG4sIG4yCiAgZW5kCgogIGlmIGI0IHRoZW4KICAgIG4gPSBuICsgYjQgKiAxNjc3NzIxNgogIGVsc2UKICAgIHJldHVybiBuLCBuMgogIGVuZAoKICAtLS0tLS0tLS0tLS0tLS0tLS0tCiAgLS0gTUlSIEFnZW50IEx1YSBkb2VzIG5vdCBzdXBwb3J0IDY0IGJpdCBpbnRlZ2VycwogIC0tIHNvIHdlIHJldHVybiAobG93IGR3b3JkLCBoaWdoIGR3b3JkKQogIG4yID0gYjUKCiAgaWYgYjYgdGhlbgogICAgbjIgPSBuMiArIGI2ICogMjU2CiAgZWxzZQogICAgcmV0dXJuIG4sIG4yCiAgZW5kCgogIGlmIGI3IHRoZW4KICAgIG4yID0gbjIgKyBiNyAqIDY1NTM2CiAgZWxzZQogICAgcmV0dXJuIG4sIG4yCiAgZW5kCgogIGlmIGI4IHRoZW4KICAgIG4yID0gbjIgKyBiOCAqIDE2Nzc3MjE2CiAgZWxzZQogICAgcmV0dXJuIG4sIG4yCiAgZW5kCgogIHJldHVybiBuLCBuMgplbmQKCgotLS0KLS0gYnl0ZXMybnVtYmVyX2JlCi0tIENvbnZlcnQgdXAgdG8gZm91ciBiaWcgZW5kaWFuIGJ5dGVzIGludG8gYW4gdW5zaWduZWQgbnVtYmVyLgotLSBAd2FybmluZyBPbmx5IHRoZSBmaXJzdCA0IGJ5dGVzIGFyZSB1c2VkIHVudGlsIDY0IGJpdCBzdXBwb3J0IGlzCi0tICAgY29tcGlsZWQgaW4uCi0tIEByZXR1cm4gbG93IERXT1JELCBoaWdoIERXT1JECmJpbmFyeXBhcnNlci5ieXRlczJudW1iZXJfYmUgPSBmdW5jdGlvbihiMSwgYjIsIGIzLCBiNCwgYjUsIGI2LCBiNywgYjgpCiAgICBsb2NhbCBieXRlcyA9IHtiMSwgYjIsIGIzLCBiNCwgYjUsIGI2LCBiNywgYjggfQogICAgbG9jYWwgYTEsIGEyLCBhMywgYTQsIGE1LCBhNiwgYTcsIGE4CiAgICBsb2NhbCBhcmdzID0ge2ExLCBhMiwgYTMsIGE0LCBhNSwgYTYsIGE3LCBhOH0KICAgIGxvY2FsIGFyZ3NfcHRyID0gMQoKICAgIGZvciBpPTgsMSwtMSBkbwogICAgICAgIGlmIGJ5dGVzW2ldIHRoZW4KICAgICAgICAgICAgYXJnc1thcmdzX3B0cl0gPSBieXRlc1tpXQogICAgICAgICAgICBhcmdzX3B0ciA9IGFyZ3NfcHRyICsgMQogICAgICAgIGVuZAogICAgZW5kCiAgICByZXR1cm4gYmluYXJ5cGFyc2VyLmJ5dGVzMm51bWJlcihhcmdzWzFdLCBhcmdzWzJdLCBhcmdzWzNdLCBhcmdzWzRdLCBhcmdzWzVdLCBhcmdzWzZdLCBhcmdzWzddLCBhcmdzWzhdKQplbmQKCgotLS0KLS0gbGVzc190aGFuIDY0Yml0IGxlc3MgdGhhbiB0ZXN0IHVzaW5nIERXT1JEcy4KLS0gQHBhcmFtIGFfaGlnaCBBIERXT1JELgotLSBAcGFyYW0gYV9sb3cgQSBEV09SRC4KLS0gQHBhcmFtIGJfaGlnaCBBIERXT1JELgotLSBAcGFyYW0gYl9sb3cgQSBEV09SRC4KLS0gQHJldHVybiBUcnVlIG9yIEZhbHNlLgpiaW5hcnlwYXJzZXIucWxlc3NfdGhhbiA9IGZ1bmN0aW9uKGFfaGlnaCwgYV9sb3csIGJfaGlnaCwgYl9sb3cpCiAgIGlmIGFfaGlnaCA8IGJfaGlnaCB0aGVuIHJldHVybiB0cnVlIGVuZAogICBpZiBhX2hpZ2ggPT0gYl9oaWdoIGFuZCBhX2xvdyA8IGJfbG93IHRoZW4gcmV0dXJuIHRydWUgZW5kCiAgIHJldHVybiBmYWxzZQplbmQKCgotLS0KLS0gZ3JlYXRlcl90aGFuIDY0Yml0IGdyZWF0ZXIgdGhhbiB0ZXN0IHVzaW5nIERXT1JEcy4KLS0gQHBhcmFtIGFfaGlnaCBBIERXT1JELgotLSBAcGFyYW0gYV9sb3cgQSBEV09SRC4KLS0gQHBhcmFtIGJfaGlnaCBBIERXT1JELgotLSBAcGFyYW0gYl9sb3cgQSBEV09SRC4KLS0gQHJldHVybiBBIHBhaXIgb2YgRFdPUkRzLCAoRFdPUkRfaGlnaCwgRFdPUkRfbG93KS4KYmluYXJ5cGFyc2VyLnFncmVhdGVyX3RoYW4gPSBmdW5jdGlvbihhX2hpZ2gsIGFfbG93LCBiX2hpZ2gsIGJfbG93KQogICByZXR1cm4gYmluYXJ5cGFyc2VyLmxlc3NfdGhhbihiX2hpZ2gsIGJfbG93LCBhX2hpZ2gsIGFfbG93KQplbmQKCgotLS0KLS0gc3VidHJhY3QgU3VidHJhY3QgNjRiaXQgdmFsdWVzIHVzaW5nIGxvdyBhbmQgaGlnaCBEV09SRHMgdG8KLS0gICByZXByZXNlbnQgdGhlc2UgbGFyZ2VyIG51bWJlcnMuIGBhYCBNVVNUIGJlIGdyZWF0ZXIKLS0gICB0aGFuIGBiYC4KLS0gQHBhcmFtIGFfaGlnaCBBIERXT1JELgotLSBAcGFyYW0gYV9sb3cgQSBEV09SRC4KLS0gQHBhcmFtIGJfaGlnaCBBIERXT1JELgotLSBAcGFyYW0gYl9sb3cgQSBEV09SRC4KLS0gQHJldHVybiBBIHBhaXIgb2YgRFdPUkRzLCAoRFdPUkRfaGlnaCwgRFdPUkRfbG93KS4KYmluYXJ5cGFyc2VyLnFzdWJ0cmFjdCA9IGZ1bmN0aW9uKGFfaGlnaCwgYV9sb3csIGJfaGlnaCwgYl9sb3cpCiAgIGxvY2FsIHJldF9oaWdoCiAgIGxvY2FsIHJldF9sb3cKICAgbG9jYWwgY2FycnkgPSBmYWxzZQoKICAgcmV0X2xvdyA9IGFfbG93IC0gYl9sb3cKICAgaWYgcmV0X2xvdyA8IDAgdGhlbgogICAgICByZXRfbG93ID0gcmV0X2xvdyArIDQyOTQ5NjcyOTYKICAgICAgY2FycnkgICA9IHRydWUKICAgZW5kCgogICByZXRfaGlnaCA9IGFfaGlnaCAtIGJfaGlnaAogICBpZiBjYXJyeSB0aGVuCiAgICAgIHJldF9oaWdoID0gcmV0X2hpZ2ggLSAxCiAgIGVuZAoKICAgcmV0dXJuIHJldF9oaWdoLCByZXRfbG93CmVuZAoKCi0tLQotLSBhZGQgQWRkIDY0IGJpdCB2YWx1ZXMgdXNpbmcgbG93IGFuZCBoaWdoIERXT1JEcyB0bwotLSAgIHJlcHJlc2VudCB0aGVzZSBsYXJnZXIgbnVtYmVycy4KLS0gQHBhcmFtIGFfaGlnaCBBIERXT1JELgotLSBAcGFyYW0gYV9sb3cgQSBEV09SRC4KLS0gQHBhcmFtIGJfaGlnaCBBIERXT1JELgotLSBAcGFyYW0gYl9sb3cgQSBEV09SRC4KLS0gQHJldHVybiBBIHBhaXIgb2YgRFdPUkRzLCAoRFdPUkRfaGlnaCwgRFdPUkRfbG93KS4KYmluYXJ5cGFyc2VyLnFhZGQgPSBmdW5jdGlvbihhX2hpZ2gsIGFfbG93LCBiX2hpZ2gsIGJfbG93KQogICBsb2NhbCByZXRfaGlnaAogICBsb2NhbCByZXRfbG93CiAgIGxvY2FsIGNhcnJ5ID0gZmFsc2UKICAgbG9jYWwgb3ZlcmZsb3cgPSAwCgogICByZXRfbG93ID0gYV9sb3cgKyBiX2xvdwogICBpZiByZXRfbG93ID4gbWF0aC5wb3coMiwgMzIpIC0gMSB0aGVuCiAgICAgIGxvY2FsIHJlYWxfcmV0X2xvdyA9IGJpbmFyeXBhcnNlci5iYW5kKHJldF9sb3csIDQyOTQ5NjcyOTYgLSAxKQogICAgICBvdmVyZmxvdyA9IChyZXRfbG93IC0gcmVhbF9yZXRfbG93KSAvIChtYXRoLnBvdygyLCAzMikpCiAgICAgIHJldF9sb3cgPSByZWFsX3JldF9sb3cKICAgZW5kCgogICByZXRfaGlnaCA9IGFfaGlnaCArIGJfaGlnaAogICByZXRfaGlnaCA9IHJldF9oaWdoICsgb3ZlcmZsb3cKCiAgIHJldHVybiByZXRfaGlnaCwgcmV0X2xvdwplbmQKCi0tLQotLSBpbnRfYnl0ZSBHaXZlbiBhIERXT1JEIGFzIGBpbnRgIGFuZCBhbiBpbmRleCBgaW5kZXhgCi0tICAgcmV0dXJuIHRoZSBieXRlIHZhbHVlIGF0IHRoYXQgaW5kZXguIEl0cyBsaWtlIHVzaW5nCi0tICAgYml0bWFza3MgdG8gZ2V0IG9uZSBieXRlLgotLSBAcGFyYW0gaW50IEEgRFdPUkQgc2l6ZWQgbnVtYmVyLgotLSBAcGFyYW0gaW5kZXggQSBudW1iZXIgYmV0d2VlbiAxIGFuZCA0LgotLSBAcmV0dXJuIEEgbnVtYmVyIGJldHdlZW4gMCBhbmQgMjU1LgpiaW5hcnlwYXJzZXIuaW50X2J5dGUgPSBmdW5jdGlvbihpbnQsIGluZGV4KQogICBsb2NhbCBleCA9IDAKICAgaWYgaW5kZXggPT0gMSB0aGVuCiAgICAgIGV4ID0gMAogICBlbmQKICAgaWYgaW5kZXggPT0gMiB0aGVuCiAgICAgIGV4ID0gOAogICBlbmQKICAgaWYgaW5kZXggPT0gMyB0aGVuCiAgICAgIGV4ID0gMTYKICAgZW5kCiAgIGlmIGluZGV4ID09IDQgdGhlbgogICAgICBleCA9IDI0CiAgIGVuZAogICByZXR1cm4gYmluYXJ5cGFyc2VyLmJhbmQoaW50LCAyNTUgKiBtYXRoLnBvdygyLCBleCkpIC8gbWF0aC5wb3coMiwgZXgpCmVuZAoKLS0tCi0tIG11bHRpcGx5IE11bHRpcGx5IHR3byA2NGJpdCBudW1iZXJzIHVzaW5nIGhpZ2ggYW5kIGxvdwotLSAgIERXT1JEUy4gIFVzZXMgdGhlIGFsZ29yaXRobSB5b3UgbGVhcm5lZCBhcyBhIGNoaWxkIGluCi0tICAgc2Nob29sLiAgVGhpcyBkZWZpbml0ZWx5IHdvbid0IHdvcmsgZm9yIG5lZ2F0aXZlIG51bWJlcnMuCi0tICAgQWxzbywgbWFrZSBzdXJlIHRoaXMgY2Fubm90IG92ZXJmbG93IDY0Yml0IG51bWJlcnMuCi0tIEBwYXJhbSBhX2hpZ2ggQSBEV09SRC4KLS0gQHBhcmFtIGFfbG93IEEgRFdPUkQuCi0tIEBwYXJhbSBiX2hpZ2ggQSBEV09SRC4KLS0gQHBhcmFtIGJfbG93IEEgRFdPUkQuCi0tIEByZXR1cm4gQSBwYWlyIG9mIERXT1JEcywgKERXT1JEX2hpZ2gsIERXT1JEX2xvdykuCmJpbmFyeXBhcnNlci5xbXVsdGlwbHkgPSBmdW5jdGlvbihhX2hpZ2gsIGFfbG93LCBiX2hpZ2gsIGJfbG93KQogICBsb2NhbCByZXRfaGlnaAogICBsb2NhbCByZXRfbG93CgogICAtLSBpbnB1dCBieXRlcywgbGl0dGxlIGVuZGlhbgogICBsb2NhbCBhX2J5dGVzID0gewogICAgICBiaW5hcnlwYXJzZXIuaW50X2J5dGUoYV9sb3csIDEpLAogICAgICBiaW5hcnlwYXJzZXIuaW50X2J5dGUoYV9sb3csIDIpLAogICAgICBiaW5hcnlwYXJzZXIuaW50X2J5dGUoYV9sb3csIDMpLAogICAgICBiaW5hcnlwYXJzZXIuaW50X2J5dGUoYV9sb3csIDQpLAogICAgICBiaW5hcnlwYXJzZXIuaW50X2J5dGUoYV9oaWdoLCAxKSwKICAgICAgYmluYXJ5cGFyc2VyLmludF9ieXRlKGFfaGlnaCwgMiksCiAgICAgIGJpbmFyeXBhcnNlci5pbnRfYnl0ZShhX2hpZ2gsIDMpLAogICAgICBiaW5hcnlwYXJzZXIuaW50X2J5dGUoYV9oaWdoLCA0KSwKICAgfQogICBsb2NhbCBiX2J5dGVzID0gewogICAgICBiaW5hcnlwYXJzZXIuaW50X2J5dGUoYl9sb3csIDEpLAogICAgICBiaW5hcnlwYXJzZXIuaW50X2J5dGUoYl9sb3csIDIpLAogICAgICBiaW5hcnlwYXJzZXIuaW50X2J5dGUoYl9sb3csIDMpLAogICAgICBiaW5hcnlwYXJzZXIuaW50X2J5dGUoYl9sb3csIDQpLAogICAgICBiaW5hcnlwYXJzZXIuaW50X2J5dGUoYl9oaWdoLCAxKSwKICAgICAgYmluYXJ5cGFyc2VyLmludF9ieXRlKGJfaGlnaCwgMiksCiAgICAgIGJpbmFyeXBhcnNlci5pbnRfYnl0ZShiX2hpZ2gsIDMpLAogICAgICBiaW5hcnlwYXJzZXIuaW50X2J5dGUoYl9oaWdoLCA0KSwKICAgfQogICBsb2NhbCBvdXRfYnl0ZXMgPSB7MCwgMCwgMCwgMCwgMCwgMCwgMCwgMH0KCiAgIC0tIDh4OCBtYXRyaXgsIGludG8gd2hpY2ggaW50ZXJtZWRpYXRlIHN0ZXBzIGFyZSBzdG9yZWQKICAgbG9jYWwgcmVzdWx0X21hdHJpeCA9IHt9CiAgIGZvciBpPTEsIDggZG8KICAgICAgcmVzdWx0X21hdHJpeFtpXSA9IHt9CiAgIGVuZAoKICAgLS0tCiAgIC0tIGxvd19ieXRlIEdpdmVuIGEgbnVtYmVyIG9mIHVwIHRvIHR3byBieXRlcywgcmV0dXJuIHRoZQogICAtLSAgIGxvd2VyIGJ5dGUgdmFsdWUuCiAgIC0tIEBwYXJhbSBkIEEgbnVtYmVyIG5vIGxhcmdlciB0aGFuIDIqKjE2IC0gMQogICAtLSBAcmV0dXJuIEEgbnVtYmVyIG5vIGxhcmdlciB0aGFuIDIqKjggLSAxCiAgIGZ1bmN0aW9uIGxvd19ieXRlKGQpCiAgICAgIHJldHVybiBiaW5hcnlwYXJzZXIuYmFuZChkLCAyNTUpCiAgIGVuZAoKICAgLS0tCiAgIC0tIGhpZ2hfYnl0ZSBHaXZlbiBhIG51bWJlciBvZiB1cCB0byB0d28gYnl0ZXMsIHJldHVybiB0aGUKICAgLS0gICBoaWdoZXIgYnl0ZSB2YWx1ZS4KICAgLS0gQHBhcmFtIGQgQSBudW1iZXIgbm8gbGFyZ2VyIHRoYW4gMioqMTYgLSAxCiAgIC0tIEByZXR1cm4gQSBudW1iZXIgbm8gbGFyZ2VyIHRoYW4gMioqOCAtIDEKICAgZnVuY3Rpb24gaGlnaF9ieXRlKGQpCiAgICAgIHJldHVybiBiaW5hcnlwYXJzZXIuYmFuZChkLCAyNTUgKiBtYXRoLnBvdygyLCA4KSkgLyBtYXRoLnBvdygyLCA4KQogICBlbmQKCiAgIC0tIFRoaXMgaXMgdGhlIG11bHRpcGxpY2F0aW9uIGFsZ29yaXRobSB5b3UgbGVhcm5lZCBpbiBlbGVtZW50YXJ5IHNjaG9vbC4KICAgLS0gICBGb3IgZWFjaCBieXRlIGluIHRoZSBib3R0b20gcm93LCBtdWx0aXBseSBpdCBieSBlYWNoIGJ5dGUgaW4gdGhlIHVwcGVyCiAgIC0tICAgcm93LCBhbmQgbm90ZSBpdCBkb3duIGFwcHJvcHJpYXRlZCBwYWRkZWQuCiAgIGZvciBpPTAsIDcgZG8KICAgICAgLS0gYiBieXRlcwogICAgICBsb2NhbCBiID0gYl9ieXRlc1tpICsgMV0KICAgICAgZm9yIGo9MCwgNyBkbwogICAtLSBhIGJ5dGVzCiAgIGxvY2FsIGEgPSBhX2J5dGVzW2ogKyAxXQogICBsb2NhbCB0ID0gYSAqIGIKICAgbG9jYWwgZV9sb3cgPSByZXN1bHRfbWF0cml4W2kgKyAxXVtpICsgaiArIDFdCiAgIGxvY2FsIGVfaGlnaCA9IHJlc3VsdF9tYXRyaXhbaSArIDFdW2kgKyBqICsgMSArIDFdCiAgIHJlc3VsdF9tYXRyaXhbaSArIDFdW2kgKyBqICsgMV0gICAgID0gbG93X2J5dGUodCkgKyAoZV9sb3cgb3IgMCkKICAgcmVzdWx0X21hdHJpeFtpICsgMV1baSArIGogKyAxICsgMV0gPSBoaWdoX2J5dGUodCkgKyAoZV9oaWdoIG9yIDApCiAgICAgIGVuZAogICBlbmQKCiAgIC0tIE5vdywgc3VtIHRoZSBpbnRlcm1lZGlhdGUgdmFsdWVzIHdlIGdlbmVyYXRlZCBpbiB0aGUgcHJldmlvdXMgc3RlcAogICAtLSAgIGJ5IGFkZGluZyBjb2x1bW5zIG9mIGJ5dGVzLgogICAtLSBOb3RlLCBlYWNoIG91dCAiYnl0ZSIgbWF5IGFjdHVhbGx5IGJlIGJpZ2dlciB0aGFuIGEgYnl0ZS4gIFRoaXMgaXMKICAgLS0gICBoYW5kbGVkIGxhdGVyLgogICBmb3Igaj0xLCA4IGRvCiAgICAgIGxvY2FsIHRvdGFsID0gMAogICAgICBmb3IgaT0xLCA4IGRvCiAgIHRvdGFsID0gdG90YWwgKyAocmVzdWx0X21hdHJpeFtpXVtqXSBvciAwKQogICAgICBlbmQKICAgICAgb3V0X2J5dGVzW2pdID0gdG90YWwKICAgZW5kCgogICAtLSBDb252ZXJ0IHRoZSBzZXQgb2YgYnl0ZS1saWtlIHRoaW5ncyBpbnRvIG9uZSBudW1iZXIuCiAgIHJldF9sb3cgID0gMAogICByZXRfaGlnaCA9IDAKICAgZm9yIGk9NCwgMSwgLTEgZG8KICAgICAgcmV0X2xvdyAgPSAocmV0X2xvdyAgKiBtYXRoLnBvdygyLCA4KSkgKyBvdXRfYnl0ZXNbaV0KICAgICAgcmV0X2hpZ2ggPSAocmV0X2hpZ2ggKiBtYXRoLnBvdygyLCA4KSkgKyBvdXRfYnl0ZXNbNCArIGldCiAgIGVuZAoKICAgLS0gRmluYWxseSwgaGFuZGxlIGFueSBvdmVyZmxvdyBmcm9tIHRoZSBsb3dlciAzMiBiaXRzCiAgIGxvY2FsIG92ZXJmbG93ID0gMAogICBpZiByZXRfbG93ID4gbWF0aC5wb3coMiwgMzIpIC0gMSB0aGVuCiAgICAgIGxvY2FsIHJlYWxfcmV0X2xvdyA9IGJpbmFyeXBhcnNlci5iYW5kKHJldF9sb3csIDQyOTQ5NjcyOTYgLSAxKQogICAgICBvdmVyZmxvdyA9IChyZXRfbG93IC0gcmVhbF9yZXRfbG93KSAvIChtYXRoLnBvdygyLCAzMikpCiAgICAgIHJldF9sb3cgPSByZWFsX3JldF9sb3cKICAgZW5kCiAgIHJldF9oaWdoID0gcmV0X2hpZ2ggKyBvdmVyZmxvdwoKICAgcmV0dXJuIHJldF9oaWdoLCByZXRfbG93CmVuZAoKCmJpbmFyeXBhcnNlci5tdWx0aXBseV90ZXN0ID0gZnVuY3Rpb24oKQogICB0ZXN0cyA9IHN0ZGxpYi5MaXN0KHsKICAgICAgICAtLSAgYV9oIGFfbCBiX2ggYl9sIGV4cGVjdGVkCiAgICAgICAge3swLCAwLCAwLCAwfSwgezAsIDB9fSwKICAgICAgICB7ezAsIDAsIDAsIDF9LCB7MCwgMH19LAogICAgICAgIHt7MCwgMCwgMSwgMH0sIHswLCAwfX0sCiAgICAgICAge3swLCAxLCAwLCAwfSwgezAsIDB9fSwKICAgICAgICB7ezEsIDAsIDAsIDB9LCB7MCwgMH19LAogICAgICAgIHt7MCwgMSwgMCwgMX0sIHswLCAxfX0sCiAgICAgICAge3sxLCAwLCAwLCAxfSwgezEsIDB9fSwKICAgICAgICB7ezAsIDIsIDAsIDJ9LCB7MCwgNH19LAogICAgICAgIHt7MiwgMCwgMCwgMn0sIHs0LCAwfX0sCiAgICAgICAge3swLCAxMDAwMDAsIDAsIDEwMDAwMH0sIHsyLCAxNDEwMDY1NDA4fX0sCiAgICAgICAge3swLCAxMjM0NTY3LCAwLCA2Nzg5MDEyfSwgezE5NTEsIDIwMDg5ODMzMDh9fSwKICAgICAgICAgICB9KQoKICAgZm9yIHQgaW4gdGVzdHMuZWFjaCgpIGRvCiAgICAgIGxvY2FsIGFfaCA9IHRbMV1bMV0KICAgICAgbG9jYWwgYV9sID0gdFsxXVsyXQogICAgICBsb2NhbCBiX2ggPSB0WzFdWzNdCiAgICAgIGxvY2FsIGJfbCA9IHRbMV1bNF0KICAgICAgbG9jYWwgZV9oID0gdFsyXVsxXQogICAgICBsb2NhbCBlX2wgPSB0WzJdWzJdCiAgICAgIGxvY2FsIHJfaCwgcl9sID0gYmluYXJ5cGFyc2VyLnFtdWx0aXBseShhX2gsIGFfbCwgYl9oLCBiX2wpCiAgICAgIGxvY2FsIHN1Y2Nlc3MgPSByX2ggPT0gZV9oIGFuZCByX2wgPT0gZV9sCiAgICAgIGlmIHN1Y2Nlc3MgdGhlbgogICBwcmludCgiWUVTISAiIC4uIGFfaCAuLiAiLCAiIC4uIGFfbCAuLgogICAgICAgICAiICogIiAgIC4uIGJfaCAuLiAiLCAiIC4uIGJfbCAuLgogICAgICAgICAiID89ICIgIC4uIHJfaCAuLiAiLCAiIC4uIHJfbCkKICAgICAgZWxzZQogICBwcmludCgiTk8uLi4iIC4uIGFfaCAuLiAiLCAiIC4uIGFfbCAuLgogICAgICAgICAiICogIiAgIC4uIGJfaCAuLiAiLCAiIC4uIGJfbCAuLgogICAgICAgICAiID89ICIgLi4gcl9oIC4uICIsICIgLi4gcl9sKQogICAgICBlbmQKICAgZW5kCmVuZAoKLS0tIFRlc3QgdGhlIHJlYWRfdXRmMTYgZnVuY3Rpb25hbGl0eQpiaW5hcnlwYXJzZXIudGVzdF9yZWFkX3V0ZjE2ID0gZnVuY3Rpb24oKQoKICAgIC0tIFRlc3QgYSBidW5jaCBvZiB0eXBlcyBvZiB1dGYxNiB0byB1dGY4IGNvbnZlcnNpb25zCiAgICBsb2NhbCB0ZXN0X3N0cmluZ3NfYmUgPSB7CiAgICAgICAgWyJzb21ldGhpbmciXSA9IHN0cmluZy5jaGFyKDB4MDAsIDB4NzMsIDB4MDAsIDB4NkYsIDB4MDAsIDB4NkQsIDB4MDAsIDB4NjUsIDB4MDAsIDB4NzQsIDB4MDAsIDB4NjgsIDB4MDAsIDB4NjksIDB4MDAsIDB4NkUsIDB4MDAsIDB4NjcpLAogICAgICAgIFsiUm9zw6kgUmlzaW5nIl0gPSBzdHJpbmcuY2hhcigweDAwLCAweDUyLCAweDAwLCAweDZGLCAweDAwLCAweDczLCAweDAwLCAweEU5LCAweDAwLCAweDIwLCAweDAwLCAweDUyLCAweDAwLCAweDY5LCAweDAwLCAweDczLCAweDAwLCAweDY5LCAweDAwLCAweDZFLCAweDAwLCAweDY3KSwKICAgICAgICBbIkM6XFzZitinINmD2YrZgSJdID0gc3RyaW5nLmNoYXIoMHgwMCwgMHg0MywgMHgwMCwgMHgzQSwgMHgwMCwgMHg1QywgMHgwNiwgMHg0QSwgMHgwNiwgMHgyNywgMHgwMCwgMHgyMCwgMHgwNiwgMHg0MywgMHgwNiwgMHg0QSwgMHgwNiwgMHg0MSksCiAgICAgICAgWyJDOlxcUm9zw6kuZXhlIl0gPSBzdHJpbmcuY2hhcigweDAwLCAweDQzLCAweDAwLCAweDNBLCAweDAwLCAweDVDLCAweDAwLCAweDUyLCAweDAwLCAweDZGLCAweDAwLCAweDczLCAweDAwLCAweEU5LCAweDAwLCAweDJFLCAweDAwLCAweDY1LCAweDAwLCAweDc4LCAweDAwLCAweDY1KSwKICAgICAgICBbIiQiXSA9IHN0cmluZy5jaGFyKDB4MDAsIDB4MjQpLAogICAgICAgIFsi4oKsIl0gPSBzdHJpbmcuY2hhcigweDIwLCAweEFDKSwKICAgICAgICBbIvCQkLciXSA9IHN0cmluZy5jaGFyKDB4RDgsIDB4MDEsIDB4REMsIDB4MzcpLAogICAgICAgIFsi8KStoiJdID0gc3RyaW5nLmNoYXIoMHhEOCwgMHg1MiwgMHhERiwgMHg2MiksCiAgICAgICAgWyLwkJC3JOKCrPCkraIiXSA9IHN0cmluZy5jaGFyKDB4RDgsIDB4MDEsIDB4REMsIDB4MzcsIDB4MDAsIDB4MjQsIDB4MjAsIDB4QUMsIDB4RDgsIDB4NTIsIDB4REYsIDB4NjIpCiAgICB9CiAgICBmb3IgcmVzdWx0LCB0ZXN0X3N0ciBpbiBwYWlycyh0ZXN0X3N0cmluZ3NfYmUpIGRvCiAgICAgICAgLS0gZGVidWcuZGVidWcoZGVidWcuaGV4X2R1bXAodGVzdF9zdHIpKQogICAgICAgIGxvY2FsIGJsb2NrID0gYmluYXJ5cGFyc2VyLkJsb2NrKHRlc3Rfc3RyLCAwKQogICAgICAgIGlmIGJsb2NrLnJlYWRfdXRmMTZfYmUoMCkgPT0gcmVzdWx0IHRoZW4KICAgICAgICAgICAgZGVidWcuZGVidWcoImJpZyBlbmRpYW4gZW5jb2RlIHV0Zi0xNiAtLT4gdXRmLTggc3VjY2VzcyEiKQogICAgICAgIGVsc2UKICAgICAgICAgICAgZGVidWcuZGVidWcoImJpZyBlbmRpYW4gZW5jb2RlIHV0Zi0xNiAtLT4gdXRmLTggZmFpbGVkISIpCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBsb2NhbCB0ZXN0X3N0cmluZ3NfbGUgPSB7CiAgICAgICAgWyJzb21ldGhpbmciXSA9IHN0cmluZy5jaGFyKDB4NzMsIDB4MDAsIDB4NkYsIDB4MDAsIDB4NkQsIDB4MDAsIDB4NjUsIDB4MDAsIDB4NzQsIDB4MDAsIDB4NjgsIDB4MDAsIDB4NjksIDB4MDAsIDB4NkUsIDB4MDAsIDB4NjcsIDB4MDApLAogICAgICAgIFsiUm9zw6kgUmlzaW5nIl0gPSBzdHJpbmcuY2hhcigweDUyLCAweDAwLCAweDZGLCAweDAwLCAweDczLCAweDAwLCAweEU5LCAweDAwLCAweDIwLCAweDAwLCAweDUyLCAweDAwLCAweDY5LCAweDAwLCAweDczLCAweDAwLCAweDY5LCAweDAwLCAweDZFLCAweDAwLCAweDY3LCAweDAwKSwKICAgICAgICBbIkM6XFzZitinINmD2YrZgSJdID0gc3RyaW5nLmNoYXIoMHg0MywgMHgwMCwgMHgzQSwgMHgwMCwgMHg1QywgMHgwMCwgMHg0QSwgMHgwNiwgMHgyNywgMHgwNiwgMHgyMCwgMHgwMCwgMHg0MywgMHgwNiwgMHg0QSwgMHgwNiwgMHg0MSwgMHgwNiksCiAgICAgICAgWyJDOlxcUm9zw6kuZXhlIl0gPSBzdHJpbmcuY2hhcigweDQzLCAweDAwLCAweDNBLCAweDAwLCAweDVDLCAweDAwLCAweDUyLCAweDAwLCAweDZGLCAweDAwLCAweDczLCAweDAwLCAweEU5LCAweDAwLCAweDJFLCAweDAwLCAweDY1LCAweDAwLCAweDc4LCAweDAwLCAweDY1LCAweDAwKSwKICAgICAgICBbIiQiXSA9IHN0cmluZy5jaGFyKDB4MjQsIDB4MDApLAogICAgICAgIFsi4oKsIl0gPSBzdHJpbmcuY2hhcigweEFDLCAweDIwKSwKICAgICAgICBbIvCQkLciXSA9IHN0cmluZy5jaGFyKDB4MDEsIDB4RDgsIDB4MzcsIDB4REMpLAogICAgICAgIFsi8KStoiJdID0gc3RyaW5nLmNoYXIoMHg1MiwgMHhEOCwgMHg2MiwgMHhERiksCiAgICAgICAgWyLwkJC3JOKCrPCkraIiXSA9IHN0cmluZy5jaGFyKDB4MDEsIDB4RDgsIDB4MzcsIDB4REMsIDB4MjQsIDB4MDAsIDB4QUMsIDB4MjAsIDB4NTIsIDB4RDgsIDB4NjIsIDB4REYpLAogICAgfQogICAgZm9yIHJlc3VsdCwgdGVzdF9zdHIgaW4gcGFpcnModGVzdF9zdHJpbmdzX2xlKSBkbwogICAgICAgIC0tIGRlYnVnLmRlYnVnKGRlYnVnLmhleF9kdW1wKHRlc3Rfc3RyKSkKICAgICAgICBsb2NhbCBibG9jayA9IGJpbmFyeXBhcnNlci5CbG9jayh0ZXN0X3N0ciwgMCkKICAgICAgICBpZiBibG9jay5yZWFkX3V0ZjE2X2xlKDApID09IHJlc3VsdCB0aGVuCiAgICAgICAgICAgIGRlYnVnLmRlYnVnKCJsaXR0bGUgZW5kaWFuIGVuY29kZSB1dGYtMTYgLS0+IHV0Zi04IHN1Y2Nlc3MhIikKICAgICAgICBlbHNlCiAgICAgICAgICAgIGRlYnVnLmRlYnVnKCJsaXR0bGUgZW5kaWFuIGVuY29kZSB1dGYtMTYgLS0+IHV0Zi04IGZhaWxlZCEiKQogICAgICAgIGVuZAogICAgZW5kCgogICAgbG9jYWwgbG9uZ19zdHJfbWlkX3Rlcm1fYmUgPSBzdHJpbmcuY2hhcigweEQ4LCAweDAxLCAweERDLCAweDM3LCAweDAwLCAweDI0LCAweDIwLCAweEFDLCAweEQ4LCAweDUyLCAweERGLCAweDYyLCAweDAwLCAweDAwLCAweDUyLCAweDczKQogICAgbG9jYWwgYmxvY2tfYmUgPSBiaW5hcnlwYXJzZXIuQmxvY2sobG9uZ19zdHJfbWlkX3Rlcm1fYmUsIDApCiAgICAtLSB0ZXN0IGEgbG9uZ2VyIHN0cmluZywgdGhhdCBoYXMgYSB0ZXJtaW5hdG9yIGluIGl0LCBlbnN1cmUgd2UgZG9uJ3QgZ28gcGFzdCB0ZXJtaW5hdG9yCiAgICBpZiBibG9ja19iZS5yZWFkX3V0ZjE2X2JlKDApID09ICLwkJC3JOKCrPCkraIiIHRoZW4KICAgICAgICBkZWJ1Zy5kZWJ1ZygiYmlnIGVuZGlhbiB0ZXJtaW5hdG9yIGluIGVuY29kZSB1dGYtMTYgLS0+IHV0Zi04IHN1Y2Nlc3MhIikKICAgIGVsc2UKICAgICAgICBkZWJ1Zy5kZWJ1ZygiYmlnIGVuZGlhbiB0ZXJtaW5hdG9yIGluIGVuY29kZSB1dGYtMTYgLS0+IHV0Zi04IGZhaWxlZCEiKQogICAgZW5kCgogICAgLS0gdGVzdCBhIGxvbmdlciBzdHJpbmcsIHRoYXQgd2Ugb25seSB3YW50IGEgZml4ZWQgcG9ydGlvbiBvZgogICAgaWYgYmxvY2tfYmUucmVhZF91dGYxNl9iZSgwLCA2KSA9PSAi8JCQtyQiIHRoZW4KICAgICAgICBkZWJ1Zy5kZWJ1ZygiYmlnIGVuZGlhbiBmaXhlZCBzaXplIGluIGVuY29kZSB1dGYtMTYgLS0+IHV0Zi04IHN1Y2Nlc3MhIikKICAgIGVsc2UKICAgICAgICBkZWJ1Zy5kZWJ1ZygiYmlnIGVuZGlhbiBmaXhlZCBzaXplIGluIGVuY29kZSB1dGYtMTYgLS0+IHV0Zi04IGZhaWxlZCEiKQogICAgZW5kCgogICAgLS0gdGVzdCBzdGFydGluZyB0aGUgb2Zmc2V0IGZ1cnRoZXIgaW4KICAgIGlmIGJsb2NrX2JlLnJlYWRfdXRmMTZfYmUoNikgPT0gIuKCrPCkraIiIHRoZW4KICAgICAgICBkZWJ1Zy5kZWJ1ZygiYmlnIGVuZGlhbiBkZWVwZXIgb2Zmc2V0IGluIGVuY29kZSB1dGYtMTYgLS0+IHV0Zi04IHN1Y2Nlc3MhIikKICAgIGVsc2UKICAgICAgICBkZWJ1Zy5kZWJ1ZygiYmlnIGVuZGlhbiBkZWVwZXIgb2Zmc2V0IGluIGVuY29kZSB1dGYtMTYgLS0+IHV0Zi04IGZhaWxlZCEiKQogICAgZW5kCgogICAgbG9jYWwgbG9uZ19zdHJfbWlkX3Rlcm1fbGUgPSBzdHJpbmcuY2hhcigweDAxLCAweEQ4LCAweDM3LCAweERDLCAweDI0LCAweDAwLCAweEFDLCAweDIwLCAweDUyLCAweEQ4LCAweDYyLCAweERGLCAweDAwLCAweDAwLCAweDczLCAweDUyKQogICAgbG9jYWwgYmxvY2tfbGUgPSBiaW5hcnlwYXJzZXIuQmxvY2sobG9uZ19zdHJfbWlkX3Rlcm1fbGUsIDApCiAgICAtLSB0ZXN0IGEgbG9uZ2VyIHN0cmluZywgdGhhdCBoYXMgYSB0ZXJtaW5hdG9yIGluIGl0LCBlbnN1cmUgd2UgZG9uJ3QgZ28gcGFzdCB0ZXJtaW5hdG9yCiAgICBpZiBibG9ja19sZS5yZWFkX3V0ZjE2X2xlKDApID09ICLwkJC3JOKCrPCkraIiIHRoZW4KICAgICAgICBkZWJ1Zy5kZWJ1ZygibGl0dGxlIGVuZGlhbiB0ZXJtaW5hdG9yIGluIGVuY29kZSB1dGYtMTYgLS0+IHV0Zi04IHN1Y2Nlc3MhIikKICAgIGVsc2UKICAgICAgICBkZWJ1Zy5kZWJ1ZygibGl0dGxlIGVuZGlhbiB0ZXJtaW5hdG9yIGluIGVuY29kZSB1dGYtMTYgLS0+IHV0Zi04IGZhaWxlZCEiKQogICAgZW5kCgogICAgLS0gdGVzdCBhIGxvbmdlciBzdHJpbmcsIHRoYXQgd2Ugb25seSB3YW50IGEgZml4ZWQgcG9ydGlvbiBvZgogICAgaWYgYmxvY2tfbGUucmVhZF91dGYxNl9sZSgwLCA2KSA9PSAi8JCQtyQiIHRoZW4KICAgICAgICBkZWJ1Zy5kZWJ1ZygibGl0dGxlIGVuZGlhbiBmaXhlZCBzaXplIGluIGVuY29kZSB1dGYtMTYgLS0+IHV0Zi04IHN1Y2Nlc3MhIikKICAgIGVsc2UKICAgICAgICBkZWJ1Zy5kZWJ1ZygibGl0dGxlIGVuZGlhbiBmaXhlZCBzaXplIGluIGVuY29kZSB1dGYtMTYgLS0+IHV0Zi04IGZhaWxlZCEiKQogICAgZW5kCgogICAgLS0gdGVzdCBzdGFydGluZyB0aGUgb2Zmc2V0IGZ1cnRoZXIgaW4KICAgIGlmIGJsb2NrX2xlLnJlYWRfdXRmMTZfbGUoNikgPT0gIuKCrPCkraIiIHRoZW4KICAgICAgICBkZWJ1Zy5kZWJ1ZygibGl0dGxlIGVuZGlhbiBkZWVwZXIgb2Zmc2V0IGluIGVuY29kZSB1dGYtMTYgLS0+IHV0Zi04IHN1Y2Nlc3MhIikKICAgIGVsc2UKICAgICAgICBkZWJ1Zy5kZWJ1ZygibGl0dGxlIGVuZGlhbiBkZWVwZXIgb2Zmc2V0IGluIGVuY29kZSB1dGYtMTYgLS0+IHV0Zi04IGZhaWxlZCEiKQogICAgZW5kCgplbmQKCi0tLQotLSBCbG9jawotLSBAcGFyYW0gaEZpbGUgRWl0aGVyIGFuIG9wZW4gZmlsZSBoYW5kbGUsIG9yIGEgc3RyaW5nIGNvbnRhaW5pbmcgdGhlIGJ1ZmZlciBhcyBhIHN0cmluZy4KLS0gQHBhcmFtIGJsb2NrX29mZnNldCBUaGUgXzAtaW5kZXhlZF8gb2Zmc2V0IGF0IHdoaWNoIHRoaXMgYmxvY2sgYmVnaW5zLgpmdW5jdGlvbiBiaW5hcnlwYXJzZXIuQmxvY2soaEZpbGUsIGJsb2NrX29mZnNldCkKICBsb2NhbCBzZWxmID0ge30KICBzZWxmLm9mZnNldCA9IGJsb2NrX29mZnNldAogIHNlbGYuY2FjaGUgID0ge30KICBsb2NhbCBtdCA9IHt9CiAgc2V0bWV0YXRhYmxlKHNlbGYsIG10KQoKICBtdC5fX3Rvc3RyaW5nID0gZnVuY3Rpb24oKQogICAgcmV0dXJuICJCbG9jayBhdCBvZmZzZXQgIiAuLiBibG9ja19vZmZzZXQKICBlbmQKCiAgLS0tCiAgLS0gcmVhZF9iaW4KICAtLSBSZWFkIG4gYnl0ZXMgZnJvbSBoRmlsZSBhbmQgcmV0dXJuIHRoZW0gYXMgYSBzdHJpbmcuCiAgLS0gQHBhcmFtIG9mZnNldCBUaGUgcmVsYXRpdmUgb2Zmc2V0IGluIGJ5dGVzLgogIC0tIEBwYXJhbSBuIFRoZSBudW1iZXIgb2YgYnl0ZXMgdG8gcmVhZC4KICAtLSBAcmV0dXJuIGJ1ZiwgZXJyb3IKICBzZWxmLnJlYWRfYmluID0gZnVuY3Rpb24ob2Zmc2V0LCBuKQogICAgaWYgdHlwZShoRmlsZSkgPT0gInN0cmluZyIgdGhlbgogICAgICAgIGxvY2FsIHN1YiA9IHN0cmluZy5zdWIoaEZpbGUsIHNlbGYub2Zmc2V0ICsgb2Zmc2V0ICsgMSwgc2VsZi5vZmZzZXQgKyBvZmZzZXQgKyBuKQogICAgICAgIHJldHVybiBzdWIsIG5pbAogICAgZWxzZWlmIGdldG1ldGF0YWJsZShoRmlsZSkuX190eXBlID09ICJCdWZmZXJlZEZpbGVSZWFkZXIiIHRoZW4KICAgICAgICByZXR1cm4gaEZpbGUucmVhZChzZWxmLm9mZnNldCArIG9mZnNldCwgbikKICAgIGVsc2UKICAgICAgbG9jYWwgdG90YWxfb2Zmc2V0ID0gc2VsZi5vZmZzZXQgKyBvZmZzZXQKICAgICAgbG9jYWwgc2VjdG9yID0gbWF0aC5mbG9vcih0b3RhbF9vZmZzZXQgLyA1MTIpCiAgICAgIGxvY2FsIHNlY3Rvcl9vZmZzZXQgPSBtYXRoLm1vZCh0b3RhbF9vZmZzZXQsIDUxMikKICAgICAgbG9jYWwgbGVuZ3RoID0gNTEyCiAgICAgIGlmIG4gPiBsZW5ndGggdGhlbgogICAgICAgIGxlbmd0aCA9IDUxMiAqIChtYXRoLmZsb29yKG4gLyA1MTIpICsgMSkKICAgICAgZW5kCgogICAgICBsb2NhbCByZXQgPSBmaWxlLkZpbGVTZWVrQVBJKGhGaWxlLCBzZWN0b3IgKiA1MTIsIHN0ZGxpYi5TRUVLX0JFR0lOKQogICAgICBpZiBub3QgcmV0IHRoZW4gcmV0dXJuIG5pbCwgIlVuYWJsZSB0byBzZWVrIHRvIHNlY3RvciAiIC4uIHNlY3RvciBlbmQKICAgICAgbG9jYWwgZGF0YSA9IGZpbGUuRmlsZVJlYWRBUEkoaEZpbGUsIGxlbmd0aCkKICAgICAgaWYgbm90IGRhdGEgdGhlbiByZXR1cm4gbmlsLCAiVW5hYmxlIHRvIHJlYWQgZGF0YSBmcm9tIHNlY3RvciAiIC4uIHNlY3RvciBlbmQKCiAgICAgIHJldHVybiBzdHJpbmcuc3ViKGRhdGEsIHNlY3Rvcl9vZmZzZXQgKyAxLCBzZWN0b3Jfb2Zmc2V0ICsgbikKICAgIGVuZAogIGVuZAogIC0tLQogIC0tIHJlYWRfbgogIC0tIFJlYWQgbiBsaXR0bGUgZW5kaWFuIGJ5dGVzIGZyb20gdGhlIGdpdmVuIF8wLUlOREVYRURfIG9mZnNldCBhbmQgcmV0dXJuIGFuCiAgLS0gdW5zaWduZWQgbnVtYmVyLgogIC0tIEBwYXJhbSBvZmZzZXQgVGhlIHJlbGF0aXZlIG9mZnNldCBpbiBieXRlcy4KICAtLSBAcGFyYW0gbiBUaGUgbnVtYmVyIG9mIGJ5dGVzIHRvIHJlYWQuIFNob3VsZCBiZSBsZXNzIHRoYW4gb3IgZXF1YWwgdG8KICAtLSAgICB0aGUgbWF4IG51bWJlciBvZiBhcmd1bWVudHMgdG8gYnl0ZXMybnVtYmVyKCkuCiAgICAtLSBAcmV0dXJuIGR3b3JkX2xvdywgZHdvcmRfaGlnaCwgZXJyb3IKICBsb2NhbCByZWFkX24gPSBmdW5jdGlvbihvZmZzZXQsIG4pCiAgICBsb2NhbCBkYXRhLCBlcnIgPSBzZWxmLnJlYWRfYmluKG9mZnNldCwgbikKICAgICAgICBpZiBlcnIgdGhlbiByZXR1cm4gbmlsLCBuaWwsIGVyciBlbmQKICAgICAgICBsb2NhbCBsb3csIGhpZ2ggPSBiaW5hcnlwYXJzZXIuYnl0ZXMybnVtYmVyKHN0cmluZy5ieXRlKGRhdGEsIDEsIG4pKQogICAgcmV0dXJuIGxvdywgaGlnaCwgbmlsCiAgICBlbmQKICAgIC0tLQogIC0tIHJlYWRfbl9iZQogIC0tIFJlYWQgbiBiaWcgZW5kaWFuIGJ5dGVzIGZyb20gdGhlIGdpdmVuIF8wLUlOREVYRURfIG9mZnNldCBhbmQgcmV0dXJuIGFuCiAgLS0gdW5zaWduZWQgbnVtYmVyLgogIC0tIEBwYXJhbSBvZmZzZXQgVGhlIHJlbGF0aXZlIG9mZnNldCBpbiBieXRlcy4KICAtLSBAcGFyYW0gbiBUaGUgbnVtYmVyIG9mIGJ5dGVzIHRvIHJlYWQuIFNob3VsZCBiZSBsZXNzIHRoYW4gb3IgZXF1YWwgdG8KICAtLSAgICB0aGUgbWF4IG51bWJlciBvZiBhcmd1bWVudHMgdG8gYnl0ZXMybnVtYmVyKCkuCiAgICAtLSBAcmV0dXJuIGR3b3JkX2xvdywgZHdvcmRfaGlnaCwgZXJyb3IKICBsb2NhbCByZWFkX25fYmUgPSBmdW5jdGlvbihvZmZzZXQsIG4pCiAgICBsb2NhbCBkYXRhID0gc2VsZi5yZWFkX2JpbihvZmZzZXQsIG4pCiAgICBpZiBub3QgZGF0YSB0aGVuIHJldHVybiBuaWwgZW5kCiAgICAgICAgbG9jYWwgbG93LCBoaWdoID0gYmluYXJ5cGFyc2VyLmJ5dGVzMm51bWJlcl9iZShzdHJpbmcuYnl0ZShkYXRhLCAxLCBuKSkKICAgIHJldHVybiBsb3csIGhpZ2gsIGVycgogIGVuZAogIHNlbGYucmVhZF9ieXRlID0gZnVuY3Rpb24ob2Zmc2V0KQogICAgICAgIGlmIHR5cGUoaEZpbGUpID09ICJzdHJpbmciIHRoZW4KICAgICAgICAgICAgbG9jYWwgYnl0ZSwgXyA9IGJpbmFyeXBhcnNlci5zdHJpbmdieXRlczJudW1iZXIoaEZpbGUsIHNlbGYub2Zmc2V0ICsgb2Zmc2V0ICsgMSwgMSkKICAgICAgICAgICAgcmV0dXJuIGJ5dGUsIG5pbAogICAgICAgIGVsc2UKICAgICAgICAgICAgbG9jYWwgYnl0ZSwgXywgIGVyciA9IHJlYWRfbihvZmZzZXQsIDEpCiAgICAgICAgICAgIGlmIGVyciB0aGVuIHJldHVybiBuaWwsIGVyciBlbmQKICAgICAgICAgICAgcmV0dXJuIGJ5dGUsIG5pbAogICAgICAgIGVuZAogICAgZW5kCiAgICBzZWxmLnJlYWRfaW50OCA9IGZ1bmN0aW9uKG9mZnNldCkKICAgICAgICBsb2NhbCBieXRlID0gc2VsZi5yZWFkX2J5dGUob2Zmc2V0KQogICAgICAgIHJldHVybiAoYnl0ZSA+IDEyNykgYW5kIChieXRlIC0gMjU2KSBvciBieXRlCiAgICBlbmQKICBzZWxmLnJlYWRfd29yZCA9IGZ1bmN0aW9uKG9mZnNldCkKICAgICAgICBpZiB0eXBlKGhGaWxlKSA9PSAic3RyaW5nIiB0aGVuCiAgICAgICAgICAgIGxvY2FsIHdvcmQsIF8gPSBiaW5hcnlwYXJzZXIuc3RyaW5nYnl0ZXMybnVtYmVyKGhGaWxlLCBzZWxmLm9mZnNldCArIG9mZnNldCArIDEsIDIpCiAgICAgICAgICAgIHJldHVybiB3b3JkLCBuaWwKICAgICAgICBlbHNlCiAgICAgICAgICAgIGxvY2FsIHdvcmQsIF8sIGVyciA9IHJlYWRfbihvZmZzZXQsIDIpCiAgICAgICAgICAgIHJldHVybiB3b3JkLCBlcnIKICAgICAgICBlbmQKICAgIGVuZAogIHNlbGYucmVhZF93b3JkX2JlID0gZnVuY3Rpb24ob2Zmc2V0KQogICAgICAgIGlmIHR5cGUoaEZpbGUpID09ICJzdHJpbmciIHRoZW4KICAgICAgICAgICAgbG9jYWwgd29yZCwgXyA9IGJpbmFyeXBhcnNlci5zdHJpbmdieXRlczJudW1iZXJfYmUoaEZpbGUsIHNlbGYub2Zmc2V0ICsgb2Zmc2V0ICsgMSwgMikKICAgICAgICAgICAgcmV0dXJuIHdvcmQsIG5pbAogICAgICAgIGVsc2UKICAgICAgICAgICAgbG9jYWwgd29yZCwgXywgZXJyID0gcmVhZF9uX2JlKG9mZnNldCwgMikKICAgICAgICAgICAgcmV0dXJuIHdvcmQsIGVycgogICAgICAgIGVuZAogICAgZW5kCiAgICBzZWxmLnJlYWRfaW50MTYgPSBmdW5jdGlvbihvZmZzZXQpCiAgICAgICAgbG9jYWwgYnl0ZSA9IHNlbGYucmVhZF93b3JkKG9mZnNldCkKICAgICAgICByZXR1cm4gKGJ5dGUgPiAzNjg2MykgYW5kIChieXRlIC0gNjU1MzUpIG9yIGJ5dGUKICAgIGVuZAogIHNlbGYucmVhZF9kd29yZCA9IGZ1bmN0aW9uKG9mZnNldCkKICAgICAgaWYgdHlwZShoRmlsZSkgPT0gInN0cmluZyIgdGhlbgogICAgICAgICAgICBsb2NhbCBkd29yZCwgXyA9IGJpbmFyeXBhcnNlci5zdHJpbmdieXRlczJudW1iZXIoaEZpbGUsIHNlbGYub2Zmc2V0ICsgb2Zmc2V0ICsgMSwgNCkKICAgICAgICAgICAgcmV0dXJuIGR3b3JkLCBuaWwKICAgICAgICBlbHNlCiAgICAgICAgICAgIGxvY2FsIGR3b3JkLCBfLCBlcnIgPSByZWFkX24ob2Zmc2V0LCA0KQogICAgICAgICAgICByZXR1cm4gZHdvcmQsIGVycgogICAgICAgIGVuZAogICAgZW5kCiAgICBzZWxmLnJlYWRfZHdvcmRfYmUgPSBmdW5jdGlvbihvZmZzZXQpCiAgICAgIGlmIHR5cGUoaEZpbGUpID09ICJzdHJpbmciIHRoZW4KICAgICAgICAgICAgbG9jYWwgZHdvcmQsIF8gPSBiaW5hcnlwYXJzZXIuc3RyaW5nYnl0ZXMybnVtYmVyX2JlKGhGaWxlLCBzZWxmLm9mZnNldCArIG9mZnNldCArIDEsIDQpCiAgICAgICAgICAgIHJldHVybiBkd29yZCwgbmlsCiAgICAgICAgZWxzZQogICAgICAgICAgICBsb2NhbCBkd29yZCwgXywgZXJyID0gcmVhZF9uX2JlKG9mZnNldCwgNCkKICAgICAgICAgICAgcmV0dXJuIGR3b3JkLCBlcnIKICAgICAgICBlbmQKICAgIGVuZAogICAgc2VsZi5yZWFkX2ludDMyID0gZnVuY3Rpb24ob2Zmc2V0KQogICAgICAgIGxvY2FsIGJ5dGUgPSBzZWxmLnJlYWRfZHdvcmQob2Zmc2V0KQogICAgICAgIHJldHVybiAoYnl0ZSA+IDIxNDc0ODM2NDcpIGFuZCAoYnl0ZSAtIDQyOTQ5NjcyOTYpIG9yIGJ5dGUKICAgIGVuZAogIHNlbGYucmVhZF9xd29yZCA9IGZ1bmN0aW9uKG9mZnNldCkKICAgICAgICBsb2NhbCBsLCBoCiAgICAgIGlmIHR5cGUoaEZpbGUpID09ICJzdHJpbmciIHRoZW4KICAgICAgICAgICAgbCA9IGJpbmFyeXBhcnNlci5zdHJpbmdieXRlczJudW1iZXIoaEZpbGUsIHNlbGYub2Zmc2V0ICsgb2Zmc2V0ICsgMSwgNCkKICAgICAgICAgICAgaCA9IGJpbmFyeXBhcnNlci5zdHJpbmdieXRlczJudW1iZXIoaEZpbGUsIHNlbGYub2Zmc2V0ICsgb2Zmc2V0ICsgMSArIDQsIDQpCiAgICAgICAgZWxzZQogICAgICAgICAgICBsID0gc2VsZi5yZWFkX2R3b3JkKG9mZnNldCkKICAgICAgICAgICAgaCA9IHNlbGYucmVhZF9kd29yZChvZmZzZXQgKyA0KQogICAgICAgIGVuZAogICAgICAgIHJldHVybiBsLCBoCiAgICBlbmQKICAgIC0tLQogICAgLS0gQHJldHVybiBsb3cgZHdvcmQsIGhpZ2ggZHdvcmQsIGJvdGggd2l0aCB0aGUgc2lnbiBvZiB0aGUgcXdvcmQuCiAgICBzZWxmLnJlYWRfaW50NjQgPSBmdW5jdGlvbihvZmZzZXQpCiAgICAgICAgbG9jYWwgbCwgaCA9IHNlbGYucmVhZF9xd29yZChvZmZzZXQpCiAgICAgICAgaWYgaCA8PSAzMjc2OCB0aGVuIHJldHVybiBsLCBoIGVuZAoKICAgICAgICBoID0gaCAtIDMyNzY4ICAtLSAweDEwMDAwMDAwMDAwMDAwMDAKICAgICAgICBoID0gYmluYXJ5cGFyc2VyLmJ4b3IoaCwgMzI3NjgpICAtIDB4MDExMTExMTExMTExMTExMQogICAgICAgIGwgPSBiaW5hcnlwYXJzZXIuYnhvcihsLCA2NTUzNSkgIC0gMHgxMTExMTExMTExMTExMTExCiAgICAgICAgbCA9IGwgKyAxCiAgICAgICAgbCA9IC1sCiAgICAgICAgaCA9IC1oCiAgICAgICAgcmV0dXJuIGwsIGgKICAgIGVuZAogIHNlbGYucmVhZF9zaWduZWRfYnl0ZSA9IGZ1bmN0aW9uKG9mZnNldCkKICAgIGxvY2FsIHJldCwgXywgZXJyID0gcmVhZF9uKG9mZnNldCwgMSkKICAgIHJldHVybiAocmV0ID4gMTI3KSBhbmQgKHJldCAtIDI1Nikgb3IgcmV0CiAgZW5kCiAgc2VsZi5yZWFkX3NpZ25lZF9kd29yZCA9IGZ1bmN0aW9uKG9mZnNldCkKICAgIGxvY2FsIHJldCwgXywgZXJyID0gcmVhZF9uKG9mZnNldCwgNCkKICAgIHJldHVybiAocmV0ID4gMjE0NzQ4MzY0NykgYW5kIChyZXQgLSA0Mjk0OTY3Mjk2KSBvciByZXQKICBlbmQKICBzZWxmLnJlYWRfZ3VpZCA9IGZ1bmN0aW9uKG9mZnNldCkKICAgIGxvY2FsIHJldCA9IHN0ZGxpYi5TdHJpbmdCdWlsZGVyKCIiKQogICAgbG9jYWwgY2h1bmsgPSBzZWxmLnJlYWRfYmluKG9mZnNldCwgMTYpCiAgICByZXQuYXBwZW5kKGJpbmFyeXBhcnNlci5oZXgoY2h1bms6Ynl0ZSg0KSkpCiAgICByZXQuYXBwZW5kKGJpbmFyeXBhcnNlci5oZXgoY2h1bms6Ynl0ZSgzKSkpCiAgICByZXQuYXBwZW5kKGJpbmFyeXBhcnNlci5oZXgoY2h1bms6Ynl0ZSgyKSkpCiAgICByZXQuYXBwZW5kKGJpbmFyeXBhcnNlci5oZXgoY2h1bms6Ynl0ZSgxKSkpCiAgICByZXQuYXBwZW5kKCItIikKICAgIHJldC5hcHBlbmQoYmluYXJ5cGFyc2VyLmhleChjaHVuazpieXRlKDYpKSkKICAgIHJldC5hcHBlbmQoYmluYXJ5cGFyc2VyLmhleChjaHVuazpieXRlKDUpKSkKICAgIHJldC5hcHBlbmQoIi0iKQogICAgcmV0LmFwcGVuZChiaW5hcnlwYXJzZXIuaGV4KGNodW5rOmJ5dGUoOCkpKQogICAgcmV0LmFwcGVuZChiaW5hcnlwYXJzZXIuaGV4KGNodW5rOmJ5dGUoNykpKQogICAgcmV0LmFwcGVuZCgiLSIpCiAgICByZXQuYXBwZW5kKGJpbmFyeXBhcnNlci5oZXgoY2h1bms6Ynl0ZSg5KSkpCiAgICByZXQuYXBwZW5kKGJpbmFyeXBhcnNlci5oZXgoY2h1bms6Ynl0ZSgxMCkpKQogICAgcmV0LmFwcGVuZCgiLSIpCiAgICByZXQuYXBwZW5kKGJpbmFyeXBhcnNlci5oZXgoY2h1bms6Ynl0ZSgxMSkpKQogICAgcmV0LmFwcGVuZChiaW5hcnlwYXJzZXIuaGV4KGNodW5rOmJ5dGUoMTIpKSkKICAgIHJldC5hcHBlbmQoYmluYXJ5cGFyc2VyLmhleChjaHVuazpieXRlKDEzKSkpCiAgICByZXQuYXBwZW5kKGJpbmFyeXBhcnNlci5oZXgoY2h1bms6Ynl0ZSgxNCkpKQogICAgcmV0LmFwcGVuZChiaW5hcnlwYXJzZXIuaGV4KGNodW5rOmJ5dGUoMTUpKSkKICAgIHJldC5hcHBlbmQoYmluYXJ5cGFyc2VyLmhleChjaHVuazpieXRlKDE2KSkpCiAgICByZXR1cm4gcmV0LnN0cmluZygpCiAgZW5kCiAgc2VsZi5yZWFkX2Rvc2RhdGUgPSBmdW5jdGlvbihvZmZzZXQpCiAgICBsb2NhbCBkYXRlLCB0aW1lCiAgICBkYXRlID0gc2VsZi5yZWFkX3dvcmQob2Zmc2V0KQogICAgdGltZSA9IHNlbGYucmVhZF93b3JkKG9mZnNldCArIDIpCgogICAgbG9jYWwgZGF5ID0gYmluYXJ5cGFyc2VyLmJhbmQoZGF0ZSwgMzEpIC8gMiBeIDAgICAgICAtLSBiMDAwMDAwMDAwMDAxMTExMQogICAgbG9jYWwgbW9udGggPSBiaW5hcnlwYXJzZXIuYmFuZChkYXRlLCA0ODApIC8gMiBeIDUgICAtLSBiMDAwMDAwMDExMTEwMDAwMAogICAgbG9jYWwgeWVhciA9IGJpbmFyeXBhcnNlci5iYW5kKGRhdGUsIDY1MDI0KSAvIDIgXiA5ICAtLSBiMTExMTExMTAwMDAwMDAwMAogICAgeWVhciA9IHllYXIgKyAxOTgwCgogICAgbG9jYWwgc2VjID0gYmluYXJ5cGFyc2VyLmJhbmQodGltZSwgMzEpIC8gMiBeIDAgICAgICAtLSBiMDAwMDAwMDAwMDAxMTExMQogICAgc2VjID0gc2VjICogMgogICAgbG9jYWwgbWludXRlID0gYmluYXJ5cGFyc2VyLmJhbmQodGltZSwgMjAxNikgLyAyIF4gNSAtLSBiMDAwMDAxMTExMTEwMDAwMAogICAgbG9jYWwgaG91ciA9IGJpbmFyeXBhcnNlci5iYW5kKHRpbWUsIDYzNDg4KSAvIDIgXiAxMSAtLSBiMTExMTEwMDAwMDAwMDAwMAoKICAgIHJldHVybiBzdGRsaWIuRGF0ZVRpbWUoewogICAgICB3WWVhciA9IHllYXIsCiAgICAgIHdNb250aCA9IG1vbnRoLAogICAgICB3RGF5ID0gZGF5LAogICAgICB3SG91ciA9IGhvdXIsCiAgICAgIHdNaW51dGUgPSBtaW51dGUsCiAgICAgIHdTZWNvbmQgPSBzZWMKICAgIH0pCiAgZW5kCiAgc2VsZi5yZWFkX3N0cmluZyA9IGZ1bmN0aW9uKG9mZnNldCwgc2l6ZSkKICAgIGxvY2FsIGxlbmd0aCA9IDY0CiAgICBsb2NhbCBsYXN0X3JlYWQgPSAwCiAgICBsb2NhbCBtb3ZpbmdfZm9yd2FyZCA9IHRydWUKCiAgICBpZiBzaXplIHRoZW4KICAgICAgcmV0dXJuIHNlbGYucmVhZF9iaW4ob2Zmc2V0LCBzaXplKQogICAgZW5kCgogICAgd2hpbGUgbW92aW5nX2ZvcndhcmQgZG8KICAgICAgbG9jYWwgZGF0YSA9IHNlbGYucmVhZF9iaW4ob2Zmc2V0LCBsZW5ndGgpCiAgICAgIGxvY2FsIGUgPSBzdHJpbmcuZmluZChkYXRhLCAiXDAiLCAxKQogICAgICBpZiBlIHRoZW4KICAgICAgICByZXR1cm4gc3RyaW5nLnN1YihkYXRhLCAxLCBlIC0gMSkKICAgICAgZW5kCgogICAgICBpZiBzdHJpbmcubGVuKGRhdGEpIDw9IGxhc3RfcmVhZCB0aGVuCiAgICAgICAgbW92aW5nX2ZvcndhcmQgPSBmYWxzZQogICAgICBlbmQKICAgICAgbGFzdF9yZWFkID0gc3RyaW5nLmxlbihkYXRhKQogICAgICBsZW5ndGggPSBsZW5ndGggKiAyCiAgICBlbmQKICAgIHJldHVybiAiIgogIGVuZAogIC0tLQogIC0tIHJlYWRfd3N0cmluZygpCiAgLS0gUmVhZCBhIHdpZGUgKDE2Yml0KSBzdHJpbmcgZnJvbSB0aGUgZ2l2ZW4gcmVsYXRpdmUgb2Zmc2V0LAogIC0tIHdpdGggYW4gb3B0aW9uYWwgc2l6ZS4KICAtLSBOb3RlLCB0aGlzIGZ1bmN0aW9uIGN1cnJlbnRseSB0cmllcyB0byBuYWl2ZWx5IGNvbnZlcnQgdGhlIHN0cmluZwogIC0tIHRvIGFuIDhiaXQgc3RyaW5nLgogIC0tIEEgYmV0dGVyIG9wdGlvbiBpcyB0byBwcm9iYWJseSBjYWxsIGByZWFkX3V0ZjE2X2xlKClgIGluc3RlYWQKICBzZWxmLnJlYWRfd3N0cmluZyA9IGZ1bmN0aW9uKG9mZnNldCwgc2l6ZSkKICAgIGxvY2FsIGxlbmd0aCA9IDY0CiAgICBsb2NhbCBsYXN0X3JlYWQgPSAwCiAgICBsb2NhbCBtb3ZpbmdfZm9yd2FyZCA9IHRydWUKCiAgICBpZiBzaXplIHRoZW4KICAgICAgbG9jYWwgcyA9IHNlbGYucmVhZF9iaW4ob2Zmc2V0LCBzaXplKQogICAgICBsb2NhbCByZXQgPSBzdGRsaWIuU3RyaW5nQnVpbGRlcigpCiAgICAgIGZvciBpPTEsc3RyaW5nLmxlbihzKSBkbwogICAgICAgIGlmIG1hdGgubW9kKGksIDIpIH49IDAgdGhlbgogICAgICAgICAgcmV0LmFwcGVuZChzdHJpbmcuc3ViKHMsIGksIGkpKQogICAgICAgIGVuZAogICAgICBlbmQKICAgICAgcmV0dXJuIHJldC5zdHJpbmcoKQogICAgICAtLXJldHVybiBkZWJ1Zy5oZXhfZHVtcChzdHJpbmcuZ3N1YihzZWxmLnJlYWRfYmluKG9mZnNldCwgc2l6ZSksICJcMCIsICIiKSkKICAgIGVuZAoKICAgIHdoaWxlIG1vdmluZ19mb3J3YXJkIGRvCiAgICAgIGxvY2FsIGRhdGEgPSBzZWxmLnJlYWRfYmluKG9mZnNldCwgbGVuZ3RoKQogICAgICBsb2NhbCBlID0gc3RyaW5nLmZpbmQoZGF0YSwgIlwwXDAiLCAxKQogICAgICBpZiBlIHRoZW4KICAgICAgICBpZiBzdHJpbmcuYnl0ZShkYXRhLCBlIC0gMSkgPT0gIlwwIiB0aGVuCiAgICAgICAgICBlID0gZSArIDIKICAgICAgICBlbmQKICAgICAgICByZXR1cm4gYmluYXJ5cGFyc2VyLm5haXZlX3dzdHJpbmcyc3RyaW5nKHN0cmluZy5zdWIoZGF0YSwgMSwgZSAtIDEpKQogICAgICBlbmQKCiAgICAgIGlmIHN0cmluZy5sZW4oZGF0YSkgPD0gbGFzdF9yZWFkIHRoZW4KICAgICAgICBtb3ZpbmdfZm9yd2FyZCA9IGZhbHNlCiAgICAgIGVuZAogICAgICBsYXN0X3JlYWQgPSBzdHJpbmcubGVuKGRhdGEpCiAgICAgIGxlbmd0aCA9IGxlbmd0aCAqIDIKICAgIGVuZAogICAgcmV0dXJuICIiCiAgZW5kCgogIC0tLSBEZWNvZGVzIGEgVVRGLTE2IGNoYXJhY3Rlci4KICAtLSBUeXBpY2FsbHkgdXNlZCB3aXRoIHJlYWRfdXRmMTYoKQogIC0tIERvZXMgbm90IGNoZWNrIHRoYXQgdGhlIHJldHVybmVkIGNvZGUgcG9pbnQgaXMgYSByZWFsIGNoYXJhY3Rlci4KICAtLSBTcGVjaWZpY2FsbHksIGl0IGNhbiBiZSBmb29sZWQgYnkgb3V0LW9mLW9yZGVyIGxlYWQtIGFuZCB0cmFpbC1zdXJyb2dhdGUKICAtLSBjaGFyYWN0ZXJzLgogIC0tIEBwYXJhbSBvZmZzZXQgVGhlIGluZGV4IGluIHRoZSBzdHJpbmcgd2hlcmUgdGhlIGNoYXJhY3RlciBiZWdpbnMKICAtLSBAcGFyYW0gYmlnZW5kaWFuIFNldCB0byB0cnVlIGZvciBiaWdlbmRpYW4gdXRmMTYgc3RyaW5ncwogIC0tIEByZXR1cm4gb2Zmc2V0IFRoZSBpbmRleCBpbiB0aGUgc3RyaW5nIHdoZXJlIHRoZSBjaGFyYWN0ZXIgZW5kZWQKICAtLSBAcmV0dXJuIGNwIFRoZSBjb2RlIHBvaW50IG9mIHRoZSBjaGFyYWN0ZXIgYXMgYSBudW1iZXIKICBsb2NhbCB1dGYxNl9kZWMgPSBmdW5jdGlvbihvZmZzZXQsIGJpZ2VuZGlhbikKICAgIHJlYWRfd29yZCA9IHNlbGYucmVhZF93b3JkCiAgICBpZiBiaWdlbmRpYW4gdGhlbgogICAgICAgIHJlYWRfd29yZCA9IHNlbGYucmVhZF93b3JkX2JlCiAgICBlbmQKICAgIGxvY2FsIGNwID0gcmVhZF93b3JkKG9mZnNldCkKICAgIGlmIGNwID49IDB4RDgwMCBhbmQgY3AgPD0gMHhERkZGIHRoZW4KICAgICAgICBsb2NhbCBoaWdoID0gYmluYXJ5cGFyc2VyLmxzaGlmdChjcCAtIDB4RDgwMCwgMTApCiAgICAgICAgb2Zmc2V0ID0gb2Zmc2V0ICsgMgogICAgICAgIGNwID0gcmVhZF93b3JkKG9mZnNldCkKICAgICAgICBjcCA9IDB4MTAwMDAgKyBoaWdoICsgY3AgLSAweERDMDAKICAgIGVuZAogICAgb2Zmc2V0ID0gb2Zmc2V0ICsgMgogICAgcmV0dXJuIG9mZnNldCwgY3AKICBlbmQKCiAgLS0tIEVuY29kZSBhIFVuaWNvZGUgY29kZSBwb2ludCB0byBVVEYtOC4gU2VlIFJGQyAzNjI5LgogIC0tIFR5cGljYWxseSB1c2VkIHdpdGggcmVhZF91dGYxNigpCiAgLS0gRG9lcyBub3QgY2hlY2sgdGhhdCBjcCBpcyBhIHJlYWwgY2hhcmFjdGVyOyB0aGF0IGlzLCBkb2Vzbid0IGV4Y2x1ZGUgdGhlCiAgLS0gc3Vycm9nYXRlIHJhbmdlIFUrRDgwMCAtIFUrREZGRiBhbmQgYSBoYW5kZnVsIG9mIG90aGVycy4KICAtLSBAcGFyYW0gY3AgVGhlIFVuaWNvZGUgY29kZSBwb2ludCBhcyBhIG51bWJlcgogIC0tIEByZXR1cm4gQSBzdHJpbmcgY29udGFpbmluZyB0aGUgY29kZSBwb2ludCBpbiBVVEYtOCBlbmNvZGluZy4KICBsb2NhbCB1dGY4X2VuYyA9IGZ1bmN0aW9uKGNwKQogICAgbG9jYWwgYnl0ZXMgPSB7fQogICAgbG9jYWwgbiwgbWFzawoKICAgIGlmIGNwICUgMS4wIH49IDAuMCBvciBjcCA8IDAgdGhlbgogICAgICAgIC0tIE9ubHkgZGVmaW5lZCBmb3Igbm9ubmVnYXRpdmUgaW50ZWdlcnMuCiAgICAgICAgcmV0dXJuIG5pbAogICAgZWxzZWlmIGNwIDw9IDB4N0YgdGhlbgogICAgICAgIC0tIFNwZWNpYWwgY2FzZSBvZiBvbmUtYnl0ZSBlbmNvZGluZy4KICAgICAgICByZXR1cm4gc3RyaW5nLmNoYXIoY3ApCiAgICBlbHNlaWYgY3AgPD0gMHg3RkYgdGhlbgogICAgICAgIG4gPSAyCiAgICAgICAgbWFzayA9IDB4QzAKICAgIGVsc2VpZiBjcCA8PSAweEZGRkYgdGhlbgogICAgICAgIG4gPSAzCiAgICAgICAgbWFzayA9IDB4RTAKICAgIGVsc2VpZiBjcCA8PSAweDEwRkZGRiB0aGVuCiAgICAgICAgbiA9IDQKICAgICAgICBtYXNrID0gMHhGMAogICAgZWxzZQogICAgICAgIHJldHVybiBuaWwKICAgIGVuZAoKICAgIHdoaWxlIG4gPiAxIGRvCiAgICAgICAgYnl0ZXNbbl0gPSBzdHJpbmcuY2hhcigweDgwICsgYmluYXJ5cGFyc2VyLmJhbmQoY3AsIDB4M0YpKQogICAgICAgIGNwID0gYmluYXJ5cGFyc2VyLnJzaGlmdChjcCwgNikKICAgICAgICBuID0gbiAtIDEKICAgIGVuZAogICAgYnl0ZXNbMV0gPSBzdHJpbmcuY2hhcihtYXNrICsgY3ApCgogICAgcmV0dXJuIHRhYmxlLmNvbmNhdChieXRlcykKICBlbmQKCiAgLS0tIFRyYW5zY29kZSBVVEYtMTYgdG8gVVRGLTgKICAtLSBDb252ZXJ0IGEgVVRGLTE2IHN0cmluZyBsaWtlIGEgV2luZG93cy9TTUIgdW5pY29kZSBzdHJpbmcgdG8gVVRGLTgKICAtLSBAcGFyYW0gb2Zmc2V0IFRoZSBpbmRleCBvZiBhIHN0cmluZyBpbiBVVEYtMTYKICAtLSBAcGFyYW0gc2l6ZSAob3B0aW9uYWwpIG1heCBzaXplIG9mIHN0cmluZywgb3RoZXJ3aXNlIGZpcnN0IHRlcm1pbmF0b3Igb3IgbWF4IG9mIGJsb2NrCiAgLS0gQHBhcmFtIGJpZ2VuZGlhbiBTZXQgdG8gdHJ1ZSBmb3IgYmlnZW5kaWFuIHV0ZjE2IHN0cmluZ3MKICAtLSBAcmV0dXJuIFRoZSBzdHJpbmcgaW4gVVRGLTgKICBsb2NhbCByZWFkX3V0ZjE2ID0gZnVuY3Rpb24ob2Zmc2V0LCBzaXplLCBiaWdlbmRpYW4pCiAgICBsb2NhbCBvdXQgPSB7fQogICAgbG9jYWwgY3AKICAgIG9mZnNldCA9IHNlbGYub2Zmc2V0ICsgb2Zmc2V0CiAgICAtLSBUcnkgYW5kIGZpbmQgdGhlIGVuZCBvZiB0aGUgc3RyaW5nLCBidXQgaWYgbm8gdGVybWluYXRvciB0aGVuIHNldCB0byBtYXggb2YgYmxvY2sKICAgIGlmIHNpemUgPT0gbmlsIHRoZW4KICAgICAgLS1kZWJ1Zy5kZWJ1ZyhzdHJpbmcuZm9ybWF0KCJyZWFkX3V0ZjE2OiBuaWwgc2l6ZSByZXF1ZXN0IGF0IG9mZnNldCAlZCB3aXRoIHNpemUgJWQiLCBvZmZzZXQsICNoRmlsZSkpCiAgICAgIAogICAgICBsb2NhbCBsZW5ndGggPSA2NAogICAgICBsb2NhbCBsYXN0X3JlYWQgPSAwCiAgICAgIGxvY2FsIG1vdmluZ19mb3J3YXJkID0gdHJ1ZQoKICAgICAgLS0gaXRlcmF0ZSA2NCBieXRlcyBhdCBhIHRpbWUgc2VhcmNoaW5nIGZvciB1dGYxNiBzdHJpbmcKICAgICAgLS0gdGVybWluYXRvciAoIlwwXDAiKQogICAgICB3aGlsZSBtb3ZpbmdfZm9yd2FyZCBkbwogICAgICAgIGxvY2FsIGRhdGEgPSBzZWxmLnJlYWRfYmluKG9mZnNldCwgbGVuZ3RoKQoKICAgICAgICBsb2NhbCBlID0gc3RyaW5nLmZpbmQoZGF0YSwgIlwwXDAiLCAxKQogICAgICAgIGlmIGUgdGhlbgogICAgICAgICAgc2l6ZSA9IGUgLSAxIC0tIGRvIG5vdCBpbmNsdWRlIG51bGwgYnl0ZQogICAgICAgICAgYnJlYWsKICAgICAgICBlbmQKICAKICAgICAgICAtLWRlYnVnLmRlYnVnKHN0cmluZy5mb3JtYXQoIlx0XHQlZCA8PSAlZCIsIHN0cmluZy5sZW4oZGF0YSksIGxhc3RfcmVhZCkpCiAgICAgICAgaWYgc3RyaW5nLmxlbihkYXRhKSA8PSBsYXN0X3JlYWQgdGhlbgogICAgICAgICAgbW92aW5nX2ZvcndhcmQgPSBmYWxzZQogICAgICAgIGVuZAogICAgICAgIGxhc3RfcmVhZCA9IHN0cmluZy5sZW4oZGF0YSkKICAgICAgICBsZW5ndGggPSBsZW5ndGggKiAyCiAgICAgICAgc2l6ZSA9IGxhc3RfcmVhZAogICAgICBlbmQKICAgIGVuZAoKICAgIC0tZGVidWcuZGVidWcoInJlYWRfdXRmMTYgLS1vZmZzZXQ6ICIgLi4gb2Zmc2V0IC4uICIgIC0tc2l6ZTogIiAuLiBzaXplKQogICAgc2l6ZSA9IG9mZnNldCArIHNpemUKCiAgICB3aGlsZSBvZmZzZXQgPCBzaXplIGRvCiAgICAgIG9mZnNldCwgY3AgPSB1dGYxNl9kZWMob2Zmc2V0LCBiaWdlbmRpYW4pCiAgICAgIC0tZGVidWcuZGVidWcoIm9mZnNldDogIiAuLiBvZmZzZXQgLi4gIiAgIGNwOiAiIC4uIHN0cmluZy5mb3JtYXQoIjB4JXgiLCBjcCkpCiAgICAgIG91dFsjb3V0KzFdID0gdXRmOF9lbmMoY3ApCiAgICBlbmQKICAgIHJldHVybiB0YWJsZS5jb25jYXQob3V0KQogIGVuZAoKICBzZWxmLnJlYWRfdXRmMTZfYmUgPSBmdW5jdGlvbihvZmZzZXQsIHNpemUpCiAgICAgIHJldHVybiByZWFkX3V0ZjE2KG9mZnNldCwgc2l6ZSwgdHJ1ZSkKICBlbmQKCiAgc2VsZi5yZWFkX3V0ZjE2X2xlID0gZnVuY3Rpb24ob2Zmc2V0LCBzaXplKQogICAgICByZXR1cm4gcmVhZF91dGYxNihvZmZzZXQsIHNpemUsIGZhbHNlKQogIGVuZAoKICBzZWxmLnBhcnNlX2ZpbGV0aW1lID0gZnVuY3Rpb24odHNfaGlnaCwgdHNfbG93KQogICAgbG9jYWwgeTIwMDAgPSB7fQogICAgeTIwMDBbImhpZ2giXSA9IDB4MDFCRjUzRUIgLS0gMjAwMC0wMS0wMSAwMDowMDowMC4wMDAwMDAKICAgIHkyMDAwWyJsb3ciXSAgPSAweDI1NkQ0MDAwIC0tIDIwMDAtMDEtMDEgMDA6MDA6MDAuMDAwMDAwCgogICAgbG9jYWwgbW9udGhzID0ge30KICAgIG1vbnRoc1swXSA9IHt9IC0tIGR1bW15CiAgICBtb250aHNbMF1bInN0ZCJdID0gMAogICAgbW9udGhzWzBdWyJseSJdICA9IDAKCiAgICBtb250aHNbMV0gPSB7fQogICAgbW9udGhzWzFdWyJzdGQiXSA9IDI2Nzg0MDAwMDAwMDAwCiAgICBtb250aHNbMV1bImx5Il0gID0gMjY3ODQwMDAwMDAwMDAKCiAgICBtb250aHNbMl0gPSB7fQogICAgbW9udGhzWzJdWyJzdGQiXSA9IDUwOTc2MDAwMDAwMDAwCiAgICBtb250aHNbMl1bImx5Il0gID0gNTE4NDAwMDAwMDAwMDAKCiAgICBtb250aHNbM10gPSB7fQogICAgbW9udGhzWzNdWyJzdGQiXSA9IDc3NzYwMDAwMDAwMDAwCiAgICBtb250aHNbM11bImx5Il0gID0gNzg2MjQwMDAwMDAwMDAKCiAgICBtb250aHNbNF0gPSB7fQogICAgbW9udGhzWzRdWyJzdGQiXSA9IDEwMzY4MDAwMDAwMDAwMAogICAgbW9udGhzWzRdWyJseSJdICA9IDEwNDU0NDAwMDAwMDAwMAoKICAgIG1vbnRoc1s1XSA9IHt9CiAgICBtb250aHNbNV1bInN0ZCJdID0gMTMwNDY0MDAwMDAwMDAwCiAgICBtb250aHNbNV1bImx5Il0gID0gMTMxMzI4MDAwMDAwMDAwCgogICAgbW9udGhzWzZdID0ge30KICAgIG1vbnRoc1s2XVsic3RkIl0gPSAxNTYzODQwMDAwMDAwMDAKICAgIG1vbnRoc1s2XVsibHkiXSAgPSAxNTcyNDgwMDAwMDAwMDAKCiAgICBtb250aHNbN10gPSB7fQogICAgbW9udGhzWzddWyJzdGQiXSA9IDE4MzE2ODAwMDAwMDAwMAogICAgbW9udGhzWzddWyJseSJdICA9IDE4NDAzMjAwMDAwMDAwMAoKICAgIG1vbnRoc1s4XSA9IHt9CiAgICBtb250aHNbOF1bInN0ZCJdID0gMjA5OTUyMDAwMDAwMDAwCiAgICBtb250aHNbOF1bImx5Il0gID0gMjEwODE2MDAwMDAwMDAwCgogICAgbW9udGhzWzldID0ge30KICAgIG1vbnRoc1s5XVsic3RkIl0gPSAyMzU4NzIwMDAwMDAwMDAKICAgIG1vbnRoc1s5XVsibHkiXSAgPSAyMzY3MzYwMDAwMDAwMDAKCiAgICBtb250aHNbMTBdID0ge30KICAgIG1vbnRoc1sxMF1bInN0ZCJdID0gMjYyNjU2MDAwMDAwMDAwCiAgICBtb250aHNbMTBdWyJseSJdICA9IDI2MzUyMDAwMDAwMDAwMAoKICAgIG1vbnRoc1sxMV0gPSB7fQogICAgbW9udGhzWzExXVsic3RkIl0gPSAyODg1NzYwMDAwMDAwMDAKICAgIG1vbnRoc1sxMV1bImx5Il0gID0gMjg5NDQwMDAwMDAwMDAwCgogICAgbW9udGhzWzEyXSA9IHt9CiAgICBtb250aHNbMTJdWyJzdGQiXSA9IDMxNTM2MDAwMDAwMDAwMAogICAgbW9udGhzWzEyXVsibHkiXSAgPSAzMTYyMjQwMDAwMDAwMDAKCiAgICBpZiBiaW5hcnlwYXJzZXIucWxlc3NfdGhhbih0c19oaWdoLCB0c19sb3csIHkyMDAwWyJoaWdoIl0sIHkyMDAwWyJsb3ciXSkgdGhlbgogICAgICByZXR1cm4gbmlsLCAiVW5zdXBwb3J0ZWQgZmlsZXRpbWU6IFVuZGVyZmxvdyIKICAgIGVsc2UKICAgICAgLS0gMjAwMCBhbmQgYmV5b25kCiAgICAgIGxvY2FsIHR0eWVhcl9oaWdoID0geTIwMDBbImhpZ2giXQogICAgICBsb2NhbCB0dHllYXJfbG93ICA9IHkyMDAwWyJsb3ciXQogICAgICBsb2NhbCB0eWVhcl9oaWdoICA9IHkyMDAwWyJoaWdoIl0KICAgICAgbG9jYWwgdHllYXJfbG93ICAgPSB5MjAwMFsibG93Il0KICAgICAgbG9jYWwgeWVhcl9kaWZmICA9IDAKCiAgICAgIHdoaWxlIHRydWUgZG8KICAgICAgICBsb2NhbCBpLCBqLCBrLCBsLCBtCiAgICAgICAgbG9jYWwgaXNfbHkgPSBtYXRoLm1vZCh5ZWFyX2RpZmYsIDQpID09IDAKCiAgICAgICAgdHR5ZWFyX2hpZ2ggPSB0eWVhcl9oaWdoCiAgICAgICAgdHR5ZWFyX2xvdyAgPSB0eWVhcl9sb3cKCiAgICAgICAgaWYgaXNfbHkgdGhlbgogICAgICAgICAgdHllYXJfaGlnaCwgdHllYXJfbG93ID0gYmluYXJ5cGFyc2VyLnFhZGQodHllYXJfaGlnaCwgdHllYXJfbG93LCA3MzYyNiwgMjczNzg2NDcwNCkgLS0gMTFGOUEsIEEzMzA4MDAwCiAgICAgICAgZWxzZQogICAgICAgICAgdHllYXJfaGlnaCwgdHllYXJfbG93ID0gYmluYXJ5cGFyc2VyLnFhZGQodHllYXJfaGlnaCwgdHllYXJfbG93LCA3MzQyNSwgMjAyNjI5MTIwMCkgLS0gMTFFRDEsIDc4QzZDMDAwCiAgICAgICAgZW5kCgogICAgICAgIGlmIGJpbmFyeXBhcnNlci5xbGVzc190aGFuKHRzX2hpZ2gsIHRzX2xvdywgdHllYXJfaGlnaCwgdHllYXJfbG93KSB0aGVuCgogICAgICAgICAgLS0gaW4geWVhciAyMDAwICsgeWVhcl9kaWZmCiAgICAgICAgICBsb2NhbCB5dHNfaGlnaCwgeXRzX2xvdyA9IGJpbmFyeXBhcnNlci5xc3VidHJhY3QodHNfaGlnaCwgdHNfbG93LCB0dHllYXJfaGlnaCwgdHR5ZWFyX2xvdykKCiAgICAgICAgICBsb2NhbCB5dHMgPSB5dHNfaGlnaCAqIDQyOTQ5NjcyOTYgKyB5dHNfbG93IC0tIDB4MTAwMDAwMDAwCgogICAgICAgICAgZm9yIGk9MSwgMTIgZG8KICAgICAgICAgICAgbG9jYWwgbW9uX2xlbgogICAgICAgICAgICBsb2NhbCBwcmV2X21vbl9sZW4KCiAgICAgICAgICAgIGlmIGlzX2x5IHRoZW4KICAgICAgICAgICAgICBtb25fbGVuICAgICAgPSBtb250aHNbaV1bImx5Il0KICAgICAgICAgICAgICBwcmV2X21vbl9sZW4gPSBtb250aHNbaSAtIDFdWyJseSJdCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICBtb25fbGVuICAgICAgPSBtb250aHNbaV1bInN0ZCJdCiAgICAgICAgICAgICAgcHJldl9tb25fbGVuID0gbW9udGhzW2kgLSAxXVsic3RkIl0KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBpZiB5dHMgPCBtb25fbGVuIHRoZW4KICAgICAgICAgICAgICAtLSBpbiBtb250aCBpCiAgICAgICAgICAgICAgbG9jYWwgbXRzID0geXRzIC0gcHJldl9tb25fbGVuCiAgICAgICAgICAgICAgZm9yIGo9MSwzMSBkbwogICAgICAgICAgICAgICAgaWYgbXRzIDwgaiAqIDg2NDAwMDAwMDAwMCB0aGVuCiAgICAgICAgICAgICAgICAgIC0tIGluIGRheSBqCiAgICAgICAgICAgICAgICAgIGxvY2FsIGR0cyA9IG10cyAtIChqIC0gMSkgKiA4NjQwMDAwMDAwMDAKICAgICAgICAgICAgICAgICAgZm9yIGs9MSwyNCBkbwogICAgICAgICAgICAgICAgICAgIGlmIGR0cyA8IGsgKiAzNjAwMDAwMDAwMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAtLSBpbiBob3VyIGsKICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGh0cyA9IGR0cyAtIChrIC0gMSkgKiAzNjAwMDAwMDAwMAogICAgICAgICAgICAgICAgICAgICAgZm9yIGw9MSw2MCBkbwogICAgICAgICAgICAgICAgICAgICAgICBpZiBodHMgPCBsICogNjAwMDAwMDAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAtLSBpbiBtaW4gbAogICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIG1pdHMgPSBodHMgLSAobCAtIDEpICogNjAwMDAwMDAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIG09MSw2MCBkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbWl0cyA8IG0gKiAxMDAwMDAwMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0tIGluIHNlY29uZCBtCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHJldCAgICAgPSB7fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXRbIndZZWFyIl0gICA9IDIwMDAgKyB5ZWFyX2RpZmYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0WyJ3TW9udGgiXSAgPSBpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldFsid0RheSJdICAgID0gagogICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXRbIndIb3VyIl0gICA9IGsgLSAxCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldFsid01pbnV0ZSJdID0gbCAtIDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0WyJ3U2Vjb25kIl0gPSBtIC0gMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3RkbGliLkRhdGVUaW1lKHJldCksIG5pbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kIC0tIGZvciBzZWMKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICBlbmQgLS0gZm9yIG1pbgogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICBlbmQgLS0gZm9yIGhvdXIKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgIGVuZCAtLSBmb3IgZGF5CiAgICAgICAgICAgIGVuZAogICAgICAgICAgZW5kIC0tIGZvciBtb250aAogICAgICAgIGVuZAogICAgICAgIHllYXJfZGlmZiA9IHllYXJfZGlmZiArIDEKICAgICAgZW5kIC0tIHdoaWxlCiAgICBlbmQgLS0gZWxzZQogIGVuZCAtLSBmdW5jdGlvbgoKCiAgLS0gQHBhcmFtIG9mZnNldCBPZmZzZXQgdG8gUVdPUkQgRmlsZXRpbWUgdmFsdWUKICAtLSBAcmV0dXJuIHRpbWUsIGVycm9yCiAgc2VsZi5yZWFkX2ZpbGV0aW1lID0gZnVuY3Rpb24ob2Zmc2V0KQogICAgIC0tIGRlZiB0b193aW4oZCk6CiAgICAgLS0gICAgcmV0dXJuIGludCgoaW50KGNhbGVuZGFyLnRpbWVnbShkLnRpbWV0dXBsZSgpKSkgKyAxMTY0NDQ3MzYwMCkgKiAxZTcpCgogICAgIC0tIGRlZiBzKG4pOgogICAgIC0tICAgICByZXR1cm4gbiA+PiAzMiwgbiAmIDB4RkZGRkZGRkYKICAgICBsb2NhbCB0c19sb3csIHRzX2hpZ2gKICAgICB0c19sb3cgID0gc2VsZi5yZWFkX2R3b3JkKG9mZnNldCkKICAgICB0c19oaWdoID0gc2VsZi5yZWFkX2R3b3JkKG9mZnNldCArIDQpCiAgICAgcmV0dXJuIHNlbGYucGFyc2VfZmlsZXRpbWUodHNfaGlnaCwgdHNfbG93KSwgbmlsCiAgZW5kCgogIHNlbGYudGVzdF9wYXJzZV9maWxldGltZSA9IGZ1bmN0aW9uKCkKICAgICAtLVRPRE86IHRoaXMgd2FzIG5vdCB1cGRhdGVkIGFmdGVyIHBhcnNlX2ZpbGV0aW1lIHdhcyB1cGRhdGVkIHRvIHN1cHBvcnQgeWVhcnMgMjAwMCsKICAgICBwcmludCgiMjAwOC0wMS0wMSAwMDowMDowMCAgICAgIiAuLiBzZWxmLnBhcnNlX2ZpbGV0aW1lKDI5OTAzODgxLCAxMDgxNTI0MjI0KSkKICAgICBwcmludCgiMjAwOC0wMS0wMSAwMDowMDowMSAgICAgIiAuLiBzZWxmLnBhcnNlX2ZpbGV0aW1lKDI5OTAzODgxLCAxMDkxNTI0MjI0KSkKICAgICBwcmludCgiMjAwOC0wMS0wMSAwMDowMTowMSAgICAgIiAuLiBzZWxmLnBhcnNlX2ZpbGV0aW1lKDI5OTAzODgxLCAxNjkxNTI0MjI0KSkKICAgICBwcmludCgiMjAwOC0wMS0wMSAwMTowMTowMSAgICAgIiAuLiBzZWxmLnBhcnNlX2ZpbGV0aW1lKDI5OTAzODg5LCAzMzMxNzg1ODU2KSkKCiAgICAgcHJpbnQoIjIwMDgtMDEtMDIgMDE6MDE6MDEgICAgICIgLi4gc2VsZi5wYXJzZV9maWxldGltZSgyOTkwNDA5MCwgNDA0MzM1OTM2MCkpCiAgICAgcHJpbnQoIjIwMDgtMDItMDIgMDE6MDE6MDEgICAgICIgLi4gc2VsZi5wYXJzZV9maWxldGltZSgyOTkxMDMyNywgMzMyMzM0MjA4KSkKICAgICBwcmludCgiMjAwOS0wMi0wMiAwMTowMTowMSAgICAgIiAuLiBzZWxmLnBhcnNlX2ZpbGV0aW1lKDI5OTgzOTUzLCAzMDcwMTk4OTEyKSkKCiAgICAgcHJpbnQoIjIwMTItMDItMDIgMDE6MDE6MDEgICAgICIgLi4gc2VsZi5wYXJzZV9maWxldGltZSgzMDIwNDIzMCwgNTU5MTM3OTIwKSkKICAgICBwcmludCgiMjAxMi0wMi0xNSAwMTowMTowMSAgICAgIiAuLiBzZWxmLnBhcnNlX2ZpbGV0aW1lKDMwMjA2ODQ1LCAxMjE5NjU4ODgwKSkKICAgICBwcmludCgiMjAxMi0wMi0xNSAxNTowMTowMSAgICAgIiAuLiBzZWxmLnBhcnNlX2ZpbGV0aW1lKDMwMjA2OTYyLCAyNzA4NDg1MjQ4KSkKCiAgICAgcHJpbnQoIjIwMTMtMDItMDIgMDE6MDE6MDEgICAgICIgLi4gc2VsZi5wYXJzZV9maWxldGltZSgzMDI3Nzg1NiwgMzI5NzAwMjYyNCkpCiAgICAgcHJpbnQoIjIwMTMtMDItMTUgMDE6MDE6MDEgICAgICIgLi4gc2VsZi5wYXJzZV9maWxldGltZSgzMDI4MDQ3MSwgMzk1NzUyMzU4NCkpCiAgICAgcHJpbnQoIjIwMTMtMDItMTUgMTU6MDE6MDEgICAgICIgLi4gc2VsZi5wYXJzZV9maWxldGltZSgzMDI4MDU4OSwgMTE1MTM4MjY1NikpCiAgZW5kCgoKICAtLS0KICAtLSBwYXJzZV91bml4dGltZSBQYXJzZSBhIFVuaXggc3R5bGUgdGltZXN0YW1wIHByb3ZpZGVkIGFzIGEgc2luZ2xlIERXT1JELgogIC0tIEBwYXJhbSBkd29yZCBBIERXT1JELgogIC0tIEByZXR1cm4gQSB0YWJsZSB3aXRoIHRoZSBmb2xsb3dpbmcgZmllbGRzOgogIC0tICAgIndZZWFyIiA6IG51bWJlcgogIC0tICAgIndNb250aCIgOiBudW1iZXIKICAtLSAgICJ3RGF5IiA6IG51bWJlcgogIC0tICAgIndIb3VyIiA6IG51bWJlcgogIC0tICAgIndNaW51dGUiIDogbnVtYmVyCiAgLS0gICAid1NlY29uZCIgOiBudW1iZXIKICBzZWxmLnBhcnNlX3VuaXh0aW1lID0gZnVuY3Rpb24oZHdvcmQpCiAgICAgLS0gZGVmIHRvX3dpbihkKToKICAgICAtLSAgICByZXR1cm4gaW50KChpbnQoY2FsZW5kYXIudGltZWdtKGQudGltZXR1cGxlKCkpKSArIDExNjQ0NDczNjAwKSAqIDFlNykKICAgICBsb2NhbCB0c19sb3csIHRzX2hpZ2gKICAgICB0c19sb3cgID0gZHdvcmQKICAgICB0c19oaWdoID0gMAoKICAgICB0c19oaWdoLCB0c19sb3cgPSBiaW5hcnlwYXJzZXIucWFkZCh0c19oaWdoLCB0c19sb3csIDAsIDExNjQ0NDczNjAwKQogICAgIHRzX2hpZ2gsIHRzX2xvdyA9IGJpbmFyeXBhcnNlci5xbXVsdGlwbHkodHNfaGlnaCwgdHNfbG93LCAwLCAxMDAwMDAwMCkKCiAgICAgcmV0dXJuIHNlbGYucGFyc2VfZmlsZXRpbWUodHNfaGlnaCwgdHNfbG93KQogIGVuZAoKICAtLSBAcGFyYW0gb2Zmc2V0IE9mZnNldCB0byBEV09SRCBVTklYIHRpbWVzdGFtcAogIC0tIEByZXR1cm4gdGltZSwgZXJyb3IKICBzZWxmLnJlYWRfdW5peHRpbWUgPSBmdW5jdGlvbihvZmZzZXQpCiAgICAgbG9jYWwgZHdvcmQgPSBzZWxmLnJlYWRfZHdvcmQob2Zmc2V0KQogICAgIHJldHVybiBzZWxmLnBhcnNlX3VuaXh0aW1lKGR3b3JkKSwgbmlsCiAgZW5kCgogIHNlbGYudGVzdF9wYXJzZV91bml4dGltZSA9IGZ1bmN0aW9uKCkKICAgICBwcmludCgiMjAwOC0wMS0wMSAwMDowMDowMCAgICAgIiAuLgogICAgIHN0ZGxpYi5Db252ZXJ0U3lzdGVtVGltZShzZWxmLnBhcnNlX3VuaXh0aW1lKDExOTkxNDU2MDApIG9yICJGQUlMIikpIC0tIHVuaXg6IDExOTkxNDU2MDAKICAgICBwcmludCgiMjAwOC0wMS0wMSAwMDowMDowMCAgICAgIiAuLgogICAgIHN0ZGxpYi5Db252ZXJ0U3lzdGVtVGltZShzZWxmLnBhcnNlX3VuaXh0aW1lKDExOTkxNDU2MDApKSkgLS0gdW5peDogMTE5OTE0NTYwMAogICAgIHByaW50KCIyMDA4LTAxLTAxIDAwOjAwOjAxICAgICAiIC4uCiAgICAgc3RkbGliLkNvbnZlcnRTeXN0ZW1UaW1lKHNlbGYucGFyc2VfdW5peHRpbWUoMTE5OTE0NTYwMSkpKSAtLSB1bml4OiAxMTk5MTQ1NjAxCiAgICAgcHJpbnQoIjIwMDgtMDEtMDEgMDA6MDE6MDEgICAgICIgLi4KICAgICBzdGRsaWIuQ29udmVydFN5c3RlbVRpbWUoc2VsZi5wYXJzZV91bml4dGltZSgxMTk5MTQ1NjYxKSkpIC0tIHVuaXg6IDExOTkxNDU2NjEKICAgICBwcmludCgiMjAwOC0wMS0wMSAwMTowMTowMSAgICAgIiAuLgogICAgIHN0ZGxpYi5Db252ZXJ0U3lzdGVtVGltZShzZWxmLnBhcnNlX3VuaXh0aW1lKDExOTkxNDkyNjEpKSkgLS0gdW5peDogMTE5OTE0OTI2MQoKICAgICBwcmludCgiMjAwOC0wMS0wMiAwMTowMTowMSAgICAgIiAuLgogICAgIHN0ZGxpYi5Db252ZXJ0U3lzdGVtVGltZShzZWxmLnBhcnNlX3VuaXh0aW1lKDExOTkyMzU2NjEpKSkgLS0gdW5peDogMTE5OTIzNTY2MQogICAgIHByaW50KCIyMDA4LTAyLTAyIDAxOjAxOjAxICAgICAiIC4uCiAgICAgc3RkbGliLkNvbnZlcnRTeXN0ZW1UaW1lKHNlbGYucGFyc2VfdW5peHRpbWUoMTIwMTkxNDA2MSkpKSAtLSB1bml4OiAxMjAxOTE0MDYxCiAgICAgcHJpbnQoIjIwMDktMDItMDIgMDE6MDE6MDEgICAgICIgLi4KICAgICBzdGRsaWIuQ29udmVydFN5c3RlbVRpbWUoc2VsZi5wYXJzZV91bml4dGltZSgxMjMzNTM2NDYxKSkpIC0tIHVuaXg6IDEyMzM1MzY0NjEKCiAgICAgcHJpbnQoIjIwMTItMDItMDIgMDE6MDE6MDEgICAgICIgLi4KICAgICBzdGRsaWIuQ29udmVydFN5c3RlbVRpbWUoc2VsZi5wYXJzZV91bml4dGltZSgxMzI4MTQ0NDYxKSkpICAtLSB1bml4OiAxMzI4MTQ0NDYxCiAgICAgcHJpbnQoIjIwMTItMDItMTUgMDE6MDE6MDEgICAgICIgLi4KICAgICBzdGRsaWIuQ29udmVydFN5c3RlbVRpbWUoc2VsZi5wYXJzZV91bml4dGltZSgxMzI5MjY3NjYxKSkpIC0tIHVuaXg6IDEzMjkyNjc2NjEKICAgICBwcmludCgiMjAxMi0wMi0xNSAxNTowMTowMSAgICAgIiAuLgogICAgIHN0ZGxpYi5Db252ZXJ0U3lzdGVtVGltZShzZWxmLnBhcnNlX3VuaXh0aW1lKDEzMjkzMTgwNjEpKSkgLS0gdW5peDogMTMyOTMxODA2MQoKICAgICBwcmludCgiMjAxMy0wMi0wMiAwMTowMTowMSAgICAgIiAuLgogICAgIHN0ZGxpYi5Db252ZXJ0U3lzdGVtVGltZShzZWxmLnBhcnNlX3VuaXh0aW1lKDEzNTk3NjY4NjEpKSkgLS0gdW5peDogMTM1OTc2Njg2MQogICAgIHByaW50KCIyMDEzLTAyLTE1IDAxOjAxOjAxICAgICAiIC4uCiAgICAgc3RkbGliLkNvbnZlcnRTeXN0ZW1UaW1lKHNlbGYucGFyc2VfdW5peHRpbWUoMTM2MDg5MDA2MSkpKSAtLSB1bml4OiAxMzYwODkwMDYxCiAgICAgcHJpbnQoIjIwMTMtMDItMTUgMTU6MDE6MDEgICAgICIgLi4KICAgICBzdGRsaWIuQ29udmVydFN5c3RlbVRpbWUoc2VsZi5wYXJzZV91bml4dGltZSgxMzYwOTQwNDYxKSkpIC0tIHVuaXg6IDEzNjA5NDA0NjEKICAgIGVuZAoKICAgIHNlbGYucmVhZF9zeXN0ZW10aW1lID0gZnVuY3Rpb24ob2Zmc2V0KQogICAgICAgIHJldHVybiBzdGRsaWIuRGF0ZVRpbWUoewogICAgICAgICAgICB3WWVhciA9IHNlbGYucmVhZF93b3JkKG9mZnNldCksCiAgICAgICAgICAgIHdNb250aCA9IHNlbGYucmVhZF93b3JkKG9mZnNldCArIDIpLAogICAgICAgICAgICB3RGF5T2ZXZWVrID0gc2VsZi5yZWFkX3dvcmQob2Zmc2V0ICsgNCksCiAgICAgICAgICAgIHdEYXkgPSBzZWxmLnJlYWRfd29yZChvZmZzZXQgKyA2KSwKICAgICAgICAgICAgd0hvdXIgPSBzZWxmLnJlYWRfd29yZChvZmZzZXQgKyA4KSwKICAgICAgICAgICAgd01pbnV0ZSA9IHNlbGYucmVhZF93b3JkKG9mZnNldCArIDEwKSwKICAgICAgICAgICAgd1NlY29uZCA9IHNlbGYucmVhZF93b3JkKG9mZnNldCArIDEyKSwKICAgICAgICAgICAgd01pbGxpc2Vjb25kID0gc2VsZi5yZWFkX3dvcmQob2Zmc2V0ICsgMTQpCiAgICAgICAgfSkKICAgIGVuZAoKICAtLS0KICAtLSBkZWNsYXJlX2ZpZWxkCiAgLS0gRHluYW1pY2FsbHkgYWRkIGFjY2Vzc29ycyBmb3IgYSBmaWVsZCB0byB0aGUgYmxvY2suCiAgLS0gRm9yIGV4YW1wbGUsCiAgLS0gICAgc2VsZi5kZWNsYXJlX2ZpZWxkKCJieXRlIiwgIm15ZmllbGQiLCAweDEwKQogIC0tIHdvdWxkIGFkZCB0aGUgZmllbGQ6CiAgLS0gICAgc2VsZi5fb2ZmX215ZmllbGQgICAgLS0gZXF1YWwgdG8gMHgxMAogIC0tIGFuZCB0aGUgbWV0aG9kOgogIC0tICAgIHNlbGYubXlmaWVsZCgpICAgICAgIC0tIHJldHVybnMgdGhlIHJlc3VsdCBvZiBzZWxmLnJlYWRfYnl0ZSgweDEwKQogIC0tIEBwYXJhbSB0eXBlIFRoZSB0eXBlIG9mIHByaW1pdGl2ZSBkYXRhIHRvIHVucGFjay4KICAtLSBAcGFyYW0gbmFtZSBUaGUgbmFtZSBvZiB0aGUgZmllbGQuIFRoaXMgd2lsbCBiZSB1c2VkIHRvIGNyZWF0ZQogIC0tICAgIGFjY2Vzc29ycyBzZWxmLiRuYW1lIGFuZCBzZWxmLl9vZmZfJG5hbWUKICAtLSBAcGFyYW0gb2Zmc2V0IFRoZSBvZmZzZXQgYXQgd2hpY2ggdG8gZmluZCB0aGUgZmllbGQsIDAtaW5kZXhlZC4KICAtLSBAcGFyYW0gbGVuZ3RoIE9wdGlvbmFsLiBXaWxsIGJlIHBhc3NlZCB0byB0aGUgdW5wYWNrZXIgZnVuY3Rpb24uCiAgLS0gQHJldHVybiBzdWNjZXNzLCBlcnJvcgogIHNlbGYuZGVjbGFyZV9maWVsZCA9IGZ1bmN0aW9uKHR5cGUsIG5hbWUsIG9mZnNldCwgbGVuZ3RoKQogICAgaWYgbm90IHR5cGUgdGhlbiByZXR1cm4gbmlsIGVuZAogICAgaWYgbm90IG5hbWUgdGhlbiByZXR1cm4gbmlsIGVuZAogICAgaWYgbm90IG9mZnNldCB0aGVuIHJldHVybiBuaWwgZW5kCgogICAgc2VsZi5fZmllbGRzID0gc3RkbGliLkxpc3QoKQoKICAgIGxvY2FsIHVucGFja2VyID0gc2VsZlsicmVhZF8iIC4uIHR5cGVdCiAgICBpZiBub3QgdW5wYWNrZXIgdGhlbiByZXR1cm4gbmlsLCAiRXJyb3IgZmluZGluZyB1bnBhY2tlcjogcmVhZF8iIC4uIHR5cGUgZW5kCgogICAgbG9jYWwgZnVuY3Rpb24gaGFuZGxlcigpCiAgICAgIGlmIGxlbmd0aCB0aGVuCiAgICAgICAgcmV0dXJuIHVucGFja2VyKG9mZnNldCwgbGVuZ3RoKQogICAgICBlbHNlCiAgICAgICAgcmV0dXJuIHVucGFja2VyKG9mZnNldCkKICAgICAgZW5kCiAgICBlbmQKCiAgICBzZWxmW25hbWVdID0gaGFuZGxlcgogICAgc2VsZlsiX29mZl8iIC4uIG5hbWVdID0gb2Zmc2V0CgogICAgcmV0dXJuIHRydWUKICBlbmQKCiAgcmV0dXJuIHNlbGYKZW5kCgotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi0tCi0tIE1JUiBBZ2VudCBMdWEgLSBVdGlscyBtb2R1bGUKLS0KLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi0tIAotLSBNSVIgQWdlbnQgTHVhIC0gRGVidWcgbW9kdWxlCi0tCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KZGVidWcgPSB7fQoKLS0KLS0gRW5hYmxlIGRlYnVnZ2luZyBtZXNzYWdlcy4KLS0gTm90ZSwgdGhpcyBvZnRlbiBicmVha3Mgc2NoZW1hcy4KLS0gCmRlYnVnLmVuYWJsZV9kZWJ1Z2dpbmcgPSBmYWxzZQpkZWJ1Zy5lbmFibGVfc3Rkb3V0ID0gZmFsc2UKCi0tLQotLSBkZWJ1ZygpCi0tIFJlY29yZCBhIGRlYnVnZ2luZyBtZXNzZ2UuCi0tIEBzaWRlZWZmZWN0IFdyaXRlcyB0byByZGIgZG9jdW1lbnQKLS0gQHJldHVybiB2b2lkCmZ1bmN0aW9uIGRlYnVnLmRlYnVnKG1zZywgbTIsIG0zLCBtNCwgbTUsIG02LCBtNywgbTgpCgogIGlmIG5vdCBkZWJ1Zy5lbmFibGVfZGVidWdnaW5nIGFuZCBub3QgZGVidWcuZW5hYmxlX3N0ZG91dCB0aGVuCiAgICByZXR1cm4KICBlbmQKCglsb2NhbCBvdXQgPSBtc2cKCWlmIG0yIHRoZW4gb3V0ID0gb3V0Li4iICAgICIuLm0yIGVuZAoJaWYgbTMgdGhlbiBvdXQgPSBvdXQuLiIgICAgIi4ubTMgZW5kCglpZiBtNCB0aGVuIG91dCA9IG91dC4uIiAgICAiLi5tNCBlbmQKCWlmIG01IHRoZW4gb3V0ID0gb3V0Li4iICAgICIuLm01IGVuZAoJaWYgbTYgdGhlbiBvdXQgPSBvdXQuLiIgICAgIi4ubTYgZW5kCglpZiBtNyB0aGVuIG91dCA9IG91dC4uIiAgICAiLi5tNyBlbmQKCWlmIG04IHRoZW4gb3V0ID0gb3V0Li4iICAgICIuLm04IGVuZAoKCWlmIGRlYnVnLmVuYWJsZV9kZWJ1Z2dpbmcgdGhlbgoJCXJkYi5SZGJTdGFydEl0ZW0oIkRlYnVnIikKCQlyZGIuUmRiQWRkRmllbGQoIk1lc3NhZ2UiLCAiXG4iIC4uIHRvc3RyaW5nKG91dCkpCgkJcmRiLlJkYkVuZEl0ZW0oIkRlYnVnIikKCWVuZAoJaWYgZGVidWcuZW5hYmxlX3N0ZG91dCB0aGVuCgkgIHByaW50KHRvc3RyaW5nKG91dCkpCgllbmQKZW5kCgotLS0KLS0gZGVzY3JpYmUoKQotLSBHaXZlbiBhIHRoaW5nLCBhbmQgaXRzIG5hbWUsIGRlc2NyaWJlIGl0cwotLSAgIHR5cGUgYW5kIG5lc3RlZCBzdHJ1Y3R1cmUuCi0tIEBzaWRlZWZmZWN0IFdyaXRlcyB0byByZGIgZG9jdW1lbnQKLS0gQHJldHVybiB2b2lkCmZ1bmN0aW9uIGRlYnVnLmRlc2NyaWJlKHRoaW5nLCBuYW1lKQoJbG9jYWwgc3RhcnRlZF9oZXJlID0gZmFsc2UKCWlmIG5vdCBkZWJ1Zy5faXNfZGVzY3JpYmluZyB0aGVuIAoJCWRlYnVnLl9pc19kZXNjcmliaW5nID0gdHJ1ZSAKCQlzdGFydGVkX2hlcmUgPSB0cnVlCiAgICAgICAgZGVidWcuc2VlbiA9IHt9CgkJcmRiLlJkYlN0YXJ0SXRlbSgiRGVidWciKQoJCWlmIG5vdCBuYW1lIHRoZW4gbmFtZSA9ICJzb21ldGhpbmciIGVuZAoJCXJkYi5SZGJBZGRGaWVsZCgiRGVzY3JpYmluZyIsIG5hbWUpCgkJcmRiLlJkYkFkZEZpZWxkKCJUeXBlIiwgdHlwZSh0aGluZykpCiAgICBlbmQKCiAgICBpZiBkZWJ1Zy5zZWVuW3RoaW5nXSB0aGVuIHJldHVybiBlbmQKICAgIGRlYnVnLnNlZW5bdGhpbmddID0gdHJ1ZQoKCWlmIHRoaW5nID09IG5pbCB0aGVuCgkgICByZGIuUmRiQWRkRmllbGQoIlZhbHVlIiwgIm5pbCIpCgllbHNlaWYgdHlwZSh0aGluZykgPT0gInRhYmxlIiB0aGVuCiAgICAgICAgaWYgZ2V0bWV0YXRhYmxlKHRoaW5nKSBhbmQgZ2V0bWV0YXRhYmxlKHRoaW5nKS5fX3R5cGUgPT0gIkRhdGVUaW1lIiB0aGVuCiAgICAgICAgICAgIHJkYi5SZGJBZGRGaWVsZCgiRGF0ZVRpbWUiLCBuYW1lIC4uICI6ICIgLi4gdGhpbmcuaXNvZm9ybWF0KCkgKQogICAgICAgIGVsc2UKICAgICAgICAgICAgZm9yIGssIHYgaW4gcGFpcnModGhpbmcpIGRvCiAgICAgICAgICAgICAgICBkZWJ1Zy5kZXNjcmliZSh2LCBuYW1lIC4uICIuIiAuLiBrKQogICAgICAgICAgICBlbmQKICAgICAgIGVuZAoJZWxzZWlmIHR5cGUodGhpbmcpID09ICJmdW5jdGlvbiIgdGhlbgoJICAgcmRiLlJkYkFkZEZpZWxkKCJGdW5jdGlvbiIsIG5hbWUgLi4gIigpIikKCWVsc2VpZiB0eXBlKHRoaW5nKSA9PSAidXNlcmRhdGEiIHRoZW4KCSAgIHJkYi5SZGJBZGRGaWVsZCgiVXNlcmRhdGEiLCBuYW1lICkKCWVsc2UKCSAgIHJkYi5SZGJBZGRGaWVsZCgiVmFsdWUiLCBuYW1lIC4uICIgOiAiIC4uIHRvc3RyaW5nKHRoaW5nKSkKCWVuZAoKCWlmIHN0YXJ0ZWRfaGVyZSB0aGVuCgkgICBkZWJ1Zy5faXNfZGVzY3JpYmluZyA9IGZhbHNlCgkgICByZGIuUmRiRW5kSXRlbSgiRGVidWciKQoJZW5kCmVuZAoKZGVidWcubG9nID0ge30KZGVidWcubG9nLl9zYiA9IHN0ZGxpYi5TdHJpbmdCdWlsZGVyKCkKZGVidWcubG9nLndyaXRlID0gZnVuY3Rpb24ocykKICAgZGVidWcubG9nLl9zYi5hcHBlbmQocyAuLiAiXG4iKQplbmQKZGVidWcubG9nLl9kZXNjcmliZV9pbmRlbnQgPSAiIgpkZWJ1Zy5sb2cuaW5kZW50ID0gZnVuY3Rpb24oKSAKICAgZGVidWcubG9nLl9kZXNjcmliZV9pbmRlbnQgPSBkZWJ1Zy5sb2cuX2Rlc2NyaWJlX2luZGVudCAuLiAiICAgICIKZW5kCmRlYnVnLmxvZy5kZWRlbnQgPSBmdW5jdGlvbigpCiAgIGRlYnVnLmxvZy5fZGVzY3JpYmVfaW5kZW50ID0gc3RyaW5nLnN1YihkZWJ1Zy5sb2cuX2Rlc2NyaWJlX2luZGVudCwgNSkKZW5kCmRlYnVnLmxvZy5hZGRfaW5kZW50ID0gZnVuY3Rpb24oKQogICBkZWJ1Zy5sb2cuX3NiLmFwcGVuZChkZWJ1Zy5sb2cuX2Rlc2NyaWJlX2luZGVudCkKZW5kCmRlYnVnLmxvZy5kZXNjcmliZSA9IGZ1bmN0aW9uKHRoaW5nLCBuYW1lKQogICBpZiBub3QgbmFtZSB0aGVuIG5hbWUgPSAic29tZXRoaW5nIiBlbmQKICAgCiAgIGRlYnVnLmxvZy5hZGRfaW5kZW50KCkKICAgZGVidWcubG9nLndyaXRlKCIoIiAuLiB0eXBlKHRoaW5nKSAuLiAiKSAiIC4uIG5hbWUgLi4gIiAiKQoKICAgaWYgdGhpbmcgPT0gbmlsIHRoZW4KICAgICAgZGVidWcubG9nLmFkZF9pbmRlbnQoKQogICAgICBkZWJ1Zy5sb2cud3JpdGUoIlZhbHVlOiAgbmlsIikKICAgZWxzZWlmIHR5cGUodGhpbmcpID09ICJ0YWJsZSIgdGhlbgogICAgICBmb3IgaywgdiBpbiBwYWlycyh0aGluZykgZG8KICAgICAgICAgZGVidWcubG9nLmluZGVudCgpCiAgICAgICAgIGRlYnVnLmxvZy5kZXNjcmliZSh2LCBuYW1lIC4uICIuIiAuLiBrKQogICAgICAgICBkZWJ1Zy5sb2cuZGVkZW50KCkKICAgICAgZW5kCiAgIGVsc2VpZiB0eXBlKHRoaW5nKSA9PSAiZnVuY3Rpb24iIHRoZW4KICAgICAgLS0gZG8gbm90aGluZwogICBlbHNlaWYgdHlwZSh0aGluZykgPT0gInVzZXJkYXRhIiB0aGVuCiAgICAgIC0tIGRvIG5vdGhpbmcKICAgZWxzZQogICAgICBkZWJ1Zy5sb2cuYWRkX2luZGVudCgpCiAgICAgIGRlYnVnLmxvZy53cml0ZSgiVmFsdWU6ICIgLi4gdG9zdHJpbmcodGhpbmcpKQogICBlbmQKZW5kCmRlYnVnLmxvZy5nZXRWYWx1ZSA9IGRlYnVnLmxvZy5fc2Iuc3RyaW5nKCkKZGVidWcubG9nLmZsdXNoID0gZnVuY3Rpb24oKSAKICAgcmRiLlJkYlN0YXJ0SXRlbSgiZGVidWdfbG9nIikKICAgcmRiLlJkYkFkZEZpZWxkKCJMb2ciLCAiXG4iIC4uIGRlYnVnLmxvZy5fc2Iuc3RyaW5nKCkpCiAgIHJkYi5SZGJFbmRJdGVtKCJkZWJ1Z19sb2ciKQogICBkZWJ1Zy5sb2cuX3NiID0gc3RkbGliLlN0cmluZ0J1aWxkZXIoKQplbmQKCi0tLQotLSBoZXhfZHVtcAotLSBUYWtlIGEgYnl0ZXN0cmluZyBhbmQgcmV0dXJuIGEgMTYgYnl0ZSB3aWRlIGhleCB2aWV3IHN0cmluZy4KLS0gVGhlIHJlc3VsdGluZyBzdHJpbmcgd2lsbCBsb29rIHNvbWV0aGluZyBsaWtlIHRoaXM6Ci0tIDAwMDAwMUEwICAwRCAwQSA0RSA1NCA0QyA0NCA1MiAyMCAgNjkgNzMgMjAgNkQgNjkgNzMgNzMgNjkgIC4uTlRMRFIgaXMgbWlzc2kmIzEzOwotLSAwMDAwMDFCMCAgNkUgNjcgMDAgMEQgMEEgNEUgNTQgNEMgIDQ0IDUyIDIwIDY5IDczIDIwIDYzIDZGICBuZy4uLk5UTERSIGlzIGNvJiMxMzsKLS0gMDAwMDAxQzAgIDZEIDcwIDcyIDY1IDczIDczIDY1IDY0ICAwMCAwRCAwQSA1MCA3MiA2NSA3MyA3MyAgbXByZXNzZWQuLi5QcmVzcyYjMTM7Ci0tCi0tIEBwYXJhbSBidWYgQW4gaW5wdXQgYnl0ZXN0cmluZy4KLS0gQHBhcmFtIG9mZnNldCAoT3B0aW9uYWwpIEEgbnVtYmVyIGF0IHdoaWNoIHRoZSBsZWZ0IGNvbHVtbiAoYWRkcmVzcykgd2lsbCBiZWdpbi4KLS0gQHNlZSBodHRwOi8vbHVhLXVzZXJzLm9yZy93aWtpL0hleER1bXAKLS0gQHJldHVybiBBIHN0cmluZy4gVGhlIGVtcHR5IHN0cmluZyBpZiBidWYgaXMgbm90IGEgc3RyaW5nLgpmdW5jdGlvbiBkZWJ1Zy5oZXhfZHVtcChidWYsIG9mZnNldCkKCWxvY2FsIHNiID0gc3RkbGliLlN0cmluZ0J1aWxkZXIoKQoJCglpZiB0eXBlKGJ1Zikgfj0gInN0cmluZyIgdGhlbiAKCQlyZXR1cm4gIiIKCWVuZAoJCglpZiBvZmZzZXQgPT0gbmlsIHRoZW4KCQlvZmZzZXQgPSAwMAoJZW5kCgkKCWZvciBpPTEsbWF0aC5jZWlsKCNidWYvMTYpICogMTYgZG8KCQkgaWYgKGktMSkgJSAxNiA9PSAwIHRoZW4gc2IuYXBwZW5kKHN0cmluZy5mb3JtYXQoJyUwOFggICcsIG9mZnNldCArIGktMSkpIGVuZAoJCSBzYi5hcHBlbmQoIGkgPiAjYnVmIGFuZCAnICAgJyBvciBzdHJpbmcuZm9ybWF0KCclMDJYICcsIGJ1ZjpieXRlKGkpKSApCgkJIGlmIGkgJSAgOCA9PSAwIHRoZW4gc2IuYXBwZW5kKCcgJykgZW5kCgkJIGlmIGkgJSAxNiA9PSAwIHRoZW4gCgkJCXNiLmFwcGVuZCggYnVmOnN1YihpLTE2KzEsIGkpOmdzdWIoJyVjJywnLicpKQoJCQlzYi5hcHBlbmQoJ1xuJykKCQllbmQKCWVuZAoJcmV0dXJuIHNiLnN0cmluZygpCmVuZAoKCnV0aWxzID0ge30KCi0tIHNpemUgZGVmaW5pdGlvbnMKdXRpbHMuQllURSAgPSAxCnV0aWxzLldPUkQgID0gMgp1dGlscy5EV09SRCA9IDQKdXRpbHMuUVdPUkQgPSA4CgotLSByZWFkcyBsaXR0bGUtZW5kaWFuIG51bWJlciBmcm9tIHRoZSBidWZmZXIgYnVmZiBhbmQgc2l6ZSBpbiBieXRlcygxIGZvciBCWVRFLCAyIGZvciBXT1JELCA0IGZvciBEV09SRCwgOCBmb3IgUVdPUkQpCmZ1bmN0aW9uIHV0aWxzLnJlYWRfbnVtYmVyKGJ1ZmYsIG9mZnNldCwgc2l6ZSwgYmlnZW5kaWFuKQogICAgYmlnZW5kaWFudCA9IGJpZ2VuZGlhbiBvciBmYWxzZSAtLSBkZWZhdWx0IHZhbHVlCiAgICBhc3NlcnQoc2l6ZSA8IDkpIC0tIG1heCA4IGJ5dGVzIGFrYSBRV09SRAogICAgbG9jYWwgcmV0MSA9IDAKICAgIGxvY2FsIHJldDIgPSAwCiAgICBsb2NhbCBieXRlcyA9IGJ1ZmY6c3ViKG9mZnNldCsxLCBvZmZzZXQrc2l6ZSkKICAgIGlmIG5vdCBiaWdlbmRpYW4gdGhlbgogICAgICAgIGJ5dGVzID0gYnl0ZXM6cmV2ZXJzZSgpIC0tIGxpdHRsZS1lbmRpYW4sIGhvc3QgYnl0ZSBvcmRlciwgcmV2ZXJzZSBieXRlIG9yZGVyLCBldGMuLi4KICAgIGVuZAogICAgbG9jYWwgYnl0ZSA9IDEKICAgIGZvciBiIGluIHN0cmluZy5nZmluZChieXRlcywgIi4iKSBkbwogICAgICAgIGlmIGJ5dGUgPCA1IHRoZW4KICAgICAgICAgICAgcmV0MSA9IGJpdC5sc2hpZnQocmV0MSwgOCkKICAgICAgICAgICAgcmV0MSA9IGJpdC5ib3IocmV0MSwgc3RyaW5nLmJ5dGUoYikpCiAgICAgICAgZWxzZQogICAgICAgICAgICByZXQyID0gYml0LmxzaGlmdChyZXQyLCA4KQogICAgICAgICAgICByZXQyID0gYml0LmJvcihyZXQyLCBzdHJpbmcuYnl0ZShiKSkKICAgICAgICBlbmQKICAgICAgICBieXRlID0gYnl0ZSArIDEKICAgIGVuZAoKICAgIGlmIHNpemUgPiA0IHRoZW4KICAgICAgICByZXR1cm4gdG9udW1iZXIoYml0LnRvaGV4KHJldDIpLCAxNiksIHRvbnVtYmVyKGJpdC50b2hleChyZXQxKSwgMTYpIC0tIHJldHVybiBsbywgaGkKICAgIGVuZAoKICAgIHJldHVybiB0b251bWJlcihiaXQudG9oZXgocmV0MSksIDE2KSAtLSByZXR1cm4gbG8KZW5kCgotLSByZWFkcyBhIHdtaSBzdHJpbmcgZnJvbSBhIGJ1ZmZlciByZXR1cm5pbmcgYSB1dGY4IHN0cmluZwotLSB0aGVzZSBzdHJpbmdzIHN0YXJ0IHdpdGggYSBsZWFkaW5nIGJ5dGUgd2hpY2ggaW5kaWNhdGVzIGlmCi0tIHRoZSBzdHJpbmcgaXMgd2luMTI1NiBvciB1dGYxNgpmdW5jdGlvbiB1dGlscy5yZWFkX3dtaV9zdHJpbmcoYnVmZmVyLCBzdGFydF9vZmZzZXQsIGxpbWl0KQogICAgbGltaXQgPSBsaW1pdCBvciAxMDI0CgogICAgLS0gcmVhZCBzdHJpbmcgdHlwZSBmcm9tIGZpcnN0IGJ5dGU7IHRoZSByZWFkX251bWJlciBmdW5jdGlvbiBhY2NvdW50cwogICAgLS0gZm9yIGx1YSAxLWJhc2VkIGFycmF5cwogICAgbG9jYWwgdW5pX3N0cmluZyA9IHV0aWxzLnJlYWRfbnVtYmVyKGJ1ZmZlciwgc3RhcnRfb2Zmc2V0LCAxKQogICAgaWYgdW5pX3N0cmluZyA9PSAwIHRoZW4KCiAgICAgICAgLS0gcmVhZF9zdHJpbmcgZG9lcyBub3QgYWNjb3VudCBmb3IgbHVhIDEtYmFzZWQgYXJyYXlzLCBzbyBvZmZzZXQgMiBmcm9tIHN0YXJ0CiAgICAgICAgLS0gKDEgZm9yIDEtYmFzZWQgYXJyYXlzLCAxIHRvIGFjY291bnQgZm9yIHN0cmluZyB0eXBlIGJ5dGUgcmVhZCBhYm92ZSk7IGFsc28KICAgICAgICAtLSBhZGQgb25lIHRvIGxpbWl0IGZvciAxLWJhc2VkIGFycmF5cwogICAgICAgIGxvY2FsIGJ5dF9zdHIgPSB1dGlscy5yZWFkX3N0cmluZyhidWZmZXIsIHN0YXJ0X29mZnNldCArIDIsIGxpbWl0KQoKICAgICAgICAtLSB0aGlzIGlzIGEgbmFycm93IHN0cmluZyBzbyByZWFkIGl0LCBhbmQgY29udmVydCBmcm9tIHdpbjEyNTYgdG8gdXRmOAogICAgICAgIHJldHVybiB1dGlscy53aW4xMjU2X3RvX3V0ZjgoYnl0X3N0cikKCiAgICBlbHNlaWYgdW5pX3N0cmluZyA9PSAxIHRoZW4KICAgICAgICAtLSBUaGlzIGlzIGEgdXRmMTYgc3RyaW5nIHNvIHJlYWQgaXQgYW5kIHJldHVybiB1dGY4CiAgICAgICAgbG9jYWwgYmxvY2sgPSBiaW5hcnlwYXJzZXIuQmxvY2soYnVmZmVyLCAwKQogICAgICAgIHJldHVybiBibG9jay5yZWFkX3V0ZjE2X2xlKHN0YXJ0X29mZnNldCArIDEsIGxpbWl0IC0gMSkKICAgIGVsc2UKICAgICAgICByZXR1cm4gIiIKICAgIGVuZAplbmQKCmZ1bmN0aW9uIHV0aWxzLnJlYWRfc3RyaW5nKGJ1ZmZlciwgc3RhcnRfb2Zmc2V0LCBsaW1pdCkKICAgIGxpbWl0ID0gbGltaXQgb3IgMTAyNAogICAgbG9jYWwgaWR4PTAKICAgIGZvciBpPXN0YXJ0X29mZnNldCxzdGFydF9vZmZzZXQrbGltaXQtMSwxIGRvCiAgICAgICAgaWYgYnVmZmVyOmJ5dGUoaSxpKSA9PSAwIHRoZW4gLS1hbmQgYnVmZmVyOmJ5dGUoaSsxLGkrMSkgPT0gMCB0aGVuCiAgICAgICAgICAgIHJldHVybiBidWZmZXI6c3ViKHN0YXJ0X29mZnNldCwgaS0xKQogICAgICAgIGVuZAogICAgICAgIGlkeCA9IGkKICAgIGVuZAogICAgcmV0dXJuIGJ1ZmZlcjpzdWIoc3RhcnRfb2Zmc2V0LCBpZHgpCmVuZAoKZnVuY3Rpb24gdXRpbHMucmVhZF93c3RyaW5nKGJ1ZmZlciwgc3RhcnRfb2Zmc2V0LCBsaW1pdCkKICAgIGxpbWl0ID0gbGltaXQgb3IgMTAyNAogICAgbG9jYWwgaQogICAgbG9jYWwgYnVmX2FzY2lpID0ge30KICAgIGZvciBpPXN0YXJ0X29mZnNldCxzdGFydF9vZmZzZXQrbGltaXQtMSwyIGRvCiAgICAgICAgaWYgYnVmZmVyOmJ5dGUoaSxpKSA9PSAwIHRoZW4KICAgICAgICAgICAgYnJlYWsKICAgICAgICBlbmQKICAgICAgICB0YWJsZS5pbnNlcnQoYnVmX2FzY2lpLCBidWZmZXI6c3ViKGksaSkpCiAgICBlbmQKICAgIHJldHVybiB0YWJsZS5jb25jYXQoYnVmX2FzY2lpKQplbmQKCi0tIENvbnZlcnRzIHdpbmRvd3MtMTI1NiBjb2RlcGFnZSBpbnRvIHV0Zi04Ci0tIEZyb206IGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMTY2MjQwMzYvaG93LXRvLWNvbnZlcnQtd2luZG93cy0xMjU2LXRvLXV0Zi04LWluLWx1YQpmdW5jdGlvbiB1dGlscy53aW4xMjU2X3RvX3V0Zjgoc3RyKQogICAgbG9jYWwgZW5jb2RpbmcgPSB7CiAgICAgICAgLS0gdGFibGUgbWFwcyB0aGUgb25lIGJ5dGUgV2luZG93cy0xMjU2IGVuY29kaW5nIGZvciBhIGNoYXJhY3RlciB0byBhIEx1YSBzdHJpbmcgd2l0aCB0aGUgVVRGLTggZW5jb2RpbmcgZm9yIHRoZSBjaGFyYWN0ZXIKICAgICAgICAiXDAwMCIgICAgICAgICwgIlwwMDEiICAgICAgICAsICJcMDAyIiAgICAgICAgLCAiXDAwMyIgICAgICAgICwgIlwwMDQiICAgICAgICAsICJcMDA1IiAgICAgICAgLCAiXDAwNiIgICAgICAgICwgIlwwMDciICAgICAgICAsCiAgICAgICAgIlwwMDgiICAgICAgICAsICJcMDA5IiAgICAgICAgLCAiXDAxMCIgICAgICAgICwgIlwwMTEiICAgICAgICAsICJcMDEyIiAgICAgICAgLCAiXDAxMyIgICAgICAgICwgIlwwMTQiICAgICAgICAsICJcMDE1IiAgICAgICAgLAogICAgICAgICJcMDE2IiAgICAgICAgLCAiXDAxNyIgICAgICAgICwgIlwwMTgiICAgICAgICAsICJcMDE5IiAgICAgICAgLCAiXDAyMCIgICAgICAgICwgIlwwMjEiICAgICAgICAsICJcMDIyIiAgICAgICAgLCAiXDAyMyIgICAgICAgICwKICAgICAgICAiXDAyNCIgICAgICAgICwgIlwwMjUiICAgICAgICAsICJcMDI2IiAgICAgICAgLCAiXDAyNyIgICAgICAgICwgIlwwMjgiICAgICAgICAsICJcMDI5IiAgICAgICAgLCAiXDAzMCIgICAgICAgICwgIlwwMzEiICAgICAgICAsCiAgICAgICAgIlwwMzIiICAgICAgICAsICJcMDMzIiAgICAgICAgLCAiXDAzNCIgICAgICAgICwgIlwwMzUiICAgICAgICAsICJcMDM2IiAgICAgICAgLCAiXDAzNyIgICAgICAgICwgIlwwMzgiICAgICAgICAsICJcMDM5IiAgICAgICAgLAogICAgICAgICJcMDQwIiAgICAgICAgLCAiXDA0MSIgICAgICAgICwgIlwwNDIiICAgICAgICAsICJcMDQzIiAgICAgICAgLCAiXDA0NCIgICAgICAgICwgIlwwNDUiICAgICAgICAsICJcMDQ2IiAgICAgICAgLCAiXDA0NyIgICAgICAgICwKICAgICAgICAiXDA0OCIgICAgICAgICwgIlwwNDkiICAgICAgICAsICJcMDUwIiAgICAgICAgLCAiXDA1MSIgICAgICAgICwgIlwwNTIiICAgICAgICAsICJcMDUzIiAgICAgICAgLCAiXDA1NCIgICAgICAgICwgIlwwNTUiICAgICAgICAsCiAgICAgICAgIlwwNTYiICAgICAgICAsICJcMDU3IiAgICAgICAgLCAiXDA1OCIgICAgICAgICwgIlwwNTkiICAgICAgICAsICJcMDYwIiAgICAgICAgLCAiXDA2MSIgICAgICAgICwgIlwwNjIiICAgICAgICAsICJcMDYzIiAgICAgICAgLAogICAgICAgICJcMDY0IiAgICAgICAgLCAiXDA2NSIgICAgICAgICwgIlwwNjYiICAgICAgICAsICJcMDY3IiAgICAgICAgLCAiXDA2OCIgICAgICAgICwgIlwwNjkiICAgICAgICAsICJcMDcwIiAgICAgICAgLCAiXDA3MSIgICAgICAgICwKICAgICAgICAiXDA3MiIgICAgICAgICwgIlwwNzMiICAgICAgICAsICJcMDc0IiAgICAgICAgLCAiXDA3NSIgICAgICAgICwgIlwwNzYiICAgICAgICAsICJcMDc3IiAgICAgICAgLCAiXDA3OCIgICAgICAgICwgIlwwNzkiICAgICAgICAsCiAgICAgICAgIlwwODAiICAgICAgICAsICJcMDgxIiAgICAgICAgLCAiXDA4MiIgICAgICAgICwgIlwwODMiICAgICAgICAsICJcMDg0IiAgICAgICAgLCAiXDA4NSIgICAgICAgICwgIlwwODYiICAgICAgICAsICJcMDg3IiAgICAgICAgLAogICAgICAgICJcMDg4IiAgICAgICAgLCAiXDA4OSIgICAgICAgICwgIlwwOTAiICAgICAgICAsICJcMDkxIiAgICAgICAgLCAiXDA5MiIgICAgICAgICwgIlwwOTMiICAgICAgICAsICJcMDk0IiAgICAgICAgLCAiXDA5NSIgICAgICAgICwKICAgICAgICAiXDA5NiIgICAgICAgICwgIlwwOTciICAgICAgICAsICJcMDk4IiAgICAgICAgLCAiXDA5OSIgICAgICAgICwgIlwxMDAiICAgICAgICAsICJcMTAxIiAgICAgICAgLCAiXDEwMiIgICAgICAgICwgIlwxMDMiICAgICAgICAsCiAgICAgICAgIlwxMDQiICAgICAgICAsICJcMTA1IiAgICAgICAgLCAiXDEwNiIgICAgICAgICwgIlwxMDciICAgICAgICAsICJcMTA4IiAgICAgICAgLCAiXDEwOSIgICAgICAgICwgIlwxMTAiICAgICAgICAsICJcMTExIiAgICAgICAgLAogICAgICAgICJcMTEyIiAgICAgICAgLCAiXDExMyIgICAgICAgICwgIlwxMTQiICAgICAgICAsICJcMTE1IiAgICAgICAgLCAiXDExNiIgICAgICAgICwgIlwxMTciICAgICAgICAsICJcMTE4IiAgICAgICAgLCAiXDExOSIgICAgICAgICwKICAgICAgICAiXDEyMCIgICAgICAgICwgIlwxMjEiICAgICAgICAsICJcMTIyIiAgICAgICAgLCAiXDEyMyIgICAgICAgICwgIlwxMjQiICAgICAgICAsICJcMTI1IiAgICAgICAgLCAiXDEyNiIgICAgICAgICwgIlwxMjciICAgICAgICAsCiAgICAgICAgIlwyMjZcMTMwXDE3MiIsICJcMjE3XDE5MCIgICAgLCAiXDIyNlwxMjhcMTU0IiwgIlwxOThcMTQ2IiAgICAsICJcMjI2XDEyOFwxNTgiLCAiXDIyNlwxMjhcMTY2IiwgIlwyMjZcMTI4XDE2MCIsICJcMjI2XDEyOFwxNjEiLAogICAgICAgICJcMjAzXDEzNCIgICAgLCAiXDIyNlwxMjhcMTc2IiwgIlwyMTdcMTg1IiAgICAsICJcMjI2XDEyOFwxODUiLCAiXDE5N1wxNDYiICAgICwgIlwyMThcMTM0IiAgICAsICJcMjE4XDE1MiIgICAgLCAiXDIxOFwxMzYiICAgICwKICAgICAgICAiXDIxOFwxNzUiICAgICwgIlwyMjZcMTI4XDE1MiIsICJcMjI2XDEyOFwxNTMiLCAiXDIyNlwxMjhcMTU2IiwgIlwyMjZcMTI4XDE1NyIsICJcMjI2XDEyOFwxNjIiLCAiXDIyNlwxMjhcMTQ3IiwgIlwyMjZcMTI4XDE0OCIsCiAgICAgICAgIlwyMThcMTY5IiAgICAsICJcMjI2XDEzMlwxNjIiLCAiXDIxOFwxNDUiICAgICwgIlwyMjZcMTI4XDE4NiIsICJcMTk3XDE0NyIgICAgLCAiXDIyNlwxMjhcMTQwIiwgIlwyMjZcMTI4XDE0MSIsICJcMjE4XDE4NiIgICAgLAogICAgICAgICJcMTk0XDE2MCIgICAgLCAiXDIxNlwxNDAiICAgICwgIlwxOTRcMTYyIiAgICAsICJcMTk0XDE2MyIgICAgLCAiXDE5NFwxNjQiICAgICwgIlwxOTRcMTY1IiAgICAsICJcMTk0XDE2NiIgICAgLCAiXDE5NFwxNjciICAgICwKICAgICAgICAiXDE5NFwxNjgiICAgICwgIlwxOTRcMTY5IiAgICAsICJcMjE4XDE5MCIgICAgLCAiXDE5NFwxNzEiICAgICwgIlwxOTRcMTcyIiAgICAsICJcMTk0XDE3MyIgICAgLCAiXDE5NFwxNzQiICAgICwgIlwxOTRcMTc1IiAgICAsCiAgICAgICAgIlwxOTRcMTc2IiAgICAsICJcMTk0XDE3NyIgICAgLCAiXDE5NFwxNzgiICAgICwgIlwxOTRcMTc5IiAgICAsICJcMTk0XDE4MCIgICAgLCAiXDE5NFwxODEiICAgICwgIlwxOTRcMTgyIiAgICAsICJcMTk0XDE4MyIgICAgLAogICAgICAgICJcMTk0XDE4NCIgICAgLCAiXDE5NFwxODUiICAgICwgIlwyMTZcMTU1IiAgICAsICJcMTk0XDE4NyIgICAgLCAiXDE5NFwxODgiICAgICwgIlwxOTRcMTg5IiAgICAsICJcMTk0XDE5MCIgICAgLCAiXDIxNlwxNTkiICAgICwKICAgICAgICAiXDIxOVwxMjkiICAgICwgIlwyMTZcMTYxIiAgICAsICJcMjE2XDE2MiIgICAgLCAiXDIxNlwxNjMiICAgICwgIlwyMTZcMTY0IiAgICAsICJcMjE2XDE2NSIgICAgLCAiXDIxNlwxNjYiICAgICwgIlwyMTZcMTY3IiAgICAsCiAgICAgICAgIlwyMTZcMTY4IiAgICAsICJcMjE2XDE2OSIgICAgLCAiXDIxNlwxNzAiICAgICwgIlwyMTZcMTcxIiAgICAsICJcMjE2XDE3MiIgICAgLCAiXDIxNlwxNzMiICAgICwgIlwyMTZcMTc0IiAgICAsICJcMjE2XDE3NSIgICAgLAogICAgICAgICJcMjE2XDE3NiIgICAgLCAiXDIxNlwxNzciICAgICwgIlwyMTZcMTc4IiAgICAsICJcMjE2XDE3OSIgICAgLCAiXDIxNlwxODAiICAgICwgIlwyMTZcMTgxIiAgICAsICJcMjE2XDE4MiIgICAgLCAiXDE5NVwxNTEiICAgICwKICAgICAgICAiXDIxNlwxODMiICAgICwgIlwyMTZcMTg0IiAgICAsICJcMjE2XDE4NSIgICAgLCAiXDIxNlwxODYiICAgICwgIlwyMTdcMTI4IiAgICAsICJcMjE3XDEyOSIgICAgLCAiXDIxN1wxMzAiICAgICwgIlwyMTdcMTMxIiAgICAsCiAgICAgICAgIlwxOTVcMTYwIiAgICAsICJcMjE3XDEzMiIgICAgLCAiXDE5NVwxNjIiICAgICwgIlwyMTdcMTMzIiAgICAsICJcMjE3XDEzNCIgICAgLCAiXDIxN1wxMzUiICAgICwgIlwyMTdcMTM2IiAgICAsICJcMTk1XDE2NyIgICAgLAogICAgICAgICJcMTk1XDE2OCIgICAgLCAiXDE5NVwxNjkiICAgICwgIlwxOTVcMTcwIiAgICAsICJcMTk1XDE3MSIgICAgLCAiXDIxN1wxMzciICAgICwgIlwyMTdcMTM4IiAgICAsICJcMTk1XDE3NCIgICAgLCAiXDE5NVwxNzUiICAgICwKICAgICAgICAiXDIxN1wxMzkiICAgICwgIlwyMTdcMTQwIiAgICAsICJcMjE3XDE0MSIgICAgLCAiXDIxN1wxNDIiICAgICwgIlwxOTVcMTgwIiAgICAsICJcMjE3XDE0MyIgICAgLCAiXDIxN1wxNDQiICAgICwgIlwxOTVcMTgzIiAgICAsCiAgICAgICAgIlwyMTdcMTQ1IiAgICAsICJcMTk1XDE4NSIgICAgLCAiXDIxN1wxNDYiICAgICwgIlwxOTVcMTg3IiAgICAsICJcMTk1XDE4OCIgICAgLCAiXDIyNlwxMjhcMTQyIiwgIlwyMjZcMTI4XDE0MyIsICJcMjE5XDE0NiIKICAgIH0KICAgIGFzc2VydCh0eXBlKHN0cikgPT0gInN0cmluZyIsICJQYXJhbWV0ZXIgMSBtdXN0IGJlIGEgc3RyaW5nIikKICAgIGxvY2FsIHJlc3VsdCA9IHt9CiAgICBmb3IgaSA9IDEsIHN0cmluZy5sZW4oc3RyKSBkbwogICAgICAgIHRhYmxlLmluc2VydChyZXN1bHQsIGVuY29kaW5nW3N0cmluZy5ieXRlKHN0cixpKSsxXSkKICAgIGVuZAogICAgcmV0dXJuIHRhYmxlLmNvbmNhdChyZXN1bHQpCmVuZAoKLS0gY29udmVydHMgdGhlIGJ1ZmZlciBgYnVmYCB0byBBU0NJSSBoZXggdGFibGUgZm9ybWF0OwotLSBpbnRlbmRlZCBmb3IgdXNlIHdpdGggZGVidWdnaW5nCmZ1bmN0aW9uIHV0aWxzLmhleF90YWJsZShidWYpCiAgICBsb2NhbCBvdXQgPSAiIgogICAgZm9yIGk9MSwgbWF0aC5jZWlsKCNidWYgLyAxNikgKiAxNiBkbwogICAgICAgIGlmIChpLTEpICUgMTYgPT0gMCB0aGVuIG91dCA9IG91dCAuLiBzdHJpbmcuZm9ybWF0KCclMDhYICAnLCBpLTEpIGVuZAogICAgICAgIG91dCA9IG91dCAuLiAoIGkgPiAjYnVmIGFuZCAnICAgJyBvciBzdHJpbmcuZm9ybWF0KCclMDJYICcsIGJ1ZjpieXRlKGkpKSApCiAgICAgICAgaWYgaSAlICA4ID09IDAgdGhlbiBvdXQgPSBvdXQgLi4gJyAnIGVuZAogICAgICAgIGlmIGkgJSAxNiA9PSAwIHRoZW4gb3V0ID0gb3V0IC4uIChidWY6c3ViKGktMTYrMSwgaSk6Z3N1YignJWMnLCcuJykgLi4gJ1xuJykgIGVuZAogICAgZW5kCiAgICByZXR1cm4gb3V0CmVuZAoKLS0gZHVtcHMgdGhlIGJ1ZmZlciBgYnVmYCBpbiBBU0NJSSBoZXggdGFibGUgZm9ybWF0CmZ1bmN0aW9uIHV0aWxzLmhleGxpZnkoYnVmLCBkZWxpbWl0ZXIpCiAgbG9jYWwgdCA9IHt9CiAgZm9yIGk9MSwgI2J1ZiBkbwogICAgIHRhYmxlLmluc2VydCh0LCBpID4gI2J1ZiBhbmQgJyAgICcgb3Igc3RyaW5nLmZvcm1hdCgnJTAyWCcsIGJ1ZjpieXRlKGkpKSkKICBlbmQKICBpZiB0eXBlKGRlbGltaXRlcikgPT0gInN0cmluZyIgdGhlbgogICAgIHJldHVybiB0YWJsZS5jb25jYXQodCwgZGVsaW1pdGVyKQogIGVuZAogIHJldHVybiB0YWJsZS5jb25jYXQodCkKZW5kCgpmdW5jdGlvbiB1dGlscy5zcGxpdF9uaWJibGVzKGJ5dGUpCiAgICBsb2NhbCB0bXAgPSBzdHJpbmcuZm9ybWF0KCIlMDJYIixieXRlKQogICAgICAgIGxvY2FsIG5pYjEgID0gdG9udW1iZXIodG1wOnN1YigxLDEpKQogICAgICAgIGxvY2FsIG5pYjIgID0gdG9udW1iZXIodG1wOnN1YigyLDIpKQoKICAgICAgICByZXR1cm4gbmliMSwgbmliMgplbmQKCi0tIE5PVEU6IGx1YV9JbnRlZ2VyIGlzIHB0cmRpZmZfdC4KLS0gVGhlIEMrKyBjb2RlIHVzZXMgbHVhX0ludGVnZXIgYXMgYW4gYXJndW1lbnQgdG8gc2VlaygpCi0tIHN0ZDo6cHRyZGlmZl90IGlzIHRoZSBzaWduZWQgaW50ZWdlciB0eXBlIG9mIHRoZSByZXN1bHQgb2Ygc3VidHJhY3RpbmcgdHdvIHBvaW50ZXJzLgotLSBNYXggc2VlayBvZmZzZXQ6IDIxNDc0ODM2NDgKLS0gVGhlIGZ1bmN0aW9uIGJlbG93IGlzIHdvcmsgYXJvdW5kIHRoaXMgbGltaXRhdGlvbgpmdW5jdGlvbiB1dGlscy5teXNlZWsoaGFuZGxlLCBvZmZzZXQsIHN0YXJ0KQogICAgbG9jYWwgZGl2LCBtb2QsIHJldCA9IHRydWUKCiAgICBpZiBvZmZzZXQgPiAyMTQ3NDgzMTM2IHRoZW4KICAgICAgICBkaXYgPSBtYXRoLmZsb29yKG9mZnNldC8yMTQ3NDgzMTM2KQogICAgICAgIG1vZCA9IG9mZnNldCUyMTQ3NDgzMTM2CiAgICBlbHNlCiAgICAgICAgZGl2ID0gMAogICAgICAgIG1vZCA9IG9mZnNldAogICAgZW5kCgogICAgaWYgc3RhcnQgPT0gMCB0aGVuCiAgICAgICAgZmlsZS5GaWxlU2Vla0FQSShoYW5kbGUsIDAsIDApCiAgICBlbmQKCiAgICBmb3IgaT0xLGRpdiwxIGRvCiAgICAgICAgcmV0ID0gZmlsZS5GaWxlU2Vla0FQSShoYW5kbGUsIDIxNDc0ODMxMzYsIDEpCiAgICBlbmQKCiAgICBpZiByZXQgdGhlbgogICAgICAgIHJldCA9IGZpbGUuRmlsZVNlZWtBUEkoaGFuZGxlLCBtb2QsIDEpCiAgICBlbmQKCiAgICByZXR1cm4gcmV0CmVuZAoKLS1nZXQgZGlyZWN0b3J5IG5hbWUgZnJvbSBmaWxlIHBhdGgKZnVuY3Rpb24gdXRpbHMuZ2V0X2Rpcl9uYW1lKGZpbGVfcGF0aCwgcGF0aF9zZXApCiAgICBwYXRoX3NlcCA9IHBhdGhfc2VwIG9yICcvJwogICAgcmV0dXJuIGZpbGVfcGF0aDptYXRjaCgiKC4qIi4ucGF0aF9zZXAuLiIpIikKZW5kCgotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQotLSBTZWFyY2hlcyB0aGUgc3lzdGVtIHBhdGggZm9yIHRoZSBwcmVzZW5jZSBvZiBhIGZpbGUKLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KZnVuY3Rpb24gdXRpbHMuZmluZF9maWxlX3BhdGgoZmlsZV9uYW1lLCBlbnZfdmFycykKICAgIGZvciBlbnZfcGF0aCBpbiBzdGRsaWIuc3BsaXQoZW52X3ZhcnNbIlBhdGgiXSwgJzsnKS5lYWNoKCkgZG8KICAgICAgICBsb2NhbCB0ZXN0X3BhdGggPSBlbnZfcGF0aCAuLiAnXFwnIC4uIGZpbGVfbmFtZQogICAgICAgIGxvY2FsIGlkeCA9IGZpbGUuRmlsZU9wZW5BUEkodGVzdF9wYXRoKQogICAgICAgIGlmIHR5cGUoaWR4KSB+PSAibmlsIiB0aGVuCiAgICAgICAgICAgIGZpbGUuRmlsZUNsb3NlQVBJKGlkeCkKICAgICAgICAgICAgcmV0dXJuIHRlc3RfcGF0aAogICAgICAgIGVsc2UKICAgICAgICAgICAgaWR4ID0gbmlsCiAgICAgICAgZW5kCiAgICBlbmQKICAgIHJldHVybiBmaWxlX25hbWUKZW5kCgotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQotLSBQYXJzZXMgYSBmaWxlIHBhdGggYW5kIHJldHVybnMgdGhlIGZpbGUgbG9jYXRpb25zIHRoYXQgdGhlIHdpbmRvd3Mgc2VydmljZQotLSBtYW5hZ2VyIChzZXJ2aWNlcy5leGUpIHdpbGwgYXR0ZW1wdCB0byBsb2FkIHRoZSBmaWxlIGZyb20uIEZvciBleGFtcGxlLCBhIHNlcnZpY2UKLS0gd2l0aCB0aGUgKnVucXVvdGVkKiBwYXRoICJDOlxQcm9ncmFtIEZpbGVzICh4ODYpXERWRCBNYWtlclxmaWxlLmV4ZSIgd2lsbCBjYXVzZQotLSB0aGUgc2VydmljZSBtYW5hZ2VyIHRvIGV4ZWN1dGUgdGhlIGZpcnN0IGZpbGUgaXQgZmluZHMgZnJvbSB0aGUgZm9sbG93aW5nCi0tIGxvY2F0aW9uczoKLS0KLS0gICBDOlxQcm9ncmFtCi0tICAgQzpcUHJvZ3JhbS5leGUKLS0gICBDOlxQcm9ncmFtIEZpbGVzCi0tICAgQzpcUHJvZ3JhbSBGaWxlcyAoeDg2KVxEVkQKLS0gICBDOlxQcm9ncmFtIEZpbGVzICh4ODYpXERWRC5leGUKLS0gICBDOlxQcm9ncmFtIEZpbGVzICh4ODYpXERWRCBNYWtlclxmaWxlLmV4ZQotLSAgIEM6XFByb2dyYW0gRmlsZXMgKHg4NilcRFZEIE1ha2VyXGZpbGUuZXhlLmV4ZQotLQotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpmdW5jdGlvbiB1dGlscy5nZXRfdW5xdW90ZWRfcGF0aHMoZmlsZV9wYXRoKQoKICAgIG1hdGNoX3N0ciA9ICIiCiAgICBpX2JlZyA9IDEKICAgIGN1cnJfcGF0aCA9ICIiCiAgICB1bnF1b3RlZF9wYXRocyA9IHt9CgogICAgLS0gbG93ZXItY2FzZSwgaGFuZGxpbmcgdGhlIEx1YSBidWcgaW4gd2hpY2ggbG93ZXIgcmV0dXJucyBuaWwgaWYKICAgIC0tIHRtcF9saW5lIGNvbnRhaW5zIHVuaWNvZGUKICAgIGZpbGVfcGF0aF9sb3dlciA9IGZpbGVfcGF0aDpsb3dlcigpCiAgICBpZiB0eXBlKGZpbGVfcGF0aF9sb3dlcikgPT0gInN0cmluZyIgdGhlbgogICAgICAgIGZpbGVfcGF0aCA9IGZpbGVfcGF0aF9sb3dlcgogICAgZW5kCgogICAgd2hpbGUgbWF0Y2hfc3RyIH49IG5pbCBkbwogICAgICAgIGlfYmVnLCBpX2VuZCwgbWF0Y2hfc3RyID0gc3RyaW5nLmZpbmQoZmlsZV9wYXRoLCAiKC4tKSVzIiwgaV9iZWcpCiAgICAgICAgaWYgbWF0Y2hfc3RyIH49IG5pbCB0aGVuCiAgICAgICAgICAgIGlmIGN1cnJfcGF0aCB+PSAiIiB0aGVuCiAgICAgICAgICAgICAgICBjdXJyX3BhdGggPSBjdXJyX3BhdGggLi4gIiAiCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBjdXJyX3BhdGggPSBjdXJyX3BhdGggLi4gbWF0Y2hfc3RyCiAgICAgICAgICAgIHRhYmxlLmluc2VydCh1bnF1b3RlZF9wYXRocywgY3Vycl9wYXRoKQogICAgICAgICAgICB0YWJsZS5pbnNlcnQodW5xdW90ZWRfcGF0aHMsIGN1cnJfcGF0aCAuLiAiLmV4ZSIpCiAgICAgICAgICAgIGlfYmVnID0gaV9lbmQgKyAxCiAgICAgICAgZW5kCiAgICBlbmQKICAgIHRhYmxlLmluc2VydCh1bnF1b3RlZF9wYXRocywgZmlsZV9wYXRoKQogICAgdGFibGUuaW5zZXJ0KHVucXVvdGVkX3BhdGhzLCBmaWxlX3BhdGggLi4gIi5leGUiKQogICAgcmV0dXJuIHVucXVvdGVkX3BhdGhzCmVuZAoKLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLS0gUGFyc2VzIGEgV2luZG93cyBjb21tYW5kIGludG8gYSBsaXN0IG9mIHBvdGVudGlhbCBhYnNvbHV0ZSBhbmQgcmVsYXRpdmUgZmlsZQotLSBwYXRocy4gU2VlIHV0aWxzLnRlc3RfY29tbWFuZF9saW5lX3BhcnNlciBmb3IgYSBsaXN0IG9mIHN1cHBvcnRlZCBwYXRocy4gSWYKLS0gdGhlcmUgYXJlIG5vIG1hdGNoZXMgdGhlIGVudGlyZSBjb21tYW5kIGxpbmUgaXMgcmV0dXJuZWQuCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmZ1bmN0aW9uIHV0aWxzLnBhcnNlX2NtZF9saW5lKGNtZF9saW5lLCBlbnZfdmFycykKCiAgICBsb2NhbCBmaWxlX3BhdGhzID0ge30KICAgIGxvY2FsIGZpbGVfcGF0aHNfY250ID0gMAogICAgbG9jYWwgbWF0Y2hfc3RyID0gIiIKICAgIGxvY2FsIGlfYmVnLCBpX2VuZCA9IDAsMAoKICAgIC0tIHdoaXRlbGlzdHMgY29tbWFuZHMgdGhhdCBzdGFydCB3aXRoICdjbWQnIGFuZCBjbGVhbnMgdXAKICAgIC0tIHdoaXRlc3BhY2UgYmVmb3JlIGFkZGluZyB0byBsaXN0IG9mIGZpbGUgcGF0aHMKICAgIGZ1bmN0aW9uIHNhdmVfcGF0aChmaWxlX3BhdGgsIHBvc3NpYmxlX2V4dHMpCiAgICAgICAgLS0gc29tZSBtYXRjaGVzIGluY2x1ZGUgdHJhaWxpbmcgd2hpdGVzcGFjZQogICAgICAgIGZpbGVfcGF0aCA9IGZpbGVfcGF0aDpnc3ViKCcoLi0pJXMrJCcsICclMScpCgogICAgICAgIC0tIGNoZWNrIGlmIHBhdGggaGFzIG5vIGV4dGVuc2lvbgogICAgICAgIGlmIHN0cmluZy5maW5kKGZpbGVfcGF0aCwgIiUuJXcrJCIpID09IG5pbCB0aGVuCgogICAgICAgICAgICBpZiBzdGRsaWIuZW5kc3dpdGgoZmlsZV9wYXRoLCAiY21kIikgb3IKICAgICAgICAgICAgICAgc3RkbGliLmVuZHN3aXRoKGZpbGVfcGF0aCwgInJlZyIpIG9yCiAgICAgICAgICAgICAgIHN0ZGxpYi5lbmRzd2l0aChmaWxlX3BhdGgsICJydW5kbGwzMiIpIG9yCiAgICAgICAgICAgICAgIHN0ZGxpYi5lbmRzd2l0aChmaWxlX3BhdGgsICJyZWdzdnIzMiIpIHRoZW4KICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydChmaWxlX3BhdGhzLCBmaWxlX3BhdGggLi4gIi5leGUiKQogICAgICAgICAgICAgICAgZmlsZV9wYXRoc19jbnQgPSBmaWxlX3BhdGhzX2NudCArIDEKICAgICAgICAgICAgZWxzZWlmIHR5cGUocG9zc2libGVfZXh0cykgPT0gInRhYmxlIiB0aGVuCiAgICAgICAgICAgICAgICBmb3IgXywgZXh0IGluIGlwYWlycyhwb3NzaWJsZV9leHRzKSBkbwogICAgICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydChmaWxlX3BhdGhzLCBmaWxlX3BhdGggLi4gIi4iIC4uIGV4dCkKICAgICAgICAgICAgICAgICAgICBmaWxlX3BhdGhzX2NudCA9IGZpbGVfcGF0aHNfY250ICsgMQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVsc2UKICAgICAgICAgICAgdGFibGUuaW5zZXJ0KGZpbGVfcGF0aHMsIGZpbGVfcGF0aCkKICAgICAgICAgICAgZmlsZV9wYXRoc19jbnQgPSBmaWxlX3BhdGhzX2NudCArIDEKICAgICAgICBlbmQKICAgIGVuZAoKICAgIC0tIGZ1bmN0aW9uIHRoYXQgc3BsaXRzIGEgY29tbWFuZCBsaW5lIGludG8gc2VwYXJhdGUgcGFydHMgdGhhdCAqbWF5KgogICAgLS0gY29udGFpbnMgZmlsZSBuYW1lczsgZm9yIGV4YW1wbGUsIGlmIGEgY29tbWFuZCBsaW5lIGNvbnNpc3RzIG9mCiAgICAtLSBtdWx0aXBsZSBxdW90YXRpb24tZW5jbG9zZWQgc3RyaW5ncywgZWFjaCBxdW90YXRpb24tZW5jbG9zZWQgc3RyaW5nCiAgICAtLSBpcyBpZGVudGlmaWVkIGFzIGEgc2VwYXJhdGUgcGFydC4gTk9URVM6CiAgICAtLSAxKSBpZiBzYXZlX21hdGNoIGlzIHRydWUsIHRoZSBtYXRjaCBpcyBhY3R1YWxseSBhIGZpbGUgbmFtZSBhbmQKICAgIC0tICAgIHNob3VsZCBiZSBzYXZlZCBhbmQgcmVtb3ZlZCBmcm9tIHRoZSBzdHJpbmcKICAgIC0tIDIpIHJlcGxhY2Vfc3RyIHdhcyBzcGVjaWZpY2FsbHkgYWRkZWQgZm9yIHJlZ2V4ICcoJWE6XFwuLSklcyglYTopJywKICAgIC0tICAgIGluIHdoaWNoIHRoZSBzZWNvbmQgbWF0Y2ggc2hvdWxkIGJlIHByZXNlcnZlZCB3aGVuIHRoZSBtYXRjaGluZwogICAgLS0gICAgc3RyaW5nIGlzIHJlbW92ZWQuIEZvciBleGFtcGxlLCAiYzpcZmlsZTEudHh0IGM6XGZpbGUyLnR4dCIKICAgIC0tICAgIG1hdGNoZXMgb24gImM6XGZpbGUxLnR4dCBjOlwiLiBUaGUgcmVzdWx0aW5nIHN0cmluZyBzaG91bGQgYmUKICAgIC0tICAgICJjOlxmaWxlMi50eHQiLCBub3QgImZpbGUyLnR4dCIKICAgIGZ1bmN0aW9uIHNwbGl0X2NtZF9wYXJ0cyhjbWRfcGFydHMsIGZpbmRfcmVnZXgsIHJlcGxhY2Vfc3RyLCBzYXZlX21hdGNoLCBwb3NzaWJsZV9leHRzKQogICAgICAgIGxvY2FsIG5ld19wYXJ0cyA9IHt9CgogICAgICAgIGZvciBfLCBjbWRfcGFydCBpbiBpcGFpcnMoY21kX3BhcnRzKSBkbwogICAgICAgICAgICBtYXRjaF9zdHIgPSAiIgogICAgICAgICAgICAtLSBlYWNoIG1hdGNoIGlzIHN1YmVxdWVudGx5IHJlbW92ZWQgZnJvbSB0aGUgb3JpZ2luYWwgc3RyaW5nCiAgICAgICAgICAgIHdoaWxlIG1hdGNoX3N0ciB+PSBuaWwgYW5kIGNtZF9wYXJ0IH49ICIiIGRvCiAgICAgICAgICAgICAgICBpX2JlZywgaV9lbmQsIG1hdGNoX3N0ciwgbWF0Y2hfc3RyXzIgPSBzdHJpbmcuZmluZChjbWRfcGFydCwgZmluZF9yZWdleCkKICAgICAgICAgICAgICAgIGlmIG1hdGNoX3N0ciB+PSBuaWwgdGhlbgogICAgICAgICAgICAgICAgICAgIGlmIHNhdmVfbWF0Y2ggPT0gdHJ1ZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIC0tIGZpbmRfcmVnZXggbWF0Y2hlcyBvbiBhIGZpbGUgdGhhdCBzaG91bGQgYmUgc2F2ZWQKICAgICAgICAgICAgICAgICAgICAgICAgc2F2ZV9wYXRoKG1hdGNoX3N0ciwgcG9zc2libGVfZXh0cykKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbWF0Y2hfc3RyXzIgfj0gbmlsIGFuZCByZXBsYWNlX3N0ciA9PSAnJyB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYXZlX3BhdGgobWF0Y2hfc3RyXzIsIHBvc3NpYmxlX2V4dHMpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgLS0gZmluZF9yZWdleCBtYXRjaGVzIG9uIGEgc2VjdGlvbiBvZiB0aGUgY29tbWFuZCBsaW5lCiAgICAgICAgICAgICAgICAgICAgICAgIC0tIHRoYXQgZG9lcyBub3QgbmVjZXNzYXJpbHkgcmVwcmVzZW50IGEgY29tcGxldGUKICAgICAgICAgICAgICAgICAgICAgICAgLS0gZmlsZSBwYXRoIChlLmcuLCBhIHF1b3RhdGlvbiBlbmNsb3NlZCBzdHJpbmcpCiAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydChuZXdfcGFydHMsIG1hdGNoX3N0cikKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbWF0Y2hfc3RyXzIgfj0gbmlsIGFuZCByZXBsYWNlX3N0ciA9PSAnJyB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZS5pbnNlcnQobmV3X3BhcnRzLCBtYXRjaF9zdHJfMikKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgLS0gcmVtb3ZlIHRoZSBtYXRjaCBmcm9tIHRoZSBzdHJpbmcgYW5kIGxvb3AgYWdhaW4KICAgICAgICAgICAgICAgICAgICBjbWRfcGFydCA9IGNtZF9wYXJ0OmdzdWIoZmluZF9yZWdleCwgcmVwbGFjZV9zdHIsIDEpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIC0tIHNhdmUgYW55IHJlbWFpbmluZywgdW5tYXRjaCBkYXRhIGFzIGEgZmluYWwgcGFydAogICAgICAgICAgICB0YWJsZS5pbnNlcnQobmV3X3BhcnRzLCBjbWRfcGFydCkKICAgICAgICBlbmQKICAgICAgICByZXR1cm4gbmV3X3BhcnRzCiAgICBlbmQKCiAgICAtLSByZXNvbHZlIGVudmlyb25tZW50IHZhcmlhYmxlcwogICAgbG9jYWwgdG1wX2xpbmUsIGVyciA9IHN0ZGxpYi5FbnYucmVzb2x2ZV92YXJpYWJsZXMoY21kX2xpbmUsIGVudl92YXJzKQogICAgaWYgZXJyIHRoZW4KICAgICAgICB0bXBfbGluZSA9IGNtZF9saW5lCiAgICBlbmQKCiAgICAtLSBsb3dlci1jYXNlLCBoYW5kbGluZyB0aGUgTHVhIGJ1ZyBpbiB3aGljaCBsb3dlciByZXR1cm5zIG5pbCBpZgogICAgLS0gdG1wX2xpbmUgY29udGFpbnMgdW5pY29kZQogICAgbG9jYWwgdG1wX2xpbmVfbG93ZXIgPSB0bXBfbGluZTpsb3dlcigpCiAgICBpZiB0eXBlKHRtcF9saW5lX2xvd2VyKSA9PSAic3RyaW5nIiB0aGVuCiAgICAgICAgdG1wX2xpbmUgPSB0bXBfbGluZV9sb3dlcgogICAgZW5kCiAgICAtLSB1bmVzY2FwZSBjb21tYW5kIGxpbmUKICAgIHRtcF9saW5lID0gdG1wX2xpbmU6Z3N1YigiXFxcXCIsICJcXCIpICAgLS0gdW5lc2NhcGUgZXNjYXBlZCBiYWNrc2xhc2hlcwogICAgdG1wX2xpbmUgPSB0bXBfbGluZTpnc3ViKCdcXCInLCAgJyInKSAgICAtLSB1bmVzY2FwZSBlc2NhcGVkIGRvdWJsZS1xdW90ZXMKICAgIHRtcF9saW5lID0gdG1wX2xpbmU6Z3N1YignJnF1b3Q7JywgJyInKSAgLS0gdW5lc2NhcGUgWE1MIGVzY2FwZWQgZG91YmxlLXF1b3RlcwogICAgdG1wX2xpbmUgPSB0bXBfbGluZTpnc3ViKCdcXCU/JT9cXCcsICcnKSAtLSByZW1vdmUKCiAgICAtLSBiZWdpbiBkaXZpZGluZyB0aGUgb3JpZ2luYWwgY29tbWFuZCBsaW5lIGludG8gYSBzZXJpZXMgb2YgcGFydHMKICAgIGxvY2FsIGNtZF9wYXJ0cyA9IHt0bXBfbGluZX0KCiAgICAtLSBiZWZvcmUgc3ViLWRpdmRpbmcgdGhlIG9yaWdpbmFsIGNvbW1hbmQgbGluZSBpbnRvIHBhcnRzLCBleHRyYWN0CiAgICAtLSBmaWxlIG5hbWVzIGZyb20gcnVuZGxsMzIgYW5kIGNtZCAoc2VlIGNvbW1lbnRzKQoKICAgIC0tIDEpIGNvbW1hbmQgaXMganVzdCBhIGZpbGUgbmFtZQogICAgY21kX3BhcnRzID0gc3BsaXRfY21kX3BhcnRzKGNtZF9wYXJ0cywgJ14oWyV3XyUtJS5dKyUuJXcrKSQnLCAnJywgdHJ1ZSkKCiAgICAtLSAyKSBETExzIGludm9rZWQgYnkgcnVuZGxsMzIKICAgIC0tICAgIHJlZ2V4OiBydW5kbGwzMiB3LyBleHRlbnNpb24gKG9wdGlvbmFsKSBmb2xsb3dlZCBieSBxdW90ZS1lbmNsb3NlZCAob3B0aW9uYWwpIGZpbGVuYW1lIGZvbGxvd2VkIGJ5IERMTCBleHBvcnQgKG9wdGlvbmFsKQogICAgY21kX3BhcnRzID0gc3BsaXRfY21kX3BhcnRzKGNtZF9wYXJ0cywgJ14ocnVuZGxsMzIlLj8ldyolcyspIj8oW14sIl0rKScsICcnLCB0cnVlLCB7J2RsbCd9KQoKICAgIC0tIDMpIFRoaXMgaXMgZm9yIGEgdmVyeSBzcGVjaWZpYyAoYW5kIHBlcmhhcHMgdW5saWtlbHkpIGNvbW1hbmQ6ICJjbWQgL2MgZXZpbCIKICAgIC0tICAgICJOb3JtYWwiIGRldmlhdGlvbnMgb2YgY21kIChlLmcuLCAiY21kIC9jIGV2aWwuZXhlIikgd2lsbCBiZSBwYXJzZWQgb3V0CiAgICAtLSAgICBpbiB0aGUgbG9vcHMgYmVsb3cKICAgIGNtZF9wYXJ0cyA9IHNwbGl0X2NtZF9wYXJ0cyhjbWRfcGFydHMsICdeKGNtZCklcysvYyVzKygldyspJCcsICcnLCB0cnVlLCB7J2V4ZScsICdiYXQnfSkKCiAgICAtLSA0KSBzdWItZGl2aWRlIHRoZSByZW1haW5pbmcgY29tbWFuZCBsaW5lIGludG8gcGFydHMKICAgIGNtZF9wYXJ0cyA9IHNwbGl0X2NtZF9wYXJ0cyhjbWRfcGFydHMsICciKC4tKSIlcyonLCAnJykgICAgICAgICAgLS0gcXVvdGF0aW9uIGVuY2xvc2VkIHN0cmluZ3MKICAgIGNtZF9wYXJ0cyA9IHNwbGl0X2NtZF9wYXJ0cyhjbWRfcGFydHMsICcoJWE6XFwuLSklcyglYTopJywgJyUyJykgLS0gbXVsdGlwbGUgZmlsZSBwYXRocyBiZWdpbmluZyB3LyBkcml2ZSBsZXR0ZXIKICAgIGNtZF9wYXJ0cyA9IHNwbGl0X2NtZF9wYXJ0cyhjbWRfcGFydHMsICcoLi0pJXMrLyV3JXMqJywgJycpICAgICAgLS0gZmlsZSBhcmd1bWVudHMgKGUuZy4sIC9hcmcpCiAgICBjbWRfcGFydHMgPSBzcGxpdF9jbWRfcGFydHMoY21kX3BhcnRzLCAnKC4tKSVzKyUtKyV3JXMqJywgJycpICAgIC0tIGZpbGUgYXJndW1lbnRzIChlLmcuLCAtYXJnIG9yIC0tYXJnKQogICAgY21kX3BhcnRzID0gc3BsaXRfY21kX3BhcnRzKGNtZF9wYXJ0cywgJyguLSlbJj4sJSUlKl0nLCAnJykgICAgICAtLSBhbXBlcnNhbmQsIGdyZWF0ZXItdGhhbiwgYW5kIGNvbW1hCiAgICBjbWRfcGFydHMgPSBzcGxpdF9jbWRfcGFydHMoY21kX3BhcnRzLCAnJS5cXCguKiknLCAnJykgICAgICAgICAgIC0tIGN1cnJlbnQtZGlyZWN0b3J5IHByZWZpeCAoLlwpCgogICAgLS0gbmV4dCwgbG9vcCBvdmVyIGFsbCB0aGUgcGFydHMgYW5kIHNlYXJjaCBmb3IgZmlsZSBwYXRocwogICAgLS0gc3RhcnRpbmcgdy8gZHJpdmUgbGV0dGVyCiAgICBsb2NhbCByZWdleF93aW5fcGF0aF9zcGFjZXMgPSAnXiglYTouLVteJS4lcy9dLSkkJwogICAgZm9yIF8sIGNvbW1hbmRfcGFydCBpbiBpcGFpcnMoY21kX3BhcnRzKSBkbwoKICAgICAgICAtLSB0d28gbG9vcHMgYXJlIHVzZWQgdG8gc2VhcmNoIGZvciBmaWxlIHBhdGhzOgogICAgICAgIC0tIDEpIFdISUxFIGxvb3A6IGZ1bGx5LXF1YWxpZmllZCB3aW5kb3dzIHBhdGhzIHdpdGggc3BhY2VzCiAgICAgICAgLS0gMikgRk9SIGxvb3AgIDogZmlsZSBuYW1lcyAocXVhbGlmaWVkIGFuZCBub3QpIHNlcGFyYXRlZCBieSBzcGFjZXMKCiAgICAgICAgbWF0Y2hfc3RyID0gIiIKCiAgICAgICAgLS0gc2VhcmNoIGZvciBmdWxseS1xdWFsaWZpZWQgd2luZG93cyBwYXRocyBjb250YWluaW5nIHNwYWNlcwogICAgICAgIHdoaWxlIChtYXRjaF9zdHIgfj0gbmlsKSBkbwoKICAgICAgICAgICAgLS0gc2VhcmNoIGZvciBwYXRocyB3aXRoIHNwYWNlcwogICAgICAgICAgICAtLSBleGFtcGxlOiBjOlx3aW5kb3dzXHN5c3RlbTMyXGNtZAogICAgICAgICAgICAgIGlfYmVnLCBpX2VuZCwgbWF0Y2hfc3RyID0gc3RyaW5nLmZpbmQoY29tbWFuZF9wYXJ0LCByZWdleF93aW5fcGF0aF9zcGFjZXMpCiAgICAgICAgICAgICAgaWYgbWF0Y2hfc3RyIH49IG5pbCB0aGVuCiAgICAgICAgICAgICAgICAgIG1hdGNoX3N0ciA9IG1hdGNoX3N0cjpnc3ViKCcoLi0pJXMrJCcsICclMScpCiAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAtLSBpZiBlaXRoZXIgaXMgZm91bmQsIHNhdmUgdGhlIG1hdGNoICpBTkQqIHJlbW92ZSBpdCBmcm9tCiAgICAgICAgICAgIC0tIHRoZSB0ZW1wIHN0cmluZzsgdGhlIG1hdGNoIGlzIHJlbW92ZWQgZnJvbSB0aGUgdG1wIHN0cmluZwogICAgICAgICAgICAtLSBzbyB0aGF0IGR1cGxpY2F0ZSBtYXRjaGVzIGFyZSBub3QgcHJvZHVjZWQgaW4gdGhlIHN1YnNlcXVlbnQKICAgICAgICAgICAgLS0gZm9yIGxvb3AgYmVsb3cKICAgICAgICAgICAgaWYgbWF0Y2hfc3RyIH49IG5pbCB0aGVuCiAgICAgICAgICAgICAgICBzYXZlX3BhdGgobWF0Y2hfc3RyKQogICAgICAgICAgICAgICAgY29tbWFuZF9wYXJ0ID0gY29tbWFuZF9wYXJ0OmdzdWIocmVnZXhfd2luX3BhdGhfc3BhY2VzLCAnJywgMSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCgogICAgICAgIC0tIHdpdGggZmlsZSBwYXRocyBjb250YWluaW5nIHNwYWNlcyByZW1vdmVkLCBzcGxpdCByZW1haW5pbmcgY21kCiAgICAgICAgLS0gbGluZSBieSBzcGFjZSBhbmQgc2VhcmNoIGZvciB3aW5kb3dzIHBhdGhzIGFuZCBmaWxlIG5hbWVzCiAgICAgICAgbG9jYWwgcmVnZXhfd2luX3BhdGggPSAnKCVhOi4tW15cXC9dLSUuW14lLlxcJXMvXSopJCcKCiAgICAgICAgZm9yIGNtZF9wYXJ0IGluIHN0cmluZy5nbWF0Y2goY29tbWFuZF9wYXJ0LCAiJVMrIikgZG8KICAgICAgICAgICAgaWYgY21kX3BhcnQgfj0gJyAnIGFuZCBjbWRfcGFydCB+PSAnJyB0aGVuCgogICAgICAgICAgICAgICAgaWYgc3RyaW5nLmZpbmQoY21kX3BhcnQsIHJlZ2V4X3dpbl9wYXRoKSB+PSBuaWwgdGhlbgogICAgICAgICAgICAgICAgICAgIHNhdmVfcGF0aChjbWRfcGFydCkKCiAgICAgICAgICAgICAgICAtLSBtYXRjaGVzIG9uIDxwcmVmaXg+LjxzdWZmaXg+CiAgICAgICAgICAgICAgICBlbHNlaWYgc3RyaW5nLmZpbmQoY21kX3BhcnQsICdeWyV3Xy0lLl0rJS4ldysnKSB+PSBuaWwgdGhlbgogICAgICAgICAgICAgICAgICAgIHNhdmVfcGF0aChjbWRfcGFydCkKCiAgICAgICAgICAgICAgICAtLSBtYXRjaGVzIG9uIGFueSBhbHBoYW51bWVyaWMgd29yZCwgd2hpY2ggKmNvdWxkKiByZXByZXNlbnQKICAgICAgICAgICAgICAgIC0tIGFuIGV4dGVuc2lvbmxlc3MgZmlsZSBuYW1lOyBob3dldmVyLCBhcyB0aGVyZSBpcyBubyBjb250ZXh0CiAgICAgICAgICAgICAgICAtLSB3ZSBjYW5ub3QgYXNzdW1lIGl0IGlzIGEgZmlsZSBuYW1lLCB1bmxlc3MgaXQgaXMgbG9jYXRlZAogICAgICAgICAgICAgICAgLS0gYXQgdGhlIHN0YXJ0IG9mIHRoZSBvcmlnaW5hbCBjb21tYW5kIGxpbmUKICAgICAgICAgICAgICAgIGVsc2VpZiBzdHJpbmcuZmluZChjbWRfcGFydCwgJ15bJXdfJS1dKyQnKSB+PSBuaWwgdGhlbgogICAgICAgICAgICAgICAgICAgIC0tIGFzc3VtZSBhbHBoYW51bWVyaWMgd29yZHMgdGhhdCBzdGFydCBhIGNvbW1hbmQgbGluZQogICAgICAgICAgICAgICAgICAgIC0tIHJlcHJlc2VudCBleHRlbnNpb25sZXNzIGZpbGUgbmFtZXMKICAgICAgICAgICAgICAgICAgICBpZiAoc3RyaW5nLmZpbmQoY21kX2xpbmUsIGNtZF9wYXJ0KSA9PSAxKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHNhdmVfcGF0aChjbWRfcGFydCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAogICAgLS0gaWYgbm8gbWF0Y2hlcyBmb3VuZCwgcmV0dXJuIHRoZSBvcmlnaW5hbCBjb21tYW5kIGxpbmUKICAgIGlmIGZpbGVfcGF0aHNfY250ID09IDAgdGhlbgogICAgICAgIHRhYmxlLmluc2VydChmaWxlX3BhdGhzLCBjbWRfbGluZSkKICAgIGVuZAogICAgcmV0dXJuIGZpbGVfcGF0aHMKZW5kCgpmdW5jdGlvbiB1dGlscy50ZXN0X2NvbW1hbmRfbGluZV9wYXJzZXIoKQoKICAgIC0tIGludm9rZXMgdXRpbHMucGFyc2VfY21kX2xpbmUgYW5kIGNvbXBhcmVzIHRoZSByZXN1bHRzIHRvIHRoZSBleHBlY3RlZCBvdXRwdXQKICAgIGZ1bmN0aW9uIHJ1bl90ZXN0KGNtZCwgZXhwZWN0ZWRfcmVzdWx0cywgZW52X3ZhcnMpCgogICAgICAgIGxvY2FsIHJlc3VsdHMgPSB1dGlscy5wYXJzZV9jbWRfbGluZShjbWQsIGVudl92YXJzKQogICAgICAgIGxvY2FsIGNudF9yZXN1bHRzID0gMAogICAgICAgIGxvY2FsIGNudF9leHBlY3RlZCA9IGV4cGVjdGVkX3Jlc3VsdHMuc2l6ZSgpCiAgICAgICAgZm9yIF8sIHBhcnNlZF9wYXRoIGluIGlwYWlycyhyZXN1bHRzKSBkbwogICAgICAgICAgICAtLSBpdGVyYXRlIG92ZXIgYSBjb3B5IG9mIGV4cGVjdGVkX3Jlc3VsdHMgc28gdGhhdCBtYXRjaGluZyBpdGVtcwogICAgICAgICAgICAtLSBjYW4gYmUgc2FmZWx5IHBvcHBlZCBvZmYgdGhlIG9yaWdpbmFsIGxpc3QKICAgICAgICAgICAgaWR4ID0gMQogICAgICAgICAgICBmb3IgcmVzdWx0IGluIGV4cGVjdGVkX3Jlc3VsdHMuZmlsdGVyKGZ1bmN0aW9uKG8pIHJldHVybiB0cnVlIGVuZCkuZWFjaCgpIGRvCiAgICAgICAgICAgICAgICBpZiBwYXJzZWRfcGF0aDpsb3dlcigpID09IHJlc3VsdDpsb3dlcigpIHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCB0ZXN0ID0gZXhwZWN0ZWRfcmVzdWx0cy5wb3AoaWR4KQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGlkeCA9IGlkeCArIDEKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGNudF9yZXN1bHRzID0gY250X3Jlc3VsdHMgKyAxCiAgICAgICAgZW5kCgogICAgICAgIGlmIGV4cGVjdGVkX3Jlc3VsdHMuc2l6ZSgpID09IDAgYW5kIChjbnRfZXhwZWN0ZWQgPT0gY250X3Jlc3VsdHMpIHRoZW4KICAgICAgICAgICAgZGVidWcuZGVidWcoIlBBU1M6ICIgLi4gY21kKQogICAgICAgIGVsc2UKICAgICAgICAgICAgZGVidWcuZGVidWcoIkZBSUw6ICIgLi4gY21kKQogICAgICAgICAgICBmb3IgcmVzdWx0IGluIGV4cGVjdGVkX3Jlc3VsdHMuZWFjaCgpIGRvCiAgICAgICAgICAgICAgICBkZWJ1Zy5kZWJ1ZygiIiwgIk1JU1NFRDonIiAuLiByZXN1bHQgLi4gIiciKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgZm9yIF8sIHBhdGggaW4gaXBhaXJzKHJlc3VsdHMpIGRvCiAgICAgICAgICAgICAgICBkZWJ1Zy5kZWJ1ZygiIiwgIkZPVU5EIDonIiAuLiBwYXRoIC4uICInIikKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGRlYnVnLmRlYnVnKCIiKQogICAgICAgIGVuZAogICAgZW5kCgogICAgbG9jYWwgZW52X3ZhcnMgPSBzdGRsaWIuRW52LnZhcmlhYmxlcygpCgoKICAgIC0tIGdlbmVyaWMgZmlsZSBuYW1lIHRlc3RzCiAgICBydW5fdGVzdCgiZXZpbC5kbGwiLCBzdGRsaWIuTGlzdCh7ImV2aWwuZGxsIn0pLCBlbnZfdmFycykKICAgIHJ1bl90ZXN0KCJpeXV2XzMyLmRsbCIsIHN0ZGxpYi5MaXN0KHsiaXl1dl8zMi5kbGwifSksIGVudl92YXJzKQoKICAgIHJ1bl90ZXN0KCJleHBsb3Jlci5leGUsYzpcXGRvY3VtZW50cyBhbmQgc2V0dGluZ3NcXGl1a2Rxdy5leGUiLCBzdGRsaWIuTGlzdCh7ImV4cGxvcmVyLmV4ZSIsICJjOlxcZG9jdW1lbnRzIGFuZCBzZXR0aW5nc1xcaXVrZHF3LmV4ZSJ9KSwgZW52X3ZhcnMpCiAgICBydW5fdGVzdCgiLlxcc2V0dXAuZXhlIiwgc3RkbGliLkxpc3QoeyJzZXR1cC5leGUifSksIGVudl92YXJzKQogICAgcnVuX3Rlc3QoImEuZGxsLGIuZGxsLGMuZGxsIiwgc3RkbGliLkxpc3QoeyJhLmRsbCIsICJiLmRsbCIsICJjLmRsbCJ9KSwgZW52X3ZhcnMpCiAgICBydW5fdGVzdCgiYzpcXHdpbmRvd3NcXHRlbXBcXGV2aWwuZGxsIiwgc3RkbGliLkxpc3QoeyJjOlxcd2luZG93c1xcdGVtcFxcZXZpbC5kbGwifSksIGVudl92YXJzKQogICAgcnVuX3Rlc3QoIlxcPz9cXGM6XFx3aW5kb3dzXFx0ZW1wXFxldmlsLmRsbCIsIHN0ZGxpYi5MaXN0KHsiYzpcXHdpbmRvd3NcXHRlbXBcXGV2aWwuZGxsIn0pLCBlbnZfdmFycykKCiAgICAtLSBydW5kbGwzMiB0ZXN0cwogICAgcnVuX3Rlc3QoInJ1bmRsbDMyIGM6XFx3aW5kb3dzXFx0ZW1wXFxldmlsLmRsbCIsIHN0ZGxpYi5MaXN0KHsicnVuZGxsMzIuZXhlIiwgImM6XFx3aW5kb3dzXFx0ZW1wXFxldmlsLmRsbCJ9KSwgZW52X3ZhcnMpCiAgICBydW5fdGVzdCgicnVuZGxsMzIgZXZpbC5kbGwiLCBzdGRsaWIuTGlzdCh7InJ1bmRsbDMyLmV4ZSIsICJldmlsLmRsbCJ9KSwgZW52X3ZhcnMpCiAgICBydW5fdGVzdCgicnVuZGxsMzIgZXZpbC5kbGwsMSIsIHN0ZGxpYi5MaXN0KHsicnVuZGxsMzIuZXhlIiwgImV2aWwuZGxsIn0pLCBlbnZfdmFycykKICAgIHJ1bl90ZXN0KCJydW5kbGwzMi5leGUgXCJldmlsLmRsbFwiLDEgLTMgdW5pbnN0YWxsdHlwZT1pZSIsIHN0ZGxpYi5MaXN0KHsicnVuZGxsMzIuZXhlIiwgImV2aWwuZGxsIn0pLCBlbnZfdmFycykKICAgIHJ1bl90ZXN0KCJydW5kbGwzMiBldmlsLmRsbCxldmlsX2V4cG9ydCBodHRwOi8vd3d3Lmlnbm9yZXVybC5jb20vcmQvIiwgc3RkbGliLkxpc3QoeyJydW5kbGwzMi5leGUiLCAiZXZpbC5kbGwifSksIGVudl92YXJzKQogICAgcnVuX3Rlc3QoIlwiYzpcXHBhdGggd2l0aCBzcGFjZXNcXHJ1bmRsbDMyXCIgYzpcXHBhdGggd2l0aCBzcGFjZXNcXGV2aWwuZGxsIiwgc3RkbGliLkxpc3QoeyJjOlxccGF0aCB3aXRoIHNwYWNlc1xccnVuZGxsMzIuZXhlIiwgImM6XFxwYXRoIHdpdGggc3BhY2VzXFxldmlsLmRsbCJ9KSwgZW52X3ZhcnMpCiAgICBydW5fdGVzdCgiJVN5c3RlbVJvb3QlXFxzeXN0ZW0zMlxccnVuZGxsMzIuZXhlIFwiYzpcXHdpbmRvd3NcXHRlbXBcXGV2aWwuZGxsXCIiLCBzdGRsaWIuTGlzdCh7ImM6XFx3aW5kb3dzXFxzeXN0ZW0zMlxccnVuZGxsMzIuZXhlIiwgImM6XFx3aW5kb3dzXFx0ZW1wXFxldmlsLmRsbCJ9KSwgZW52X3ZhcnMpCiAgICBydW5fdGVzdCgicnVuZGxsMzIgZXZpbGRsbCxldmlsX2V4cG9ydCBcImV2aWwuY3BsXCIiLCBzdGRsaWIuTGlzdCh7InJ1bmRsbDMyLmV4ZSIsICJldmlsZGxsLmRsbCIsICJldmlsLmNwbCJ9KSwgZW52X3ZhcnMpCiAgICBydW5fdGVzdCgiJXdpbmRpciVcXHN5c3RlbTMyXFxydW5kbGwzMi5leGUgL2QgYWNwcm94eS5kbGwsUGVyZm9ybUF1dG9jaGtPcGVyYXRpb25zIiwgc3RkbGliLkxpc3QoeyJjOlxcd2luZG93c1xcc3lzdGVtMzJcXHJ1bmRsbDMyLmV4ZSIsICJhY3Byb3h5LmRsbCJ9KSwgZW52X3ZhcnMpCiAgICBydW5fdGVzdCgiQzpcXFdpbmRvd3NcXFN5c1dPVzY0XFxSdW5kbGwzMi5leGUgQzpcXFdpbmRvd3NcXFN5c1dPVzY0XFxtc2Nvcmllcy5kbGwsSW5zdGFsbCIsIHN0ZGxpYi5MaXN0KHsiQzpcXFdpbmRvd3NcXFN5c1dPVzY0XFxydW5kbGwzMi5leGUiLCAiQzpcXFdpbmRvd3NcXFN5c1dPVzY0XFxtc2Nvcmllcy5kbGwifSksIGVudl92YXJzKQoKICAgIC0tIHJlZ3N2cjMyIHRlc3RzCiAgICBydW5fdGVzdCgicmVnc3ZyMzIgL3MgZXZpbC5kbGwiLCBzdGRsaWIuTGlzdCh7InJlZ3N2cjMyLmV4ZSIsICJldmlsLmRsbCJ9KSwgZW52X3ZhcnMpCiAgICBydW5fdGVzdCgicmVnc3ZyMzIuZXhlIC9zIFwiYzpcXHByb2dyYW0gZmlsZXMgKHg4NilcXGV2aWwub2N4XCIiLCBzdGRsaWIuTGlzdCh7InJlZ3N2cjMyLmV4ZSIsICJjOlxccHJvZ3JhbSBmaWxlcyAoeDg2KVxcZXZpbC5vY3gifSksIGVudl92YXJzKQogICAgcnVuX3Rlc3QoInJlZ3N2cjMyLmV4ZSAvcyAvbiAvaTpVIHNoZWxsMzIuZGxsIiwgc3RkbGliLkxpc3QoeyJyZWdzdnIzMi5leGUiLCAic2hlbGwzMi5kbGwifSksIGVudl92YXJzKQoKICAgIC0tIGNtZC5leGUgdGVzdHMKICAgIHJ1bl90ZXN0KCJjbWQgL2MgZXZpbCIsIHN0ZGxpYi5MaXN0KHsiY21kLmV4ZSIsICJldmlsLmV4ZSIsICJldmlsLmJhdCJ9KSwgZW52X3ZhcnMpCiAgICBydW5fdGVzdCgiY21kIC9jIGV2aWwuZGxsIiwgc3RkbGliLkxpc3QoeyJjbWQuZXhlIiwgImV2aWwuZGxsIn0pLCBlbnZfdmFycykKICAgIHJ1bl90ZXN0KCJjbWQuZXhlIC9jIGV2aWwuZGxsIiwgc3RkbGliLkxpc3QoeyJjbWQuZXhlIiwgImV2aWwuZGxsIn0pLCBlbnZfdmFycykKICAgIHJ1bl90ZXN0KCJjbWQgL2MgXCJldmlsLmRsbFwiIiwgc3RkbGliLkxpc3QoeyJjbWQuZXhlIiwgImV2aWwuZGxsIn0pLCBlbnZfdmFycykKCiAgICBydW5fdGVzdCgiJUNvbVNwZWMlIC9jIGV2aWwuZXhlIiwgc3RkbGliLkxpc3QoeyJDOlxcd2luZG93c1xcc3lzdGVtMzJcXGNtZC5leGUiLCAiZXZpbC5leGUifSksIGVudl92YXJzKQogICAgcnVuX3Rlc3QoImM6XFx3aW5kb3dzXFxzeXN0ZW0zMlxcY21kIC9jIGV2aWwuZXhlIiwgc3RkbGliLkxpc3QoeyJDOlxcd2luZG93c1xcc3lzdGVtMzJcXGNtZC5leGUiLCAiZXZpbC5leGUifSksIGVudl92YXJzKQogICAgcnVuX3Rlc3QoIkM6XFx3aW5kb3dzXFxzeXN0ZW0zMlxcY21kLmV4ZSAvYyBcImV2aWwuYmF0ID4gYzpcXHdpbmRvd3NcXHRlbXBcXGV2aWwudHh0XCIiLCBzdGRsaWIuTGlzdCh7IkM6XFx3aW5kb3dzXFxzeXN0ZW0zMlxcY21kLmV4ZSIsICJldmlsLmJhdCIsICJjOlxcd2luZG93c1xcdGVtcFxcZXZpbC50eHQifSksIGVudl92YXJzKQogICAgcnVuX3Rlc3QoJ0M6XFx3aW5kb3dzXFxzeXN0ZW0zMlxcY21kLmV4ZSAvYyBcXCJldmlsLmJhdCA+IGM6XFx3aW5kb3dzXFx0ZW1wXFxldmlsLnR4dFxcIicsIHN0ZGxpYi5MaXN0KHsiQzpcXHdpbmRvd3NcXHN5c3RlbTMyXFxjbWQuZXhlIiwgImV2aWwuYmF0IiwgImM6XFx3aW5kb3dzXFx0ZW1wXFxldmlsLnR4dCJ9KSwgZW52X3ZhcnMpCgogICAgcnVuX3Rlc3QoImNtZCAvYyBcImV2aWwuYmF0ID4gYzpcXHdpbmRvd3NcXHRlbXBcXGV2aWwudHh0XCIiLCBzdGRsaWIuTGlzdCh7ImNtZC5leGUiLCAiZXZpbC5iYXQiLCAiYzpcXHdpbmRvd3NcXHRlbXBcXGV2aWwudHh0In0pLCBlbnZfdmFycykKICAgIHJ1bl90ZXN0KCJjbWQgL2MgZWNobyBjOlxcd2luZG93c1xcdGVtcFxcZXZpbC5leGUgPiBjOlxcd2luZG93c1xcdGVtcFxcZXZpbC50eHQiLCBzdGRsaWIuTGlzdCh7ImNtZC5leGUiLCAiYzpcXHdpbmRvd3NcXHRlbXBcXGV2aWwuZXhlIiwgImM6XFx3aW5kb3dzXFx0ZW1wXFxldmlsLnR4dCJ9KSwgZW52X3ZhcnMpCgogICAgLS0gYXJndW1lbnQgdGVzdHMgKGVuc3VyZSBhcmd1bWVudHMgYXJlbid0IHBpY2tlZCB1cCkKICAgIHJ1bl90ZXN0KCIlU3lzdGVtUm9vdCVcXFN5c3RlbTMyXFxldmlsLmV4ZSAtYXJnIC1hcmcyIiwgc3RkbGliLkxpc3QoeyJjOlxcd2luZG93c1xcc3lzdGVtMzJcXGV2aWwuZXhlIn0pLCBlbnZfdmFycykKICAgIHJ1bl90ZXN0KCIlU3lzdGVtUm9vdCVcXFN5c3RlbTMyXFxldmlsLmV4ZSAtYXJnIC0tYXJnMiIsIHN0ZGxpYi5MaXN0KHsiYzpcXHdpbmRvd3NcXHN5c3RlbTMyXFxldmlsLmV4ZSJ9KSwgZW52X3ZhcnMpCiAgICBydW5fdGVzdCgiZXZpbC5leGUgL2FyZyBldmlsLmRsbCIsIHN0ZGxpYi5MaXN0KHsiZXZpbC5leGUiLCAiZXZpbC5kbGwifSksIGVudl92YXJzKQogICAgcnVuX3Rlc3QoImV2aWwuZXhlIC9hcmcgXCJjOlxcdGVtcFxcZXZpbC5kbGxcIiIsIHN0ZGxpYi5MaXN0KHsiZXZpbC5leGUiLCAiYzpcXHRlbXBcXGV2aWwuZGxsIn0pLCBlbnZfdmFycykKICAgIHJ1bl90ZXN0KCIlU3lzdGVtUm9vdCVcXFN5c3RlbTMyXFxldmlsLmV4ZSAvYXJnOjkwIC9hcmcyIiwgc3RkbGliLkxpc3QoeyJjOlxcd2luZG93c1xcc3lzdGVtMzJcXGV2aWwuZXhlIn0pLCBlbnZfdmFycykKICAgIHJ1bl90ZXN0KCdDOlxcV2luZG93c1xcU3lzV09XNjRcXG1zaHRhLmV4ZSAiJTEiICUqJywgc3RkbGliLkxpc3QoeyJDOlxcV2luZG93c1xcU3lzV09XNjRcXG1zaHRhLmV4ZSJ9KSwgZW52X3ZhcnMpCgogICAgLS0gbWlzY2VsbGFuZW91cyB0ZXN0cwogICAgcnVuX3Rlc3QoInJlZyBpbXBvcnQgXCJjOlxcdGVtcFxcZXZpbC5yZWdcIiIsIHN0ZGxpYi5MaXN0KHsicmVnLmV4ZSIsICJjOlxcdGVtcFxcZXZpbC5yZWcifSksIGVudl92YXJzKQogICAgcnVuX3Rlc3QoImNzY3JpcHQuZXhlIFwiYzpcXHByb2dyYW0gZmlsZXMgKHg4NilcXGV2aWwudmJzXCIiLCBzdGRsaWIuTGlzdCh7ImNzY3JpcHQuZXhlIiwgImM6XFxwcm9ncmFtIGZpbGVzICh4ODYpXFxldmlsLnZicyJ9KSwgZW52X3ZhcnMpCiAgICBydW5fdGVzdCgiQzpcXFByb2dyYW0gRmlsZXMgXCh4ODZcKVxcZXZpbC5leGUiLCBzdGRsaWIuTGlzdCh7IkM6XFxQcm9ncmFtIEZpbGVzIFwoeDg2XClcXGV2aWwuZXhlIn0pLCBlbnZfdmFycykKICAgIHJ1bl90ZXN0KCImcXVvdDslUHJvZ3JhbUZpbGVzKHg4NiklXFxldmlsLmV4ZSZxdW90OyBmdW5jdGlvbiIsIHN0ZGxpYi5MaXN0KHsiQzpcXFByb2dyYW0gRmlsZXMgXCh4ODZcKVxcZXZpbC5leGUifSksIGVudl92YXJzKQoKZW5kCmRlYnVnLmVuYWJsZV9zdGRvdXQgPSBmYWxzZQotLXV0aWxzLnRlc3RfY29tbWFuZF9saW5lX3BhcnNlcigpCgoKQXBwQ29tcGF0ID0ge30KCkFwcENvbXBhdC5jZXJ0X2lzc3Vlcl93aGl0ZWxpc3QgPSB7fSAgICAtLSBvcHRpb25hbGx5IHdoaXRlbGlzdCBjZXJ0IGlzc3VlcnMKQXBwQ29tcGF0LmNlcnRfc3ViamVjdF93aGl0ZWxpc3QgPSB7fSAgIC0tIG9wdGlvbmFsbHkgd2hpdGVsaXN0IGNlcnQgc3ViamVjdHMKQXBwQ29tcGF0LnByb2Nlc3NlZF9wYXRocyA9IHt9ICAgICAgICAgIC0tIGxpc3Qgb2YgZmlsZSBwYXRocyBwcm9jZXNzZWQgYnkgYXVkaXQKQXBwQ29tcGF0LmluY2x1ZGVfZmlsZV9kZXRhaWxzID0gZmFsc2UgIC0tIHByb3ZpZGUgYWJpbGl0eSB0byBkaXNhYmxlIGZpbGUgZGV0YWlsIGNvbGxlY3Rpb24KQXBwQ29tcGF0LnBhcnNlX2FsbF9jdHJsX3NldHMgPSBmYWxzZSAgIC0tIHByb3ZpZGUgYWJpbGl0eSB0byBwYXJzZSBhbGwgY29udHJvbCBzZXRzCiAgICAgICAgICAgICAgICAgICAgICAKQXBwQ29tcGF0LkNvbmZpZyA9IHt9CkFwcENvbXBhdC5Db25maWcuQVJDSElURUNUVVJFX1JFRyA9IHsKICAgIHBhdGggPSAiSEtMTVxcU1lTVEVNXFxDdXJyZW50Q29udHJvbFNldFxcQ29udHJvbFxcU2Vzc2lvbiBNYW5hZ2VyXFxFbnZpcm9ubWVudCIsCiAgICBrZXkgPSAiUFJPQ0VTU09SX0FSQ0hJVEVDVFVSRSIKfQpBcHBDb21wYXQuQ29uZmlnLldJTkRPV1NfVkVSU0lPTl9SRUcgPSB7CiAgICBwYXRoID0gIkhLTE1cXFNvZnR3YXJlXFxNaWNyb3NvZnRcXFdpbmRvd3MgTlRcXEN1cnJlbnRWZXJzaW9uIiwKICAgIGtleSA9ICJDdXJyZW50VmVyc2lvbiIKfQoKQXBwQ29tcGF0LkNvbmZpZy5XSU5ET1dTX1ZFUlNJT05TID0gewogICAgWyI1LjAiXSAgPSAiMjAwMCIsIC0tIG5vdCBzdXBwb3J0ZWQgYnkgdGhpcyBzY3JpcHQKICAgIFsiNS4xIl0gID0gIlhQIiwKICAgIFsiNS4yIl0gID0gIlhQNjQvMjAwMyIsCiAgICBbIjYuMCJdICA9ICJWaXN0YS8yMDA4IiwKICAgIFsiNi4xIl0gID0gIjcvMjAwOFIyIiwKICAgIFsiNi4yIl0gID0gIjgvMjAxMiIsCiAgICBbIjYuMyJdICA9ICI4LjEvMjAxMlIyIiwKICAgIFsiMTAuMCJdID0gIjEwIiwKfQoKQXBwQ29tcGF0LkNvbmZpZy5BUFBDT01QQVRfSElWRVMgPSB7CgogICAgLS0gaGl2ZSBsb2NhdGlvbiBhbmQgYSBmcmllbmRseSBuYW1lCiAgICBoaXZlcyA9IHt7IkhLTE1cXFNZU1RFTVxcQ3VycmVudENvbnRyb2xTZXRcXENvbnRyb2xcXFNlc3Npb24gTWFuYWdlclxcIiwgIkN1cnJlbnQifSwKICAgICAgICAgICAgIHsiSEtMTVxcU1lTVEVNXFxDb250cm9sU2V0MDAxXFxDb250cm9sXFxTZXNzaW9uIE1hbmFnZXJcXCIsICAgICAiMDAxIn0sCiAgICAgICAgICAgICB7IkhLTE1cXFNZU1RFTVxcQ29udHJvbFNldDAwMlxcQ29udHJvbFxcU2Vzc2lvbiBNYW5hZ2VyXFwiLCAgICAgIjAwMiJ9LAogICAgICAgICAgICAgeyJIS0xNXFxTWVNURU1cXENvbnRyb2xTZXQwMDNcXENvbnRyb2xcXFNlc3Npb24gTWFuYWdlclxcIiwgICAgICIwMDMifSwKICAgICAgICAgICAgIH0sCgogICAgWFAgPSB7CiAgICAgICAgcmVnX2tleSA9ICJBcHBDb21wYXRpYmlsaXR5IiwKICAgICAgICByZWdfdmFsID0gIkFwcENvbXBhdENhY2hlIiwKICAgIH0sCgogICAgVmlzdGEgPSB7CiAgICAgICAgcmVnX2tleSA9ICJBcHBDb21wYXRDYWNoZSIsCiAgICAgICAgcmVnX3ZhbCA9ICJBcHBDb21wYXRDYWNoZSIsCiAgICB9Cn0KCi0tLQotLSBpc18zMl9iaXQoKQotLSBDaGVjayBpZiB0aGUgV2luZG93cyBPUyBpcyAzMiBiaXRzIG9yIDY0IGJpdHMgYnkgY2hlY2tpbmcgdGhlIHJlZ2lzdHkKLS0gQHRvZG8gTWF5IG5lZWQgdG8gY2hlY2sgb24gUFJPQ0VTU09SX0FSQ0hJVEVXNjQzMiBhcyBwZXIgaHR0cDovL2Jsb2dzLm1zZG4uY29tL2IvZGF2aWQud2FuZy9hcmNoaXZlLzIwMDYvMDMvMjYvaG93dG8tZGV0ZWN0LXByb2Nlc3MtYml0bmVzcy5hc3B4Ci0tIEByZXR1cm4gdHJ1ZSBpZiBzeXN0ZW0gaXMgMzIgYml0cyAKZnVuY3Rpb24gQXBwQ29tcGF0LmlzXzMyX2JpdCgpCiAgbG9jYWwga2V5ID0gc3RkbGliLlJlZ2lzdHJ5S2V5KEFwcENvbXBhdC5Db25maWcuQVJDSElURUNUVVJFX1JFRy5wYXRoKQogIGxvY2FsIHZhbHVlID0ga2V5LnZhbHVlKEFwcENvbXBhdC5Db25maWcuQVJDSElURUNUVVJFX1JFRy5rZXkpCiAgaWYgc3RyaW5nLm1hdGNoKHZhbHVlLlRleHQ6bG93ZXIoKSwgIng4NiIpIHRoZW4gCiAgICByZXR1cm4gdHJ1ZQogIGVsc2UgCiAgICByZXR1cm4gZmFsc2UgCiAgZW5kCmVuZAoKLS0tCi0tIGdldF9vcygpCi0tIEdldCB0aGUgV2luZG93cyBPcGVyYXRpbmcgU3lzdGVtIHZlcnNpb24KLS0gQHJldHVybiBzdHJpbmcgQ3VycmVudCBvcGVyYXRpbmcgc3lzdGVtCi0tIEBzZWUgQXBwQ29tcGF0LkNvbmZpZy5XSU5ET1dTX1ZFUlNJT05TCmZ1bmN0aW9uIEFwcENvbXBhdC5nZXRfb3MoKQogIGxvY2FsIGtleSA9IHN0ZGxpYi5SZWdpc3RyeUtleShBcHBDb21wYXQuQ29uZmlnLldJTkRPV1NfVkVSU0lPTl9SRUcucGF0aCkKICBsb2NhbCB2YWx1ZSA9IGtleS52YWx1ZShBcHBDb21wYXQuQ29uZmlnLldJTkRPV1NfVkVSU0lPTl9SRUcua2V5KQogIAogIGlmIEFwcENvbXBhdC5Db25maWcuV0lORE9XU19WRVJTSU9OU1t2YWx1ZS5UZXh0XSA9PSBuaWwgdGhlbiAKICAgIHJldHVybiBuaWwKICBlbHNlIAogICAgcmV0dXJuIEFwcENvbXBhdC5Db25maWcuV0lORE9XU19WRVJTSU9OU1t2YWx1ZS5UZXh0XQogIGVuZAplbmQKCi0tIFByb3ZpZGVzIGEgYmFzaWMgaXRlcmF0b3IgZm9yIHRoZSBzdXBwbGllZCB2YWx1ZXMKLS0gR2lzdCBmcm9tIGh0dHBzOi8vZ2lzdC5naXRodWIuY29tL0dsb3J5RmlzaC83NDA3NTAKZnVuY3Rpb24gQXBwQ29tcGF0LnJhbmdlKG51bWEsIG51bWIsIHN0ZXApCiAgYXNzZXJ0KG51bWEgPCBudW1iLCAnRmlyc3QgcGFyYW1ldGVyIG11c3QgYmUgbGVzcyB0aGFuIHNlY29uZCBwYXJhbWV0ZXIuJykKICAKICBpZiAoc3RlcCA9PSBuaWwpIHRoZW4KICAgIHN0ZXAgPSAxCiAgZW5kCiAgCiAgYXNzZXJ0KHN0ZXAgPiAwLCAnU3RlcCBwYXJhbWV0ZXIgbXVzdCBiZSBwb3NpdGl2ZS4nKQogCiAgbG9jYWwgaSA9IG51bWEKICAKICByZXR1cm4gZnVuY3Rpb24oKQogICAgbG9jYWwgcmV0ID0gaQogICAgaSA9IGkgKyBzdGVwCiAgICBpZiByZXQgPD0gbnVtYiB0aGVuCiAgICAgIHJldHVybiByZXQKICAgIGVuZCAKICBlbmQKZW5kCgotLS0KLS0gZ2V0X2FwcGNvbXBhdF9kYXRhKHJlZ19rZXksIHJlZ192YWwpCi0tIEdldCB0aGUgQXBwQ29tcGF0IGJpbmFyeSBkYXRhIHN0b3JlZCBpbiB0aGUgc3BlY2lmaWVkIHJlZ2lzdHJ5IGtleS92YWx1ZQotLSBAcmV0dXJuIHN0cmluZyBUaGUgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBiaW5hcnkgQXBwQ29tcGF0IGRhdGEgc3RvcmVkIGluIHRoZSByZWdpc3RyeQotLQpBcHBDb21wYXQuZ2V0X2FwcGNvbXBhdF9kYXRhID0gZnVuY3Rpb24ocmVnX2tleSwgcmVnX3ZhbCkKICAgIAogICAgbG9jYWwga2V5ID0gc3RkbGliLlJlZ2lzdHJ5S2V5KHJlZ19rZXkpCiAgICBpZiBub3Qga2V5IHRoZW4gCiAgICAgIHJldHVybiBuaWwKICAgIGVuZAoKICAgIGxvY2FsIHZhbHVlID0ga2V5LnZhbHVlKHJlZ192YWwpCiAgICBpZiBub3QgdmFsdWUgdGhlbgogICAgICByZXR1cm4gbmlsIAogICAgZW5kCiAgICAKICAgIHJldHVybiB0b3N0cmluZyh2YWx1ZS5WYWx1ZSkKZW5kCgotLS0KLS0gZ2V0X2NhY2hlX2VudHJ5X250XzZfMjQoYmxvY2ssIGJsb2NrX2xlbiwgbWFnaWMpCi0tIFBhcnNlIFdpbmRvd3MgMTAgYXBwY29tcGF0IGVudHJpZXMuIEVhY2ggZW50cnkgaW5jbHVkZXMgdGhlIGZvbGxvd2luZyBmaWVsZDoKLS0gCi0tICAgcGF0aCAtIGZpbGUgcGF0aAotLSAgIHNlcXVlbmNlIC0gc2VxdWVuY2UgaW4gdGhlIGNhY2hlICgxLCAyLCAzLi4uKQotLSAgIGV4ZWNfZmxhZyAtIGV4ZWN1dGlvbiBmbGFnCi0tICAgbGFzdF9tb2RfdGltZSAtIGxhc3QgbW9kaWZpZWQgdGltZQotLQotLSBAcmV0dXJuIHN0ZGxpYi5MaXN0IExpc3Qgb2YgYXBwY29tcGF0IGVudHJpZXMKLS0KZnVuY3Rpb24gQXBwQ29tcGF0LmdldF9jYWNoZV9lbnRyeV9udF82XzQoYmxvY2ssIGJsb2NrX2xlbikKCiAgLS0gVmFsdWVzIHVzZWQgYnkgV2luZG93cyBOVCA2LjQgKFdpbjEwKQogIGxvY2FsIE1BR0lDICAgICAgICAgICAgPSAweDczNzQzMDMxCiAgbG9jYWwgT0ZGU0VUX1NUQVRTICAgICA9IDB4MzAKICBsb2NhbCBPRkZTRVRfTUFHSUNfSERSID0gMHgwMAogIGxvY2FsIE9GRlNFVF9DUkMzMl9IRFIgPSAweDA0CiAgbG9jYWwgT0ZGU0VUX0VOVFJZX0xFTiA9IDB4MDgKICBsb2NhbCBPRkZTRVRfUEFUSF9MRU4gID0gMHgwQwogIGxvY2FsIE9GRlNFVF9QQVRIICAgICAgPSAweDBFCiAgLS0gb2Zmc2V0IGlzIGFkanVzdGVkIGJlbG93IHRvIGluY29ycG9yYXRlIGFyYml0cmFyeSBwYXRoIGxlbmd0aAogIGxvY2FsIE9GRlNFVF9MT1dfREFURSAgPSAweDAwCiAgbG9jYWwgT0ZGU0VUX0hJR0hfREFURSA9IDB4MDQKCiAgbG9jYWwgZW50cmllcyA9IHN0ZGxpYi5MaXN0KCkKCiAgbG9jYWwgc3lzdGVtX3ZvbHVtZSA9IHN0ZGxpYi5FbnYudmFyaWFibGVzKClbIlN5c3RlbURyaXZlIl0KCiAgbG9jYWwgb2Zmc2V0ID0gT0ZGU0VUX1NUQVRTCiAgbG9jYWwgc2VxdWVuY2UgPSAxCiAgCiAgd2hpbGUgb2Zmc2V0IDwgYmxvY2tfbGVuIGRvCgogICAgLS0gZmlyc3QgMHhDIGJ5dGVzIGNvbnRhaW4gZW50cnkgaGVhZGVyIGluZm9ybWF0aW9uCiAgICBsb2NhbCBtYWdpY19oZHIgPSBibG9jay5yZWFkX2R3b3JkKG9mZnNldCArIE9GRlNFVF9NQUdJQ19IRFIpCiAgICBsb2NhbCBjcmMzMl9oYXNoID0gYmxvY2sucmVhZF9kd29yZChvZmZzZXQgKyBPRkZTRVRfQ1JDMzJfSERSKQogICAgbG9jYWwgZW50cnlfbGVuID0gYmxvY2sucmVhZF9kd29yZChvZmZzZXQgKyBPRkZTRVRfRU5UUllfTEVOKQogICAgCiAgICBpZiBtYWdpY19oZHIgfj0gTUFHSUMgdGhlbgogICAgICBkZWJ1Zy5kZWJ1ZygiSW52YWxpZCBlbnRyeSBtYWdpYyBoZWFkZXIgJyIgLi4gc3RyaW5nLmZvcm1hdCgnJTA0eCcsIG1hZ2ljX2hkcikgLi4gICInOyBleHBlY3RlZCAnIiAuLiBzdHJpbmcuZm9ybWF0KCclMDR4JywgTUFHSUMpIC4uICAiJyIpCiAgICAgIGJyZWFrCiAgICBlbmQKICAgIAogICAgLS0gaXQgaXMgdW5jb25maXJtZWQgdGhhdCB0aGUgYXBwY29tcGF0IHBhdGggbGVuZ3RoIGNvdWxkIGluIGZhY3QgYmUgCiAgICAtLSB0aGUgbWF4IFVOQyBwYXRoIGxlbmd0aCAoMzJLKTsgaG93ZXZlciwgc29tZSB2YWxpZGF0aW9uIG9mIHRoZSAKICAgIC0tIGVudHJ5IGFuZCBwYXRoIGxlbmd0aHMgaXMgd2FycmFudGVkIGhlcmUgc28gd2UgY2hvb3NlIDMySwogICAgaWYgZW50cnlfbGVuID4gMzI3NjggdGhlbgogICAgICBkZWJ1Zy5kZWJ1ZygiSW52YWxpZCBlbnRyeSBsZW5ndGg6ICciIC4uIGVudHJ5X2xlbikKICAgICAgYnJlYWsKICAgIGVuZAoKICAgIGxvY2FsIHBhdGhfbGVuID0gYmxvY2sucmVhZF93b3JkKG9mZnNldCArIE9GRlNFVF9QQVRIX0xFTiwgMikKICAgIGlmIHBhdGhfbGVuID4gMzI3NjggdGhlbgogICAgICBkZWJ1Zy5kZWJ1ZygiSW52YWxpZCBlbnRyeSBwYXRoIGxlbmd0aDogJyIgLi4gcGF0aF9sZW4pCiAgICAgIGJyZWFrCiAgICBlbmQKCiAgICBsb2NhbCBwYXRoID0gYmxvY2sucmVhZF91dGYxNl9sZShvZmZzZXQgKyBPRkZTRVRfUEFUSCwgcGF0aF9sZW4pCiAgICBpZiBwYXRoIH49IG5pbCB0aGVuCiAgICAgIHBhdGggPSBwYXRoOmdzdWIoJ1NZU1ZPTCcsIHN5c3RlbV92b2x1bWUpCiAgICBlbHNlCiAgICAgIGRlYnVnLmRlYnVnKCJVbmFibGUgdG8gcmVhZCBlbnRyeSBwYXRoIikKICAgICAgYnJlYWsKICAgIGVuZAoKICAgIGxvY2FsIHBhdGhfb2Zmc2V0ID0gb2Zmc2V0ICsgT0ZGU0VUX1BBVEggKyBwYXRoX2xlbgogICAgbG9jYWwgbG93X2RhdGVfdGltZSAgPSBibG9jay5yZWFkX2R3b3JkKHBhdGhfb2Zmc2V0ICsgT0ZGU0VUX0xPV19EQVRFKQogICAgbG9jYWwgaGlnaF9kYXRlX3RpbWUgPSBibG9jay5yZWFkX2R3b3JkKHBhdGhfb2Zmc2V0ICsgT0ZGU0VUX0hJR0hfREFURSkKCiAgICAtLSBhbiBlcnJvciB3aWxsIG9jY3VyIGlmIHRoZSBkYXRlIGlzIGJlZm9yZSBKYW4uIDEsIDIwMDAgKHBhcnNlX2ZpbGV0aW1lIG9ubHkgc3VwcG9ydHMgMS8xLzIwMDArKQogICAgbG9jYWwgbGFzdF9tb2RfdGltZSA9IGJsb2NrLnBhcnNlX2ZpbGV0aW1lKGhpZ2hfZGF0ZV90aW1lLCBsb3dfZGF0ZV90aW1lKQogICAgaWYgbGFzdF9tb2RfdGltZSB+PSBuaWwgdGhlbgogICAgICBsYXN0X21vZF90aW1lID0gbGFzdF9tb2RfdGltZS5pc29mb3JtYXQoKQogICAgIAogICAgICBsb2NhbCBlbnRyeSA9IHt9CiAgICAgIGVudHJ5LnBhdGggPSBwYXRoCiAgICAgIGVudHJ5LmV4ZWNfZmxhZyA9ICcnCiAgICAgIGVudHJ5LmZpbGVfc2l6ZSA9ICcnCiAgICAgIGVudHJ5LnNlcXVlbmNlID0gc2VxdWVuY2UKICAgICAgZW50cnkubGFzdF9tb2RfdGltZSA9IGxhc3RfbW9kX3RpbWUKICAgICAgZW50cnkubGFzdF91cGRhdGVkX3RpbWUgPSAnJwogICAgICAKICAgICAgZW50cmllcy5hcHBlbmQoZW50cnkpCiAgICAgIHNlcXVlbmNlID0gc2VxdWVuY2UgKyAxCiAgICAgIAogICAgICBkZWJ1Zy5kZWJ1ZygiZW50cnkucGF0aCAgICAgICAgIDogIiAuLiBlbnRyeS5wYXRoKQogICAgICBkZWJ1Zy5kZWJ1ZygiZW50cnkuc2VxdWVuY2UgICAgIDogIiAuLiBlbnRyeS5zZXF1ZW5jZSkKICAgICAgZGVidWcuZGVidWcoImVudHJ5LmV4ZWNfZmxhZyAgICA6ICIgLi4gdG9zdHJpbmcoZW50cnkuZXhlY19mbGFnKSkKICAgICAgZGVidWcuZGVidWcoImVudHJ5LmZpbGVfc2l6ZSAgICA6ICIgLi4gdG9zdHJpbmcoZW50cnkuZmlsZV9zaXplKSkKICAgICAgZGVidWcuZGVidWcoImVudHJ5Lmxhc3RfbW9kX3RpbWU6ICIgLi4gdG9zdHJpbmcoZW50cnkubGFzdF9tb2RfdGltZSkpCiAgICAgIGRlYnVnLmRlYnVnKCJlbnRyeS5sYXN0X3VwZF90aW1lOiAiIC4uIHRvc3RyaW5nKGVudHJ5Lmxhc3RfdXBkYXRlZF90aW1lKSkKICAgICAgZGVidWcuZGVidWcoIiIpCgogICAgZWxzZQogICAgICAtLSBza2lwIHRoZSB1bnJlY29nbml6ZWQgTWljcm9zb2Z0IEFwcCBlbnRyeSBmb3JtYXQgZm9yIG5vdwogICAgICBkZWJ1Zy5kZWJ1ZygiU2tpcHBpbmcgZW50cnk6ICIgLi4gcGF0aCkKICAgIGVuZAoKICAgIC0tIGluY3JlbWVudCB0byB0aGUgbmV4dCBlbnRyeSBpbiB0aGUgY2FjaGU7IGFkZCB0aGUgbGVuZ3RoIG9mIHRoZQogICAgLS0gZW50cnkgaGVhZGVyIGZpZWxkcyAoT0ZGU0VUX1BBVEhfTEVOKSBwbHVzIHRoZSBsZW5ndGggb2YgdGhlIGVudHJ5CiAgICBvZmZzZXQgPSBvZmZzZXQgKyBPRkZTRVRfUEFUSF9MRU4gKyBlbnRyeV9sZW4KCiAgZW5kCiAgcmV0dXJuIGVudHJpZXMKZW5kCgotLQotLSB3cmFwcGVyIGZ1bmN0aW9uIHRvIGludm9rZSBnZXRfY2FjaGVfZW50cnlfbnRfNl8yMyB3aXRoIGNvcnJlY3QgbWFnaWMgdmFsdWUKLS0KZnVuY3Rpb24gQXBwQ29tcGF0LmdldF9jYWNoZV9lbnRyeV9udF82XzIoYmxvY2ssIGJsb2NrX2xlbikKICBsb2NhbCBNQUdJQyA9IDB4NzM3NDMwMzAKICByZXR1cm4gQXBwQ29tcGF0LmdldF9jYWNoZV9lbnRyeV9udF82XzIzKGJsb2NrLCBibG9ja19sZW4sIE1BR0lDKQplbmQKCi0tCi0tIHdyYXBwZXIgZnVuY3Rpb24gdG8gaW52b2tlIGdldF9jYWNoZV9lbnRyeV9udF82XzIzIHdpdGggY29ycmVjdCBtYWdpYyB2YWx1ZQotLQpmdW5jdGlvbiBBcHBDb21wYXQuZ2V0X2NhY2hlX2VudHJ5X250XzZfMyhibG9jaywgYmxvY2tfbGVuKQogIGxvY2FsIE1BR0lDID0gMHg3Mzc0MzAzMQogIHJldHVybiBBcHBDb21wYXQuZ2V0X2NhY2hlX2VudHJ5X250XzZfMjMoYmxvY2ssIGJsb2NrX2xlbiwgTUFHSUMpCmVuZAoKLS0tCi0tIGdldF9jYWNoZV9lbnRyeV9udF82XzIzKGJsb2NrLCBibG9ja19sZW4sIG1hZ2ljKQotLSBQYXJzZSBXaW5kb3dzIDgvOC4xIGFwcGNvbXBhdCBlbnRyaWVzLiBFYWNoIGVudHJ5IGluY2x1ZGVzIHRoZSBmb2xsb3dpbmcgZmllbGQ6Ci0tIAotLSAgIHBhdGggLSBmaWxlIHBhdGgKLS0gICBzZXF1ZW5jZSAtIHNlcXVlbmNlIGluIHRoZSBjYWNoZSAoMSwgMiwgMy4uLikKLS0gICBleGVjX2ZsYWcgLSBleGVjdXRpb24gZmxhZwotLSAgIGxhc3RfbW9kX3RpbWUgLSBsYXN0IG1vZGlmaWVkIHRpbWUKLS0KLS0gQHJldHVybiBzdGRsaWIuTGlzdCBMaXN0IG9mIGFwcGNvbXBhdCBlbnRyaWVzCi0tCmZ1bmN0aW9uIEFwcENvbXBhdC5nZXRfY2FjaGVfZW50cnlfbnRfNl8yMyhibG9jaywgYmxvY2tfbGVuLCBtYWdpYykKCiAgbG9jYWwgQ1NSU1NfRkxBRyA9IDB4MgogIGxvY2FsIE9GRlNFVF9TVEFUUyAgICAgPSAweDgwCiAgbG9jYWwgT0ZGU0VUX01BR0lDX0hEUiA9IDB4MDAKICBsb2NhbCBPRkZTRVRfQ1JDMzJfSERSID0gMHgwNAogIGxvY2FsIE9GRlNFVF9FTlRSWV9MRU4gPSAweDA4CiAgbG9jYWwgT0ZGU0VUX1BBVEhfTEVOICA9IDB4MEMKICBsb2NhbCBPRkZTRVRfUEFUSCAgICAgID0gMHgwRQoKICAtLSBvZmZzZXQgaXMgYWRqdXN0ZWQgYmVsb3cgdG8gaW5jb3Jwb3JhdGUgYXJiaXRyYXJ5IHBhdGggbGVuZ3RoCiAgbG9jYWwgT0ZGU0VUX0ZMQUdTICAgICA9IDB4MDAKICBsb2NhbCBPRkZTRVRfVU5LMSAgICAgID0gMHgwNAogIGxvY2FsIE9GRlNFVF9MT1dfREFURSAgPSAweDA4CiAgbG9jYWwgT0ZGU0VUX0hJR0hfREFURSA9IDB4MEMKICBsb2NhbCBPRkZTRVRfVU5LMiAgICAgID0gMHgxMAoKICBsb2NhbCBlbnRyaWVzID0gc3RkbGliLkxpc3QoKQoKICBsb2NhbCBzeXN0ZW1fdm9sdW1lID0gc3RkbGliLkVudi52YXJpYWJsZXMoKVsiU3lzdGVtRHJpdmUiXQoKICBsb2NhbCBvZmZzZXQgPSBPRkZTRVRfU1RBVFMKICBsb2NhbCBzZXF1ZW5jZSA9IDEKICAKICB3aGlsZSBvZmZzZXQgPCBibG9ja19sZW4gZG8KCiAgICAtLSBmaXJzdCAweEMgYnl0ZXMgY29udGFpbiBlbnRyeSBoZWFkZXIgaW5mb3JtYXRpb24KICAgIGxvY2FsIG1hZ2ljX2hkciA9IGJsb2NrLnJlYWRfZHdvcmQob2Zmc2V0ICsgT0ZGU0VUX01BR0lDX0hEUikKICAgIGxvY2FsIGNyYzMyX2hhc2ggPSBibG9jay5yZWFkX2R3b3JkKG9mZnNldCArIE9GRlNFVF9DUkMzMl9IRFIpCiAgICBsb2NhbCBlbnRyeV9sZW4gPSBibG9jay5yZWFkX2R3b3JkKG9mZnNldCArIE9GRlNFVF9FTlRSWV9MRU4pCiAgICAKICAgIGlmIG1hZ2ljX2hkciB+PSBtYWdpYyB0aGVuCiAgICAgIGRlYnVnLmRlYnVnKCJJbnZhbGlkIGVudHJ5IG1hZ2ljIGhlYWRlciAnIiAuLiBzdHJpbmcuZm9ybWF0KCclMDR4JywgbWFnaWNfaGRyKSAuLiAgIic7IGV4cGVjdGVkICciIC4uIHN0cmluZy5mb3JtYXQoJyUwNHgnLCBtYWdpYykgLi4gICInIikKICAgICAgYnJlYWsKICAgIGVuZAogICAgCiAgICBpZiBlbnRyeV9sZW4gPiAzMjc2OCB0aGVuCiAgICAgIGRlYnVnLmRlYnVnKCJJbnZhbGlkIGVudHJ5IGxlbmd0aDogJyIgLi4gZW50cnlfbGVuKQogICAgICBicmVhawogICAgZW5kCgogICAgbG9jYWwgcGF0aF9sZW4gPSBibG9jay5yZWFkX3dvcmQob2Zmc2V0ICsgT0ZGU0VUX1BBVEhfTEVOLCAyKQogICAgaWYgcGF0aF9sZW4gPiAzMjc2OCB0aGVuCiAgICAgIGRlYnVnLmRlYnVnKCJJbnZhbGlkIGVudHJ5IHBhdGggbGVuZ3RoOiAnIiAuLiBwYXRoX2xlbikKICAgICAgYnJlYWsKICAgIGVuZAoKICAgIC0tZGVidWcuZGVidWcoIlBhdGggbGVuZ3RoOiAiIC4uIHN0cmluZy5mb3JtYXQoJyUwNHgnLCBwYXRoX2xlbikpCgogICAgbG9jYWwgcGF0aCA9IGJsb2NrLnJlYWRfdXRmMTZfbGUob2Zmc2V0ICsgT0ZGU0VUX1BBVEgsIHBhdGhfbGVuKQogICAgaWYgcGF0aCB+PSBuaWwgdGhlbgogICAgICBpZiBwYXRoID09ICcnIHRoZW4KICAgICAgICBwYXRoID0gJ04vQScKICAgICAgZWxzZQogICAgICAgIHBhdGggPSBwYXRoOmdzdWIoJ1NZU1ZPTCcsIHN5c3RlbV92b2x1bWUpCiAgICAgIGVuZAogICAgZWxzZQogICAgICBkZWJ1Zy5kZWJ1ZygiVW5hYmxlIHRvIHJlYWQgZW50cnkgcGF0aCIpCiAgICAgIGJyZWFrCiAgICBlbmQKCiAgICBwYXRoX29mZnNldCA9IG9mZnNldCArIE9GRlNFVF9QQVRIICsgcGF0aF9sZW4KICAgIAogICAgZGVidWcuZGVidWcoIkFmdGVyIHBhdGggb2Zmc2V0OiAiIC4uIHN0cmluZy5mb3JtYXQoJyUwNHgnLCBwYXRoX29mZnNldCkpCiAgICAKICAgIC0tIHNraXAgb3ZlciBwYWNrYWdlIHZhbHVlCiAgICBsb2NhbCBwa2dfbGVuID0gYmxvY2sucmVhZF93b3JkKHBhdGhfb2Zmc2V0KQogICAgcGF0aF9vZmZzZXQgPSBwYXRoX29mZnNldCArIDIgICAgICAgLS0gaW5jcmVtZW50IGZvciBwYWNrYWdlIGxlbmd0aCAoMiBieXRlcykKICAgIHBhdGhfb2Zmc2V0ID0gcGF0aF9vZmZzZXQgKyBwa2dfbGVuIC0tIGluY3JlbWVudCBmb3IgcGFja2FnZSAobGVuZ3RoIGlzIHVzdWFsbHkgMCkKCiAgICAtLSByZWFkIGV4ZWN1dGlvbiBmbGFnIGFuZCBjaGVjayBhZ2FpbnQgQ1NSU1NfRkxBRwogICAgbG9jYWwgZmxhZ3MgPSBibG9jay5yZWFkX2R3b3JkKHBhdGhfb2Zmc2V0ICsgT0ZGU0VUX0ZMQUdTKQogICAgbG9jYWwgZXhlY19mbGFnID0gZmFsc2UKICAgIGlmIGJpbmFyeXBhcnNlci5iYW5kKGZsYWdzLCBDU1JTU19GTEFHKSA9PSAyIHRoZW4KICAgICAgZXhlY19mbGFnID0gdHJ1ZQogICAgZW5kICAgIAoKICAgIC0tIGlnbm9yZSBVTksxIGZpZWxkCiAgICAtLWxvY2FsIHVuazEgID0gYmxvY2sucmVhZF9kd29yZChwYXRoX29mZnNldCArIE9GRlNFVF9VTksxKQoKICAgIC0tIHBhcnNlIGxhc3QgbW9kaWZpZWQgZGF0ZS90aW1lCiAgICBsb2NhbCBsb3dfZGF0ZV90aW1lICA9IGJsb2NrLnJlYWRfZHdvcmQocGF0aF9vZmZzZXQgKyBPRkZTRVRfTE9XX0RBVEUpCiAgICBsb2NhbCBoaWdoX2RhdGVfdGltZSA9IGJsb2NrLnJlYWRfZHdvcmQocGF0aF9vZmZzZXQgKyBPRkZTRVRfSElHSF9EQVRFKQoKICAgIC0tYW4gZXJyb3Igd2lsbCBvY2N1ciBpZiB0aGUgZGF0ZSBpcyBiZWZvcmUgSmFuLiAxLCAyMDAwIChwYXJzZV9maWxldGltZSBvbmx5IHN1cHBvcnRzIDEvMS8yMDAwKykKICAgIGxvY2FsIGxhc3RfbW9kX3RpbWUgPSBibG9jay5wYXJzZV9maWxldGltZShoaWdoX2RhdGVfdGltZSwgbG93X2RhdGVfdGltZSkKICAgIGlmIGxhc3RfbW9kX3RpbWUgfj0gbmlsIHRoZW4KICAgICAgbGFzdF9tb2RfdGltZSA9IGxhc3RfbW9kX3RpbWUuaXNvZm9ybWF0KCkKICAgIGVuZAoKICAgIC0tIGlnbm9yZSBVTksyIGZpZWxkCiAgICAtLWxvY2FsIHVuazIgID0gYmxvY2sucmVhZF9kd29yZChwYXRoX29mZnNldCArIE9GRlNFVF9VTksyKQoKICAgIC0tIGluY3JlbWVudCBvZmZzZXQgYWZ0ZXIgVU5LMiBmaWVsZCBmb3IgbmV4dCBpdGVyYXRpb24gb2YgbG9vcAogICAgLS1vZmZzZXQgPSBvZmZzZXQgKyBPRkZTRVRfVU5LMiArIDQKCiAgICAtLSBpbmNyZW1lbnQgdG8gdGhlIG5leHQgZW50cnkgaW4gdGhlIGNhY2hlOyBhZGQgdGhlIGxlbmd0aCBvZiB0aGUKICAgIC0tIGVudHJ5IGhlYWRlciBmaWVsZHMgKE9GRlNFVF9QQVRIX0xFTikgcGx1cyB0aGUgbGVuZ3RoIG9mIHRoZSBlbnRyeQogICAgb2Zmc2V0ID0gb2Zmc2V0ICsgT0ZGU0VUX1BBVEhfTEVOICsgZW50cnlfbGVuCiAgICBkZWJ1Zy5kZWJ1ZygiTmV4dCBlbnRyeSBvZmZzZXQ6ICIgLi4gc3RyaW5nLmZvcm1hdCgnJTA0eCcsIG9mZnNldCkpCgogICAgbG9jYWwgZW50cnkgPSB7fQogICAgZW50cnkucGF0aCA9IHBhdGgKICAgIGVudHJ5LmV4ZWNfZmxhZyA9IGV4ZWNfZmxhZwogICAgZW50cnkuZmlsZV9zaXplID0gJycKICAgIGVudHJ5LnNlcXVlbmNlID0gc2VxdWVuY2UKICAgIGVudHJ5Lmxhc3RfbW9kX3RpbWUgPSBsYXN0X21vZF90aW1lCiAgICBlbnRyeS5sYXN0X3VwZGF0ZWRfdGltZSA9ICcnCgogICAgZW50cmllcy5hcHBlbmQoZW50cnkpCiAgICBzZXF1ZW5jZSA9IHNlcXVlbmNlICsgMQogICAgCiAgICBkZWJ1Zy5kZWJ1ZygiZW50cnkucGF0aCAgICAgICAgIDogIiAuLiBlbnRyeS5wYXRoKQogICAgZGVidWcuZGVidWcoImVudHJ5LnNlcXVlbmNlICAgICA6ICIgLi4gZW50cnkuc2VxdWVuY2UpCiAgICBkZWJ1Zy5kZWJ1ZygiZW50cnkuZXhlY19mbGFnICAgIDogIiAuLiB0b3N0cmluZyhlbnRyeS5leGVjX2ZsYWcpKQogICAgZGVidWcuZGVidWcoImVudHJ5LmZpbGVfc2l6ZSAgICA6ICIgLi4gdG9zdHJpbmcoZW50cnkuZmlsZV9zaXplKSkKICAgIGRlYnVnLmRlYnVnKCJlbnRyeS5sYXN0X21vZF90aW1lOiAiIC4uIHRvc3RyaW5nKGVudHJ5Lmxhc3RfbW9kX3RpbWUpKQogICAgZGVidWcuZGVidWcoImVudHJ5Lmxhc3RfdXBkX3RpbWU6ICIgLi4gdG9zdHJpbmcoZW50cnkubGFzdF91cGRhdGVkX3RpbWUpKQogICAgZGVidWcuZGVidWcoIiIpCgogIGVuZAogIHJldHVybiBlbnRyaWVzCmVuZAoKLS0tCi0tIGdldF9jYWNoZV9lbnRyeV9udF82XzEoYmxvY2ssIGJsb2NrX2xlbiwgbWFnaWMpCi0tIFBhcnNlIFdpbmRvd3MgNy8yMDA4UjIgYXBwY29tcGF0IGVudHJpZXMuIEVhY2ggZW50cnkgaW5jbHVkZXMgdGhlIGZvbGxvd2luZyBmaWVsZDoKLS0gCi0tICAgcGF0aCAtIGZpbGUgcGF0aAotLSAgIHNlcXVlbmNlIC0gc2VxdWVuY2UgaW4gdGhlIGNhY2hlICgxLCAyLCAzLi4uKQotLSAgIGV4ZWNfZmxhZyAtIGV4ZWN1dGlvbiBmbGFnCi0tICAgbGFzdF9tb2RfdGltZSAtIGxhc3QgbW9kaWZpZWQgdGltZQotLQotLSBAcmV0dXJuIHN0ZGxpYi5MaXN0IExpc3Qgb2YgYXBwY29tcGF0IGVudHJpZXMgCi0tCmZ1bmN0aW9uIEFwcENvbXBhdC5nZXRfY2FjaGVfZW50cnlfbnRfNl8xKGJsb2NrLCBibG9ja19sZW4pCgogIGxvY2FsIE1BR0lDICAgICAgICAgICAgICA9IDB4YmFkYzBmZWUKICBsb2NhbCBFTlRSWV9TSVpFMzIgICAgICAgPSAwWDIwCiAgbG9jYWwgRU5UUllfU0laRTY0ICAgICAgID0gMHgzMAogIGxvY2FsIENBQ0hFX0hFQURFUl9TSVpFICA9IDB4ODAKICBsb2NhbCBDU1JTU19GTEFHICAgICAgICAgPSAweDIKICBsb2NhbCBPRkZTRVRfTlVNX0VOVFJJRVMgPSAweDAwMDQKCiAgbG9jYWwgZW50cmllcyA9IHN0ZGxpYi5MaXN0KCkKCiAgLS0gdmFsaWRhdGUgdGhlIG1hZ2ljIHZhbHVlCiAgbG9jYWwgbWFnaWNfaGRyID0gYmxvY2sucmVhZF9kd29yZCgwKQogIGlmIG1hZ2ljX2hkciB+PSBNQUdJQyB0aGVuCiAgICBkZWJ1Zy5kZWJ1ZygiSW52YWxpZCBlbnRyeSBtYWdpYyBoZWFkZXIgJyIgLi4gc3RyaW5nLmZvcm1hdCgnJTA0eCcsIG1hZ2ljX2hkcikgLi4gICInOyBleHBlY3RlZCAnIiAuLiBzdHJpbmcuZm9ybWF0KCclMDR4JywgTUFHSUMpIC4uICAiJyIpCiAgICByZXR1cm4gZW50cmllcwogIGVuZAogIAogIC0tIGdldCB0aGUgbnVtYmVyIG9mIGVudHJpZXMgaW4gdGhlIGNhY2hlCiAgbG9jYWwgbnVtX2VudHJpZXMgPSBibG9jay5yZWFkX2R3b3JkKE9GRlNFVF9OVU1fRU5UUklFUykKICBpZiBudW1fZW50cmllcyA9PSAwIG9yIG51bV9lbnRyaWVzID09IG5pbCB0aGVuIAogICAgcmV0dXJuIGVudHJpZXMKICBlbmQKCiAgLS0gY2FsY3VsYXRlIHRoZSBlbnRyeSBzaXplIGJhc2VkIG9uIE9TIGJpdG5lc3MgIAogIGxvY2FsIGVudHJ5X3NpemUgPSBuaWwKICBsb2NhbCBpc18zMl9iaXQgPSBBcHBDb21wYXQuaXNfMzJfYml0KCkKICBpZiBpc18zMl9iaXQgPT0gdHJ1ZSB0aGVuIAogICAgZW50cnlfc2l6ZSA9IEVOVFJZX1NJWkUzMgogIGVsc2UgCiAgICBlbnRyeV9zaXplID0gRU5UUllfU0laRTY0IAogIGVuZAoKICAtLSBzZXF1ZW5jZSBvZiBleGVjdXRpb24KICBzZXF1ZW5jZSA9IDEKICAKICBmb3Igb2Zmc2V0IGluIEFwcENvbXBhdC5yYW5nZShDQUNIRV9IRUFERVJfU0laRSwgbnVtX2VudHJpZXMgKiBlbnRyeV9zaXplLCBlbnRyeV9zaXplKSBkbwogICAgbG9jYWwgZmllbGRzID0ge30KICAgIAogICAgZmllbGRzLndMZW5ndGggPSBibG9jay5yZWFkX3dvcmQob2Zmc2V0KQogICAgb2Zmc2V0ID0gb2Zmc2V0ICsgMgogICAgZmllbGRzLndNYXhpbXVtTGVuZ3RoID0gYmxvY2sucmVhZF93b3JkKG9mZnNldCkKICAgIG9mZnNldCA9IG9mZnNldCArIDIKICAgIAogICAgaWYgaXNfMzJfYml0IHRoZW4KICAgICAgZmllbGRzLk9mZnNldCA9IGJsb2NrLnJlYWRfZHdvcmQob2Zmc2V0KQogICAgICBvZmZzZXQgPSBvZmZzZXQgKyA0CiAgICAgIGZpZWxkcy5kd0xvd0RhdGVUaW1lID0gYmxvY2sucmVhZF9kd29yZChvZmZzZXQpCiAgICAgIG9mZnNldCA9IG9mZnNldCArIDQKICAgICAgZmllbGRzLmR3SGlnaERhdGVUaW1lID0gYmxvY2sucmVhZF9kd29yZChvZmZzZXQpCiAgICAgIG9mZnNldCA9IG9mZnNldCArIDQKICAgICAgZmllbGRzLkZpbGVGbGFncyA9IGJsb2NrLnJlYWRfZHdvcmQob2Zmc2V0KQogICAgICBvZmZzZXQgPSBvZmZzZXQgKyA0CiAgICAgIGZpZWxkcy5GbGFncyA9IGJsb2NrLnJlYWRfZHdvcmQob2Zmc2V0KQogICAgZWxzZQogICAgICBvZmZzZXQgPSBvZmZzZXQgKyA0IC0tIGlnbm9yZSBwYWRkaW5nIGJ5dGVzCiAgICAgIGZpZWxkcy5PZmZzZXQgPSBibG9jay5yZWFkX3F3b3JkKG9mZnNldCkKICAgICAgb2Zmc2V0ID0gb2Zmc2V0ICsgOAogICAgICBmaWVsZHMuZHdMb3dEYXRlVGltZSA9IGJsb2NrLnJlYWRfZHdvcmQob2Zmc2V0KQogICAgICBvZmZzZXQgPSBvZmZzZXQgKyA0CiAgICAgIGZpZWxkcy5kd0hpZ2hEYXRlVGltZSA9IGJsb2NrLnJlYWRfZHdvcmQob2Zmc2V0KQogICAgICBvZmZzZXQgPSBvZmZzZXQgKyA0CiAgICAgIGZpZWxkcy5GaWxlRmxhZ3MgPSBibG9jay5yZWFkX2R3b3JkKG9mZnNldCkKICAgICAgb2Zmc2V0ID0gb2Zmc2V0ICsgNAogICAgICBmaWVsZHMuRmxhZ3MgPSBibG9jay5yZWFkX2R3b3JkKG9mZnNldCkKICAgIGVuZAoKICAgIC0tYW4gZXJyb3Igd2lsbCBvY2N1ciBpZiB0aGUgZGF0ZSBpcyBiZWZvcmUgSmFuLiAxLCAyMDAwIChwYXJzZV9maWxldGltZSBvbmx5IHN1cHBvcnRzIDEvMS8yMDAwKykKICAgIGxvY2FsIGxhc3RfbW9kX3RpbWUgPSBibG9jay5wYXJzZV9maWxldGltZShmaWVsZHMuZHdIaWdoRGF0ZVRpbWUsIGZpZWxkcy5kd0xvd0RhdGVUaW1lKQogICAgaWYgbGFzdF9tb2RfdGltZSB+PSBuaWwgdGhlbgogICAgICBsYXN0X21vZF90aW1lID0gbGFzdF9tb2RfdGltZS5pc29mb3JtYXQoKQogICAgZW5kCgogICAgbG9jYWwgcGF0aCA9IHN0cmluZy5nc3ViKGJsb2NrLnJlYWRfdXRmMTZfbGUoZmllbGRzLk9mZnNldCwgZmllbGRzLndMZW5ndGgpLCAnKFxcJT8lP1xcKScsJycpCgogICAgbG9jYWwgZXhlY19mbGFnID0gZmFsc2UKICAgIGlmIGJpbmFyeXBhcnNlci5iYW5kKGZpZWxkcy5GaWxlRmxhZ3MsIENTUlNTX0ZMQUcpID09IDIgdGhlbgogICAgICBleGVjX2ZsYWcgPSB0cnVlCiAgICBlbmQgICAgCiAgICAKICAgIGxvY2FsIGVudHJ5ID0ge30KICAgIGVudHJ5LnBhdGggPSBwYXRoOmdzdWIoIlxcXFwiLCJcXCIpCiAgICBlbnRyeS5zZXF1ZW5jZSA9IHNlcXVlbmNlCiAgICBlbnRyeS5leGVjX2ZsYWcgPSBleGVjX2ZsYWcKICAgIGVudHJ5LmZpbGVfc2l6ZSA9ICcnCiAgICBlbnRyeS5sYXN0X21vZF90aW1lID0gbGFzdF9tb2RfdGltZQogICAgZW50cnkubGFzdF91cGRhdGVkX3RpbWUgPSAnJwoKICAgIGVudHJpZXMuYXBwZW5kKGVudHJ5KQogICAgc2VxdWVuY2UgPSBzZXF1ZW5jZSArIDEKCiAgICBkZWJ1Zy5kZWJ1ZygiZW50cnkucGF0aCAgICAgICAgIDogIiAuLiBlbnRyeS5wYXRoKQogICAgZGVidWcuZGVidWcoImVudHJ5LnNlcXVlbmNlICAgICA6ICIgLi4gZW50cnkuc2VxdWVuY2UpCiAgICBkZWJ1Zy5kZWJ1ZygiZW50cnkuZXhlY19mbGFnICAgIDogIiAuLiB0b3N0cmluZyhlbnRyeS5leGVjX2ZsYWcpKQogICAgZGVidWcuZGVidWcoImVudHJ5LmZpbGVfc2l6ZSAgICA6ICIgLi4gdG9zdHJpbmcoZW50cnkuZmlsZV9zaXplKSkKICAgIGRlYnVnLmRlYnVnKCJlbnRyeS5sYXN0X21vZF90aW1lOiAiIC4uIHRvc3RyaW5nKGVudHJ5Lmxhc3RfbW9kX3RpbWUpKQogICAgZGVidWcuZGVidWcoImVudHJ5Lmxhc3RfdXBkX3RpbWU6ICIgLi4gdG9zdHJpbmcoZW50cnkubGFzdF91cGRhdGVkX3RpbWUpKQogICAgZGVidWcuZGVidWcoIiIpCiAgICAgIAogIGVuZAoKICByZXR1cm4gZW50cmllcwplbmQKCi0tCi0tIHdyYXBwZXIgZnVuY3Rpb24gdG8gaW52b2tlIGdldF9jYWNoZV9lbnRyeV9udF81XzJfNl8wIHdpdGggYSBmbGFnCi0tIGluZGljYXRpbmcgaWYgdGhlIGFwcGNvbXBhdCBlbnRyeSBjb250YWlucyB0aGUgZmlsZSBzaXplIChYUC8yMDAzKQotLSBvciBleGVjdXRpb24gZmxhZyAoVmlzdGEvMjAwOCkKLS0KZnVuY3Rpb24gQXBwQ29tcGF0LmdldF9jYWNoZV9lbnRyeV9udF81XzIoYmxvY2ssIGJsb2NrX2xlbikKICByZXR1cm4gQXBwQ29tcGF0LmdldF9jYWNoZV9lbnRyeV9udF81XzJfNl8wKGJsb2NrLCBibG9ja19sZW4sIHRydWUpCmVuZAoKLS0KLS0gd3JhcHBlciBmdW5jdGlvbiB0byBpbnZva2UgZ2V0X2NhY2hlX2VudHJ5X250XzVfMl82XzAgd2l0aCBhIGZsYWcKLS0gaW5kaWNhdGluZyBpZiB0aGUgYXBwY29tcGF0IGVudHJ5IGNvbnRhaW5zIHRoZSBmaWxlIHNpemUgKFhQLzIwMDMpCi0tIG9yIGV4ZWN1dGlvbiBmbGFnIChWaXN0YS8yMDA4KQotLQpmdW5jdGlvbiBBcHBDb21wYXQuZ2V0X2NhY2hlX2VudHJ5X250XzZfMChibG9jaywgYmxvY2tfbGVuKQogIHJldHVybiBBcHBDb21wYXQuZ2V0X2NhY2hlX2VudHJ5X250XzVfMl82XzAoYmxvY2ssIGJsb2NrX2xlbiwgZmFsc2UpCmVuZAoKLS0tCi0tIGdldF9jYWNoZV9lbnRyeV9udF81XzJfNl8wKGJsb2NrLCBibG9ja19sZW4sIGNvbnRhaW5zX2ZpbGVfc2l6ZSkKLS0gUGFyc2VzIFdpbmRvd3MgWFAgKHg2NCkgLyBWaXN0YSAvIFNlcnZlciAyMDAzIC8gU2VydmVyIDIwMDggYXBwY29tcGF0IGVudHJpZXMuIAotLSBFYWNoIGVudHJ5IGluY2x1ZGVzIHRoZSBmb2xsb3dpbmcgZmllbGRzOgotLSAKLS0gICBwYXRoIC0gZmlsZSBwYXRoCi0tICAgc2VxdWVuY2UgLSBzZXF1ZW5jZSBpbiB0aGUgY2FjaGUgKDEsIDIsIDMuLi4pCi0tICAgZXhlY19mbGFnIC0gZXhlY3V0aW9uIGZsYWcKLS0gICBsYXN0X21vZF90aW1lIC0gbGFzdCBtb2RpZmllZCB0aW1lCi0tCi0tIEByZXR1cm4gc3RkbGliLkxpc3QgTGlzdCBvZiBhcHBjb21wYXQgZW50cmllcwotLQpmdW5jdGlvbiBBcHBDb21wYXQuZ2V0X2NhY2hlX2VudHJ5X250XzVfMl82XzAoYmxvY2ssIGJsb2NrX2xlbiwgY29udGFpbnNfZmlsZV9zaXplKQoKICBsb2NhbCBNQUdJQyAgICAgICAgICAgICAgICAgID0gMHhiYWRjMGZmZQogIGxvY2FsIEhEUl9TSVpFICAgICAgICAgICAgICAgPSAweDA4CiAgbG9jYWwgSERSX09GRlNFVF9OVU1fRU5UUklFUyA9IDB4MDQKICBsb2NhbCBFTlRSWV9TSVpFMzIgICAgICAgICAgID0gMHgxOAogIGxvY2FsIEVOVFJZX1NJWkU2NCAgICAgICAgICAgPSAweDIwCiAgbG9jYWwgQ1NSU1NfRkxBRyAgICAgICAgICAgICA9IDB4MDIKCiAgbG9jYWwgZW50cmllcyA9IHN0ZGxpYi5MaXN0KCkKCiAgLS0gdmFsaWRhdGUgdGhlIG1hZ2ljIGhlYWRlcgogIGxvY2FsIG1hZ2ljX2hkciA9IGJsb2NrLnJlYWRfZHdvcmQoMCkKICBpZiBtYWdpY19oZHIgfj0gTUFHSUMgdGhlbgogICAgZGVidWcuZGVidWcoIkludmFsaWQgZW50cnkgbWFnaWMgaGVhZGVyICciIC4uIHN0cmluZy5mb3JtYXQoJyUwNHgnLCBtYWdpY19oZHIpIC4uICAiJzsgZXhwZWN0ZWQgJyIgLi4gc3RyaW5nLmZvcm1hdCgnJTA0eCcsIE1BR0lDKSAuLiAgIiciKQogICAgcmV0dXJuIGVudHJpZXMKICBlbmQKCiAgLS0gY2hlY2sgdGhlIG51bWJlciBvZiBlbnRyaWVzICAKICBsb2NhbCBudW1fZW50cmllcyA9IGJsb2NrLnJlYWRfZHdvcmQoSERSX09GRlNFVF9OVU1fRU5UUklFUykKICBpZiBudW1fZW50cmllcyA9PSAwIG9yIG51bV9lbnRyaWVzID09IG5pbCB0aGVuIAogICAgcmV0dXJuIGVudHJpZXMKICBlbmQKICBkZWJ1Zy5kZWJ1ZygiUGFyc2luZyAiIC4uIG51bV9lbnRyaWVzIC4uICIgZW50cmllcyIpCgogIGxvY2FsIHNlcXVlbmNlID0gMQoKICAtLSBjYWxjdWxhdGUgdGhlIGVudHJ5IHNpemUgYmFzZWQgb24gT1MgYml0bmVzcyAgCiAgbG9jYWwgZW50cnlfc2l6ZSA9IG5pbAogIGxvY2FsIGlzXzMyX2JpdCA9IEFwcENvbXBhdC5pc18zMl9iaXQoKQogIGlmIGlzXzMyX2JpdCA9PSB0cnVlIHRoZW4gCiAgICBlbnRyeV9zaXplID0gRU5UUllfU0laRTMyCiAgZWxzZSAKICAgIGVudHJ5X3NpemUgPSBFTlRSWV9TSVpFNjQgCiAgZW5kCiAgCiAgLS0gc2VxdWVuY2Ugb2YgZXhlY3V0aW9uCiAgc2VxdWVuY2UgPSAxICAgICAgICAgCiAgICAgICAgCiAgZm9yIG9mZnNldCBpbiBBcHBDb21wYXQucmFuZ2UoSERSX1NJWkUsIG51bV9lbnRyaWVzICogZW50cnlfc2l6ZSwgZW50cnlfc2l6ZSkgZG8KICAgIGxvY2FsIGZpZWxkcyA9IHt9CiAgICAKICAgIGZpZWxkcy53TGVuZ3RoID0gYmxvY2sucmVhZF93b3JkKG9mZnNldCkKICAgIG9mZnNldCA9IG9mZnNldCArIDIKICAgIGZpZWxkcy53TWF4aW11bUxlbmd0aCA9IGJsb2NrLnJlYWRfd29yZChvZmZzZXQpCiAgICBvZmZzZXQgPSBvZmZzZXQgKyAyCgogICAgaWYgaXNfMzJfYml0IHRoZW4KICAgICAgZmllbGRzLk9mZnNldCA9IGJsb2NrLnJlYWRfZHdvcmQob2Zmc2V0KQogICAgICBvZmZzZXQgPSBvZmZzZXQgKyA0CiAgICAgIGZpZWxkcy5kd0xvd0RhdGVUaW1lID0gYmxvY2sucmVhZF9kd29yZChvZmZzZXQpCiAgICAgIG9mZnNldCA9IG9mZnNldCArIDQKICAgICAgZmllbGRzLmR3SGlnaERhdGVUaW1lID0gYmxvY2sucmVhZF9kd29yZChvZmZzZXQpCiAgICAgIG9mZnNldCA9IG9mZnNldCArIDQKICAgICAgCiAgICAgIC0tIGFsdGhvdWdoIGZpZWxkcyBhcmUgbmFtZWQgRmlsZVNpemVMb3cvSGlnaCwgb24gVmlzdGEvMjAwOCB0aGVzZQogICAgICAtLSBmaWVsZHMgYWN0dWFsbHkgY29udGFpbiBhIHNlcmllcyBvZiBmbGFnLCBvbiBvZiB3aGljaCBpcyB0aGUgCiAgICAgIC0tIGV4ZWN1dGlvbiBmbGFnCiAgICAgIGZpZWxkcy5kd0ZpbGVTaXplTG93ID0gYmxvY2sucmVhZF9kd29yZChvZmZzZXQpCiAgICAgIG9mZnNldCA9IG9mZnNldCArIDQKICAgICAgZmllbGRzLmR3RmlsZVNpemVIaWdoID0gYmxvY2sucmVhZF9kd29yZChvZmZzZXQpCiAgICAgIG9mZnNldCA9IG9mZnNldCArIDQKCiAgICBlbHNlCiAgICAgIG9mZnNldCA9IG9mZnNldCArIDQgLS0gaWdub3JlIHBhZGRpbmcgYnl0ZXMKICAgICAgZmllbGRzLk9mZnNldCA9IGJsb2NrLnJlYWRfcXdvcmQob2Zmc2V0KQogICAgICBvZmZzZXQgPSBvZmZzZXQgKyA4CiAgICAgIGZpZWxkcy5kd0xvd0RhdGVUaW1lID0gYmxvY2sucmVhZF9kd29yZChvZmZzZXQpCiAgICAgIG9mZnNldCA9IG9mZnNldCArIDQKICAgICAgZmllbGRzLmR3SGlnaERhdGVUaW1lID0gYmxvY2sucmVhZF9kd29yZChvZmZzZXQpCiAgICAgIG9mZnNldCA9IG9mZnNldCArIDQKCiAgICAgIC0tIGFsdGhvdWdoIGZpZWxkcyBhcmUgbmFtZWQgRmlsZVNpemVMb3cvSGlnaCwgb24gVmlzdGEvMjAwOCB0aGVzZQogICAgICAtLSBmaWVsZHMgYWN0dWFsbHkgY29udGFpbiBhIHNlcmllcyBvZiBmbGFnLCBvbiBvZiB3aGljaCBpcyB0aGUgCiAgICAgIC0tIGV4ZWN1dGlvbiBmbGFnCiAgICAgIGZpZWxkcy5kd0ZpbGVTaXplTG93ID0gYmxvY2sucmVhZF9kd29yZChvZmZzZXQpCiAgICAgIG9mZnNldCA9IG9mZnNldCArIDQKICAgICAgZmllbGRzLmR3RmlsZVNpemVIaWdoID0gYmxvY2sucmVhZF9kd29yZChvZmZzZXQpCiAgICAgIG9mZnNldCA9IG9mZnNldCArIDQKICAgIGVuZAoKICAgIC0tYW4gZXJyb3Igd2lsbCBvY2N1ciBpZiB0aGUgZGF0ZSBpcyBiZWZvcmUgSmFuLiAxLCAyMDAwIChwYXJzZV9maWxldGltZSBvbmx5IHN1cHBvcnRzIDEvMS8yMDAwKykKICAgIGxvY2FsIGxhc3RfbW9kX3RpbWUsIGVyciA9IGJsb2NrLnBhcnNlX2ZpbGV0aW1lKGZpZWxkcy5kd0hpZ2hEYXRlVGltZSwgZmllbGRzLmR3TG93RGF0ZVRpbWUpCiAgICBpZiBlcnIgPT0gbmlsIHRoZW4KICAgICAgbGFzdF9tb2RfdGltZSA9IGxhc3RfbW9kX3RpbWUuaXNvZm9ybWF0KCkKICAgIGVsc2UKICAgICAgbGFzdF9tb2RfdGltZSA9ICIiCiAgICAgIC0tZGVidWcuZGVidWcoZXJyKQogICAgZW5kCgogICAgbG9jYWwgcGF0aCA9IHN0cmluZy5nc3ViKGJsb2NrLnJlYWRfdXRmMTZfbGUoZmllbGRzLk9mZnNldCwgZmllbGRzLndMZW5ndGgpLCAnKFxcJT8lP1xcKScsJycpCgogICAgbG9jYWwgZXhlY19mbGFnID0gJycKICAgIGxvY2FsIGZpbGVfc2l6ZSA9ICcnCgogICAgLS0gT24gU2VydmVyIDIwMDMsIHRoZSBkd29yZCByZWFkIGludG8gZmllbGRzLmR3RmlsZVNpemVMb3cgYWJvdmUgY29udGFpbnMKICAgIC0tIHRoZSBmaWxlIHNpemU7IG9uIFZpc3RhL1NlcnZlciAyMDA4IGl0IGNvbnRhaW5zIHRoZSBleGVjdXRpb24gZmxhZwogICAgaWYgY29udGFpbnNfZmlsZV9zaXplIHRoZW4KICAgICAgZmlsZV9zaXplID0gZmllbGRzLmR3RmlsZVNpemVMb3cKICAgIGVsc2UKICAgICAgaWYgYmluYXJ5cGFyc2VyLmJhbmQoZmllbGRzLmR3RmlsZVNpemVMb3csIENTUlNTX0ZMQUcpID09IDIgdGhlbgogICAgICAgIGV4ZWNfZmxhZyA9IHRydWUKICAgICAgZWxzZQogICAgICAgIGV4ZWNfZmxhZyA9IGZhbHNlCiAgICAgIGVuZCAgICAKICAgIGVuZAogICAgCiAgICBsb2NhbCBlbnRyeSA9IHt9CiAgICBlbnRyeS5wYXRoID0gcGF0aDpnc3ViKCJcXFxcIiwiXFwiKQogICAgZW50cnkuc2VxdWVuY2UgPSBzZXF1ZW5jZQogICAgZW50cnkuZXhlY19mbGFnID0gZXhlY19mbGFnCiAgICBlbnRyeS5maWxlX3NpemUgPSBmaWxlX3NpemUKICAgIGVudHJ5Lmxhc3RfbW9kX3RpbWUgPSBsYXN0X21vZF90aW1lCiAgICBlbnRyeS5sYXN0X3VwZGF0ZWRfdGltZSA9ICcnCgogICAgZW50cmllcy5hcHBlbmQoZW50cnkpCiAgICBzZXF1ZW5jZSA9IHNlcXVlbmNlICsgMQoKICAgIGRlYnVnLmRlYnVnKCJlbnRyeS5wYXRoICAgICAgICAgOiAiIC4uIGVudHJ5LnBhdGgpCiAgICBkZWJ1Zy5kZWJ1ZygiZW50cnkuc2VxdWVuY2UgICAgIDogIiAuLiBlbnRyeS5zZXF1ZW5jZSkKICAgIGRlYnVnLmRlYnVnKCJlbnRyeS5leGVjX2ZsYWcgICAgOiAiIC4uIHRvc3RyaW5nKGVudHJ5LmV4ZWNfZmxhZykpCiAgICBkZWJ1Zy5kZWJ1ZygiZW50cnkuZmlsZV9zaXplICAgIDogIiAuLiB0b3N0cmluZyhlbnRyeS5maWxlX3NpemUpKQogICAgZGVidWcuZGVidWcoImVudHJ5Lmxhc3RfbW9kX3RpbWU6ICIgLi4gdG9zdHJpbmcoZW50cnkubGFzdF9tb2RfdGltZSkpCiAgICBkZWJ1Zy5kZWJ1ZygiZW50cnkubGFzdF91cGRfdGltZTogIiAuLiB0b3N0cmluZyhlbnRyeS5sYXN0X3VwZGF0ZWRfdGltZSkpCiAgICBkZWJ1Zy5kZWJ1ZygiIikKICBlbmQgIAogIAogIHJldHVybiBlbnRyaWVzCmVuZAoKLS0tCi0tIGdldF9jYWNoZV9lbnRyeV9udF81XzEoYmxvY2ssIGJsb2NrX2xlbikKLS0gUGFyc2VzIFdpbmRvd3MgWFAgYXBwY29tcGF0IGVudHJpZXMuIEVhY2ggZW50cnkgaW5jbHVkZXMgdGhlIGZvbGxvd2luZyBmaWVsZHM6Ci0tIAotLSAgIHBhdGggICAgICAtIGZpbGUgcGF0aAotLSAgIGZpbGVfc2l6ZSAtIGZpbGUgc2l6ZQotLSAgIHNlcXVlbmNlICAtIG5vdCBwcm92aWRlZDsgb24gWFAsIHRoZXJlIGlzIGEgc2VwYXJhdGUgYmxvYiBpbiB0aGUgYXBwY29tcGF0IAotLSAgICAgICAgICAgICAgIHRoYXQgZGVmaW5lcyB0aGUgc2VxdWVuY2U7IGJlY2F1c2UgWFAgcHJvdmlkZXMgdGhlIHRpbWUgZWFjaAotLSAgICAgICAgICAgICAgIGVudHJ5IHdhcyBleGVjdXRlZCAobGFzdF91cGRhdGVkX3RpbWUpIHRoZSBkYXRhIGNhbiBiZSBzb3J0ZWQKLS0gICAgICAgICAgICAgICBieSB0aGlzIGZpZWxkOyBmb3IgdGhpcyByZWFzb24gdGhlIHNlcXVlbmNlIGxvZ2ljIHdhcyBub3QKLS0gICAgICAgICAgICAgICBpbXBsZW1lbnRlZAotLSAgIGV4ZWNfZmxhZyAtIG5vdCBhdmFpbGFibGUgb24gV2luZG93cyBYUAotLSAgIGxhc3RfbW9kX3RpbWUgLSBsYXN0IG1vZGlmaWVkIHRpbWUgb2YgZmlsZSBhdCB0aW1lIG9mIGV4ZWN1dGlvbgotLSAgIGxhc3RfdXBkYXRlZF90aW1lIC0gdXBkYXRlZCB3aGVuIGZpbGVzIGFyZSBleGVjdXRlZAotLQotLSBAcmV0dXJuIHN0ZGxpYi5MaXN0IExpc3Qgb2YgYXBwY29tcGF0IGVudHJpZXMKLS0KZnVuY3Rpb24gQXBwQ29tcGF0LmdldF9jYWNoZV9lbnRyeV9udF81XzEoYmxvY2ssIGJsb2NrX2xlbikKCiAgbG9jYWwgTUFHSUMgPSAweGRlYWRiZWVmCiAgCiAgbG9jYWwgSERSX1NJWkUzMiAgICAgICAgICAgICA9IDB4MTkwCiAgbG9jYWwgSERSX09GRlNFVF9NQVhfRU5UUklFUyA9IDB4MDQKICBsb2NhbCBIRFJfT0ZGU0VUX05VTV9FTlRSSUVTID0gMHgwOAogIGxvY2FsIEhEUl9PRkZTRVRfU0VRX0JMT0IgICAgPSAweDEwCiAgbG9jYWwgSERSX1NFUV9CTE9CX1NJWkUgICAgICA9IEhEUl9TSVpFMzIgLSBIRFJfT0ZGU0VUX1NFUV9CTE9CCiAgbG9jYWwgSERSX1NFUV9FTlRSWV9TSVpFICAgICA9IDB4MDQKICAKICBsb2NhbCBFTlRSWV9TSVpFMzIgICAgICAgICAgICAgPSAweDIyOAogIGxvY2FsIEVOVFJZX01BWF9QQVRIICAgICAgICAgICA9IDB4MjA4CiAgbG9jYWwgRU5UUllfT0ZGU0VUX1BBVEggICAgICAgID0gMHgwOAogIGxvY2FsIEVOVFJZX09GRlNFVF9MT1dfREFURV8xICA9IEVOVFJZX09GRlNFVF9QQVRIICsgRU5UUllfTUFYX1BBVEggKyAweDAwCiAgbG9jYWwgRU5UUllfT0ZGU0VUX0hJR0hfREFURV8xID0gRU5UUllfT0ZGU0VUX1BBVEggKyBFTlRSWV9NQVhfUEFUSCArIDB4MDQKICBsb2NhbCBFTlRSWV9PRkZTRVRfRklMRV9TSVpFICAgPSBFTlRSWV9PRkZTRVRfUEFUSCArIEVOVFJZX01BWF9QQVRIICsgMHgwOAogIGxvY2FsIEVOVFJZX09GRlNFVF9MT1dfREFURV8yICA9IEVOVFJZX09GRlNFVF9QQVRIICsgRU5UUllfTUFYX1BBVEggKyAweDEwCiAgbG9jYWwgRU5UUllfT0ZGU0VUX0hJR0hfREFURV8yID0gRU5UUllfT0ZGU0VUX1BBVEggKyBFTlRSWV9NQVhfUEFUSCArIDB4MTQKICAKICBsb2NhbCBlbnRyaWVzID0gc3RkbGliLkxpc3QoKQoKICAtLSB2YWxpZGF0ZSB0aGUgbWFnaXggaGVhZGVyCiAgbG9jYWwgbWFnaWNfaGRyID0gYmxvY2sucmVhZF9kd29yZCgwKQogIGlmIG1hZ2ljX2hkciB+PSBNQUdJQyB0aGVuCiAgICBkZWJ1Zy5kZWJ1ZygiSW52YWxpZCBlbnRyeSBtYWdpYyBoZWFkZXIgJyIgLi4gc3RyaW5nLmZvcm1hdCgnJTA0eCcsIG1hZ2ljX2hkcikgLi4gICInOyBleHBlY3RlZCAnIiAuLiBzdHJpbmcuZm9ybWF0KCclMDR4JywgTUFHSUMpIC4uICAiJyIpCiAgICByZXR1cm4gZW50cmllcwogIGVuZAoKICAtLSBtYXhpbXVtIG51bWJlciBvZiBlbnRyaWVzICh1c3VhbGx5IDk2KQogIGxvY2FsIG1heF9lbnRyaWVzID0gYmxvY2sucmVhZF9kd29yZChIRFJfT0ZGU0VUX01BWF9FTlRSSUVTKQogIGlmIG1heF9lbnRyaWVzID09IDAgb3IgbWF4X2VudHJpZXMgPT0gbmlsIHRoZW4gCiAgICByZXR1cm4gZW50cmllcwogIGVuZAogIAogIC0tIGdldCB0aGUgbnVtYmVyIG9mIGVudHJpZXMgZnJvbSB0aGUgaGVhZGVyCiAgbG9jYWwgbnVtX2VudHJpZXMgPSBibG9jay5yZWFkX2ludDgoSERSX09GRlNFVF9OVU1fRU5UUklFUykKICBpZiBudW1fZW50cmllcyA9PSAwIG9yIG51bV9lbnRyaWVzID09IG5pbCB0aGVuIAogICAgcmV0dXJuIGVudHJpZXMKICBlbmQKCiAgLS0gdmFsaWRhdGUgbWF4IGVudHJpZXMgYW5kIG51bSBlbnRyaWVzCiAgaWYgbnVtX2VudHJpZXMgPiBtYXhfZW50cmllcyB0aGVuCiAgICBkZWJ1Zy5kZWJ1ZyhzdHJpbmcuZm9ybWF0KCJOdW1iZXIgb2YgZW50cmllcyBpbiBoZWFkZXIgJyVkJyBleGNlZWRzIG1heGltdW0gZW50cmllcyBpbiBoZWFkZXIgJyVkJyIsIG51bV9lbnRyaWVzLCBtYXhfZW50cmllcykpCiAgICByZXR1cm4gZW50cmllcwogIGVuZAogIAogIGVudHJ5X29yZGVyID0gc3RkbGliLkxpc3QoKQogIAogIC0tIHBhcnNlIHRoZSBlbnRyeSBzZXF1ZW5jZSBibG9iIGluIHRoZSBoZWFkZXI7IHRoaXMgYmxvYiBjb250YWlucyAKICAtLSBhIGxpc3Qgb2Ygb2Zmc2V0cyBpbnRvIHRoZSBjYWNoZSBkYXRhLCB0aGUgb3JkZXIgb2Ygd2hpY2ggcmVwcmVzZW50cwogIC0tIHRoZSAqcmV2ZXJzZSogb3JkZXIgb2YgZXhlY3V0aW9uIChtb3N0IHJlY2VudCBmaXJzdCkKICBsb2NhbCBudW1fc2VxID0gMAogIGZvciBlbnRyeV9zZXEgaW4gQXBwQ29tcGF0LnJhbmdlKEhEUl9PRkZTRVRfU0VRX0JMT0IsIEhEUl9TRVFfQkxPQl9TSVpFLCBIRFJfU0VRX0VOVFJZX1NJWkUpIGRvCiAgICBsb2NhbCBzZXFfdmFsID0gYmxvY2sucmVhZF9pbnQ4KGVudHJ5X3NlcSkKICAgIGlmIHNlcV92YWwgPT0gLTEgdGhlbgogICAgICBicmVhawogICAgZW5kCiAgICBlbnRyeV9vcmRlci5hcHBlbmQoc2VxX3ZhbCkKICAgIG51bV9zZXEgPSBudW1fc2VxICsgMQogIGVuZAogIAogIC0tZGVidWcuZGVidWcoIlJlYWRpbmcgIiAuLiBudW1fZW50cmllcyAuLiAiIGVudHJpZXMiKQogIC0tZGVidWcuZGVidWcoIlJlYWRpbmcgIiAuLiBudW1fc2VxIC4uICIgc2VxdWVuY2VzIikKICAKICBpZiBudW1fc2VxIH49IG51bV9lbnRyaWVzIHRoZW4KICAgIGRlYnVnLmRlYnVnKHN0cmluZy5mb3JtYXQoIk51bWJlciBvZiBzZXF1ZW5jZXMgJyVkJyBmb3VuZCBkb2VzIG5vdCBtYXRjaCBudW1iZXIgb2YgZW50cmllcyBpbiBoZWFkZXIgJyVkJyIsIG51bV9zZXEsIG51bV9lbnRyaWVzKSkKICAgIHJldHVybiBlbnRyaWVzCiAgZW5kCgogIGxvY2FsIHNlcXVlbmNlID0gMSAtLSB0aGUgYWN0dWFsIGV4ZWN1dGlvbiBzZXF1ZW5jZQogIAogIC0tIGxvb3AgdGhyb3VnaCBlYWNoIHNlcXVlbmNlIGFuZCBvZmZzZXQgdGhhdCBtYW55IGVsZW1lbnRzIGludG8KICAtLSB0aGUgY2FjaGUKICBmb3IgZW50cnlfcG9zIGluIGVudHJ5X29yZGVyLmVhY2goKSBkbwogIAogICAgLS0gY2FsY3VsYXRlIHRoZSBvZmZzZXQgaW50byB0aGUgZGF0YSB1c2luZyB0aGUgZW50cnkgcG9zaXRpb24KICAgIG9mZnNldCA9IEhEUl9TSVpFMzIgKyAoZW50cnlfcG9zICogRU5UUllfU0laRTMyKQoKICAgIC0tIGdldCB0aGUgZmlsZSBwYXRoCiAgICBwYXRoID0gYmxvY2sucmVhZF91dGYxNl9sZShvZmZzZXQgKyBFTlRSWV9PRkZTRVRfUEFUSCkKICAgIGlmIHBhdGggPT0gbmlsIG9yIHBhdGggPT0gIiIgdGhlbgogICAgICBkZWJ1Zy5kZWJ1ZygiTnVsbCBwYXRoIGZvdW5kOyBhYm9ydGluZyIpCiAgICAgIHJldHVybiBlbnRyaWVzCiAgICBlbmQKCiAgICAtLSBnZXQgbGFzdCBtb2RpZmllZCB0aW1lCiAgICBsb2NhbCBsb3dfZGF0ZV90aW1lICA9IGJsb2NrLnJlYWRfZHdvcmQob2Zmc2V0ICsgRU5UUllfT0ZGU0VUX0xPV19EQVRFXzEpCiAgICBsb2NhbCBoaWdoX2RhdGVfdGltZSA9IGJsb2NrLnJlYWRfZHdvcmQob2Zmc2V0ICsgRU5UUllfT0ZGU0VUX0hJR0hfREFURV8xKQoKICAgIC0tYW4gZXJyb3Igd2lsbCBvY2N1ciBpZiB0aGUgZGF0ZSBpcyBiZWZvcmUgSmFuLiAxLCAyMDAwIChwYXJzZV9maWxldGltZSBvbmx5IHN1cHBvcnRzIDEvMS8yMDAwKykKICAgIGxvY2FsIGxhc3RfbW9kX3RpbWUgPSBibG9jay5wYXJzZV9maWxldGltZShoaWdoX2RhdGVfdGltZSwgbG93X2RhdGVfdGltZSkKICAgIGlmIGxhc3RfbW9kX3RpbWUgfj0gbmlsIHRoZW4KICAgICAgbGFzdF9tb2RfdGltZSA9IGxhc3RfbW9kX3RpbWUuaXNvZm9ybWF0KCkKICAgIGVuZAoKICAgIC0tIGdldCBmaWxlIHNpemUKICAgIGxvY2FsIGZpbGVfc2l6ZSA9IGJsb2NrLnJlYWRfaW50NjQob2Zmc2V0ICsgRU5UUllfT0ZGU0VUX0ZJTEVfU0laRSkKICAgIGlmIGZpbGVfc2l6ZSA9PSAwIHRoZW4KICAgICAgZGVidWcuZGVidWcoIkZpbGUgc2l6ZSAwOyBhYm9ydGluZyIpCiAgICAgIHJldHVybiBlbnRyaWVzCiAgICBlbmQKCiAgICAtLSBnZXQgbGFzdCB1cGRhdGVkIHRpbWUKICAgIGxvd19kYXRlX3RpbWUgID0gYmxvY2sucmVhZF9kd29yZChvZmZzZXQgKyBFTlRSWV9PRkZTRVRfTE9XX0RBVEVfMikKICAgIGhpZ2hfZGF0ZV90aW1lID0gYmxvY2sucmVhZF9kd29yZChvZmZzZXQgKyBFTlRSWV9PRkZTRVRfSElHSF9EQVRFXzIpCgogICAgLS1hbiBlcnJvciB3aWxsIG9jY3VyIGlmIHRoZSBkYXRlIGlzIGJlZm9yZSBKYW4uIDEsIDIwMDAgKHBhcnNlX2ZpbGV0aW1lIG9ubHkgc3VwcG9ydHMgMS8xLzIwMDArKQogICAgbG9jYWwgbGFzdF91cGRhdGVkX3RpbWUgPSBibG9jay5wYXJzZV9maWxldGltZShoaWdoX2RhdGVfdGltZSwgbG93X2RhdGVfdGltZSkKICAgIGlmIGxhc3RfdXBkYXRlZF90aW1lIH49IG5pbCB0aGVuCiAgICAgIGxhc3RfdXBkYXRlZF90aW1lID0gbGFzdF91cGRhdGVkX3RpbWUuaXNvZm9ybWF0KCkKICAgIGVuZAogICAgCiAgICBpZiBwYXRoIH49ICIiIGFuZCBmaWxlX3NpemUgPiAwIHRoZW4KICAgICAgbG9jYWwgZW50cnkgPSB7fQogICAgICBlbnRyeS5wYXRoID0gcGF0aDpnc3ViKCJcXFxcIiwiXFwiKQogICAgICBlbnRyeS5zZXF1ZW5jZSA9IHNlcXVlbmNlCiAgICAgIGVudHJ5LmV4ZWNfZmxhZyA9ICcnCiAgICAgIGVudHJ5LmZpbGVfc2l6ZSA9IGZpbGVfc2l6ZQogICAgICBlbnRyeS5sYXN0X21vZF90aW1lID0gbGFzdF9tb2RfdGltZQogICAgICBlbnRyeS5sYXN0X3VwZGF0ZWRfdGltZSA9IGxhc3RfdXBkYXRlZF90aW1lCiAgICAgIGVudHJpZXMuYXBwZW5kKGVudHJ5KQogICAgICBzZXF1ZW5jZSA9IHNlcXVlbmNlICsgMQoKICAgICAgZGVidWcuZGVidWcoImVudHJ5LnBhdGggICAgICAgICA6ICIgLi4gZW50cnkucGF0aCkKICAgICAgZGVidWcuZGVidWcoImVudHJ5LnNlcXVlbmNlICAgICA6ICIgLi4gZW50cnkuc2VxdWVuY2UpCiAgICAgIGRlYnVnLmRlYnVnKCJlbnRyeS5leGVjX2ZsYWcgICAgOiAiIC4uIHRvc3RyaW5nKGVudHJ5LmV4ZWNfZmxhZykpCiAgICAgIGRlYnVnLmRlYnVnKCJlbnRyeS5maWxlX3NpemUgICAgOiAiIC4uIHRvc3RyaW5nKGVudHJ5LmZpbGVfc2l6ZSkpCiAgICAgIGRlYnVnLmRlYnVnKCJlbnRyeS5sYXN0X21vZF90aW1lOiAiIC4uIHRvc3RyaW5nKGVudHJ5Lmxhc3RfbW9kX3RpbWUpKQogICAgICBkZWJ1Zy5kZWJ1ZygiZW50cnkubGFzdF91cGRfdGltZTogIiAuLiB0b3N0cmluZyhlbnRyeS5sYXN0X3VwZGF0ZWRfdGltZSkpCiAgICBlbmQKICBlbmQKICByZXR1cm4gZW50cmllcwplbmQKCmZ1bmN0aW9uIEFwcENvbXBhdC5pc19jZXJ0X3doaXRlbGlzdGVkKGNlcnQsIGlzc3Vlcl93aGl0ZWxpc3QsIHN1YmplY3Rfd2hpdGVsaXN0KQoKICAgIGlmIGNlcnQgPT0gbmlsIHRoZW4KICAgICAgcmV0dXJuIGZhbHNlCiAgICBlbmQKCiAgICAtLSBvbmx5IHNpZ25lZCBhbmQgdmVyaWZpZWQgY2VydGlmaWNhdGVzIGFyZSBlbGlnaWJsZSBmb3Igd2hpdGVsaXN0aW5nCiAgICBpZiBjZXJ0LlNpZ25hdHVyZUV4aXN0cyB+PSB0cnVlIG9yIGNlcnQuU2lnbmF0dXJlVmVyaWZpZWQgfj0gdHJ1ZSB0aGVuCiAgICAgIHJldHVybiBmYWxzZQogICAgZW5kCgogICAgaWYgY2VydC5DZXJ0aWZpY2F0ZUlzc3VlciB+PSBuaWwgdGhlbgogICAgICBmb3IgXywgd2hpdGVsaXN0ZWRfaXNzdWVyIGluIGlwYWlycyhpc3N1ZXJfd2hpdGVsaXN0KSBkbwogICAgICAgIGlmIHN0ZGxpYi5zdGFydHN3aXRoKGNlcnQuQ2VydGlmaWNhdGVJc3N1ZXI6bG93ZXIoKSwgd2hpdGVsaXN0ZWRfaXNzdWVyKSB0aGVuCiAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgIGVuZAogICAgICBlbmQKICAgIGVuZAoKICAgIGlmIGNlcnQuQ2VydGlmaWNhdGVTdWJqZWN0IH49IG5pbCB0aGVuCiAgICAgIGZvciBfLCB3aGl0ZWxpc3RlZF9zdWJqZWN0IGluIGlwYWlycyhzdWJqZWN0X3doaXRlbGlzdCkgZG8KICAgICAgICBpZiBzdGRsaWIuc3RhcnRzd2l0aChjZXJ0LkNlcnRpZmljYXRlU3ViamVjdDpsb3dlcigpLCB3aGl0ZWxpc3RlZF9zdWJqZWN0KSB0aGVuCiAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgIGVuZAogICAgICBlbmQKICAgIGVuZAplbmQKCi0tLQotLSB3cml0ZV9hcHBjb21wYXQocmVnX2tleSwgYXBwX2l0ZW0sIGNudF9lbnRyaWVzKQotLSBXcml0ZXMgYXBwY29tcGF0IGVudHJpZXMgdG8gdGhlIG91dHB1dCBYTUwuCi0tCkFwcENvbXBhdC53cml0ZV9hcHBjb21wYXQgPSBmdW5jdGlvbihyZWdfa2V5LCBjb250cm9sX3NldCwgYXBwX2l0ZW0pCiAgbG9jYWwgaWR4ID0gMAoKICByZGIuUmRiU3RhcnRJdGVtKCJBcHBDb21wYXRJdGVtRXh0ZW5kZWQiKQogIHJkYi5SZGJBZGRGaWVsZCgiUGVyc2lzdGVuY2VUeXBlIiwgIkFwcENvbXBhdCIpCgogIC0tIGF2YWlsYWJsZSBvbiBhbGwgT1NlcwogIGxvY2FsIGZpbGVfcGF0aCA9IGFwcF9pdGVtLnBhdGg6Z3N1YignXFw/P1xcJywgJycpCiAgZmlsZV9wYXRoID0gZmlsZV9wYXRoOmdzdWIoJ1xcXFw/XFwnLCAnJykKICBkZWJ1Zy5kZWJ1ZyhhcHBfaXRlbS5zZXF1ZW5jZSwgYXBwX2l0ZW0ubGFzdF9tb2RfdGltZSwgYXBwX2l0ZW0ucGF0aCwgZmlsZV9wYXRoKQogIAogIHJkYi5SZGJBZGRGaWVsZCgiQXBwQ29tcGF0UGF0aCIsIGZpbGVfcGF0aCkKCiAgLS0gZmlsZSBzaXplIGlzIG5vdCBwcmVzZW50IG9uIGFsbCBPU2VzCiAgaWYgYXBwX2l0ZW0uZmlsZV9zaXplIH49ICIiIHRoZW4KICAgIHJkYi5SZGJBZGRGaWVsZCgiRmlsZVNpemUiLCBhcHBfaXRlbS5maWxlX3NpemUpCiAgZW5kCgogIC0tIGF2YWlsYWJsZSBvbiBhbGwgT1NlcwogIHJkYi5SZGJBZGRGaWVsZCgiTGFzdE1vZGlmaWVkIiwgYXBwX2l0ZW0ubGFzdF9tb2RfdGltZSkKCiAgLS0gZmlsZSBzaXplIGlzIG5vdCBwcmVzZW50IG9uIGFsbCBPU2VzCiAgaWYgYXBwX2l0ZW0ubGFzdF91cGRhdGVkX3RpbWUgfj0gIiIgdGhlbgogICAgcmRiLlJkYkFkZEZpZWxkKCJMYXN0VXBkYXRlZCIsIGFwcF9pdGVtLmxhc3RfdXBkYXRlZF90aW1lKQogIGVuZAoKICByZGIuUmRiQWRkRmllbGQoIlJlZ2lzdHJ5S2V5IiwgcmVnX2tleSkKCiAgLS0gZnJpZW5kbHkgbmFtZSBmb3IgY29udHJvbCBzZXQgKHVzZWQgZm9yIGRpc3BsYXkgaW4gVUlzKQogIHJkYi5SZGJBZGRGaWVsZCgiQ29udHJvbFNldFNlcSIsIHN0cmluZy5mb3JtYXQoIiVzLSUwNGQiLGNvbnRyb2xfc2V0LCBhcHBfaXRlbS5zZXF1ZW5jZSkpCgogIC0tIHRoZSBzZXF1ZW5jZSB0aGUgZW50cnkgYXBwZWFyZWQgaW4gdGhlIGNhY2hlICh1c2VmdWwgd2hlbiBzb3J0aW5nIG91dHB1dCkKICByZGIuUmRiQWRkRmllbGQoIlNlcXVlbmNlIiwgYXBwX2l0ZW0uc2VxdWVuY2UpCgogIC0tIHRoZSBleGVjdXRpb24gZmxhZyAoc2V0IHRvICdOL0EnIGZvciBzb21lKQogIHJkYi5SZGJBZGRGaWVsZCgiRXhlY3V0aW9uRmxhZyIsIGFwcF9pdGVtLmV4ZWNfZmxhZykKCiAgLS0gY2hlY2sgaWYgdGhlIGZpbGUgZXhpc3RzIG9uIGRpc2sKICBpZiBBcHBDb21wYXQuaW5jbHVkZV9maWxlX2RldGFpbHMgPT0gdHJ1ZSBhbmQgZmlsZV9wYXRoIH49IG5pbCB0aGVuCiAgICBpZHggPSBmaWxlLkZpbGVPcGVuQVBJKGZpbGVfcGF0aCkKICBlbHNlCiAgICBpZHggPSBuaWwKICBlbmQKCiAgLS0gd3JpdGUgYWRkaXRpb25hbCBmaWxlIG1ldGFkYXRhIGlmOgogIC0tIDEpIHNjcmlwdCBmbGFnIGlzIHNldCB0byBpbmNsdWRlIGRldGFpbHMgKEFwcENvbXBhdC5pbmNsdWRlX2ZpbGVfZGV0YWlscykKICAtLSAyKSBmaWxlIGV4aXN0cyBvbiBkaXNrCiAgLS0gMykgZmlsZSBoYXMgbm90IGFscmVhZHkgYmVlbiBzZWVuIChvbmx5IGVuZm9yY2VkIHdoZW4gcGFyc2luZyBhbGwgY3RybCBzZXRzKQogIC0tICAgIG5vdGU6IHdoZW4gcGFyc2luZyBhbGwgY29udHJvbCBzZXRzIDk5JSBvZiB0aGUgZGF0YSB3aWxsIGJlIGR1cGxpY2F0ZTsKICAtLSAgICB0byByZWR1Y2Ugc2NyaXB0IG92ZXJoZWFkIG1ldGFkYXRhIGlzIG9ubHkgY29sbGVjdGVkIGZvciB1bmlxdWUgZmlsZXMKICBpZiBBcHBDb21wYXQuaW5jbHVkZV9maWxlX2RldGFpbHMgPT0gdHJ1ZSBhbmQgCiAgICAgdHlwZShpZHgpIH49ICJuaWwiIGFuZCAKICAgICBub3QgKEFwcENvbXBhdC5wYXJzZV9hbGxfY3RybF9zZXRzID09IHRydWUgYW5kIEFwcENvbXBhdC5wcm9jZXNzZWRfcGF0aHNbZmlsZV9wYXRoOmxvd2VyKCldKSB0aGVuCiAgCiAgICBsb2NhbCBmaWxlX2luZm8gPSBmaWxlLkZpbGVHZXRJbmZvQnlIYW5kbGVBUEkoaWR4KQogICAgICAKICAgIHJkYi5SZGJBZGRGaWVsZCgiRmlsZU93bmVyIiwgZmlsZV9pbmZvLlVzZXJuYW1lKQogICAgcmRiLlJkYkFkZEZpZWxkKCJGaWxlQ3JlYXRlZCIsIHN0ZGxpYi5Db252ZXJ0U3lzdGVtVGltZShmaWxlX2luZm8uQ3JlYXRlZCkpCiAgICByZGIuUmRiQWRkRmllbGQoIkZpbGVNb2RpZmllZCIsIHN0ZGxpYi5Db252ZXJ0U3lzdGVtVGltZShmaWxlX2luZm8uTW9kaWZpZWQpKQogICAgcmRiLlJkYkFkZEZpZWxkKCJGaWxlQWNjZXNzZWQiLCBzdGRsaWIuQ29udmVydFN5c3RlbVRpbWUoZmlsZV9pbmZvLkFjY2Vzc2VkKSkKICAgIHJkYi5SZGJBZGRGaWVsZCgiRmlsZUNoYW5nZWQiLCBzdGRsaWIuQ29udmVydFN5c3RlbVRpbWUoZmlsZV9pbmZvLkNoYW5nZWQpKQoKICAgIGlmIGZpbGUuRmlsZUdldE9wdGlvbigiTUQ1IikgPT0gMSB0aGVuCiAgICAgIGxvY2FsIGhhc2ggPSBmaWxlLkZpbGVIYXNoQVBJKGlkeCwgMCkKICAgICAgaWYgaGFzaCB+PSBuaWwgdGhlbgogICAgICAgIHJkYi5SZGJBZGRGaWVsZCgibWQ1c3VtIiwgaGFzaCkKICAgICAgZW5kICAgICAKCiAgICAgIC0tIGNhbGN1bGF0ZSBtYWdpYyBoZWFkZXIKICAgICAgZmlsZS5GaWxlU2Vla0FQSShpZHgsIDAsIDApCiAgICAgIGxvY2FsIGJ5dGVzID0gZmlsZS5GaWxlUmVhZEFQSShpZHgsIDE2KQogICAgICBpZiBieXRlcyB+PSBuaWwgdGhlbgogICAgICAgIHJkYi5SZGJBZGRGaWVsZCgiTWFnaWNIZWFkZXIiLCB0b3N0cmluZyh1dGlscy5oZXhsaWZ5KGJ5dGVzKSkpCiAgICAgIGVuZAogICAgZW5kCiAgIAogICAgbG9jYWwgZHMgPSBuaWwKICAgIGlmIGZpbGUuRmlsZUdldE9wdGlvbigidmVyaWZ5IGRpZ2l0YWwgc2lnbmF0dXJlcyIpID09IDEgdGhlbgogICAgICBkcyA9IGZpbGUuRmlsZURpZ2l0YWxTaWduYXR1cmVBUEkoaWR4KQogICAgICBpZiBkcyB+PSBuaWwgdGhlbgogICAgICAgIGlmIGRzLlNpZ25hdHVyZUV4aXN0cyA9PSB0cnVlIHRoZW4KICAgICAgICAgIHJkYi5SZGJBZGRGaWVsZCgiU2lnbmF0dXJlRXhpc3RzIiwgInRydWUiKQogICAgICAgIGVsc2UKICAgICAgICAgIHJkYi5SZGJBZGRGaWVsZCgiU2lnbmF0dXJlRXhpc3RzIiwgImZhbHNlIikgCiAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgaWYgZHMuU2lnbmF0dXJlVmVyaWZpZWQgPT0gdHJ1ZSB0aGVuCiAgICAgICAgICByZGIuUmRiQWRkRmllbGQoIlNpZ25hdHVyZVZlcmlmaWVkIiwgInRydWUiKQogICAgICAgIGVsc2UKICAgICAgICAgIHJkYi5SZGJBZGRGaWVsZCgiU2lnbmF0dXJlVmVyaWZpZWQiLCAiZmFsc2UiKQogICAgICAgIGVuZCAgICAgICAgICAgICAgICAgCiAgICAgICAgCiAgICAgICAgaWYgdHlwZShkcy5EZXNjcmlwdGlvbikgfj0gIm5pbCIgdGhlbgogICAgICAgICAgcmRiLlJkYkFkZEZpZWxkKCJTaWduYXR1cmVEZXNjcmlwdGlvbiIsIGRzLkRlc2NyaXB0aW9uKQogICAgICAgIGVuZAogICAgICAgIGlmIHR5cGUoZHMuQ2VydGlmaWNhdGVTdWJqZWN0KSB+PSAibmlsIiB0aGVuCiAgICAgICAgICByZGIuUmRiQWRkRmllbGQoIkNlcnRpZmljYXRlU3ViamVjdCIsIGRzLkNlcnRpZmljYXRlU3ViamVjdCkKICAgICAgICBlbmQKICAgICAgICBpZiB0eXBlKGRzLkNlcnRpZmljYXRlSXNzdWVyKSB+PSAibmlsIiB0aGVuCiAgICAgICAgICByZGIuUmRiQWRkRmllbGQoIkNlcnRpZmljYXRlSXNzdWVyIiwgZHMuQ2VydGlmaWNhdGVJc3N1ZXIpCiAgICAgICAgZW5kCiAgICAgIGVuZAogICAgZW5kCgogICAgLS0gdGhlIFBFIGRldGFpbHMgd3JpdHRlbiBieSBXcml0ZUZpbGVJdGVtQnlIYW5kbGVBUEkgcHJvZHVjZSBhIGxhcmdlIGFtb3VudAogICAgLS0gb2YgWE1MIGRhdGE7IHRvIHJlZHVjZSBvdXRwdXQsIGV4Y2x1ZGUgdGhpcyBpbmZvIGlmIHRoZSBmaWxlIGlzIHdoaXRlbGlzdGVkCiAgICBpZiBub3QgQXBwQ29tcGF0LmlzX2NlcnRfd2hpdGVsaXN0ZWQoZHMsIEFwcENvbXBhdC5jZXJ0X2lzc3Vlcl93aGl0ZWxpc3QsIEFwcENvbXBhdC5jZXJ0X3N1YmplY3Rfd2hpdGVsaXN0KSB0aGVuCiAgICAgIGZpbGUuV3JpdGVGaWxlSXRlbUJ5SGFuZGxlQVBJKGlkeCkKICAgIGVuZCAtLSBpcyB3aGl0ZWxpc3RlZAogIGVuZAogIAogIGlmIHR5cGUoaWR4KSB+PSAibmlsIiB0aGVuCiAgICBmaWxlLkZpbGVDbG9zZUFQSShpZHgpIAogIGVuZAogIAogIC0tIGVuZCBpdGVtCiAgcmRiLlJkYkVuZEl0ZW0oIkFwcENvbXBhdEl0ZW1FeHRlbmRlZCIpCiAgCiAgLS0gYWRkIHRoZSBpdGVtIHRvIHRoZSBsaXN0IG9mIHByb2Nlc3NlZCBwYXRocwogIEFwcENvbXBhdC5wcm9jZXNzZWRfcGF0aHNbZmlsZV9wYXRoOmxvd2VyKCldID0gdHJ1ZQogIHJldHVybiB0cnVlCmVuZAoKLS0tCi0tIHBhcnNlX2FwcGNvbXBhdCgpCi0tIFBhcnNlcyB0aGUgYXBwY29tcGF0IHJlZ2lzdHJ5IGtleS4KLS0KQXBwQ29tcGF0LnBhcnNlX2FwcGNvbXBhdCA9IGZ1bmN0aW9uKCkKCiAgbG9jYWwgcmVnX3BhcnNlX2Z1bmMgPSBuaWwKICBsb2NhbCByZWdfa2V5X29zID0gbmlsCgogIGxvY2FsIG9zX3ZlciA9IEFwcENvbXBhdC5nZXRfb3MoKQoKICAtLSBiYXNlZCBvbiB0aGUgT1MsIGRldGVybWluZSB0aGV5IHJlZ2lzdHJ5IGtleS92YWx1ZSB0byBwYXJzZSwgYW5kIHRoZSBmdW5jdGlvbgogIC0tIHRvIHVzZSB0byBwYXJzZSB0aGUgcmVnaXN0cnkgZGF0YQogIGlmIG9zX3ZlciA9PSAiWFAiIHRoZW4KICAgIGRlYnVnLmRlYnVnKCJQYXJzaW5nIGFwcGNvbXBhdCBvbiBXaW5kb3dzIFhQIikKICAgIHJlZ19wYXJzZV9mdW5jID0gQXBwQ29tcGF0LmdldF9jYWNoZV9lbnRyeV9udF81XzEKICAgIHJlZ19rZXlfb3MgICAgID0gQXBwQ29tcGF0LkNvbmZpZy5BUFBDT01QQVRfSElWRVMuWFAKCiAgZWxzZWlmIG9zX3ZlciA9PSAiWFA2NC8yMDAzIiB0aGVuCiAgICBkZWJ1Zy5kZWJ1ZygiUGFyc2luZyBhcHBjb21wYXQgb24gV2luZG93cyBYUCAoeDY0KSAvIFNlcnZlciAyMDAzIikKICAgIHJlZ19wYXJzZV9mdW5jID0gQXBwQ29tcGF0LmdldF9jYWNoZV9lbnRyeV9udF81XzIKICAgIHJlZ19rZXlfb3MgICAgID0gQXBwQ29tcGF0LkNvbmZpZy5BUFBDT01QQVRfSElWRVMuVmlzdGEKCiAgZWxzZWlmIG9zX3ZlciA9PSAiVmlzdGEvMjAwOCIgdGhlbgogICAgZGVidWcuZGVidWcoIlBhcnNpbmcgYXBwY29tcGF0IG9uIFZpc3RhIC8gU2VydmVyIDIwMDgiKQogICAgcmVnX3BhcnNlX2Z1bmMgPSBBcHBDb21wYXQuZ2V0X2NhY2hlX2VudHJ5X250XzZfMAogICAgcmVnX2tleV9vcyAgICAgPSBBcHBDb21wYXQuQ29uZmlnLkFQUENPTVBBVF9ISVZFUy5WaXN0YQoKICBlbHNlaWYgb3NfdmVyID09ICI3LzIwMDhSMiIgdGhlbgogICAgZGVidWcuZGVidWcoIlBhcnNpbmcgYXBwY29tcGF0IG9uIFdpbmRvd3MgNyAvIFNlcnZlciAyMDA4UjIiKQogICAgcmVnX3BhcnNlX2Z1bmMgPSBBcHBDb21wYXQuZ2V0X2NhY2hlX2VudHJ5X250XzZfMQogICAgcmVnX2tleV9vcyAgICAgPSBBcHBDb21wYXQuQ29uZmlnLkFQUENPTVBBVF9ISVZFUy5WaXN0YQoKICBlbHNlaWYgb3NfdmVyID09ICI4LzIwMTIiIHRoZW4KICAgIGRlYnVnLmRlYnVnKCJQYXJzaW5nIGFwcGNvbXBhdCBvbiBXaW5kb3dzIDggLyBTZXJ2ZXIgMjAxMiIpCiAgICByZWdfcGFyc2VfZnVuYyA9IEFwcENvbXBhdC5nZXRfY2FjaGVfZW50cnlfbnRfNl8yCiAgICByZWdfa2V5X29zICAgICA9IEFwcENvbXBhdC5Db25maWcuQVBQQ09NUEFUX0hJVkVTLlZpc3RhCgogIGVsc2VpZiBvc192ZXIgPT0gIjguMS8yMDEyUjIiIHRoZW4KICAgIGRlYnVnLmRlYnVnKCJQYXJzaW5nIGFwcGNvbXBhdCBvbiBXaW5kb3dzIDguMSAvIFNlcnZlciAyMDEyUjIiKQogICAgcmVnX3BhcnNlX2Z1bmMgPSBBcHBDb21wYXQuZ2V0X2NhY2hlX2VudHJ5X250XzZfMwogICAgcmVnX2tleV9vcyAgICAgPSBBcHBDb21wYXQuQ29uZmlnLkFQUENPTVBBVF9ISVZFUy5WaXN0YQoKICBlbHNlaWYgb3NfdmVyID09ICIxMCIgdGhlbgogICAgZGVidWcuZGVidWcoIlBhcnNpbmcgYXBwY29tcGF0IG9uIFdpbmRvd3MgMTAiKQogICAgcmVnX3BhcnNlX2Z1bmMgPSBBcHBDb21wYXQuZ2V0X2NhY2hlX2VudHJ5X250XzZfNAogICAgcmVnX2tleV9vcyAgICAgPSBBcHBDb21wYXQuQ29uZmlnLkFQUENPTVBBVF9ISVZFUy5WaXN0YQoKICBlbHNlCiAgICBkZWJ1Zy5kZWJ1ZygiVW5zdXBwb3J0ZWQgb3BlcmF0aW5nIHN5c3RlbTogIiAuLiBvc192ZXIpCiAgICByZXR1cm4gbmlsCiAgZW5kCiAgICAgIAogIGZvciBfLCBoaXZlIGluIGlwYWlycyhBcHBDb21wYXQuQ29uZmlnLkFQUENPTVBBVF9ISVZFUy5oaXZlcykgZG8KCiAgICBsb2NhbCByZWdfa2V5ID0gaGl2ZVsxXSAuLiByZWdfa2V5X29zLnJlZ19rZXkKICAgIGRlYnVnLmRlYnVnKCJQYXJzaW5nIHJlZ2lzdHJ5ICIgLi4gcmVnX2tleSAuLiAiXFwiIC4uIHJlZ19rZXlfb3MucmVnX3ZhbCkKICAgIAogICAgbG9jYWwgY250X2VudHJpZXMgPSAwIC0tIG51bWJlciBvZiBlbnRyaWVzIGluIHRoZSBhcHBjb21wYXQgY2FjaGUKICAgIGxvY2FsIGNudF9zYXZlZCA9IDAgICAtLSBudW1iZXIgb2YgZW50cmllcyB3cml0dGVuIHRvIG91dHB1dCAoc29tZSBtYXkgYmUgd2hpdGVsaXN0ZWQpCgogICAgbG9jYWwgZGF0YSA9IEFwcENvbXBhdC5nZXRfYXBwY29tcGF0X2RhdGEocmVnX2tleSwgcmVnX2tleV9vcy5yZWdfdmFsKQogICAgCiAgICBpZiBkYXRhIHRoZW4KICAgICAgbG9jYWwgZGF0YV9sZW4gPSBzdHJpbmcubGVuKGRhdGEpCiAgICAgIGRlYnVnLmRlYnVnKCJSZWFkICIgLi4gZGF0YV9sZW4gLi4gIiBieXRlcyBmcm9tIHJlZ2lzdHJ5IGtleSIpCiAgICAKICAgICAgbG9jYWwgYmxvY2sgPSBiaW5hcnlwYXJzZXIuQmxvY2soZGF0YSwgMHgwMCkKICAgICAgZm9yIGVudHJ5IGluIHJlZ19wYXJzZV9mdW5jKGJsb2NrLCBkYXRhX2xlbikuZWFjaCgpIGRvCiAgICAgICAgY250X2VudHJpZXMgPSBjbnRfZW50cmllcyArIDEKICAgICAgICBsb2NhbCBzdWNjZXNzID0gQXBwQ29tcGF0LndyaXRlX2FwcGNvbXBhdChyZWdfa2V5LCBoaXZlWzJdLCBlbnRyeSkKICAgICAgICBpZiBzdWNjZXNzIHRoZW4KICAgICAgICAgIGNudF9zYXZlZCA9IGNudF9zYXZlZCArIDEKICAgICAgICBlbmQKICAgICAgZW5kCiAgICBlbHNlCiAgICAgIGRlYnVnLmRlYnVnKCJBcHBjb21wYXQgZGF0YSBub3QgZm91bmQgaW4gaGl2ZSIpCiAgICBlbmQKCiAgICBkZWJ1Zy5kZWJ1ZygiUHJvY2Vzc2VkICIgLi4gY250X2VudHJpZXMgLi4gIiBhcHBjb21wYXQgZW50cmllcyIpCiAgICBkZWJ1Zy5kZWJ1ZygiV3JvdGUgIiAuLiBjbnRfc2F2ZWQgLi4gIiBhcHBjb21wYXQgZW50cmllcyIpCgogICAgLS0gdW5sZXNzIGV4cGxpY2l0bHkgcmVxdWVzdGVkLCBzdG9wIHByb2Nlc3NpbmcgYWZ0ZXIgcGFyc2luZyAKICAgIC0tIEN1cnJlbnRDb250cm9sU2V0OwogICAgaWYgQXBwQ29tcGF0LnBhcnNlX2FsbF9jdHJsX3NldHMgfj0gdHJ1ZSB0aGVuCiAgICAgIGJyZWFrCiAgICBlbmQKICBlbmQKZW5kCgpmdW5jdGlvbiBtYWluKCkgCiAgZGVidWcuZW5hYmxlX3N0ZG91dCA9IGZhbHNlCiAgQXBwQ29tcGF0LmluY2x1ZGVfZmlsZV9kZXRhaWxzID0gdHJ1ZQogIEFwcENvbXBhdC5wYXJzZV9hbGxfY3RybF9zZXRzICA9IHRydWUKICAKICByZGIuUmRiU3RhcnREb2N1bWVudCgiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiLAogICAgICAgICAgICAgICAgICAgICAgICJ3MzJzY3JpcHRpbmctcGVyc2lzdGVuY2UiLAogICAgICAgICAgICAgICAgICAgICAgICJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSIsCiAgICAgICAgICAgICAgICAgICAgICAgInczMnNjcmlwdGluZy1wZXJzaXN0ZW5jZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIjEuNC40Ny4wIikKICBBcHBDb21wYXQucGFyc2VfYXBwY29tcGF0KCkKICByZGIuUmRiRW5kRG9jdW1lbnQoKQplbmQKbWFpbigp</value>
            </param>
          </parameters>
        </config>
      </command>
    </commands>
  </script>
</command>
